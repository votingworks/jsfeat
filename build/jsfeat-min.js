!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).jsfeat=r()}(this,(function(){"use strict";var t={REVISION:"ALPHA"},r=new Int32Array(96);const a=function(r,a,e,f){var o=0,i=0,n=0,c=0,s=0,h=0,u=t.cache.get_buffer(r<<2),d=u.f32;if(1==(1&r)&&r<=7&&a<=0)switch(r>>1){case 0:d[0]=1,h=1;break;case 1:d[0]=.25,d[1]=.5,d[2]=.25,h=1;break;case 2:d[0]=.0625,d[1]=.25,d[2]=.375,d[3]=.25,d[4]=.0625,h=1;break;case 3:d[0]=.03125,d[1]=.109375,d[2]=.21875,d[3]=.28125,d[4]=.21875,d[5]=.109375,d[6]=.03125,h=1}else for(s=-.5/((c=a>0?a:.3*(.5*(r-1)-1)+.8)*c);o<r;++o)i=o-.5*(r-1),n=Math.exp(s*i*i),d[o]=n,h+=n;if(f&t.U8_t)for(h=256/h,o=0;o<r;++o)e[o]=d[o]*h+.5|0;else for(h=1/h,o=0;o<r;++o)e[o]=d[o]*h;t.cache.put_buffer(u)},e=function(t,r,a){for(var e,f=0,o=0,i=0,n=r+a>>1;;){if(a<=r)return t[n];if(a==r+1)return t[r]>t[a]&&(e=t[r],t[r]=t[a],t[a]=e),t[n];for(t[f=r+a>>1]>t[a]&&(e=t[f],t[f]=t[a],t[a]=e),t[r]>t[a]&&(e=t[r],t[r]=t[a],t[a]=e),t[f]>t[r]&&(e=t[f],t[f]=t[r],t[r]=e),o=r+1,e=t[f],t[f]=t[o],t[o]=e,i=a;;){do{++o}while(t[r]>t[o]);do{--i}while(t[i]>t[r]);if(i<o)break;e=t[o],t[o]=t[i],t[i]=e}e=t[r],t[r]=t[i],t[i]=e,i<=n?r=o:i>=n&&(a=i-1)}};var f=Object.freeze({__proto__:null,get_gaussian_kernel:a,perspective_4point_transform:function(t,r,a,e,f,o,i,n,c,s,h,u,d,_,l,b,v){var p=r,y=s,x=i,m=p*y*x,w=l,M=p*w,g=y*M,k=h,z=p*k,A=o,C=a,O=_,R=C*O,S=R*A,L=O*A*k,I=O*x,U=O*k,q=y*x,G=w*y,F=w*A,B=k*A,N=1/(I-U-q+G-F+B),E=p*O,P=C*A,V=x*p,j=w*V,T=C*y,Y=R*k,D=C*k*A,Q=x*w*y,X=w*C,H=-(g-m+z*A-A*M-R*y+S-L+I*y)*N,J=(m-g-E*x+E*k+S-y*P+F*y-L)*N,K=p,W=(-k*M+j+T*x-R*x+Y-D+F*k-Q)*N,Z=(V*k-j-X*y+Y-D+X*A+Q-I*k)*N,$=C,tt=(-z+V+T-P+U-I-G+F)*N,rt=(-M+z+R-T+F-B-I+q)*N,at=-((g=(y=u)*(M=(p=e)*(w=v)))-(m=p*y*(x=c))+(z=p*(k=d))*(A=n)-A*M-(R=(C=f)*(O=b))*y+(S=R*A)-(L=O*A*k)+(I=O*x)*y)*(N=1/(I-(U=O*k)-(q=y*x)+(G=w*y)-(F=w*A)+(B=k*A))),et=(m-g-(E=p*O)*x+E*k+S-y*(P=C*A)+F*y-L)*N,ft=p,ot=(-k*M+(j=w*(V=x*p))+(T=C*y)*x-R*x+(Y=R*k)-(D=C*k*A)+F*k-(Q=x*w*y))*N,it=(V*k-j-(X=w*C)*y+Y-D+X*A+Q-I*k)*N,nt=C,ct=(-z+V+T-P+U-I-G+F)*N,st=(-M+z+R-T+F-B-I+q)*N,ht=K*tt;S=$*tt-W;var ut=-W*rt+Z*tt,dt=H-ht;P=H*rt-(z=J*tt);var _t=(m=H*$)-(g=K*W),lt=(x=H*Z)-(M=W*J);D=(y=Z-rt*$)*(O=1/(x-m*rt-M+g*rt+z*$-ht*Z));var bt=(B=K*rt-J)*O,vt=(V=-J*$+K*Z)*O,pt=t.data;pt[0]=at*D+et*(S*O)-ft*(ut*O),pt[1]=at*bt+et*(dt*O)-ft*(P*O),pt[2]=-at*vt-et*(_t*O)+ft*(lt*O),pt[3]=ot*D+it*(S*O)-nt*(ut*O),pt[4]=ot*bt+it*(dt*O)-nt*(P*O),pt[5]=-ot*vt-it*(_t*O)+nt*(lt*O),pt[6]=ct*D+st*(S*O)-ut*O,pt[7]=ct*bt+st*(dt*O)-P*O,pt[8]=-ct*vt-st*(_t*O)+lt*O},qsort:function(t,a,e,f){var o,i,n,c,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=0,A=0,C=r;if(!(e-a+1<=1))for(C[0]=a,C[1]=e;s>=0;)for(h=C[s<<1],u=C[1+(s<<1)],s--;;){if((_=u-h+1)<=7){for(b=h+1;b<=u;b++)for(v=b;v>h&&f(t[v],t[v-1]);v--)o=t[v],t[v]=t[v-1],t[v-1]=o;break}for(A=0,y=h,m=u,M=h+(_>>1),_>40&&(k=h+(p=_>>3),z=h+(p<<1),i=t[g=h],n=t[k],c=t[z],h=f(i,n)?f(n,c)?k:f(i,c)?z:g:f(c,n)?k:f(i,c)?g:z,k=M,z=M+p,i=t[g=M-p],n=t[k],c=t[z],M=f(i,n)?f(n,c)?k:f(i,c)?z:g:f(c,n)?k:f(i,c)?g:z,k=u-p,z=u,i=t[g=u-(p<<1)],n=t[k],c=t[z],u=f(i,n)?f(n,c)?k:f(i,c)?z:g:f(c,n)?k:f(i,c)?g:z),k=M,z=u,i=t[g=h],n=t[k],c=t[z],(M=f(i,n)?f(n,c)?k:f(i,c)?z:g:f(c,n)?k:f(i,c)?g:z)!=y&&(o=t[M],t[M]=t[y],t[y]=o,M=y),h=x=y+1,u=w=m,i=t[M];;){for(;h<=u&&!f(i,t[h]);)f(t[h],i)||(h>x&&(o=t[x],t[x]=t[h],t[h]=o),A=1,x++),h++;for(;h<=u&&!f(t[u],i);)f(i,t[u])||(u<w&&(o=t[w],t[w]=t[u],t[u]=o),A=1,w--),u--;if(h>u)break;o=t[h],t[h]=t[u],t[u]=o,A=1,h++,u--}if(0==A){for(u=m,b=(h=y)+1;b<=u;b++)for(v=b;v>h&&f(t[v],t[v-1]);v--)o=t[v],t[v]=t[v-1],t[v-1]=o;break}for(l=h-(_=Math.min(x-y,h-x))|0,d=0;d<_;++d,++l)o=t[y+d],t[y+d]=t[l],t[l]=o;for(l=m-(_=Math.min(m-w,w-u))+1|0,d=0;d<_;++d,++l)o=t[h+d],t[h+d]=t[l],t[l]=o;if(l=w-u,(_=h-x)>1)l>1?_>l?(C[++s<<1]=y,C[1+(s<<1)]=y+_-1,h=m-l+1,u=m):(C[++s<<1]=m-l+1,C[1+(s<<1)]=m,h=y,u=y+_-1):(h=y,u=y+_-1);else{if(!(l>1))break;h=m-l+1,u=m}}},median:e});const o=function(r,a,e,f){var o=r.rows,i=r.cols;o>f&&i>e&&(a.resize(e,f,r.channel),r.type&t.U8_t&&a.type&t.U8_t&&o*i/(f*e)<256?function(r,a,e,f){for(var o=0,i=r.channel,n=r.cols,c=r.rows,s=r.data,h=a.data,u=n/e,d=c/f,_=u*d*65536|0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=0,A=0,C=0,O=0,R=0,S=t.cache.get_buffer(e*i<<2),L=t.cache.get_buffer(e*i<<2),I=t.cache.get_buffer(2*n*3<<2),U=S.i32,q=L.i32,G=I.i32;l<e;l++){for(y=(M=l*u)+1-1e-6|0,x=0|(g=M+u),y=Math.min(y,n-1),x=Math.min(x,n-1),y>M&&(G[w++]=l*i|0,G[w++]=(y-1)*i|0,G[w++]=256*(y-M)|0,o++),v=y;v<x;v++)o++,G[w++]=l*i|0,G[w++]=v*i|0,G[w++]=256;g-x>.001&&(o++,G[w++]=l*i|0,G[w++]=x*i|0,G[w++]=256*(g-x)|0)}for(l=0;l<e*i;l++)U[l]=q[l]=0;for(b=0,p=0;p<c;p++){for(k=n*p,w=0;w<o;w++)for(A=G[3*w],y=G[3*w+1],C=G[3*w+2],m=0;m<i;m++)U[A+m]+=s[k+y+m]*C;if((b+1)*d<=p+1||p==c-1){if(R=256-(O=256*Math.max(p+1-(b+1)*d,0)|0),z=e*b,O<=0)for(l=0;l<e*i;l++)h[z+l]=Math.min(Math.max((q[l]+256*U[l])/_,0),255),q[l]=U[l]=0;else for(l=0;l<e*i;l++)h[z+l]=Math.min(Math.max((q[l]+U[l]*R)/_,0),255),q[l]=U[l]*O,U[l]=0;b++}else for(l=0;l<e*i;l++)q[l]+=256*U[l],U[l]=0}t.cache.put_buffer(L),t.cache.put_buffer(S),t.cache.put_buffer(I)}(r,a,e,f):function(r,a,e,f){for(var o=0,i=r.channel,n=r.cols,c=r.rows,s=r.data,h=a.data,u=n/e,d=c/f,_=1/(u*d),l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=0,A=0,C=0,O=0,R=0,S=t.cache.get_buffer(e*i<<2),L=t.cache.get_buffer(e*i<<2),I=t.cache.get_buffer(2*n*3<<2),U=S.f32,q=L.f32,G=I.f32;l<e;l++){for(y=(M=l*u)+1-1e-6|0,x=0|(g=M+u),y=Math.min(y,n-1),x=Math.min(x,n-1),y>M&&(o++,G[w++]=(y-1)*i|0,G[w++]=l*i|0,G[w++]=(y-M)*_),v=y;v<x;v++)o++,G[w++]=v*i|0,G[w++]=l*i|0,G[w++]=_;g-x>.001&&(o++,G[w++]=x*i|0,G[w++]=l*i|0,G[w++]=(g-x)*_)}for(l=0;l<e*i;l++)U[l]=q[l]=0;for(b=0,p=0;p<c;p++){for(k=n*p,w=0;w<o;w++)for(y=0|G[3*w],A=0|G[3*w+1],C=G[3*w+2],m=0;m<i;m++)U[A+m]+=s[k+y+m]*C;if((b+1)*d<=p+1||p==c-1){if(R=1-(O=Math.max(p+1-(b+1)*d,0)),z=e*b,Math.abs(O)<.001)for(l=0;l<e*i;l++)h[z+l]=q[l]+U[l],q[l]=U[l]=0;else for(l=0;l<e*i;l++)h[z+l]=q[l]+U[l]*R,q[l]=U[l]*O,U[l]=0;b++}else for(l=0;l<e*i;l++)q[l]+=U[l],U[l]=0}t.cache.put_buffer(L),t.cache.put_buffer(S),t.cache.put_buffer(I)}(r,a,e,f))},i=function(t,r,a,e){void 0===a&&(a=0),void 0===e&&(e=0);var f=t.cols,o=f>>1,i=t.rows>>1,n=o-(a<<1),c=i-(e<<1),s=0,h=0,u=a+e*f,d=0,_=0,l=0;r.resize(o,i,t.channel);var b=t.data,v=r.data;for(h=0;h<c;++h){for(d=u,l=_,s=0;s<=n-2;s+=2,l+=2,d+=4)v[l]=b[d]+b[d+1]+b[d+f]+b[d+f+1]+2>>2,v[l+1]=b[d+2]+b[d+3]+b[d+f+2]+b[d+f+3]+2>>2;for(;s<n;++s,++l,d+=2)v[l]=b[d]+b[d+1]+b[d+f]+b[d+f+1]+2>>2;u+=f<<1,_+=o}},n=function(r,a){var e,f,o,i,n,c,s,h,u=r.cols,d=r.rows,_=u<<1,l=0,b=0,v=0,p=0,y=0,x=0,m=0;a.resize(u,d,2);var w=r.data,M=a.data,g=t.cache.get_buffer(u+2<<2),k=t.cache.get_buffer(u+2<<2);for(r.type&t.U8_t||r.type&t.S32_t?(s=g.i32,h=k.i32):(s=g.f32,h=k.f32);b<d;++b,y+=u){for(p=(b>0?b-1:1)*u|0,x=(b<d-1?b+1:d-2)*u|0,m=b*_|0,l=0,v=1;l<=u-2;l+=2,v+=2)e=w[p+l],f=w[x+l],s[v]=3*(e+f)+10*w[y+l],h[v]=f-e,e=w[p+l+1],f=w[x+l+1],s[v+1]=3*(e+f)+10*w[y+l+1],h[v+1]=f-e;for(;l<u;++l,++v)e=w[p+l],f=w[x+l],s[v]=3*(e+f)+10*w[y+l],h[v]=f-e;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)e=h[l+2],f=h[l+1],o=h[l+3],i=h[l+4],n=s[l+2],c=s[l+3],M[m++]=n-s[l],M[m++]=3*(e+h[l])+10*f,M[m++]=c-s[l+1],M[m++]=3*(o+f)+10*e,M[m++]=s[l+4]-n,M[m++]=3*(i+e)+10*o,M[m++]=s[l+5]-c,M[m++]=3*(h[l+5]+o)+10*i;for(;l<u;++l)M[m++]=s[l+2]-s[l],M[m++]=3*(h[l+2]+h[l])+10*h[l+1]}t.cache.put_buffer(g),t.cache.put_buffer(k)},c=function(r,a){var e,f,o,i,n,c,s,h,u=r.cols,d=r.rows,_=u<<1,l=0,b=0,v=0,p=0,y=0,x=0,m=0;a.resize(u,d,2);var w=r.data,M=a.data,g=t.cache.get_buffer(u+2<<2),k=t.cache.get_buffer(u+2<<2);for(r.type&t.U8_t||r.type&t.S32_t?(s=g.i32,h=k.i32):(s=g.f32,h=k.f32);b<d;++b,y+=u){for(p=(b>0?b-1:1)*u|0,x=(b<d-1?b+1:d-2)*u|0,m=b*_|0,l=0,v=1;l<=u-2;l+=2,v+=2)e=w[p+l],f=w[x+l],s[v]=e+f+2*w[y+l],h[v]=f-e,e=w[p+l+1],f=w[x+l+1],s[v+1]=e+f+2*w[y+l+1],h[v+1]=f-e;for(;l<u;++l,++v)e=w[p+l],f=w[x+l],s[v]=e+f+2*w[y+l],h[v]=f-e;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)e=h[l+2],f=h[l+1],o=h[l+3],i=h[l+4],n=s[l+2],c=s[l+3],M[m++]=n-s[l],M[m++]=e+h[l]+2*f,M[m++]=c-s[l+1],M[m++]=o+f+2*e,M[m++]=s[l+4]-n,M[m++]=i+e+2*o,M[m++]=s[l+5]-c,M[m++]=h[l+5]+o+2*i;for(;l<u;++l)M[m++]=s[l+2]-s[l],M[m++]=h[l+2]+h[l]+2*h[l+1]}t.cache.put_buffer(g),t.cache.put_buffer(k)},s=function(t,r,a,e){void 0===e&&(e=0);for(var f=t.cols,o=t.rows,i=r.cols,n=r.rows,c=t.data,s=r.data,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=a.data,M=w[0],g=w[1],k=w[2],z=w[3],A=w[4],C=w[5],O=0;u<n;++u)for(b=g*u+k,v=A*u+C,h=0;h<i;++h,++O,b+=M,v+=z)l=0|v,(_=0|b)>=0&&l>=0&&_<f-1&&l<o-1?(p=b-_,y=v-l,x=c[d=f*l+_]+p*(c[d+1]-c[d]),m=c[d+f]+p*(c[d+f+1]-c[d+f]),s[O]=x+y*(m-x)):s[O]=e};var h,u,d,_,l,b,v,p,y,x=Object.freeze({__proto__:null,grayscale:function(r,a,e,f,o){void 0===o&&(o=t.COLOR_RGBA2GRAY);var i=0,n=0,c=0,s=0,h=0,u=0,d=4899,_=1868,l=4;o!=t.COLOR_BGRA2GRAY&&o!=t.COLOR_BGR2GRAY||(d=1868,_=4899),o!=t.COLOR_RGB2GRAY&&o!=t.COLOR_BGR2GRAY||(l=3);var b=l<<1,v=3*l|0;f.resize(a,e,1);var p=f.data;for(n=0;n<e;++n,s+=a,c+=a*l){for(i=0,h=c,u=s;i<=a-4;i+=4,h+=l<<2,u+=4)p[u]=r[h]*d+9617*r[h+1]+r[h+2]*_+8192>>14,p[u+1]=r[h+l]*d+9617*r[h+l+1]+r[h+l+2]*_+8192>>14,p[u+2]=r[h+b]*d+9617*r[h+b+1]+r[h+b+2]*_+8192>>14,p[u+3]=r[h+v]*d+9617*r[h+v+1]+r[h+v+2]*_+8192>>14;for(;i<a;++i,++u,h+=l)p[u]=r[h]*d+9617*r[h+1]+r[h+2]*_+8192>>14}},resample:o,box_blur_gray:function(r,a,e,f){void 0===f&&(f=0);var o=r.cols,i=r.rows,n=i<<1,c=o<<1,s=0,h=0,u=0,d=0,_=1+(e<<1)|0,l=e+1|0,b=l+1|0,v=f&t.BOX_BLUR_NOSCALE?1:1/(_*_),p=t.cache.get_buffer(o*i<<2),y=0,x=0,m=0,w=0,M=0,g=p.i32,k=r.data,z=0;for(a.resize(o,i,r.channel),u=0;u<i;++u){for(x=u,y=l*k[m],s=m+1|0,d=m+e|0;s<=d;++s)y+=k[s];for(w=m+l|0,z=k[M=m],h=0;h<e;++h,x+=i)g[x]=y,y+=k[w]-z,w++;for(;h<o-b;h+=2,x+=n)g[x]=y,y+=k[w]-k[M],g[x+i]=y,y+=k[w+1]-k[M+1],w+=2,M+=2;for(;h<o-l;++h,x+=i)g[x]=y,y+=k[w]-k[M],w++,M++;for(z=k[w-1];h<o;++h,x+=i)g[x]=y,y+=z-k[M],M++;m+=o}if(m=0,k=a.data,1==v)for(u=0;u<o;++u){for(x=u,y=l*g[m],s=m+1|0,d=m+e|0;s<=d;++s)y+=g[s];for(w=m+l,z=g[M=m],h=0;h<e;++h,x+=o)k[x]=y,y+=g[w]-z,w++;for(;h<i-b;h+=2,x+=c)k[x]=y,y+=g[w]-g[M],k[x+o]=y,y+=g[w+1]-g[M+1],w+=2,M+=2;for(;h<i-l;++h,x+=o)k[x]=y,y+=g[w]-g[M],w++,M++;for(z=g[w-1];h<i;++h,x+=o)k[x]=y,y+=z-g[M],M++;m+=i}else for(u=0;u<o;++u){for(x=u,y=l*g[m],s=m+1|0,d=m+e|0;s<=d;++s)y+=g[s];for(w=m+l,z=g[M=m],h=0;h<e;++h,x+=o)k[x]=y*v,y+=g[w]-z,w++;for(;h<i-b;h+=2,x+=c)k[x]=y*v,y+=g[w]-g[M],k[x+o]=y*v,y+=g[w+1]-g[M+1],w+=2,M+=2;for(;h<i-l;++h,x+=o)k[x]=y*v,y+=g[w]-g[M],w++,M++;for(z=g[w-1];h<i;++h,x+=o)k[x]=y*v,y+=z-g[M],M++;m+=i}t.cache.put_buffer(p)},gaussian_blur:function(r,e,f,o){void 0===o&&(o=0),void 0===f&&(f=0);var i=(f=0==f?2*Math.max(1,4*o+1-1e-8)+1|0:f)>>1,n=r.cols,c=r.rows,s=r.type,h=s&t.U8_t;e.resize(n,c,r.channel);var u,d,_=r.data,l=e.data,b=f+Math.max(c,n)|0,v=t.cache.get_buffer(b<<2),p=t.cache.get_buffer(f<<2);h?(u=v.i32,d=p.i32):s&t.S32_t?(u=v.i32,d=p.f32):(u=v.f32,d=p.f32),a(f,o,d,s),h?function(t,r,a,e,f,o,i,n){for(var c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=o[0],y=0,x=e<<1,m=3*e,w=e<<2;c<f;++c){for(_=r[u],s=0;s<n;++s)t[s]=_;for(s=0;s<=e-2;s+=2)t[s+n]=r[u+s],t[s+n+1]=r[u+s+1];for(;s<e;++s)t[s+n]=r[u+s];for(_=r[u+e-1],s=e;s<n+e;++s)t[s+n]=_;for(s=0;s<=e-4;s+=4){for(_=t[s]*p,l=t[s+1]*p,b=t[s+2]*p,v=t[s+3]*p,h=1;h<i;++h)y=o[h],_+=t[h+s]*y,l+=t[h+s+1]*y,b+=t[h+s+2]*y,v+=t[h+s+3]*y;a[d+s]=Math.min(_>>8,255),a[d+s+1]=Math.min(l>>8,255),a[d+s+2]=Math.min(b>>8,255),a[d+s+3]=Math.min(v>>8,255)}for(;s<e;++s){for(_=t[s]*p,h=1;h<i;++h)_+=t[h+s]*o[h];a[d+s]=Math.min(_>>8,255)}u+=e,d+=e}for(c=0;c<e;++c){for(_=a[c],s=0;s<n;++s)t[s]=_;for(h=c,s=0;s<=f-2;s+=2,h+=x)t[s+n]=a[h],t[s+n+1]=a[h+e];for(;s<f;++s,h+=e)t[s+n]=a[h];for(_=a[(f-1)*e+c],s=f;s<n+f;++s)t[s+n]=_;for(d=c,s=0;s<=f-4;s+=4,d+=w){for(_=t[s]*p,l=t[s+1]*p,b=t[s+2]*p,v=t[s+3]*p,h=1;h<i;++h)y=o[h],_+=t[h+s]*y,l+=t[h+s+1]*y,b+=t[h+s+2]*y,v+=t[h+s+3]*y;a[d]=Math.min(_>>8,255),a[d+e]=Math.min(l>>8,255),a[d+x]=Math.min(b>>8,255),a[d+m]=Math.min(v>>8,255)}for(;s<f;++s,d+=e){for(_=t[s]*p,h=1;h<i;++h)_+=t[h+s]*o[h];a[d]=Math.min(_>>8,255)}}}(u,_,l,n,c,d,f,i):function(t,r,a,e,f,o,i,n){for(var c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=o[0],y=0,x=e<<1,m=3*e,w=e<<2;c<f;++c){for(_=r[u],s=0;s<n;++s)t[s]=_;for(s=0;s<=e-2;s+=2)t[s+n]=r[u+s],t[s+n+1]=r[u+s+1];for(;s<e;++s)t[s+n]=r[u+s];for(_=r[u+e-1],s=e;s<n+e;++s)t[s+n]=_;for(s=0;s<=e-4;s+=4){for(_=t[s]*p,l=t[s+1]*p,b=t[s+2]*p,v=t[s+3]*p,h=1;h<i;++h)y=o[h],_+=t[h+s]*y,l+=t[h+s+1]*y,b+=t[h+s+2]*y,v+=t[h+s+3]*y;a[d+s]=_,a[d+s+1]=l,a[d+s+2]=b,a[d+s+3]=v}for(;s<e;++s){for(_=t[s]*p,h=1;h<i;++h)_+=t[h+s]*o[h];a[d+s]=_}u+=e,d+=e}for(c=0;c<e;++c){for(_=a[c],s=0;s<n;++s)t[s]=_;for(h=c,s=0;s<=f-2;s+=2,h+=x)t[s+n]=a[h],t[s+n+1]=a[h+e];for(;s<f;++s,h+=e)t[s+n]=a[h];for(_=a[(f-1)*e+c],s=f;s<n+f;++s)t[s+n]=_;for(d=c,s=0;s<=f-4;s+=4,d+=w){for(_=t[s]*p,l=t[s+1]*p,b=t[s+2]*p,v=t[s+3]*p,h=1;h<i;++h)y=o[h],_+=t[h+s]*y,l+=t[h+s+1]*y,b+=t[h+s+2]*y,v+=t[h+s+3]*y;a[d]=_,a[d+e]=l,a[d+x]=b,a[d+m]=v}for(;s<f;++s,d+=e){for(_=t[s]*p,h=1;h<i;++h)_+=t[h+s]*o[h];a[d]=_}}}(u,_,l,n,c,d,f,i),t.cache.put_buffer(v),t.cache.put_buffer(p)},hough_transform:function(t,r,a,e){for(var f=t.data,o=t.cols,i=t.rows,n=o,c=Math.PI,s=Math.round((c-0)/a),h=Math.round((2*(o+i)+1)/r),u=1/r,d=new Int32Array((s+2)*(h+2)),_=new Float32Array(s),l=new Float32Array(s),b=0,v=0;b<s;b++)_[b]=Math.sin(v)*u,l[b]=Math.cos(v)*u,v+=a;for(var p=0;p<i;p++)for(var y=0;y<o;y++)if(0!=f[p*n+y])for(let t=0;t<s;t++){var x=Math.round(y*l[t]+p*_[t]);d[(t+1)*(h+2)+(x+=(h-1)/2)+1]+=1}var m=new Array;for(let t=0;t<h;t++)for(let r=0;r<s;r++){var w=(r+1)*(h+2)+t+1;d[w]>e&&d[w]>d[w-1]&&d[w]>=d[w+1]&&d[w]>d[w-h-2]&&d[w]>=d[w+h+2]&&m.push(w)}m.sort((function(t,r){return d[t]>d[r]||d[t]==d[r]&&t<r}));var M=Math.min(s*h,m.length),g=1/(h+2),k=new Array;for(let t=0;t<M;t++){var z=m[t];let e=Math.floor(z*g)-1;var A=(z-(e+1)*(h+2)-1-.5*(h-1))*r,C=e*a;k.push([A,C])}return k},pyrdown:i,scharr_derivatives:n,sobel_derivatives:c,compute_integral_image:function(t,r,a,e){var f=0|t.cols,o=0|t.rows,i=t.data,n=f+1|0,c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0;if(r&&a){for(;d<n;++d)r[d]=0,a[d]=0;for(h=n+1|0,u=1,d=0,b=0;d<o;++d,++h,++u){for(c=s=0,_=0;_<=f-2;_+=2,b+=2,h+=2,u+=2)c+=l=i[b],s+=l*l,r[h]=r[u]+c,a[h]=a[u]+s,c+=l=i[b+1],s+=l*l,r[h+1]=r[u+1]+c,a[h+1]=a[u+1]+s;for(;_<f;++_,++b,++h,++u)c+=l=i[b],s+=l*l,r[h]=r[u]+c,a[h]=a[u]+s}}else if(r){for(;d<n;++d)r[d]=0;for(h=n+1|0,u=1,d=0,b=0;d<o;++d,++h,++u){for(c=0,_=0;_<=f-2;_+=2,b+=2,h+=2,u+=2)c+=i[b],r[h]=r[u]+c,c+=i[b+1],r[h+1]=r[u+1]+c;for(;_<f;++_,++b,++h,++u)c+=i[b],r[h]=r[u]+c}}else if(a){for(;d<n;++d)a[d]=0;for(h=n+1|0,u=1,d=0,b=0;d<o;++d,++h,++u){for(s=0,_=0;_<=f-2;_+=2,b+=2,h+=2,u+=2)s+=(l=i[b])*l,a[h]=a[u]+s,s+=(l=i[b+1])*l,a[h+1]=a[u+1]+s;for(;_<f;++_,++b,++h,++u)s+=(l=i[b])*l,a[h]=a[u]+s}}if(e){for(d=0;d<n;++d)e[d]=0;for(h=n+1|0,u=0,d=0,b=0;d<o;++d,++h,++u){for(_=0;_<=f-2;_+=2,b+=2,h+=2,u+=2)e[h]=i[b]+e[u],e[h+1]=i[b+1]+e[u+1];for(;_<f;++_,++b,++h,++u)e[h]=i[b]+e[u]}for(h=n+f|0,u=f,d=0;d<o;++d,h+=n,u+=n)e[h]+=e[u];for(_=f-1;_>0;--_)for(u=(h=_+o*n)-n,d=o;d>0;--d,h-=n,u-=n)e[h]+=e[u]+e[u+1]}},equalize_histogram:function(r,a){var e=r.cols,f=r.rows,o=r.data;a.resize(e,f,r.channel);var i,n,c=a.data,s=e*f,h=0,u=0,d=t.cache.get_buffer(1024);for(i=d.i32;h<256;++h)i[h]=0;for(h=0;h<s;++h)++i[o[h]];for(u=i[0],h=1;h<256;++h)u=i[h]+=u;for(n=255/s,h=0;h<s;++h)c[h]=i[o[h]]*n+.5|0;t.cache.put_buffer(d)},canny:function(r,a,e,f){var o=r.cols,i=r.rows;a.resize(o,i,r.channel);var n=a.data,s=0,h=0,u=0,d=o<<1,_=0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=t.cache.get_buffer(i*d<<2),M=t.cache.get_buffer(3*(o+2)<<2),g=t.cache.get_buffer((i+2)*(o+2)<<2),k=t.cache.get_buffer(i*o<<2),z=M.i32,A=g.i32,C=k.i32,O=w.i32,R=new t.matrix_t(o,i,t.S32C2_t,w.data),S=1,L=o+2+1|0,I=2*(o+2)+1|0,U=o+2|0,q=U+1|0,G=0;for(c(r,R),e>f&&(s=e,e=f,f=s),s=3*(o+2)|0;--s>=0;)z[s]=0;for(s=(i+2)*(o+2)|0;--s>=0;)A[s]=0;for(;h<o;++h,u+=2)v=O[u],p=O[u+1],z[L+h]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(s=1;s<=i;++s,u+=d){if(s==i)for(h=I+o;--h>=I;)z[h]=0;else for(h=0;h<o;h++)v=O[u+(h<<1)],p=O[u+(h<<1)+1],z[I+h]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(_=u-d|0,A[q-1]=0,l=0,h=0;h<o;++h,_+=2){if((b=z[L+h])>e)if(y=(v=O[_])^(p=O[_+1]),p=(p^p>>31)-(p>>31)|0,m=(x=13573*(v=(v^v>>31)-(v>>31)|0))+(v+v<<15),(p<<=15)<x){if(b>z[L+h-1]&&b>=z[L+h+1]){b>f&&!l&&2!=A[q+h-U]?(A[q+h]=2,l=1,C[G++]=q+h):A[q+h]=1;continue}}else if(p>m){if(b>z[S+h]&&b>=z[I+h]){b>f&&!l&&2!=A[q+h-U]?(A[q+h]=2,l=1,C[G++]=q+h):A[q+h]=1;continue}}else if(b>z[S+h-(y=y<0?-1:1)]&&b>z[I+h+y]){b>f&&!l&&2!=A[q+h-U]?(A[q+h]=2,l=1,C[G++]=q+h):A[q+h]=1;continue}A[q+h]=0,l=0}A[q+o]=0,q+=U,h=S,S=L,L=I,I=h}for(h=q-U-1,s=0;s<U;++s,++h)A[h]=0;for(;G>0;)q=C[--G],1==A[q-=U+1]&&(A[q]=2,C[G++]=q),1==A[q+=1]&&(A[q]=2,C[G++]=q),1==A[q+=1]&&(A[q]=2,C[G++]=q),1==A[q+=U]&&(A[q]=2,C[G++]=q),1==A[q-=2]&&(A[q]=2,C[G++]=q),1==A[q+=U]&&(A[q]=2,C[G++]=q),1==A[q+=1]&&(A[q]=2,C[G++]=q),1==A[q+=1]&&(A[q]=2,C[G++]=q);for(q=U+1,S=0,s=0;s<i;++s,q+=U)for(h=0;h<o;++h)n[S++]=255*(2==A[q+h]);t.cache.put_buffer(w),t.cache.put_buffer(M),t.cache.put_buffer(g),t.cache.put_buffer(k)},warp_perspective:function(t,r,a,e){void 0===e&&(e=0);for(var f=0|t.cols,o=0|t.rows,i=0|r.cols,n=0|r.rows,c=t.data,s=r.data,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=a.data,A=z[0],C=z[1],O=z[2],R=z[3],S=z[4],L=z[5],I=z[6],U=z[7],q=z[8],G=0;u<n;++u)for(p=C*u+O,y=S*u+L,x=U*u+q,h=0;h<i;++h,++G,p+=A,y+=R,x+=I)_=0|(b=p*(m=1/x)),l=0|(v=y*m),b>0&&v>0&&_<f-1&&l<o-1?(w=Math.max(b-_,0),M=Math.max(v-l,0),g=c[d=f*l+_|0]+w*(c[d+1]-c[d]),k=c[d+f]+w*(c[d+f+1]-c[d+f]),s[G]=g+M*(k-g)):s[G]=e},warp_affine:s,skindetector:function(t,r){for(var a,e,f,o,i=t.width*t.height;i--;)o=4*i,a=t.data[o],e=t.data[o+1],f=t.data[o+2],a>95&&e>40&&f>20&&a>e&&a>f&&a-Math.min(e,f)>15&&Math.abs(a-e)>15?r[i]=255:r[i]=0}});h=t,u=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),d=function(t){return 65280&t},_=function(t){return 255&t},l=function(t){return u[(65280&t)>>8]},b=function(t,r){this.size=-8&(t+7|0),void 0===r?this.buffer=new ArrayBuffer(this.size):(this.buffer=r,this.size=r.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)},v=function(){function t(t,r,a,e){this.type=0|d(a),this.channel=0|_(a),this.cols=0|t,this.rows=0|r,void 0===e?this.allocate():(this.buffer=e,this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new b(this.cols*l(this.type)*this.channel*this.rows),this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var r=t.data,a=this.data,e=0,f=this.cols*this.rows*this.channel|0;e<f-4;e+=4)r[e]=a[e],r[e+1]=a[e+1],r[e+2]=a[e+2],r[e+3]=a[e+3];for(;e<f;++e)r[e]=a[e]},t.prototype.resize=function(t,r,a){void 0===a&&(a=this.channel),t*l(this.type)*a*r>this.buffer.size?(this.cols=t,this.rows=r,this.channel=a,this.allocate()):(this.cols=t,this.rows=r,this.channel=a)},t}(),p=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=i}return t.prototype.allocate=function(t,r,a){for(var e=this.levels;--e>=0;)this.data[e]=new v(t>>e,r>>e,a)},t.prototype.build=function(t,r){void 0===r&&(r=!0);var a=2,e=t,f=this.data[0];if(!r)for(var o=t.cols*t.rows;--o>=0;)f.data[o]=t.data[o];for(f=this.data[1],this.pyrdown(e,f);a<this.levels;++a)e=f,f=this.data[a],this.pyrdown(e,f)},t}(),y=function(t,r,a,e,f){void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===e&&(e=0),void 0===f&&(f=-1),this.x=t,this.y=r,this.score=a,this.level=e,this.angle=f},h.U8_t=256,h.S32_t=512,h.F32_t=1024,h.S64_t=2048,h.F64_t=4096,h.C1_t=1,h.C2_t=2,h.C3_t=3,h.C4_t=4,h.U8C1_t=257,h.U8C3_t=259,h.U8C4_t=260,h.F32C1_t=1025,h.F32C2_t=1026,h.S32C1_t=513,h.S32C2_t=514,h.EPSILON=1.192092896e-7,h.FLT_MIN=1e-37,h.COLOR_RGBA2GRAY=0,h.COLOR_RGB2GRAY=1,h.COLOR_BGRA2GRAY=2,h.COLOR_BGR2GRAY=3,h.BOX_BLUR_NOSCALE=1,h.SVD_U_T=1,h.SVD_V_T=2,h.get_data_type=d,h.get_channel=_,h.get_data_type_size=l,h.data_t=b,h.matrix_t=v,h.pyramid_t=p,h.keypoint_t=y,function(r){var a,e,f,o=(f=function(){function r(r){this.next=null,this.data=new t.data_t(r),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return r.prototype.resize=function(r){delete this.data,this.data=new t.data_t(r),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},r}(),{allocate:function(t,r){a=e=new f(r);for(var o=0;o<t;++o){var i=new f(r);e=e.next=i}},get_buffer:function(t){var r=a;return a=a.next,t>r.size&&r.resize(t),r},put_buffer:function(t){e=e.next=t}});r.cache=o,o.allocate(30,2560)}(t);const m=function(t,r){for(var a=0,e=0,f=r.rows,o=r.cols,i=0,n=0,c=0,s=r.data,h=t.data;a<f;n+=1,i+=o,a++)for(c=n,e=0;e<o;c+=f,e++)h[c]=s[i+e]},w=function(t,r,a){for(var e=0,f=0,o=0,i=0,n=0,c=0,s=0,h=0,u=r.cols,d=r.rows,_=a.cols,l=r.data,b=a.data,v=t.data,p=0;e<u;i++,e++)for(s=0,f=0;f<_;h++,s++,f++){for(c=s,n=i,p=0,o=0;o<d;n+=u,c+=_,o++)p+=l[n]*b[c];v[h]=p}},M=function(t,r){for(var a=0,e=0,f=0,o=0,i=0,n=0,c=0,s=0,h=0,u=r.cols,d=r.rows,_=r.data,l=t.data,b=0;a<u;c+=u,a++)for(o=a,s=h=c+a,e=a;e<u;s++,h+=u,e++){for(i=o,n=e,b=0,f=0;f<d;i+=u,n+=u,f++)b+=_[i]*_[n];l[s]=b,l[h]=b}},g=function(t,r){var a=t.data,e=r.data,f=a[4],o=a[8],i=a[5],n=a[7],c=a[0],s=c*f,h=c*i,u=a[3],d=a[1],_=u*d,l=a[2],b=u*l,v=a[6],p=v*d,y=v*l,x=1/(s*o-h*n-_*o+b*n+p*i-y*f);e[0]=(f*o-i*n)*x,e[1]=-(d*o-l*n)*x,e[2]=-(-d*i+l*f)*x,e[3]=-(u*o-i*v)*x,e[4]=(c*o-y)*x,e[5]=-(h-b)*x,e[6]=-(-u*n+f*v)*x,e[7]=-(c*n-p)*x,e[8]=(s-_)*x},k=function(t,r,a){var e=t.data,f=r.data,o=a.data,i=f[0],n=f[1],c=f[2],s=f[3],h=f[4],u=f[5],d=f[6],_=f[7],l=f[8],b=o[0],v=o[1],p=o[2],y=o[3],x=o[4],m=o[5],w=o[6],M=o[7],g=o[8];e[0]=i*b+n*y+c*w,e[1]=i*v+n*x+c*M,e[2]=i*p+n*m+c*g,e[3]=s*b+h*y+u*w,e[4]=s*v+h*x+u*M,e[5]=s*p+h*m+u*g,e[6]=d*b+_*y+l*w,e[7]=d*v+_*x+l*M,e[8]=d*p+_*m+l*g},z=function(t,r,a,e,f,o,i,n,c){return t*f*c-t*o*n-e*r*c+e*a*n+i*r*o-i*a*f};var A=Object.freeze({__proto__:null,identity:function(t,r){void 0===r&&(r=1);for(var a=t.data,e=t.rows,f=t.cols,o=f+1|0,i=e*f,n=i;--i>=0;)a[i]=0;for(i=n,n=0;n<i;)a[n]=r,n+=o},transpose:m,multiply:function(t,r,a){for(var e=0,f=0,o=0,i=0,n=0,c=0,s=0,h=0,u=r.cols,d=r.rows,_=a.cols,l=r.data,b=a.data,v=t.data,p=0;e<d;i+=u,e++)for(s=0,f=0;f<_;h++,s++,f++){for(c=s,n=i,p=0,o=0;o<u;n++,c+=_,o++)p+=l[n]*b[c];v[h]=p}},multiply_ABt:function(t,r,a){for(var e=0,f=0,o=0,i=0,n=0,c=0,s=0,h=r.cols,u=r.rows,d=a.rows,_=r.data,l=a.data,b=t.data,v=0;e<u;i+=h,e++)for(c=0,f=0;f<d;s++,f++){for(n=i,v=0,o=0;o<h;n++,c++,o++)v+=_[n]*l[c];b[s]=v}},multiply_AtB:w,multiply_AAt:function(t,r){for(var a=0,e=0,f=0,o=0,i=0,n=0,c=0,s=0,h=0,u=r.cols,d=r.rows,_=r.data,l=t.data,b=0;a<d;o+=d+1,i=n,a++)for(s=o,h=o,c=i,e=a;e<d;s++,h+=d,e++){for(n=i,b=0,f=0;f<u;f++)b+=_[n++]*_[c++];l[s]=b,l[h]=b}},multiply_AtA:M,identity_3x3:function(t,r){void 0===r&&(r=1);var a=t.data;a[0]=a[4]=a[8]=r,a[1]=a[2]=a[3]=0,a[5]=a[6]=a[7]=0},invert_3x3:g,multiply_3x3:k,mat3x3_determinant:function(t){var r=t.data;return r[0]*r[4]*r[8]-r[0]*r[5]*r[7]-r[3]*r[1]*r[8]+r[3]*r[2]*r[7]+r[6]*r[1]*r[5]-r[6]*r[2]*r[4]},determinant_3x3:z}),C=function(t,r,a,e){e=t[r],t[r]=t[a],t[a]=e},O=function(t,r){return(t=Math.abs(t))>(r=Math.abs(r))?(r/=t,t*Math.sqrt(1+r*r)):r>0?(t/=r,r*Math.sqrt(1+t*t)):0};const R=function(r,a){var e,f,o,i,n=0,c=0,s=0,h=r.cols,u=r.data,d=a.data;for(n=0;n<h;n++){for(s=n,c=n+1;c<h;c++)Math.abs(u[c*h+n])>Math.abs(u[s*h+n])&&(s=c);if(Math.abs(u[s*h+n])<t.EPSILON)return 0;if(s!=n){for(c=n;c<h;c++)C(u,n*h+c,s*h+c,e);C(d,n,s,e)}for(o=-1/u[n*h+n],c=n+1;c<h;c++){for(f=u[c*h+n]*o,s=n+1;s<h;s++)u[c*h+s]+=f*u[n*h+s];d[c]+=f*d[n]}u[n*h+n]=-o}for(n=h-1;n>=0;n--){for(i=d[n],s=n+1;s<h;s++)i-=u[n*h+s]*d[s];d[n]=i*u[n*h+n]}return 1},S=function(r,a,e){for(var f=r.cols,o=f*f,i=r.type|t.C1_t,n=t.cache.get_buffer(f*f<<3),c=t.cache.get_buffer(f<<3),s=new t.matrix_t(f,f,i,n.data),h=new t.matrix_t(1,f,i,c.data);--o>=0;)s.data[o]=r.data[o];if(function(r,a,e,f,o,i){var n=t.EPSILON,c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=i*i*30,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=0,A=0,R=t.cache.get_buffer(i<<2),S=t.cache.get_buffer(i<<2),L=R.i32,I=S.i32;if(f)for(;c<i;c++){for(h=c*o,s=0;s<i;s++)f[h+s]=0;f[h+c]=1}for(h=0;h<i;h++){if(e[h]=r[(a+1)*h],h<i-1){for(u=h+1,y=Math.abs(r[a*h+u]),c=h+2;c<i;c++)y<(x=Math.abs(r[a*h+c]))&&(y=x,u=c);L[h]=u}if(h>0){for(u=0,y=Math.abs(r[h]),c=1;c<h;c++)y<(x=Math.abs(r[a*c+h]))&&(y=x,u=c);I[h]=u}}if(i>1)for(;v<p;v++){for(h=0,y=Math.abs(r[L[0]]),c=1;c<i-1;c++)y<(x=Math.abs(r[a*c+L[c]]))&&(y=x,h=c);for(d=L[h],c=1;c<i;c++)y<(x=Math.abs(r[a*I[c]+c]))&&(y=x,h=I[c],d=c);if(m=r[a*h+d],Math.abs(m)<=n)break;for(w=.5*(e[d]-e[h]),k=(M=Math.abs(w)+O(m,w))/(g=O(m,M)),g=m/g,M=m/M*m,w<0&&(g=-g,M=-M),r[a*h+d]=0,e[h]-=M,e[d]+=M,c=0;c<h;c++)b=a*c+d,z=r[l=a*c+h],A=r[b],r[l]=z*k-A*g,r[b]=z*g+A*k;for(c=h+1;c<d;c++)b=a*c+d,z=r[l=a*h+c],A=r[b],r[l]=z*k-A*g,r[b]=z*g+A*k;for(l=a*h+(c=d+1),b=a*d+c;c<i;c++,l++,b++)z=r[l],A=r[b],r[l]=z*k-A*g,r[b]=z*g+A*k;if(f)for(l=o*h,b=o*d,c=0;c<i;c++,l++,b++)z=f[l],A=f[b],f[l]=z*k-A*g,f[b]=z*g+A*k;for(s=0;s<2;s++){if((_=0==s?h:d)<i-1){for(u=_+1,y=Math.abs(r[a*_+u]),c=_+2;c<i;c++)y<(x=Math.abs(r[a*_+c]))&&(y=x,u=c);L[_]=u}if(_>0){for(u=0,y=Math.abs(r[_]),c=1;c<_;c++)y<(x=Math.abs(r[a*c+_]))&&(y=x,u=c);I[_]=u}}}for(h=0;h<i-1;h++){for(u=h,c=h+1;c<i;c++)e[u]<e[c]&&(u=c);if(h!=u&&(C(e,u,h,y),f))for(c=0;c<i;c++)C(f,o*u+c,o*h+c,y)}t.cache.put_buffer(R),t.cache.put_buffer(S)}(s.data,f,h.data,a?a.data:null,f,f),e)for(;--f>=0;)e.data[f]=h.data[f];t.cache.put_buffer(n),t.cache.put_buffer(c)};var L=Object.freeze({__proto__:null,lu_solve:R,cholesky_solve:function(t,r){var a,e,f=0,o=0,i=0,n=0,c=0,s=0,h=0,u=t.cols,d=t.data,_=r.data;for(f=0;f<u;f++)for(e=1,c=n=f*u,o=f;o<u;o++){for(a=d[c+f],i=0;i<f;i++)a-=d[i*u+f]*d[c+i];if(o==f){if(d[c+f]=a,0==a)return 0;e=1/a}else d[n+o]=a,d[c+f]=a*e;c+=u}for(n=0,s=0;s<u;s++){for(a=_[s],h=0;h<s;h++)a-=d[n+h]*_[h];_[s]=a,n+=u}for(n=0,s=0;s<u;s++)_[s]/=d[n+s],n+=u;for(s=u-1;s>=0;s--){for(a=_[s],n=(h=s+1)*u;h<u;h++)a-=d[n+s]*_[h],n+=u;_[s]=a}return 1},svd_decompose:function(r,a,e,f,o){void 0===o&&(o=0);var i=0,n=0,c=r.rows,s=r.cols,h=c,u=s,d=r.type|t.C1_t;h<u&&(i=1,n=h,h=u,u=n);var _=t.cache.get_buffer(h*h<<3),l=t.cache.get_buffer(u<<3),b=t.cache.get_buffer(u*u<<3),v=new t.matrix_t(h,h,d,_.data),p=new t.matrix_t(1,u,d,l.data),y=new t.matrix_t(u,u,d,b.data);if(0==i)m(v,r);else{for(n=0;n<s*c;n++)v.data[n]=r.data[n];for(;n<u*h;n++)v.data[n]=0}if(function(r,a,e,f,o,i,n,c){for(var s=2*t.EPSILON,h=t.FLT_MIN,u=0,d=0,_=0,l=0,b=Math.max(i,30),v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=0,A=0,R=0,S=0,L=0,I=0,U=0,q=0,G=4660,F=0,B=0,N=0,E=t.cache.get_buffer(n<<3),P=E.f64;u<n;u++){for(_=0,A=0;_<i;_++)A+=(g=r[u*a+_])*g;if(P[u]=A,f){for(_=0;_<n;_++)f[u*o+_]=0;f[u*o+u]=1}}for(;l<b;l++){for(m=0,u=0;u<n-1;u++)for(d=u+1;d<n;d++){for(v=u*a|0,p=d*a|0,I=P[u],U=0,q=P[d],_=2,U+=r[v]*r[p],U+=r[v+1]*r[p+1];_<i;_++)U+=r[v+_]*r[p+_];if(!(Math.abs(U)<=s*Math.sqrt(I*q))){for(S=O(U*=2,R=I-q),R<0?(L=.5*(S-R),w=U/(S*(M=Math.sqrt(L/S))*2)):M=U/(S*(w=Math.sqrt((S+R)/(2*S)))*2),I=0,q=0,_=2,k=w*r[v]+M*r[p],z=-M*r[v]+w*r[p],r[v]=k,r[p]=z,I+=k*k,q+=z*z,k=w*r[v+1]+M*r[p+1],z=-M*r[v+1]+w*r[p+1],r[v+1]=k,r[p+1]=z,I+=k*k,q+=z*z;_<i;_++)k=w*r[v+_]+M*r[p+_],z=-M*r[v+_]+w*r[p+_],r[v+_]=k,r[p+_]=z,I+=k*k,q+=z*z;if(P[u]=I,P[d]=q,m=1,f)for(x=d*o|0,_=2,k=w*f[y=u*o|0]+M*f[x],z=-M*f[y]+w*f[x],f[y]=k,f[x]=z,k=w*f[y+1]+M*f[x+1],z=-M*f[y+1]+w*f[x+1],f[y+1]=k,f[x+1]=z;_<n;_++)k=w*f[y+_]+M*f[x+_],z=-M*f[y+_]+w*f[x+_],f[y+_]=k,f[x+_]=z}}if(0==m)break}for(u=0;u<n;u++){for(_=0,A=0;_<i;_++)A+=(g=r[u*a+_])*g;P[u]=Math.sqrt(A)}for(u=0;u<n-1;u++){for(d=u,_=u+1;_<n;_++)P[d]<P[_]&&(d=_);if(u!=d&&(C(P,u,d,A),f)){for(_=0;_<i;_++)C(r,u*a+_,d*a+_,g);for(_=0;_<n;_++)C(f,u*o+_,d*o+_,g)}}for(u=0;u<n;u++)e[u]=P[u];if(f){for(u=0;u<c;u++){for(A=u<n?P[u]:0;A<=h;){for(B=1/i,_=0;_<i;_++)F=0!=(256&(G=214013*G+2531011)>>16)?B:-B,r[u*a+_]=F;for(l=0;l<2;l++)for(d=0;d<u;d++){for(A=0,_=0;_<i;_++)A+=r[u*a+_]*r[d*a+_];for(N=0,_=0;_<i;_++)g=r[u*a+_]-A*r[d*a+_],r[u*a+_]=g,N+=Math.abs(g);for(N=N?1/N:0,_=0;_<i;_++)r[u*a+_]*=N}for(A=0,_=0;_<i;_++)A+=(g=r[u*a+_])*g;A=Math.sqrt(A)}for(M=1/A,_=0;_<i;_++)r[u*a+_]*=M}t.cache.put_buffer(E)}else t.cache.put_buffer(E)}(v.data,h,p.data,y.data,u,h,u,h),a){for(n=0;n<u;n++)a.data[n]=p.data[n];for(;n<s;n++)a.data[n]=0}if(0==i){if(e&&o&t.SVD_U_T)for(n=h*h;--n>=0;)e.data[n]=v.data[n];else e&&m(e,v);if(f&&o&t.SVD_V_T)for(n=u*u;--n>=0;)f.data[n]=y.data[n];else f&&m(f,y)}else{if(e&&o&t.SVD_U_T)for(n=u*u;--n>=0;)e.data[n]=y.data[n];else e&&m(e,y);if(f&&o&t.SVD_V_T)for(n=h*h;--n>=0;)f.data[n]=v.data[n];else f&&m(f,v)}t.cache.put_buffer(_),t.cache.put_buffer(l),t.cache.put_buffer(b)},svd_solve:function(r,a,e){var f,o=0,i=0,n=0,c=0,s=0,h=r.rows,u=r.cols,d=0,_=0,l=r.type|t.C1_t,b=t.cache.get_buffer(h*h<<3),v=t.cache.get_buffer(u<<3),p=t.cache.get_buffer(u*u<<3),y=new t.matrix_t(h,h,l,b.data),x=new t.matrix_t(1,u,l,v.data),m=new t.matrix_t(u,u,l,p.data),w=e.data,M=y.data,g=x.data,k=m.data;for(this.svd_decompose(r,x,y,m,0),f=t.EPSILON*g[0]*u;o<u;o++,s+=u){for(_=0,i=0;i<u;i++)if(g[i]>f){for(n=0,d=0,c=0;n<h;n++,c+=u)d+=M[c+i]*w[n];_+=d*k[s+i]/g[i]}a.data[o]=_}t.cache.put_buffer(b),t.cache.put_buffer(v),t.cache.put_buffer(p)},svd_invert:function(r,a){var e,f=0,o=0,i=0,n=0,c=0,s=0,h=a.rows,u=a.cols,d=0,_=a.type|t.C1_t,l=t.cache.get_buffer(h*h<<3),b=t.cache.get_buffer(u<<3),v=t.cache.get_buffer(u*u<<3),p=new t.matrix_t(h,h,_,l.data),y=new t.matrix_t(1,u,_,b.data),x=new t.matrix_t(u,u,_,v.data),m=r.data,w=p.data,M=y.data,g=x.data;for(this.svd_decompose(a,y,p,x,0),e=t.EPSILON*M[0]*u;f<u;f++,c+=u)for(o=0,n=0;o<h;o++,s++){for(i=0,d=0;i<u;i++,n++)M[i]>e&&(d+=g[c+i]*w[n]/M[i]);m[s]=d}t.cache.put_buffer(l),t.cache.put_buffer(b),t.cache.put_buffer(v)},eigenVV:S});!function(r){var a,f,o,i,n,c,s,h,u,d,_=(a=function(t){return t*t},f=new t.matrix_t(3,3,t.F32_t|t.C1_t),o=new t.matrix_t(3,3,t.F32_t|t.C1_t),i=new t.matrix_t(6,6,t.F32_t|t.C1_t),n=new t.matrix_t(6,1,t.F32_t|t.C1_t),c=function(){function r(){}return r.prototype.run=function(r,a,e,c){var s,h,u=0,d=0,_=e.type|t.C1_t,l=e.data,b=f.data,v=o.data,p=0,y=0;!function(t,r,a,e,f){for(var o,i,n=0,c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0;n<f;++n)c+=t[n].x,s+=t[n].y,u+=r[n].x,d+=r[n].y;for(c/=f,s/=f,u/=f,d/=f,n=0;n<f;++n)l=t[n].x-c,b=t[n].y-s,h+=Math.sqrt(l*l+b*b),l=r[n].x-u,b=r[n].y-d,_+=Math.sqrt(l*l+b*b);h/=f,_/=f,o=Math.SQRT2/h,i=Math.SQRT2/_,a[0]=a[4]=o,a[2]=-c*o,a[5]=-s*o,a[1]=a[3]=a[6]=a[7]=0,a[8]=1,e[0]=e[4]=i,e[2]=-u*i,e[5]=-d*i,e[1]=e[3]=e[6]=e[7]=0,e[8]=1}(r,a,b,v,c);for(var x=t.cache.get_buffer(2*c*6<<3),m=t.cache.get_buffer(2*c<<3),z=new t.matrix_t(6,2*c,_,x.data),A=new t.matrix_t(1,2*c,_,m.data),C=z.data,O=A.data;u<c;++u)s=r[u],h=a[u],p=b[0]*s.x+b[1]*s.y+b[2],y=b[3]*s.x+b[4]*s.y+b[5],C[d=2*u*6]=p,C[d+1]=y,C[d+2]=1,C[d+3]=0,C[d+4]=0,C[d+5]=0,C[d+=6]=0,C[d+1]=0,C[d+2]=0,C[d+3]=p,C[d+4]=y,C[d+5]=1,O[u<<1]=v[0]*h.x+v[1]*h.y+v[2],O[1+(u<<1)]=v[3]*h.x+v[4]*h.y+v[5];return M(i,z),w(n,z,A),R(i,n),l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=0,l[7]=0,l[8]=1,g(o,o),k(e,o,e),k(e,e,f),t.cache.put_buffer(x),t.cache.put_buffer(m),1},r.prototype.error=function(t,r,e,f,o){for(var i,n,c=0,s=e.data;c<o;++c)i=t[c],n=r[c],f[c]=a(n.x-s[0]*i.x-s[1]*i.y-s[2])+a(n.y-s[3]*i.x-s[4]*i.y-s[5])},r.prototype.check_subset=function(){return!0},r}(),s=new t.matrix_t(9,9,t.F32_t|t.C1_t),h=new t.matrix_t(9,9,t.F32_t|t.C1_t),{affine2d:c,homography2d:function(){function r(){}return r.prototype.run=function(r,a,e,i){for(var n=0,c=0,u=e.data,d=f.data,_=o.data,l=s.data,b=h.data,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,z=0,A=0,C=0,O=0;n<i;++n)M+=a[n].x,g+=a[n].y,C+=r[n].x,O+=r[n].y;for(M/=i,g/=i,C/=i,O/=i,n=0;n<i;++n)m+=Math.abs(a[n].x-M),w+=Math.abs(a[n].y-g),z+=Math.abs(r[n].x-C),A+=Math.abs(r[n].y-O);if(Math.abs(m)<t.EPSILON||Math.abs(w)<t.EPSILON||Math.abs(z)<t.EPSILON||Math.abs(A)<t.EPSILON)return 0;for(m=i/m,w=i/w,z=i/z,A=i/A,d[0]=z,d[1]=0,d[2]=-C*z,d[3]=0,d[4]=A,d[5]=-O*A,d[6]=0,d[7]=0,d[8]=1,_[0]=1/m,_[1]=0,_[2]=M,_[3]=0,_[4]=1/w,_[5]=g,_[6]=0,_[7]=0,_[8]=1,n=81;--n>=0;)l[n]=0;for(n=0;n<i;++n)v=(a[n].x-M)*m,p=(a[n].y-g)*w,y=(r[n].x-C)*z,x=(r[n].y-O)*A,l[0]+=y*y,l[1]+=y*x,l[2]+=y,l[6]+=y*-v*y,l[7]+=y*-v*x,l[8]+=y*-v,l[10]+=x*x,l[11]+=x,l[15]+=x*-v*y,l[16]+=x*-v*x,l[17]+=x*-v,l[20]+=1,l[24]+=-v*y,l[25]+=-v*x,l[26]+=-v,l[30]+=y*y,l[31]+=y*x,l[32]+=y,l[33]+=y*-p*y,l[34]+=y*-p*x,l[35]+=y*-p,l[40]+=x*x,l[41]+=x,l[42]+=x*-p*y,l[43]+=x*-p*x,l[44]+=x*-p,l[50]+=1,l[51]+=-p*y,l[52]+=-p*x,l[53]+=-p,l[60]+=-v*y*-v*y+-p*y*-p*y,l[61]+=-v*y*-v*x+-p*y*-p*x,l[62]+=-v*y*-v+-p*y*-p,l[70]+=-v*x*-v*x+-p*x*-p*x,l[71]+=-v*x*-v+-p*x*-p,l[80]+=-v*-v+-p*-p;for(n=0;n<9;++n)for(c=0;c<n;++c)l[9*n+c]=l[9*c+n];return S(s,h),u[0]=b[72],u[1]=b[73],u[2]=b[74],u[3]=b[75],u[4]=b[76],u[5]=b[77],u[6]=b[78],u[7]=b[79],u[8]=b[80],k(e,o,e),k(e,e,f),v=1/u[8],u[0]*=v,u[1]*=v,u[2]*=v,u[3]*=v,u[4]*=v,u[5]*=v,u[6]*=v,u[7]*=v,u[8]=1,1},r.prototype.error=function(t,r,a,e,f){for(var o,i,n=0,c=0,s=0,h=0,u=a.data;n<f;++n)o=t[n],i=r[n],c=1/(u[6]*o.x+u[7]*o.y+1),s=(u[0]*o.x+u[1]*o.y+u[2])*c-i.x,h=(u[3]*o.x+u[4]*o.y+u[5])*c-i.y,e[n]=s*s+h*h},r.prototype.check_subset=function(t,r,a){if(4==a){var e=0,f=t[0],o=t[1],i=t[2],n=t[3],c=r[0],s=r[1],h=r[2],u=r[3],d=f.x,_=f.y,l=o.x,b=o.y,v=i.x,p=i.y,y=c.x,x=c.y,m=s.x,w=s.y,M=h.x,g=h.y,k=z(d,_,1,l,b,1,v,p,1),A=z(y,x,1,m,w,1,M,g,1);if(k*A<0&&e++,d=o.x,_=o.y,l=i.x,b=i.y,v=n.x,p=n.y,y=s.x,x=s.y,m=h.x,w=h.y,M=u.x,g=u.y,(k=z(d,_,1,l,b,1,v,p,1))*(A=z(y,x,1,m,w,1,M,g,1))<0&&e++,d=f.x,_=f.y,l=i.x,b=i.y,v=n.x,p=n.y,y=c.x,x=c.y,m=h.x,w=h.y,M=u.x,g=u.y,(k=z(d,_,1,l,b,1,v,p,1))*(A=z(y,x,1,m,w,1,M,g,1))<0&&e++,d=f.x,_=f.y,l=o.x,b=o.y,v=n.x,p=n.y,y=c.x,x=c.y,m=s.x,w=s.y,M=u.x,g=u.y,(k=z(d,_,1,l,b,1,v,p,1))*(A=z(y,x,1,m,w,1,M,g,1))<0&&e++,0!=e&&4!=e)return!1}return!0},r}()}),l=function(){function t(t,r,a,e){void 0===t&&(t=0),void 0===r&&(r=.5),void 0===a&&(a=.5),void 0===e&&(e=.99),this.size=t,this.thresh=r,this.eps=a,this.prob=e}return t.prototype.update_iters=function(t,r){var a=Math.log(1-this.prob),e=Math.log(1-Math.pow(1-t,this.size));return 0|(e>=0||-a>=r*-e?r:Math.round(a/e))},t}(),b=(u=function(t,r,a,e,f,o,i){for(var n=[],c=0,s=0,h=0,u=0,d=!1;h<1e3;++h){for(c=0;c<e&&h<1e3;){for(d=!1,u=0;!d;)for(d=!0,u=n[c]=0|Math.floor(Math.random()*f),s=0;s<c;++s)if(u==n[s]){d=!1;break}o[c]=r[u],i[c]=a[u],t.check_subset(o,i,c+1)?++c:h++}break}return c==e&&h<1e3},d=function(t,r,a,e,f,o,i,n){var c=0,s=0,h=0,u=o*o;for(t.error(a,e,r,i,f);s<f;++s)h=i[s]<=u,n[s]=h,c+=h;return c},{ransac:function(r,a,e,f,o,i,n,c){if(void 0===c&&(c=1e3),o<r.size)return!1;var s=r.size,h=c,_=0,l=!1,b=[],v=[],p=i.cols,y=i.rows,x=i.type|t.C1_t,m=t.cache.get_buffer(p*y<<3),w=t.cache.get_buffer(o),M=t.cache.get_buffer(o<<2),g=new t.matrix_t(p,y,x,m.data),k=new t.matrix_t(o,1,t.U8C1_t,w.data),z=-1,A=0,C=M.f32;if(o==s){if(a.run(e,f,g,o)<=0)return t.cache.put_buffer(m),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;if(g.copy_to(i),n)for(;--o>=0;)n.data[o]=1;return t.cache.put_buffer(m),t.cache.put_buffer(w),t.cache.put_buffer(M),!0}for(;_<h;++_){if(!u(a,e,f,s,o,b,v)){if(0==_)return t.cache.put_buffer(m),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;break}a.run(b,v,g,s)<=0||(A=d(a,g,e,f,o,r.thresh,C,k.data))>Math.max(z,s-1)&&(g.copy_to(i),z=A,n&&k.copy_to(n),h=r.update_iters((o-A)/o,h),l=!0)}return t.cache.put_buffer(m),t.cache.put_buffer(w),t.cache.put_buffer(M),l},lmeds:function(r,a,f,o,i,n,c,s){if(void 0===s&&(s=1e3),i<r.size)return!1;var h=r.size,_=s,l=0,b=!1,v=[],p=[],y=n.cols,x=n.rows,m=n.type|t.C1_t,w=t.cache.get_buffer(y*x<<3),M=t.cache.get_buffer(i),g=t.cache.get_buffer(i<<2),k=new t.matrix_t(y,x,m,w.data),z=new t.matrix_t(i,1,t.U8_t|t.C1_t,M.data),A=0,C=g.f32,O=1e9,R=0,S=0;if(r.eps=.45,_=r.update_iters(r.eps,_),i==h){if(a.run(f,o,k,i)<=0)return t.cache.put_buffer(w),t.cache.put_buffer(M),t.cache.put_buffer(g),!1;if(k.copy_to(n),c)for(;--i>=0;)c.data[i]=1;return t.cache.put_buffer(w),t.cache.put_buffer(M),t.cache.put_buffer(g),!0}for(;l<_;++l){if(!u(a,f,o,h,i,v,p)){if(0==l)return t.cache.put_buffer(w),t.cache.put_buffer(M),t.cache.put_buffer(g),!1;break}a.run(v,p,k,h)<=0||(a.error(f,o,k,C,i),(S=e(C,0,i-1))<O&&(O=S,k.copy_to(n),b=!0))}return b&&(R=2.5*1.4826*(1+5/(i-h))*Math.sqrt(O),R=Math.max(R,.001),A=d(a,n,f,o,i,R,C,z.data),c&&z.copy_to(c),b=A>=h),t.cache.put_buffer(w),t.cache.put_buffer(M),t.cache.put_buffer(g),b}});r.ransac_params_t=l,r.motion_model=_,r.motion_estimator=b}(t);var I=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),U=new Uint8Array(512),q=new Int32Array(25),G=new Int32Array(25),F=function(t,r,a,e,f){for(var o=0,i=t[r],n=f,c=0,s=0,h=0;o<25;++o)e[o]=i-t[r+a[o]];for(o=0;o<16;o+=2)c=Math.min(e[o+1],e[o+2]),(c=Math.min(c,e[o+3]))<=n||(c=Math.min(c,e[o+4]),c=Math.min(c,e[o+5]),c=Math.min(c,e[o+6]),c=Math.min(c,e[o+7]),c=Math.min(c,e[o+8]),n=Math.max(n,Math.min(c,e[o])),n=Math.max(n,Math.min(c,e[o+9])));for(s=-n,o=0;o<16;o+=2)h=Math.max(e[o+1],e[o+2]),h=Math.max(h,e[o+3]),h=Math.max(h,e[o+4]),(h=Math.max(h,e[o+5]))>=s||(h=Math.max(h,e[o+6]),h=Math.max(h,e[o+7]),h=Math.max(h,e[o+8]),s=Math.min(s,Math.max(h,e[o])),s=Math.min(s,Math.max(h,e[o+9])));return-s-1},B=20;const N=function(t){B=Math.min(Math.max(t,0),255);for(var r=-255;r<=255;++r)U[r+255]=r<-B?1:r>B?2:0;return B};N(20);var E=Object.freeze({__proto__:null,set_threshold:N,detect:function(r,a,e){void 0===e&&(e=3);var f,o=r.data,i=r.cols,n=r.rows,c=0,s=0,h=0,u=0,d=0,_=t.cache.get_buffer(3*i),l=t.cache.get_buffer(3*(i+1)<<2),b=_.u8,v=l.i32,p=q,y=G,x=Math.max(3,e),m=Math.min(n-2,n-e),w=Math.max(3,e),M=Math.min(i-3,i-e),g=0,k=0,z=F,A=U,C=B,O=0,R=0,S=0,L=0,N=0,E=0,P=0,V=0,j=0,T=0,Y=0,D=0;!function(t,r,a){for(var e=0,f=I;e<a;++e)t[e]=f[e<<1]+f[1+(e<<1)]*r;for(;e<25;++e)t[e]=t[e-a]}(p,i,16);var Q=p[0],X=p[1],H=p[2],J=p[3],K=p[4],W=p[5],Z=p[6],$=p[7],tt=p[8],rt=p[9],at=p[10],et=p[11],ft=p[12],ot=p[13],it=p[14],nt=p[15];for(c=0;c<3*i;++c)b[c]=0;for(c=x;c<m;++c){for(P=c*i+w|0,E=(d=(c-3)%3)*i|0,N=d*(i+1)|0,s=0;s<i;++s)b[E+s]=0;if(L=0,c<m-1)for(s=w;s<M;++s,++P)if(0!=(S=A[(R=255-(O=o[P]))+o[P+Q]]|A[R+o[P+tt]])&&(S&=A[R+o[P+H]]|A[R+o[P+at]],S&=A[R+o[P+K]]|A[R+o[P+ft]],0!=(S&=A[R+o[P+Z]]|A[R+o[P+it]]))){if(S&=A[R+o[P+X]]|A[R+o[P+rt]],S&=A[R+o[P+J]]|A[R+o[P+et]],S&=A[R+o[P+W]]|A[R+o[P+ot]],1&(S&=A[R+o[P+$]]|A[R+o[P+nt]]))for(u=O-C,g=0,h=0;h<25;++h)if(o[P+p[h]]<u){if(++g>8){v[N+ ++L]=s,b[E+s]=z(o,P,p,y,C);break}}else g=0;if(2&S)for(u=O+C,g=0,h=0;h<25;++h)if(o[P+p[h]]>u){if(++g>8){v[N+ ++L]=s,b[E+s]=z(o,P,p,y,C);break}}else g=0}if(v[N+i]=L,c!=x)for(V=(d=(c-4+3)%3)*i|0,N=d*(i+1)|0,j=(d=(c-5+3)%3)*i|0,L=v[N+i],h=0;h<L;++h)T=(s=v[N+h])+1|0,Y=s-1|0,(D=b[V+s])>b[V+T]&&D>b[V+Y]&&D>b[j+Y]&&D>b[j+s]&&D>b[j+T]&&D>b[E+Y]&&D>b[E+s]&&D>b[E+T]&&((f=a[k]).x=s,f.y=c-1,f.score=D,k++)}return t.cache.put_buffer(_),t.cache.put_buffer(l),k}});!function(r){var a,e=(a=function(t,r,a,e,f,o,i){var n=-2*t[r]+t[r+e]+t[r-e],c=-2*t[r]+t[r+f]+t[r-f],s=t[r+o]+t[r-o]-t[r+i]-t[r-i],h=0|Math.sqrt((n-c)*(n-c)+4*s*s);return Math.min(Math.abs(a-h),Math.abs(-(a+h)))},{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(r,e,f){void 0===f&&(f=5);var o,i=0,n=0,c=r.cols,s=r.rows,h=r.data,u=5*c|0,d=3+3*c|0,_=3-3*c|0,l=t.cache.get_buffer(c*s<<2),b=l.i32,v=0,p=0,y=0,x=0,m=0,w=this.laplacian_threshold,M=this.min_eigen_value_threshold,g=0|Math.max(5,f),k=0|Math.max(3,f),z=0|Math.min(c-5,c-f),A=0|Math.min(s-3,s-f);for(i=c*s;--i>=0;)b[i]=0;for(function(t,r,a,e,f,o,i,n,c,s){var h=0,u=0,d=n*a+i|0,_=d;for(h=n;h<s;++h,_=d+=a)for(u=i;u<c;++u,++_)r[_]=-4*t[_]+t[_+f]+t[_-f]+t[_+o]+t[_-o]}(h,b,c,0,5,u,g,k,z,A),p=k*c+g|0,n=k;n<A;++n,p+=c)for(i=g,y=p;i<z;++i,++y)((v=b[y])<-w&&v<b[y-1]&&v<b[y+1]&&v<b[y-c]&&v<b[y+c]&&v<b[y-c-1]&&v<b[y+c-1]&&v<b[y-c+1]&&v<b[y+c+1]||v>w&&v>b[y-1]&&v>b[y+1]&&v>b[y-c]&&v>b[y+c]&&v>b[y-c-1]&&v>b[y+c-1]&&v>b[y-c+1]&&v>b[y+c+1])&&(x=a(h,y,v,5,u,d,_))>M&&((o=e[m]).x=i,o.y=n,o.score=x,++m,++i,++y);return t.cache.put_buffer(l),m}});r.yape06=e}(t),function(t){var r,a,e,f=(r=function(t,r,a,e,f){var o,i;if(a>0)for(r-=e*f,i=-f;i<=f;++i){for(o=-f;o<=f;++o)if(t[r+o]>a)return!1;r+=e}else for(r-=e*f,i=-f;i<=f;++i){for(o=-f;o<=f;++o)if(t[r+o]<a)return!1;r+=e}return!0},a=function(t,r,a,e,f,o,i,n){var c=0,s=0,h=i-1|0,u=0,d=0,_=0,l=0,b=0;if((u=t[r+o[s]])<=f)if(u>=e)if((d=t[r+o[h]])<=f){if(d>=e)return void(a[r]=0);if((_=t[r+o[++h]])>f)if((l=t[r+o[++h]])>f)b=3;else{if(!(l<e))return void(a[r]=0);b=6}else if((l=t[r+o[++h]])>f)b=7;else{if(!(l<e))return void(a[r]=0);b=2}}else if((_=t[r+o[++h]])>f)if((l=t[r+o[++h]])>f)b=3;else{if(!(l<e))return void(a[r]=0);b=6}else{if(!(_<e))return void(a[r]=0);if((l=t[r+o[++h]])>f)b=7;else{if(!(l<e))return void(a[r]=0);b=2}}else{if((d=t[r+o[h]])>f)return void(a[r]=0);if((_=t[r+o[++h]])>f)return void(a[r]=0);if((l=t[r+o[++h]])>f)return void(a[r]=0);b=1}else{if((d=t[r+o[h]])<e)return void(a[r]=0);if((_=t[r+o[++h]])<e)return void(a[r]=0);if((l=t[r+o[++h]])<e)return void(a[r]=0);b=0}for(s=1;s<=i;s++)switch(u=t[r+o[s]],b){case 0:if(u>f){if(_=l,(l=t[r+o[++h]])<e)return void(a[r]=0);c-=u+_,b=0;break}if(u<e){if(_>f)return void(a[r]=0);if(l>f)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])>f)return void(a[r]=0);c-=u+_,b=8;break}if(_<=f)return void(a[r]=0);if(l<=f)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])>f){c-=u+_,b=3;break}if(l<e){c-=u+_,b=6;break}return void(a[r]=0);case 1:if(u<e){if(_=l,(l=t[r+o[++h]])>f)return void(a[r]=0);c-=u+_,b=1;break}if(u>f){if(_<e)return void(a[r]=0);if(l<e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])<e)return void(a[r]=0);c-=u+_,b=9;break}if(_>=e)return void(a[r]=0);if(l>=e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])<e){c-=u+_,b=2;break}if(l>f){c-=u+_,b=7;break}return void(a[r]=0);case 2:if(u>f)return void(a[r]=0);if(_=l,l=t[r+o[++h]],u<e){if(l>f)return void(a[r]=0);c-=u+_,b=4;break}if(l>f){c-=u+_,b=7;break}if(l<e){c-=u+_,b=2;break}return void(a[r]=0);case 3:if(u<e)return void(a[r]=0);if(_=l,l=t[r+o[++h]],u>f){if(l<e)return void(a[r]=0);c-=u+_,b=5;break}if(l>f){c-=u+_,b=3;break}if(l<e){c-=u+_,b=6;break}return void(a[r]=0);case 4:if(u>f)return void(a[r]=0);if(u<e){if(_=l,(l=t[r+o[++h]])>f)return void(a[r]=0);c-=u+_,b=1;break}if(l>=e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])<e){c-=u+_,b=2;break}if(l>f){c-=u+_,b=7;break}return void(a[r]=0);case 5:if(u<e)return void(a[r]=0);if(u>f){if(_=l,(l=t[r+o[++h]])<e)return void(a[r]=0);c-=u+_,b=0;break}if(l<=f)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])>f){c-=u+_,b=3;break}if(l<e){c-=u+_,b=6;break}return void(a[r]=0);case 7:if(u>f)return void(a[r]=0);if(u<e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])>f){c-=u+_,b=3;break}if(l<e){c-=u+_,b=6;break}return void(a[r]=0);case 6:if(u>f)return void(a[r]=0);if(u<e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])<e){c-=u+_,b=2;break}if(l>f){c-=u+_,b=7;break}return void(a[r]=0);case 8:if(u>f){if(l<e)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])<e)return void(a[r]=0);c-=u+_,b=9;break}if(u<e){if(_=l,(l=t[r+o[++h]])>f)return void(a[r]=0);c-=u+_,b=1;break}return void(a[r]=0);case 9:if(u<e){if(l>f)return void(a[r]=0);if(_=l,(l=t[r+o[++h]])>f)return void(a[r]=0);c-=u+_,b=8;break}if(u>f){if(_=l,(l=t[r+o[++h]])<e)return void(a[r]=0);c-=u+_,b=0;break}return void(a[r]=0)}a[r]=c+n*t[r]},e=function(t,r,a){this.dirs=new Int32Array(1024),this.dirs_count=0|function(t,r,a){var e,f,o=0;for(e=a,f=0;f<e;f++,o++)e=Math.sqrt(a*a-f*f)+.5|0,r[o]=e+t*f;for(e--;e<f&&e>=0;e--,o++)f=Math.sqrt(a*a-e*e)+.5|0,r[o]=e+t*f;for(;-e<f;e--,o++)f=Math.sqrt(a*a-e*e)+.5|0,r[o]=e+t*f;for(f--;f>=0;f--,o++)e=-Math.sqrt(a*a-f*f)-.5|0,r[o]=e+t*f;for(;f>e;f--,o++)e=-Math.sqrt(a*a-f*f)-.5|0,r[o]=e+t*f;for(e++;e<=0;e++,o++)f=-Math.sqrt(a*a-e*e)-.5|0,r[o]=e+t*f;for(;e<-f;e++,o++)f=-Math.sqrt(a*a-e*e)-.5|0,r[o]=e+t*f;for(f++;f<0;f++,o++)e=Math.sqrt(a*a-f*f)+.5|0,r[o]=e+t*f;return r[o]=r[0],r[o+1]=r[1],o}(t,this.dirs,a),this.scores=new Int32Array(t*r),this.radius=0|a},{level_tables:[],tau:7,init:function(t,r,a,f){var o;for(void 0===f&&(f=1),a=Math.min(a,7),a=Math.max(a,3),o=0;o<f;++o)this.level_tables[o]=new e(t>>o,r>>o,a)},detect:function(t,e,f){void 0===f&&(f=4);var o,i,n,c,s,h=this.level_tables[0],u=0|h.radius,d=u-1|0,_=h.dirs,l=0|h.dirs_count,b=l>>1,v=t.data,p=0|t.cols,y=0|t.rows,x=p>>1,m=h.scores,w=0,M=0,g=0,k=0,z=0,A=0,C=0,O=0,R=0|this.tau,S=0,L=0|Math.max(u+1,f),I=0|Math.max(u+1,f),U=0|Math.min(p-u-2,p-f),q=0|Math.min(y-u-2,y-f);for(g=I*p+L|0,M=I;M<q;++M,g+=p)for(w=L,k=g;w<U;++w,++k)z=v[k]+R,(A=v[k]-R)<v[k+u]&&v[k+u]<z&&A<v[k-u]&&v[k-u]<z?m[k]=0:a(v,k,m,A,z,_,b,l);for(g=I*p+L|0,M=I;M<q;++M,g+=p)for(w=L,k=g;w<U;++w,++k)O=m[k],(C=Math.abs(O))<5?(++w,++k):(c=p,s=void 0,s=0,0!=(i=m)[(n=k)+1]&&s++,0!=i[n-1]&&s++,0!=i[n+c]&&s++,0!=i[n+c+1]&&s++,0!=i[n+c-1]&&s++,0!=i[n-c]&&s++,0!=i[n-c+1]&&s++,0!=i[n-c-1]&&s++,s>=3&&r(m,k,O,x,u)&&((o=e[S]).x=w,o.y=M,o.score=C,++S,w+=d,k+=d));return S}});t.yape=f}(t),function(r){var a,e,f,o,i=(a=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),e=new t.matrix_t(3,3,t.F32_t|t.C1_t),f=new t.matrix_t(32,32,t.U8_t|t.C1_t),o=function(t,r,a,f,o,i){var n=Math.cos(a),c=Math.sin(a);e.data[0]=n,e.data[1]=-c,e.data[2]=(-n+c)*i*.5+f,e.data[3]=c,e.data[4]=n,e.data[5]=(-c-n)*i*.5+o,s(t,r,e,128)},{describe:function(r,e,i,n){var c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=f.data,p=0;n.type&t.U8_t?n.resize(32,i,1):(n.type=t.U8_t,n.cols=32,n.rows=i,n.channel=1,n.allocate());var y=n.data,x=0;for(c=0;c<i;++c){for(h=e[c].x,u=e[c].y,d=e[c].angle,o(r,f,d,h,u,32),p=0,s=0;s<32;++s)b=(_=v[528+32*a[p+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]])|0,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<1,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<2,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<3,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<4,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<5,b|=((_=v[528+32*a[(p+=2)+1]+a[p]])<(l=v[528+32*a[(p+=2)+1]+a[p]]))<<6,_=v[528+32*a[(p+=2)+1]+a[p]],l=v[528+32*a[(p+=2)+1]+a[p]],p+=2,b|=(_<l)<<7,y[x+s]=b;x+=32}}});r.orb=i}(t);var P=Object.freeze({__proto__:null,track:function(r,a,e,f,o,i,c,s,h,u){void 0===c&&(c=30),void 0===s&&(s=new Uint8Array(o)),void 0===h&&(h=.01),void 0===u&&(u=1e-4);var d=.5*(i-1),_=i*i|0,l=_<<1,b=r.data,v=a.data,p=b[0].data,y=v[0].data,x=b[0].cols,m=b[0].rows,w=0,M=0,g=t.cache.get_buffer(_<<2),k=t.cache.get_buffer(l<<2),z=t.cache.get_buffer(m*(x<<1)<<2),A=new t.matrix_t(x,m,t.S32C2_t,z.data),C=g.i32,O=k.i32,R=z.i32,S=0,L=0,I=0,U=0,q=0,G=0,F=0,B=0,N=0,E=0,P=0,V=0,j=0,T=0,Y=0,D=0,Q=0,X=0,H=0,J=0,K=0,W=0,Z=0,$=0,tt=0,rt=0,at=0,et=0,ft=0,ot=0,it=0,nt=0,ct=0,st=0,ht=0,ut=0,dt=0,_t=0,lt=0,bt=0,vt=0,pt=0,yt=0;for(h*=h;J<o;++J)s[J]=1;var xt=r.levels-1|0;for($=xt;$>=0;--$)for(F=1/(1<<$),M=m>>$,S=(w=x>>$)<<1,p=b[$].data,y=v[$].data,at=w-i|0,et=M-i|0,n(b[$],A),tt=0;tt<o;++tt)if(K=(J=tt<<1)+1,B=e[J]*F,N=e[K]*F,$==xt?(E=B,P=N):(E=2*f[J],P=2*f[K]),f[J]=E,f[K]=P,0==(W=(D=0|(B-=d))<=0|D>=at|(Q=0|(N-=d))<=0|Q>=et)){for(ut=16384-(ct=(1-(ft=B-D))*(1-(ot=N-Q))*16384+.5|0)-(st=ft*(1-ot)*16384+.5|0)-(ht=(1-ft)*ot*16384+.5|0),bt=0,vt=0,pt=0,Z=0;Z<i;++Z)for(I=(L=(Z+Q)*w+D|0)<<1,q=(U=Z*i|0)<<1,W=0;W<i;++W,++L,++U,I+=2)dt=(dt=p[L]*ct+p[L+1]*st+p[L+w]*ht+p[L+w+1]*ut)+256>>9,_t=(_t=R[I]*ct+R[I+2]*st+R[I+S]*ht+R[I+S+2]*ut)+8192>>14,lt=(lt=R[I+1]*ct+R[I+3]*st+R[I+S+1]*ht+R[I+S+3]*ut)+8192>>14,C[U]=dt,O[q++]=_t,O[q++]=lt,bt+=_t*_t,vt+=_t*lt,pt+=lt*lt;if(yt=(bt*=1/(1<<20))*(pt*=1/(1<<20))-(vt*=1/(1<<20))*vt,(pt+bt-Math.sqrt((bt-pt)*(bt-pt)+4*vt*vt))/l<u||yt<1.1920929e-7)0==$&&(s[tt]=0);else for(yt=1/yt,E-=d,P-=d,V=0,j=0,rt=0;rt<c;++rt){if(0!=(W=(X=0|E)<=0|X>=at|(H=0|P)<=0|H>=et)){0==$&&(s[tt]=0);break}for(ut=16384-(ct=(1-(ft=E-X))*(1-(ot=P-H))*16384+.5|0)-(st=ft*(1-ot)*16384+.5|0)-(ht=(1-ft)*ot*16384+.5|0),it=0,nt=0,Z=0;Z<i;++Z)for(G=(Z+H)*w+X|0,q=(U=Z*i|0)<<1,W=0;W<i;++W,++G,++U)dt=(dt=y[G]*ct+y[G+1]*st+y[G+w]*ht+y[G+w+1]*ut)+256>>9,it+=(dt-=C[U])*O[q++],nt+=dt*O[q++];if(E+=T=(vt*(nt*=1/(1<<20))-pt*(it*=1/(1<<20)))*yt,P+=Y=(vt*it-bt*nt)*yt,f[J]=E+d,f[K]=P+d,T*T+Y*Y<=h)break;if(rt>0&&Math.abs(T+V)<.01&&Math.abs(Y+j)<.01){f[J]-=.5*T,f[K]-=.5*Y;break}V=T,j=Y}}else 0==$&&(s[tt]=0);t.cache.put_buffer(g),t.cache.put_buffer(k),t.cache.put_buffer(z)}}),V=function(t,r){var a=.25*t.width+.5|0;return r.x<=t.x+a&&r.x>=t.x-a&&r.y<=t.y+a&&r.y>=t.y-a&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width};const j=function(t,r,a,e,f,o,i,n){var c,s,h,u,d,_,l,b,v,p,y,x,m,w,M,g,k,z,A,C,O,R,S,L,I,U=n.size[0]*i|0,q=n.size[1]*i|0,G=.5*i+1.5|0,F=G,B=f-U|0,N=o-q|0,E=f+1|0,P=1/(U*q),V=!0,j=0,T=U,Y=q*E,D=Y+U,Q=U*q*255*.07|0,X=[];for(d=0;d<N;d+=F)for(j=d*E,u=0;u<B;u+=G,j+=G)if(_=t[j]-t[j+T]-t[j+Y]+t[j+D],e&&(e[j]-e[j+T]-e[j+Y]+e[j+D]<Q||_<20))u+=G,j+=G;else{for(_*=P,b=(l=(r[j]-r[j+T]-r[j+Y]+r[j+D])*P-_*_)>0?Math.sqrt(l):1,m=(v=n.complexClassifiers).length,V=!0,c=0;c<m;++c){for(g=(p=v[c]).threshold,w=(y=p.simpleClassifiers).length,k=0,s=0;s<w;++s){if(z=0,M=(C=(x=y[s]).features).length,1===x.tilted)for(h=0;h<M;++h)O=~~(u+(A=C[h])[0]*i)+~~(d+A[1]*i)*E,R=(L=~~(A[2]*i))*E,S=(I=~~(A[3]*i))*E,z+=(a[O]-a[O+L+R]-a[O-I+S]+a[O+L-I+R+S])*A[4];else for(h=0;h<M;++h)O=~~(u+(A=C[h])[0]*i)+~~(d+A[1]*i)*E,L=~~(A[2]*i),S=(I=~~(A[3]*i))*E,z+=(t[O]-t[O+L]-t[O+S]+t[O+S+L])*A[4];k+=z*P<x.threshold*b?x.left_val:x.right_val}if(k<g){V=!1;break}}V&&(X.push({x:u,y:d,width:U,height:q,neighbor:1,confidence:k}),u+=G,j+=G)}return X};var T=Object.freeze({__proto__:null,edges_density:.07,detect_single_scale:j,detect_multi_scale:function(t,r,a,e,f,o,i,n,c){void 0===n&&(n=1.2),void 0===c&&(c=1);for(var s=i.size[0],h=i.size[1],u=[];c*s<f&&c*h<o;)u=u.concat(j(t,r,a,e,f,o,c,i)),c*=n;return u},group_rectangles:function(t,r){void 0===r&&(r=1);var a,e,f=t.length,o=[];for(a=0;a<f;++a)o[a]={parent:-1,element:t[a],rank:0};for(a=0;a<f;++a)if(o[a].element){for(var i=a;-1!=o[i].parent;)i=o[i].parent;for(e=0;e<f;++e)if(a!=e&&o[e].element&&V(o[a].element,o[e].element)){for(var n=e;-1!=o[n].parent;)n=o[n].parent;if(n!=i){o[i].rank>o[n].rank?o[n].parent=i:(o[i].parent=n,o[i].rank==o[n].rank&&o[n].rank++,i=n);for(var c,s=e;-1!=o[s].parent;)c=s,s=o[s].parent,o[c].parent=i;for(s=a;-1!=o[s].parent;)c=s,s=o[s].parent,o[c].parent=i}}}var h=[],u=0;for(a=0;a<f;a++){e=-1;var d=a;if(o[d].element){for(;-1!=o[d].parent;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~u++),e=~o[d].rank}h[a]=e}var _=[];for(a=0;a<u+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<f;++a){let r=t[a];var l=h[a];0==_[l].neighbors&&(_[l].confidence=r.confidence),++_[l].neighbors,_[l].x+=r.x,_[l].y+=r.y,_[l].width+=r.width,_[l].height+=r.height,_[l].confidence=Math.max(_[l].confidence,r.confidence)}var b=[];for(a=0;a<u;++a)(f=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+f)/(2*f),y:(2*_[a].y+f)/(2*f),width:(2*_[a].width+f)/(2*f),height:(2*_[a].height+f)/(2*f),neighbors:_[a].neighbors,confidence:_[a].confidence});var v=[];for(f=b.length,a=0;a<f;++a){let t=b[a];var p=!0;for(e=0;e<f;++e){var y=b[e],x=.25*y.width+.5|0;if(a!=e&&t.x>=y.x-x&&t.y>=y.y-x&&t.x+t.width<=y.x+y.width+x&&t.y+t.height<=y.y+y.height+x&&(y.neighbors>Math.max(3,t.neighbors)||t.neighbors<3)){p=!1;break}}p&&v.push(t)}return v}}),Y=function(t,r){var a=.25*t.width+.5|0;return r.x<=t.x+a&&r.x>=t.x-a&&r.y<=t.y+a&&r.y>=t.y-a&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width},D=new t.pyramid_t(1);let Q=4,X=1.1486,H=5,J=1;var K=Object.freeze({__proto__:null,get interval(){return Q},get scale(){return X},get next(){return H},get scale_to(){return J},prepare_cascade:function(t){for(var r=t.stage_classifier.length,a=0;a<r;a++)for(var e=t.stage_classifier[a].feature,f=t.stage_classifier[a].count,o=t.stage_classifier[a]._feature=new Array(f),i=0;i<f;i++)o[i]={size:e[i].size,px:new Array(e[i].size),pz:new Array(e[i].size),nx:new Array(e[i].size),nz:new Array(e[i].size)}},build_pyramid:function(r,a,e,f){void 0===f&&(f=4);var n=r.cols,c=r.rows,s=0,h=0,u=0,d=!1,_=r,l=r,b=t.U8_t|t.C1_t;Q=f,X=Math.pow(2,1/(Q+1)),H=Q+1|0,J=Math.log(Math.min(n/a,c/e))/Math.log(X)|0;var v=4*(J+2*H)|0;for(D.levels!=v&&(D.levels=v,D.data=new Array(v),d=!0,D.data[0]=r),s=1;s<=Q;++s)h=n/Math.pow(X,s)|0,u=c/Math.pow(X,s)|0,_=D.data[s<<2],(d||h!=_.cols||u!=_.rows)&&(D.data[s<<2]=new t.matrix_t(h,u,b),_=D.data[s<<2]),o(r,_,h,u);for(s=H;s<J+2*H;++s)l=D.data[(s<<2)-(H<<2)],_=D.data[s<<2],h=l.cols>>1,u=l.rows>>1,(d||h!=_.cols||u!=_.rows)&&(D.data[s<<2]=new t.matrix_t(h,u,b),_=D.data[s<<2]),i(l,_);for(s=2*H;s<J+2*H;++s)h=(l=D.data[(s<<2)-(H<<2)]).cols>>1,u=l.rows>>1,_=D.data[1+(s<<2)],(d||h!=_.cols||u!=_.rows)&&(D.data[1+(s<<2)]=new t.matrix_t(h,u,b),_=D.data[1+(s<<2)]),i(l,_,1,0),_=D.data[2+(s<<2)],(d||h!=_.cols||u!=_.rows)&&(D.data[2+(s<<2)]=new t.matrix_t(h,u,b),_=D.data[2+(s<<2)]),i(l,_,0,1),_=D.data[3+(s<<2)],(d||h!=_.cols||u!=_.rows)&&(D.data[3+(s<<2)]=new t.matrix_t(h,u,b),_=D.data[3+(s<<2)]),i(l,_,1,1);return D},detect:function(t,r){var a,e,f,o,i,n=0,c=0,s=0,h=0,u=0,d=0,_=0,l=0,b=0,v=0,p=0,y=0,x=0,m=0,w=0,M=0,g=0,k=0,z=!0,A=!0,C=1,O=1,R=[0,1,0,1],S=[0,0,1,1],L=[],I=t.data,U=[],q=[0,0,0],G=[0,0,0],F=[0,0,0];for(n=0;n<J;n++){for(M=I[(w=n<<2)+(H<<3)].cols-(r.width>>2),g=I[w+(H<<3)].rows-(r.height>>2),G[0]=1*I[w].cols,G[1]=1*I[w+(H<<2)].cols,G[2]=1*I[w+(H<<3)].cols,F[0]=4*I[w].cols-4*M,F[1]=2*I[w+(H<<2)].cols-2*M,F[2]=1*I[w+(H<<3)].cols-1*M,l=r.stage_classifier.length,c=0;c<l;c++)for(f=r.stage_classifier[c].feature,e=r.stage_classifier[c]._feature,b=r.stage_classifier[c].count,s=0;s<b;s++)for(o=e[s],v=0|(i=f[s]).size,_=0;_<v;_++)o.px[_]=1*i.px[_]+i.py[_]*G[i.pz[_]],o.pz[_]=i.pz[_],o.nx[_]=1*i.nx[_]+i.ny[_]*G[i.nz[_]],o.nz[_]=i.nz[_];for(U[0]=I[w].data,U[1]=I[w+(H<<2)].data,_=0;_<4;_++)for(U[2]=I[w+(H<<3)+_].data,q[0]=2*R[_]+S[_]*(2*I[w].cols),q[1]=1*R[_]+S[_]*(1*I[w+(H<<2)].cols),q[2]=0,d=0;d<g;d++){for(u=0;u<M;u++){for(k=0,z=!0,l=r.stage_classifier.length,c=0;c<l;c++){for(k=0,a=r.stage_classifier[c].alpha,e=r.stage_classifier[c]._feature,b=r.stage_classifier[c].count,s=0;s<b;s++)if((y=U[(o=e[s]).pz[0]][q[o.pz[0]]+o.px[0]])<=(x=U[o.nz[0]][q[o.nz[0]]+o.nx[0]]))k+=a[s<<1];else{for(A=!0,v=o.size,m=1;m<v;m++){if(o.pz[m]>=0&&(p=U[o.pz[m]][q[o.pz[m]]+o.px[m]])<y){if(p<=x){A=!1;break}y=p}if(o.nz[m]>=0&&(h=U[o.nz[m]][q[o.nz[m]]+o.nx[m]])>x){if(y<=h){A=!1;break}x=h}}k+=A?a[1+(s<<1)]:a[s<<1]}if(k<r.stage_classifier[c].threshold){z=!1;break}}z&&(L.push({x:(4*u+2*R[_])*C,y:(4*d+2*S[_])*O,width:r.width*C,height:r.height*O,neighbor:1,confidence:k}),++u,q[0]+=4,q[1]+=2,q[2]+=1),q[0]+=4,q[1]+=2,q[2]+=1}q[0]+=F[0],q[1]+=F[1],q[2]+=F[2]}C*=X,O*=X}return L},group_rectangles:function(t,r){void 0===r&&(r=1);var a,e,f=t.length,o=[];for(a=0;a<f;++a)o[a]={parent:-1,element:t[a],rank:0};for(a=0;a<f;++a)if(o[a].element){for(var i=a;-1!=o[i].parent;)i=o[i].parent;for(e=0;e<f;++e)if(a!=e&&o[e].element&&Y(o[a].element,o[e].element)){for(var n=e;-1!=o[n].parent;)n=o[n].parent;if(n!=i){o[i].rank>o[n].rank?o[n].parent=i:(o[i].parent=n,o[i].rank==o[n].rank&&o[n].rank++,i=n);for(var c,s=e;-1!=o[s].parent;)c=s,s=o[s].parent,o[c].parent=i;for(s=a;-1!=o[s].parent;)c=s,s=o[s].parent,o[c].parent=i}}}var h=[],u=0;for(a=0;a<f;a++){e=-1;var d=a;if(o[d].element){for(;-1!=o[d].parent;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~u++),e=~o[d].rank}h[a]=e}var _=[];for(a=0;a<u+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<f;++a){let r=t[a];var l=h[a];0==_[l].neighbors&&(_[l].confidence=r.confidence),++_[l].neighbors,_[l].x+=r.x,_[l].y+=r.y,_[l].width+=r.width,_[l].height+=r.height,_[l].confidence=Math.max(_[l].confidence,r.confidence)}var b=[];for(a=0;a<u;++a)(f=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+f)/(2*f),y:(2*_[a].y+f)/(2*f),width:(2*_[a].width+f)/(2*f),height:(2*_[a].height+f)/(2*f),neighbors:_[a].neighbors,confidence:_[a].confidence});var v=[];for(f=b.length,a=0;a<f;++a){let t=b[a];var p=!0;for(e=0;e<f;++e){var y=b[e],x=.25*y.width+.5|0;if(a!=e&&t.x>=y.x-x&&t.y>=y.y-x&&t.x+t.width<=y.x+y.width+x&&t.y+t.height<=y.y+y.height+x&&(y.neighbors>Math.max(3,t.neighbors)||t.neighbors<3)){p=!1;break}}p&&v.push(t)}return v}});return t.math=f,t.matmath=A,t.linalg=L,t.imgproc=x,t.fast_corners=E,t.optical_flow_lk=P,t.haar=T,t.bbf=K,t}));
