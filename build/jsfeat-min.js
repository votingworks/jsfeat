!function(r,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((r=r||self).jsfeat={})}(this,(function(r){"use strict";class a{constructor(r){this.size=-8&(r+7|0),this.buffer=new ArrayBuffer(this.size),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}}var t=1.192092896e-7,e=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),o=function(r){return e[(65280&r)>>8]};class f{constructor(r,a,t,e){this.type=0|65280&t,this.channel=0|function(r){return 255&r}(t),this.cols=0|r,this.rows=0|a,void 0===e?this.allocate():(this.buffer=e,this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64)}allocate(){delete this.data,delete this.buffer,this.buffer=new a(this.cols*o(this.type)*this.channel*this.rows),this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64}copy_to(r){for(var a=r.data,t=this.data,e=0,o=this.cols*this.rows*this.channel|0;e<o-4;e+=4)a[e]=t[e],a[e+1]=t[e+1],a[e+2]=t[e+2],a[e+3]=t[e+3];for(;e<o;++e)a[e]=t[e]}resize(r,a,t){void 0===t&&(t=this.channel),r*o(this.type)*t*a>this.buffer.size?(this.cols=r,this.rows=a,this.channel=t,this.allocate()):(this.cols=r,this.rows=a,this.channel=t)}}class i{constructor(r){this.next=void 0,this.data=new a(r),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}}var n,s;const h=function(r,a){n=s=new i(a);for(var t=0;t<r;++t){var e=new i(a);s=s.next=e}},d=function(r){var a=n;if(r>a.size)throw new Error(`buffer size (${a.size}) is not big enough, requested ${r}`);if(!a.next)throw new Error("ran out of buffers");return n=a.next,a},c=function(r){s=s.next=r};h(30,2560);var u=Object.freeze({__proto__:null,allocate:h,get_buffer:d,put_buffer:c}),l=new Int32Array(96);const v=function(r,a,t,e){var o=0,f=0,i=0,n=0,s=0,h=0,u=d(r<<2),l=u.f32;if(1==(1&r)&&r<=7&&a<=0)switch(r>>1){case 0:l[0]=1,h=1;break;case 1:l[0]=.25,l[1]=.5,l[2]=.25,h=1;break;case 2:l[0]=.0625,l[1]=.25,l[2]=.375,l[3]=.25,l[4]=.0625,h=1;break;case 3:l[0]=.03125,l[1]=.109375,l[2]=.21875,l[3]=.28125,l[4]=.21875,l[5]=.109375,l[6]=.03125,h=1}else for(s=-.5/((n=a>0?a:.3*(.5*(r-1)-1)+.8)*n);o<r;++o)f=o-.5*(r-1),i=Math.exp(s*f*f),l[o]=i,h+=i;if(256&e)for(h=256/h,o=0;o<r;++o)t[o]=l[o]*h+.5|0;else for(h=1/h,o=0;o<r;++o)t[o]=l[o]*h;c(u)},b=function(r,a,t){for(var e,o=0,f=0,i=0,n=a+t>>1;;){if(t<=a)return r[n];if(t==a+1)return r[a]>r[t]&&(e=r[a],r[a]=r[t],r[t]=e),r[n];for(r[o=a+t>>1]>r[t]&&(e=r[o],r[o]=r[t],r[t]=e),r[a]>r[t]&&(e=r[a],r[a]=r[t],r[t]=e),r[o]>r[a]&&(e=r[o],r[o]=r[a],r[a]=e),f=a+1,e=r[o],r[o]=r[f],r[f]=e,i=t;;){do{++f}while(r[a]>r[f]);do{--i}while(r[i]>r[a]);if(i<f)break;e=r[f],r[f]=r[i],r[i]=e}e=r[a],r[a]=r[i],r[i]=e,i<=n?a=f:i>=n&&(t=i-1)}};var y=Object.freeze({__proto__:null,get_gaussian_kernel:v,perspective_4point_transform:function(r,a,t,e,o,f,i,n,s,h,d,c,u,l,v,b,y){var p=a,w=h,M=i,_=p*w*M,x=v,m=p*x,g=w*m,k=d,z=p*k,A=f,q=t,j=l,O=q*j,I=O*A,F=j*A*k,B=j*M,E=j*k,P=w*M,R=x*w,S=x*A,U=k*A,V=1/(B-E-P+R-S+U),C=p*j,Q=q*A,T=M*p,$=x*T,H=q*w,L=O*k,N=q*k*A,D=M*x*w,G=x*q,J=-(g-_+z*A-A*m-O*w+I-F+B*w)*V,K=(_-g-C*M+C*k+I-w*Q+S*w-F)*V,W=p,X=(-k*m+$+H*M-O*M+L-N+S*k-D)*V,Y=(T*k-$-G*w+L-N+G*A+D-B*k)*V,Z=q,rr=(-z+T+H-Q+E-B-R+S)*V,ar=(-m+z+O-H+S-U-B+P)*V,tr=-((g=(w=c)*(m=(p=e)*(x=y)))-(_=p*w*(M=s))+(z=p*(k=u))*(A=n)-A*m-(O=(q=o)*(j=b))*w+(I=O*A)-(F=j*A*k)+(B=j*M)*w)*(V=1/(B-(E=j*k)-(P=w*M)+(R=x*w)-(S=x*A)+(U=k*A))),er=(_-g-(C=p*j)*M+C*k+I-w*(Q=q*A)+S*w-F)*V,or=p,fr=(-k*m+($=x*(T=M*p))+(H=q*w)*M-O*M+(L=O*k)-(N=q*k*A)+S*k-(D=M*x*w))*V,ir=(T*k-$-(G=x*q)*w+L-N+G*A+D-B*k)*V,nr=q,sr=(-z+T+H-Q+E-B-R+S)*V,hr=(-m+z+O-H+S-U-B+P)*V,dr=W*rr;I=Z*rr-X;var cr=-X*ar+Y*rr,ur=J-dr;Q=J*ar-(z=K*rr);var lr=(_=J*Z)-(g=W*X),vr=(M=J*Y)-(m=X*K);N=(w=Y-ar*Z)*(j=1/(M-_*ar-m+g*ar+z*Z-dr*Y));var br=(U=W*ar-K)*j,yr=(T=-K*Z+W*Y)*j,pr=r.data;pr[0]=tr*N+er*(I*j)-or*(cr*j),pr[1]=tr*br+er*(ur*j)-or*(Q*j),pr[2]=-tr*yr-er*(lr*j)+or*(vr*j),pr[3]=fr*N+ir*(I*j)-nr*(cr*j),pr[4]=fr*br+ir*(ur*j)-nr*(Q*j),pr[5]=-fr*yr-ir*(lr*j)+nr*(vr*j),pr[6]=sr*N+hr*(I*j)-cr*j,pr[7]=sr*br+hr*(ur*j)-Q*j,pr[8]=-sr*yr-hr*(lr*j)+vr*j},qsort:function(r,a,t,e){var o,f,i,n,s=0,h=0,d=0,c=0,u=0,v=0,b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=l;if(!(t-a+1<=1))for(q[0]=a,q[1]=t;s>=0;)for(h=q[s<<1],d=q[1+(s<<1)],s--;;){if((u=d-h+1)<=7){for(b=h+1;b<=d;b++)for(y=b;y>h&&e(r[y],r[y-1]);y--)o=r[y],r[y]=r[y-1],r[y-1]=o;break}for(A=0,w=h,_=d,m=h+(u>>1),u>40&&(k=h+(p=u>>3),z=h+(p<<1),f=r[g=h],i=r[k],n=r[z],h=e(f,i)?e(i,n)?k:e(f,n)?z:g:e(n,i)?k:e(f,n)?g:z,k=m,z=m+p,f=r[g=m-p],i=r[k],n=r[z],m=e(f,i)?e(i,n)?k:e(f,n)?z:g:e(n,i)?k:e(f,n)?g:z,k=d-p,z=d,f=r[g=d-(p<<1)],i=r[k],n=r[z],d=e(f,i)?e(i,n)?k:e(f,n)?z:g:e(n,i)?k:e(f,n)?g:z),k=m,z=d,f=r[g=h],i=r[k],n=r[z],(m=e(f,i)?e(i,n)?k:e(f,n)?z:g:e(n,i)?k:e(f,n)?g:z)!=w&&(o=r[m],r[m]=r[w],r[w]=o,m=w),h=M=w+1,d=x=_,f=r[m];;){for(;h<=d&&!e(f,r[h]);)e(r[h],f)||(h>M&&(o=r[M],r[M]=r[h],r[h]=o),A=1,M++),h++;for(;h<=d&&!e(r[d],f);)e(f,r[d])||(d<x&&(o=r[x],r[x]=r[d],r[d]=o),A=1,x--),d--;if(h>d)break;o=r[h],r[h]=r[d],r[d]=o,A=1,h++,d--}if(0==A){for(d=_,b=(h=w)+1;b<=d;b++)for(y=b;y>h&&e(r[y],r[y-1]);y--)o=r[y],r[y]=r[y-1],r[y-1]=o;break}for(v=h-(u=Math.min(M-w,h-M))|0,c=0;c<u;++c,++v)o=r[w+c],r[w+c]=r[v],r[v]=o;for(v=_-(u=Math.min(_-x,x-d))+1|0,c=0;c<u;++c,++v)o=r[h+c],r[h+c]=r[v],r[v]=o;if(v=x-d,(u=h-M)>1)v>1?u>v?(q[++s<<1]=w,q[1+(s<<1)]=w+u-1,h=_-v+1,d=_):(q[++s<<1]=_-v+1,q[1+(s<<1)]=_,h=w,d=w+u-1):(h=w,d=w+u-1);else{if(!(v>1))break;h=_-v+1,d=_}}},median:b});const p=function(r,a,t,e){var o=r.rows,f=r.cols;o>e&&f>t&&(a.resize(t,e,r.channel),256&r.type&&256&a.type&&o*f/(e*t)<256?function(r,a,t,e){for(var o=0,f=r.channel,i=r.cols,n=r.rows,s=r.data,h=a.data,u=i/t,l=n/e,v=u*l*65536|0,b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,F=d(t*f<<2),B=d(t*f<<2),E=d(2*i*3<<2),P=F.i32,R=B.i32,S=E.i32;b<t;b++){for(M=(g=b*u)+1-1e-6|0,_=0|(k=g+u),M=Math.min(M,i-1),_=Math.min(_,i-1),M>g&&(S[m++]=b*f|0,S[m++]=(M-1)*f|0,S[m++]=256*(M-g)|0,o++),p=M;p<_;p++)o++,S[m++]=b*f|0,S[m++]=p*f|0,S[m++]=256;k-_>.001&&(o++,S[m++]=b*f|0,S[m++]=_*f|0,S[m++]=256*(k-_)|0)}for(b=0;b<t*f;b++)P[b]=R[b]=0;for(y=0,w=0;w<n;w++){for(z=i*w,m=0;m<o;m++)for(q=S[3*m],M=S[3*m+1],j=S[3*m+2],x=0;x<f;x++)P[q+x]+=s[z+M+x]*j;if((y+1)*l<=w+1||w==n-1){if(I=256-(O=256*Math.max(w+1-(y+1)*l,0)|0),A=t*y,O<=0)for(b=0;b<t*f;b++)h[A+b]=Math.min(Math.max((R[b]+256*P[b])/v,0),255),R[b]=P[b]=0;else for(b=0;b<t*f;b++)h[A+b]=Math.min(Math.max((R[b]+P[b]*I)/v,0),255),R[b]=P[b]*O,P[b]=0;y++}else for(b=0;b<t*f;b++)R[b]+=256*P[b],P[b]=0}c(B),c(F),c(E)}(r,a,t,e):function(r,a,t,e){for(var o=0,f=r.channel,i=r.cols,n=r.rows,s=r.data,h=a.data,u=i/t,l=n/e,v=1/(u*l),b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,F=d(t*f<<2),B=d(t*f<<2),E=d(2*i*3<<2),P=F.f32,R=B.f32,S=E.f32;b<t;b++){for(M=(g=b*u)+1-1e-6|0,_=0|(k=g+u),M=Math.min(M,i-1),_=Math.min(_,i-1),M>g&&(o++,S[m++]=(M-1)*f|0,S[m++]=b*f|0,S[m++]=(M-g)*v),p=M;p<_;p++)o++,S[m++]=p*f|0,S[m++]=b*f|0,S[m++]=v;k-_>.001&&(o++,S[m++]=_*f|0,S[m++]=b*f|0,S[m++]=(k-_)*v)}for(b=0;b<t*f;b++)P[b]=R[b]=0;for(y=0,w=0;w<n;w++){for(z=i*w,m=0;m<o;m++)for(M=0|S[3*m],q=0|S[3*m+1],j=S[3*m+2],x=0;x<f;x++)P[q+x]+=s[z+M+x]*j;if((y+1)*l<=w+1||w==n-1){if(I=1-(O=Math.max(w+1-(y+1)*l,0)),A=t*y,Math.abs(O)<.001)for(b=0;b<t*f;b++)h[A+b]=R[b]+P[b],R[b]=P[b]=0;else for(b=0;b<t*f;b++)h[A+b]=R[b]+P[b]*I,R[b]=P[b]*O,P[b]=0;y++}else for(b=0;b<t*f;b++)R[b]+=P[b],P[b]=0}c(B),c(F),c(E)}(r,a,t,e))},w=function(r,a,t,e){void 0===t&&(t=0),void 0===e&&(e=0);var o=r.cols,f=o>>1,i=r.rows>>1,n=f-(t<<1),s=i-(e<<1),h=0,d=0,c=t+e*o,u=0,l=0,v=0;a.resize(f,i,r.channel);var b=r.data,y=a.data;for(d=0;d<s;++d){for(u=c,v=l,h=0;h<=n-2;h+=2,v+=2,u+=4)y[v]=b[u]+b[u+1]+b[u+o]+b[u+o+1]+2>>2,y[v+1]=b[u+2]+b[u+3]+b[u+o+2]+b[u+o+3]+2>>2;for(;h<n;++h,++v,u+=2)y[v]=b[u]+b[u+1]+b[u+o]+b[u+o+1]+2>>2;c+=o<<1,l+=f}},M=function(r,a){var t,e,o,f,i,n,s,h,u=r.cols,l=r.rows,v=u<<1,b=0,y=0,p=0,w=0,M=0,_=0,x=0;a.resize(u,l,2);var m=r.data,g=a.data,k=d(u+2<<2),z=d(u+2<<2);for(256&r.type||512&r.type?(s=k.i32,h=z.i32):(s=k.f32,h=z.f32);y<l;++y,M+=u){for(w=(y>0?y-1:1)*u|0,_=(y<l-1?y+1:l-2)*u|0,x=y*v|0,b=0,p=1;b<=u-2;b+=2,p+=2)t=m[w+b],e=m[_+b],s[p]=3*(t+e)+10*m[M+b],h[p]=e-t,t=m[w+b+1],e=m[_+b+1],s[p+1]=3*(t+e)+10*m[M+b+1],h[p+1]=e-t;for(;b<u;++b,++p)t=m[w+b],e=m[_+b],s[p]=3*(t+e)+10*m[M+b],h[p]=e-t;for(b=u+1|0,s[0]=s[1],s[b]=s[u],h[0]=h[1],h[b]=h[u],b=0;b<=u-4;b+=4)t=h[b+2],e=h[b+1],o=h[b+3],f=h[b+4],i=s[b+2],n=s[b+3],g[x++]=i-s[b],g[x++]=3*(t+h[b])+10*e,g[x++]=n-s[b+1],g[x++]=3*(o+e)+10*t,g[x++]=s[b+4]-i,g[x++]=3*(f+t)+10*o,g[x++]=s[b+5]-n,g[x++]=3*(h[b+5]+o)+10*f;for(;b<u;++b)g[x++]=s[b+2]-s[b],g[x++]=3*(h[b+2]+h[b])+10*h[b+1]}c(k),c(z)},_=function(r,a){var t,e,o,f,i,n,s,h,u=r.cols,l=r.rows,v=u<<1,b=0,y=0,p=0,w=0,M=0,_=0,x=0;a.resize(u,l,2);var m=r.data,g=a.data,k=d(u+2<<2),z=d(u+2<<2);for(256&r.type||512&r.type?(s=k.i32,h=z.i32):(s=k.f32,h=z.f32);y<l;++y,M+=u){for(w=(y>0?y-1:1)*u|0,_=(y<l-1?y+1:l-2)*u|0,x=y*v|0,b=0,p=1;b<=u-2;b+=2,p+=2)t=m[w+b],e=m[_+b],s[p]=t+e+2*m[M+b],h[p]=e-t,t=m[w+b+1],e=m[_+b+1],s[p+1]=t+e+2*m[M+b+1],h[p+1]=e-t;for(;b<u;++b,++p)t=m[w+b],e=m[_+b],s[p]=t+e+2*m[M+b],h[p]=e-t;for(b=u+1|0,s[0]=s[1],s[b]=s[u],h[0]=h[1],h[b]=h[u],b=0;b<=u-4;b+=4)t=h[b+2],e=h[b+1],o=h[b+3],f=h[b+4],i=s[b+2],n=s[b+3],g[x++]=i-s[b],g[x++]=t+h[b]+2*e,g[x++]=n-s[b+1],g[x++]=o+e+2*t,g[x++]=s[b+4]-i,g[x++]=f+t+2*o,g[x++]=s[b+5]-n,g[x++]=h[b+5]+o+2*f;for(;b<u;++b)g[x++]=s[b+2]-s[b],g[x++]=h[b+2]+h[b]+2*h[b+1]}c(k),c(z)},x=function(r,a,t,e){void 0===e&&(e=0);for(var o=r.cols,f=r.rows,i=a.cols,n=a.rows,s=r.data,h=a.data,d=0,c=0,u=0,l=0,v=0,b=0,y=0,p=0,w=0,M=0,_=0,x=t.data,m=x[0],g=x[1],k=x[2],z=x[3],A=x[4],q=x[5],j=0;c<n;++c)for(b=g*c+k,y=A*c+q,d=0;d<i;++d,++j,b+=m,y+=z)v=0|y,(l=0|b)>=0&&v>=0&&l<o-1&&v<f-1?(p=b-l,w=y-v,M=s[u=o*v+l]+p*(s[u+1]-s[u]),_=s[u+o]+p*(s[u+o+1]-s[u+o]),h[j]=M+w*(_-M)):h[j]=e};var m=Object.freeze({__proto__:null,grayscale:function(r,a,t,e,o){void 0===o&&(o=0);var f=0,i=0,n=0,s=0,h=0,d=0,c=4899,u=1868,l=4;2!=o&&3!=o||(c=1868,u=4899),1!=o&&3!=o||(l=3);var v=l<<1,b=3*l|0;e.resize(a,t,1);var y=e.data;for(i=0;i<t;++i,s+=a,n+=a*l){for(f=0,h=n,d=s;f<=a-4;f+=4,h+=l<<2,d+=4)y[d]=r[h]*c+9617*r[h+1]+r[h+2]*u+8192>>14,y[d+1]=r[h+l]*c+9617*r[h+l+1]+r[h+l+2]*u+8192>>14,y[d+2]=r[h+v]*c+9617*r[h+v+1]+r[h+v+2]*u+8192>>14,y[d+3]=r[h+b]*c+9617*r[h+b+1]+r[h+b+2]*u+8192>>14;for(;f<a;++f,++d,h+=l)y[d]=r[h]*c+9617*r[h+1]+r[h+2]*u+8192>>14}},resample:p,box_blur_gray:function(r,a,t,e){void 0===e&&(e=0);var o=r.cols,f=r.rows,i=f<<1,n=o<<1,s=0,h=0,u=0,l=0,v=1+(t<<1)|0,b=t+1|0,y=b+1|0,p=1&e?1:1/(v*v),w=d(o*f<<2),M=0,_=0,x=0,m=0,g=0,k=w.i32,z=r.data,A=0;for(a.resize(o,f,r.channel),u=0;u<f;++u){for(_=u,M=b*z[x],s=x+1|0,l=x+t|0;s<=l;++s)M+=z[s];for(m=x+b|0,A=z[g=x],h=0;h<t;++h,_+=f)k[_]=M,M+=z[m]-A,m++;for(;h<o-y;h+=2,_+=i)k[_]=M,M+=z[m]-z[g],k[_+f]=M,M+=z[m+1]-z[g+1],m+=2,g+=2;for(;h<o-b;++h,_+=f)k[_]=M,M+=z[m]-z[g],m++,g++;for(A=z[m-1];h<o;++h,_+=f)k[_]=M,M+=A-z[g],g++;x+=o}if(x=0,z=a.data,1==p)for(u=0;u<o;++u){for(_=u,M=b*k[x],s=x+1|0,l=x+t|0;s<=l;++s)M+=k[s];for(m=x+b,A=k[g=x],h=0;h<t;++h,_+=o)z[_]=M,M+=k[m]-A,m++;for(;h<f-y;h+=2,_+=n)z[_]=M,M+=k[m]-k[g],z[_+o]=M,M+=k[m+1]-k[g+1],m+=2,g+=2;for(;h<f-b;++h,_+=o)z[_]=M,M+=k[m]-k[g],m++,g++;for(A=k[m-1];h<f;++h,_+=o)z[_]=M,M+=A-k[g],g++;x+=f}else for(u=0;u<o;++u){for(_=u,M=b*k[x],s=x+1|0,l=x+t|0;s<=l;++s)M+=k[s];for(m=x+b,A=k[g=x],h=0;h<t;++h,_+=o)z[_]=M*p,M+=k[m]-A,m++;for(;h<f-y;h+=2,_+=n)z[_]=M*p,M+=k[m]-k[g],z[_+o]=M*p,M+=k[m+1]-k[g+1],m+=2,g+=2;for(;h<f-b;++h,_+=o)z[_]=M*p,M+=k[m]-k[g],m++,g++;for(A=k[m-1];h<f;++h,_+=o)z[_]=M*p,M+=A-k[g],g++;x+=f}c(w)},gaussian_blur:function(r,a,t,e){void 0===e&&(e=0),void 0===t&&(t=0);var o=(t=0==t?2*Math.max(1,4*e+1-1e-8)+1|0:t)>>1,f=r.cols,i=r.rows,n=r.type,s=256&n;a.resize(f,i,r.channel);var h,u,l=r.data,b=a.data,y=t+Math.max(i,f)|0,p=d(y<<2),w=d(t<<2);s?(h=p.i32,u=w.i32):512&n?(h=p.i32,u=w.f32):(h=p.f32,u=w.f32),v(t,e,u,n),s?function(r,a,t,e,o,f,i,n){for(var s=0,h=0,d=0,c=0,u=0,l=0,v=0,b=0,y=0,p=f[0],w=0,M=e<<1,_=3*e,x=e<<2;s<o;++s){for(l=a[c],h=0;h<n;++h)r[h]=l;for(h=0;h<=e-2;h+=2)r[h+n]=a[c+h],r[h+n+1]=a[c+h+1];for(;h<e;++h)r[h+n]=a[c+h];for(l=a[c+e-1],h=e;h<n+e;++h)r[h+n]=l;for(h=0;h<=e-4;h+=4){for(l=r[h]*p,v=r[h+1]*p,b=r[h+2]*p,y=r[h+3]*p,d=1;d<i;++d)w=f[d],l+=r[d+h]*w,v+=r[d+h+1]*w,b+=r[d+h+2]*w,y+=r[d+h+3]*w;t[u+h]=Math.min(l>>8,255),t[u+h+1]=Math.min(v>>8,255),t[u+h+2]=Math.min(b>>8,255),t[u+h+3]=Math.min(y>>8,255)}for(;h<e;++h){for(l=r[h]*p,d=1;d<i;++d)l+=r[d+h]*f[d];t[u+h]=Math.min(l>>8,255)}c+=e,u+=e}for(s=0;s<e;++s){for(l=t[s],h=0;h<n;++h)r[h]=l;for(d=s,h=0;h<=o-2;h+=2,d+=M)r[h+n]=t[d],r[h+n+1]=t[d+e];for(;h<o;++h,d+=e)r[h+n]=t[d];for(l=t[(o-1)*e+s],h=o;h<n+o;++h)r[h+n]=l;for(u=s,h=0;h<=o-4;h+=4,u+=x){for(l=r[h]*p,v=r[h+1]*p,b=r[h+2]*p,y=r[h+3]*p,d=1;d<i;++d)w=f[d],l+=r[d+h]*w,v+=r[d+h+1]*w,b+=r[d+h+2]*w,y+=r[d+h+3]*w;t[u]=Math.min(l>>8,255),t[u+e]=Math.min(v>>8,255),t[u+M]=Math.min(b>>8,255),t[u+_]=Math.min(y>>8,255)}for(;h<o;++h,u+=e){for(l=r[h]*p,d=1;d<i;++d)l+=r[d+h]*f[d];t[u]=Math.min(l>>8,255)}}}(h,l,b,f,i,u,t,o):function(r,a,t,e,o,f,i,n){for(var s=0,h=0,d=0,c=0,u=0,l=0,v=0,b=0,y=0,p=f[0],w=0,M=e<<1,_=3*e,x=e<<2;s<o;++s){for(l=a[c],h=0;h<n;++h)r[h]=l;for(h=0;h<=e-2;h+=2)r[h+n]=a[c+h],r[h+n+1]=a[c+h+1];for(;h<e;++h)r[h+n]=a[c+h];for(l=a[c+e-1],h=e;h<n+e;++h)r[h+n]=l;for(h=0;h<=e-4;h+=4){for(l=r[h]*p,v=r[h+1]*p,b=r[h+2]*p,y=r[h+3]*p,d=1;d<i;++d)w=f[d],l+=r[d+h]*w,v+=r[d+h+1]*w,b+=r[d+h+2]*w,y+=r[d+h+3]*w;t[u+h]=l,t[u+h+1]=v,t[u+h+2]=b,t[u+h+3]=y}for(;h<e;++h){for(l=r[h]*p,d=1;d<i;++d)l+=r[d+h]*f[d];t[u+h]=l}c+=e,u+=e}for(s=0;s<e;++s){for(l=t[s],h=0;h<n;++h)r[h]=l;for(d=s,h=0;h<=o-2;h+=2,d+=M)r[h+n]=t[d],r[h+n+1]=t[d+e];for(;h<o;++h,d+=e)r[h+n]=t[d];for(l=t[(o-1)*e+s],h=o;h<n+o;++h)r[h+n]=l;for(u=s,h=0;h<=o-4;h+=4,u+=x){for(l=r[h]*p,v=r[h+1]*p,b=r[h+2]*p,y=r[h+3]*p,d=1;d<i;++d)w=f[d],l+=r[d+h]*w,v+=r[d+h+1]*w,b+=r[d+h+2]*w,y+=r[d+h+3]*w;t[u]=l,t[u+e]=v,t[u+M]=b,t[u+_]=y}for(;h<o;++h,u+=e){for(l=r[h]*p,d=1;d<i;++d)l+=r[d+h]*f[d];t[u]=l}}}(h,l,b,f,i,u,t,o),c(p),c(w)},hough_transform:function(r,a,t,e){for(var o=r.data,f=r.cols,i=r.rows,n=f,s=Math.PI,h=Math.round((s-0)/t),d=Math.round((2*(f+i)+1)/a),c=1/a,u=new Int32Array((h+2)*(d+2)),l=new Float32Array(h),v=new Float32Array(h),b=0,y=0;b<h;b++)l[b]=Math.sin(y)*c,v[b]=Math.cos(y)*c,y+=t;for(var p=0;p<i;p++)for(var w=0;w<f;w++)if(0!=o[p*n+w])for(let r=0;r<h;r++){var M=Math.round(w*v[r]+p*l[r]);u[(r+1)*(d+2)+(M+=(d-1)/2)+1]+=1}var _=new Array;for(let r=0;r<d;r++)for(let a=0;a<h;a++){var x=(a+1)*(d+2)+r+1;u[x]>e&&u[x]>u[x-1]&&u[x]>=u[x+1]&&u[x]>u[x-d-2]&&u[x]>=u[x+d+2]&&_.push(x)}_.sort((function(r,a){return u[r]>u[a]||u[r]==u[a]&&r<a?1:0}));var m=Math.min(h*d,_.length),g=1/(d+2),k=[];for(let r=0;r<m;r++){var z=_[r];let e=Math.floor(z*g)-1;var A=(z-(e+1)*(d+2)-1-.5*(d-1))*a,q=e*t;k.push([A,q])}return k},pyrdown:w,scharr_derivatives:M,sobel_derivatives:_,compute_integral_image:function(r,a,t,e){var o=0|r.cols,f=0|r.rows,i=r.data,n=o+1|0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,b=0;if(a&&t){for(;u<n;++u)a[u]=0,t[u]=0;for(d=n+1|0,c=1,u=0,b=0;u<f;++u,++d,++c){for(s=h=0,l=0;l<=o-2;l+=2,b+=2,d+=2,c+=2)s+=v=i[b],h+=v*v,a[d]=a[c]+s,t[d]=t[c]+h,s+=v=i[b+1],h+=v*v,a[d+1]=a[c+1]+s,t[d+1]=t[c+1]+h;for(;l<o;++l,++b,++d,++c)s+=v=i[b],h+=v*v,a[d]=a[c]+s,t[d]=t[c]+h}}else if(a){for(;u<n;++u)a[u]=0;for(d=n+1|0,c=1,u=0,b=0;u<f;++u,++d,++c){for(s=0,l=0;l<=o-2;l+=2,b+=2,d+=2,c+=2)s+=i[b],a[d]=a[c]+s,s+=i[b+1],a[d+1]=a[c+1]+s;for(;l<o;++l,++b,++d,++c)s+=i[b],a[d]=a[c]+s}}else if(t){for(;u<n;++u)t[u]=0;for(d=n+1|0,c=1,u=0,b=0;u<f;++u,++d,++c){for(h=0,l=0;l<=o-2;l+=2,b+=2,d+=2,c+=2)h+=(v=i[b])*v,t[d]=t[c]+h,h+=(v=i[b+1])*v,t[d+1]=t[c+1]+h;for(;l<o;++l,++b,++d,++c)h+=(v=i[b])*v,t[d]=t[c]+h}}if(e){for(u=0;u<n;++u)e[u]=0;for(d=n+1|0,c=0,u=0,b=0;u<f;++u,++d,++c){for(l=0;l<=o-2;l+=2,b+=2,d+=2,c+=2)e[d]=i[b]+e[c],e[d+1]=i[b+1]+e[c+1];for(;l<o;++l,++b,++d,++c)e[d]=i[b]+e[c]}for(d=n+o|0,c=o,u=0;u<f;++u,d+=n,c+=n)e[d]+=e[c];for(l=o-1;l>0;--l)for(c=(d=l+f*n)-n,u=f;u>0;--u,d-=n,c-=n)e[d]+=e[c]+e[c+1]}},equalize_histogram:function(r,a){var t=r.cols,e=r.rows,o=r.data;a.resize(t,e,r.channel);var f,i,n=a.data,s=t*e,h=0,u=0,l=d(1024);for(f=l.i32;h<256;++h)f[h]=0;for(h=0;h<s;++h)++f[o[h]];for(u=f[0],h=1;h<256;++h)u=f[h]+=u;for(i=255/s,h=0;h<s;++h)n[h]=f[o[h]]*i+.5|0;c(l)},canny:function(r,a,t,e){var o=r.cols,i=r.rows;a.resize(o,i,r.channel);var n=a.data,s=0,h=0,u=0,l=o<<1,v=0,b=0,y=0,p=0,w=0,M=0,x=0,m=0,g=d(i*l<<2),k=d(3*(o+2)<<2),z=d((i+2)*(o+2)<<2),A=d(i*o<<2),q=k.i32,j=z.i32,O=A.i32,I=g.i32,F=new f(o,i,514,g.data),B=1,E=o+2+1|0,P=2*(o+2)+1|0,R=o+2|0,S=R+1|0,U=0;for(_(r,F),t>e&&(s=t,t=e,e=s),s=3*(o+2)|0;--s>=0;)q[s]=0;for(s=(i+2)*(o+2)|0;--s>=0;)j[s]=0;for(;h<o;++h,u+=2)p=I[u],w=I[u+1],q[E+h]=(p^p>>31)-(p>>31)+((w^w>>31)-(w>>31));for(s=1;s<=i;++s,u+=l){if(s==i)for(h=P+o;--h>=P;)q[h]=0;else for(h=0;h<o;h++)p=I[u+(h<<1)],w=I[u+(h<<1)+1],q[P+h]=(p^p>>31)-(p>>31)+((w^w>>31)-(w>>31));for(v=u-l|0,j[S-1]=0,b=0,h=0;h<o;++h,v+=2){if((y=q[E+h])>t)if(M=(p=I[v])^(w=I[v+1]),w=(w^w>>31)-(w>>31)|0,m=(x=13573*(p=(p^p>>31)-(p>>31)|0))+(p+p<<15),(w<<=15)<x){if(y>q[E+h-1]&&y>=q[E+h+1]){y>e&&!b&&2!=j[S+h-R]?(j[S+h]=2,b=1,O[U++]=S+h):j[S+h]=1;continue}}else if(w>m){if(y>q[B+h]&&y>=q[P+h]){y>e&&!b&&2!=j[S+h-R]?(j[S+h]=2,b=1,O[U++]=S+h):j[S+h]=1;continue}}else if(y>q[B+h-(M=M<0?-1:1)]&&y>q[P+h+M]){y>e&&!b&&2!=j[S+h-R]?(j[S+h]=2,b=1,O[U++]=S+h):j[S+h]=1;continue}j[S+h]=0,b=0}j[S+o]=0,S+=R,h=B,B=E,E=P,P=h}for(h=S-R-1,s=0;s<R;++s,++h)j[h]=0;for(;U>0;)S=O[--U],1==j[S-=R+1]&&(j[S]=2,O[U++]=S),1==j[S+=1]&&(j[S]=2,O[U++]=S),1==j[S+=1]&&(j[S]=2,O[U++]=S),1==j[S+=R]&&(j[S]=2,O[U++]=S),1==j[S-=2]&&(j[S]=2,O[U++]=S),1==j[S+=R]&&(j[S]=2,O[U++]=S),1==j[S+=1]&&(j[S]=2,O[U++]=S),1==j[S+=1]&&(j[S]=2,O[U++]=S);for(S=R+1,B=0,s=0;s<i;++s,S+=R)for(h=0;h<o;++h)n[B++]=2==j[S+h]?255:0;c(g),c(k),c(z),c(A)},warp_perspective:function(r,a,t,e){void 0===e&&(e=0);for(var o=0|r.cols,f=0|r.rows,i=0|a.cols,n=0|a.rows,s=r.data,h=a.data,d=0,c=0,u=0,l=0,v=0,b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=t.data,A=z[0],q=z[1],j=z[2],O=z[3],I=z[4],F=z[5],B=z[6],E=z[7],P=z[8],R=0;c<n;++c)for(p=q*c+j,w=I*c+F,M=E*c+P,d=0;d<i;++d,++R,p+=A,w+=O,M+=B)l=0|(b=p*(_=1/M)),v=0|(y=w*_),b>0&&y>0&&l<o-1&&v<f-1?(x=Math.max(b-l,0),m=Math.max(y-v,0),g=s[u=o*v+l|0]+x*(s[u+1]-s[u]),k=s[u+o]+x*(s[u+o+1]-s[u+o]),h[R]=g+m*(k-g)):h[R]=e},warp_affine:x,skindetector:function(r,a){for(var t,e,o,f,i=r.width*r.height;i--;)f=4*i,t=r.data[f],e=r.data[f+1],o=r.data[f+2],t>95&&e>40&&o>20&&t>e&&t>o&&t-Math.min(e,o)>15&&Math.abs(t-e)>15?a[i]=255:a[i]=0}});class g{constructor(r){this.levels=0|r,this.data=new Array(r),this.pyrdown=w}allocate(r,a,t){for(var e=this.levels;--e>=0;)this.data[e]=new f(r>>e,a>>e,t)}build(r,a){void 0===a&&(a=!0);var t=2,e=r,o=this.data[0];if(!a)for(var f=r.cols*r.rows;--f>=0;)o.data[f]=r.data[f];for(o=this.data[1],this.pyrdown(e,o);t<this.levels;++t)e=o,o=this.data[t],this.pyrdown(e,o)}}const k=function(r,a){for(var t=0,e=0,o=a.rows,f=a.cols,i=0,n=0,s=0,h=a.data,d=r.data;t<o;n+=1,i+=f,t++)for(s=n,e=0;e<f;s+=o,e++)d[s]=h[i+e]},z=function(r,a,t){for(var e=0,o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=a.cols,u=a.rows,l=t.cols,v=a.data,b=t.data,y=r.data,p=0;e<c;i++,e++)for(h=0,o=0;o<l;d++,h++,o++){for(s=h,n=i,p=0,f=0;f<u;n+=c,s+=l,f++)p+=v[n]*b[s];y[d]=p}},A=function(r,a){for(var t=0,e=0,o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=a.cols,u=a.rows,l=a.data,v=r.data,b=0;t<c;s+=c,t++)for(f=t,h=d=s+t,e=t;e<c;h++,d+=c,e++){for(i=f,n=e,b=0,o=0;o<u;i+=c,n+=c,o++)b+=l[i]*l[n];v[h]=b,v[d]=b}},q=function(r,a){var t=r.data,e=a.data,o=t[4],f=t[8],i=t[5],n=t[7],s=t[0],h=s*o,d=s*i,c=t[3],u=t[1],l=c*u,v=t[2],b=c*v,y=t[6],p=y*u,w=y*v,M=1/(h*f-d*n-l*f+b*n+p*i-w*o);e[0]=(o*f-i*n)*M,e[1]=-(u*f-v*n)*M,e[2]=-(-u*i+v*o)*M,e[3]=-(c*f-i*y)*M,e[4]=(s*f-w)*M,e[5]=-(d-b)*M,e[6]=-(-c*n+o*y)*M,e[7]=-(s*n-p)*M,e[8]=(h-l)*M},j=function(r,a,t){var e=r.data,o=a.data,f=t.data,i=o[0],n=o[1],s=o[2],h=o[3],d=o[4],c=o[5],u=o[6],l=o[7],v=o[8],b=f[0],y=f[1],p=f[2],w=f[3],M=f[4],_=f[5],x=f[6],m=f[7],g=f[8];e[0]=i*b+n*w+s*x,e[1]=i*y+n*M+s*m,e[2]=i*p+n*_+s*g,e[3]=h*b+d*w+c*x,e[4]=h*y+d*M+c*m,e[5]=h*p+d*_+c*g,e[6]=u*b+l*w+v*x,e[7]=u*y+l*M+v*m,e[8]=u*p+l*_+v*g},O=function(r,a,t,e,o,f,i,n,s){return r*o*s-r*f*n-e*a*s+e*t*n+i*a*f-i*t*o};var I=Object.freeze({__proto__:null,identity:function(r,a){void 0===a&&(a=1);for(var t=r.data,e=r.rows,o=r.cols,f=o+1|0,i=e*o,n=i;--i>=0;)t[i]=0;for(i=n,n=0;n<i;)t[n]=a,n+=f},transpose:k,multiply:function(r,a,t){for(var e=0,o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=a.cols,u=a.rows,l=t.cols,v=a.data,b=t.data,y=r.data,p=0;e<u;i+=c,e++)for(h=0,o=0;o<l;d++,h++,o++){for(s=h,n=i,p=0,f=0;f<c;n++,s+=l,f++)p+=v[n]*b[s];y[d]=p}},multiply_ABt:function(r,a,t){for(var e=0,o=0,f=0,i=0,n=0,s=0,h=0,d=a.cols,c=a.rows,u=t.rows,l=a.data,v=t.data,b=r.data,y=0;e<c;i+=d,e++)for(s=0,o=0;o<u;h++,o++){for(n=i,y=0,f=0;f<d;n++,s++,f++)y+=l[n]*v[s];b[h]=y}},multiply_AtB:z,multiply_AAt:function(r,a){for(var t=0,e=0,o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=a.cols,u=a.rows,l=a.data,v=r.data,b=0;t<u;f+=u+1,i=n,t++)for(h=f,d=f,s=i,e=t;e<u;h++,d+=u,e++){for(n=i,b=0,o=0;o<c;o++)b+=l[n++]*l[s++];v[h]=b,v[d]=b}},multiply_AtA:A,identity_3x3:function(r,a){void 0===a&&(a=1);var t=r.data;t[0]=t[4]=t[8]=a,t[1]=t[2]=t[3]=0,t[5]=t[6]=t[7]=0},invert_3x3:q,multiply_3x3:j,mat3x3_determinant:function(r){var a=r.data;return a[0]*a[4]*a[8]-a[0]*a[5]*a[7]-a[3]*a[1]*a[8]+a[3]*a[2]*a[7]+a[6]*a[1]*a[5]-a[6]*a[2]*a[4]},determinant_3x3:O}),F=function(r,a,t){const e=r[a];r[a]=r[t],r[t]=e},B=function(r,a){return(r=Math.abs(r))>(a=Math.abs(a))?(a/=r,r*Math.sqrt(1+a*a)):a>0?(r/=a,a*Math.sqrt(1+r*r)):0};const E=function(r,a){var e,o,f,i=0,n=0,s=0,h=r.cols,d=r.data,c=a.data;for(i=0;i<h;i++){for(s=i,n=i+1;n<h;n++)Math.abs(d[n*h+i])>Math.abs(d[s*h+i])&&(s=n);if(Math.abs(d[s*h+i])<t)return 0;if(s!=i){for(n=i;n<h;n++)F(d,i*h+n,s*h+n);F(c,i,s)}for(o=-1/d[i*h+i],n=i+1;n<h;n++){for(e=d[n*h+i]*o,s=i+1;s<h;s++)d[n*h+s]+=e*d[i*h+s];c[n]+=e*c[i]}d[i*h+i]=-o}for(i=h-1;i>=0;i--){for(f=c[i],s=i+1;s<h;s++)f-=d[i*h+s]*c[s];c[i]=f*d[i*h+i]}return 1},P=function(r,a,t,e,o){void 0===o&&(o=0);var i=0,n=0,s=r.rows,h=r.cols,u=s,l=h,v=1|r.type;u<l&&(i=1,n=u,u=l,l=n);var b=d(u*u<<3),y=d(l<<3),p=d(l*l<<3),w=new f(u,u,v,b.data),M=new f(1,l,v,y.data),_=new f(l,l,v,p.data);if(0==i)k(w,r);else{for(n=0;n<h*s;n++)w.data[n]=r.data[n];for(;n<l*u;n++)w.data[n]=0}if(function(r,a,t,e,o,f,i,n){for(var s=0,h=0,u=0,l=0,v=Math.max(f,30),b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,E=0,P=4660,R=0,S=0,U=0,V=d(i<<3),C=V.f64;s<i;s++){for(u=0,z=0;u<f;u++)z+=(m=r[s*a+u])*m;if(C[s]=z,e){for(u=0;u<i;u++)e[s*o+u]=0;e[s*o+s]=1}}for(;l<v;l++){for(M=0,s=0;s<i-1;s++)for(h=s+1;h<i;h++){for(b=s*a|0,y=h*a|0,O=C[s],I=0,E=C[h],u=2,I+=r[b]*r[y],I+=r[b+1]*r[y+1];u<f;u++)I+=r[b+u]*r[y+u];if(!(Math.abs(I)<=2.384185792e-7*Math.sqrt(O*E))){for(q=B(I*=2,A=O-E),A<0?(j=.5*(q-A),_=I/(q*(x=Math.sqrt(j/q))*2)):x=I/(q*(_=Math.sqrt((q+A)/(2*q)))*2),O=0,E=0,u=2,g=_*r[b]+x*r[y],k=-x*r[b]+_*r[y],r[b]=g,r[y]=k,O+=g*g,E+=k*k,g=_*r[b+1]+x*r[y+1],k=-x*r[b+1]+_*r[y+1],r[b+1]=g,r[y+1]=k,O+=g*g,E+=k*k;u<f;u++)g=_*r[b+u]+x*r[y+u],k=-x*r[b+u]+_*r[y+u],r[b+u]=g,r[y+u]=k,O+=g*g,E+=k*k;if(C[s]=O,C[h]=E,M=1,e)for(w=h*o|0,u=2,g=_*e[p=s*o|0]+x*e[w],k=-x*e[p]+_*e[w],e[p]=g,e[w]=k,g=_*e[p+1]+x*e[w+1],k=-x*e[p+1]+_*e[w+1],e[p+1]=g,e[w+1]=k;u<i;u++)g=_*e[p+u]+x*e[w+u],k=-x*e[p+u]+_*e[w+u],e[p+u]=g,e[w+u]=k}}if(0==M)break}for(s=0;s<i;s++){for(u=0,z=0;u<f;u++)z+=(m=r[s*a+u])*m;C[s]=Math.sqrt(z)}for(s=0;s<i-1;s++){for(h=s,u=s+1;u<i;u++)C[h]<C[u]&&(h=u);if(s!=h&&(F(C,s,h),e)){for(u=0;u<f;u++)F(r,s*a+u,h*a+u);for(u=0;u<i;u++)F(e,s*o+u,h*o+u)}}for(s=0;s<i;s++)t[s]=C[s];if(e){for(s=0;s<n;s++){for(z=s<i?C[s]:0;z<=1e-37;){for(S=1/f,u=0;u<f;u++)R=0!=(256&(P=214013*P+2531011)>>16)?S:-S,r[s*a+u]=R;for(l=0;l<2;l++)for(h=0;h<s;h++){for(z=0,u=0;u<f;u++)z+=r[s*a+u]*r[h*a+u];for(U=0,u=0;u<f;u++)m=r[s*a+u]-z*r[h*a+u],r[s*a+u]=m,U+=Math.abs(m);for(U=U?1/U:0,u=0;u<f;u++)r[s*a+u]*=U}for(z=0,u=0;u<f;u++)z+=(m=r[s*a+u])*m;z=Math.sqrt(z)}for(x=1/z,u=0;u<f;u++)r[s*a+u]*=x}c(V)}else c(V)}(w.data,u,M.data,_.data,l,u,l,u),a){for(n=0;n<l;n++)a.data[n]=M.data[n];for(;n<h;n++)a.data[n]=0}if(0==i){if(t&&1&o)for(n=u*u;--n>=0;)t.data[n]=w.data[n];else t&&k(t,w);if(e&&2&o)for(n=l*l;--n>=0;)e.data[n]=_.data[n];else e&&k(e,_)}else{if(t&&1&o)for(n=l*l;--n>=0;)t.data[n]=_.data[n];else t&&k(t,_);if(e&&2&o)for(n=u*u;--n>=0;)e.data[n]=w.data[n];else e&&k(e,w)}c(b),c(y),c(p)},R=function(r,a,t){for(var e=r.cols,o=e*e,i=1|r.type,n=d(e*e<<3),s=d(e<<3),h=new f(e,e,i,n.data),u=new f(1,e,i,s.data);--o>=0;)h.data[o]=r.data[o];if(function(r,a,t,e,o,f){var i=0,n=0,s=0,h=0,u=0,l=0,v=0,b=0,y=0,p=f*f*30,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=d(f<<2),j=d(f<<2),O=q.i32,I=j.i32;if(e)for(;i<f;i++){for(s=i*o,n=0;n<f;n++)e[s+n]=0;e[s+i]=1}for(s=0;s<f;s++){if(t[s]=r[(a+1)*s],s<f-1){for(h=s+1,w=Math.abs(r[a*s+h]),i=s+2;i<f;i++)w<(M=Math.abs(r[a*s+i]))&&(w=M,h=i);O[s]=h}if(s>0){for(h=0,w=Math.abs(r[s]),i=1;i<s;i++)w<(M=Math.abs(r[a*i+s]))&&(w=M,h=i);I[s]=h}}if(f>1)for(;y<p;y++){for(s=0,w=Math.abs(r[O[0]]),i=1;i<f-1;i++)w<(M=Math.abs(r[a*i+O[i]]))&&(w=M,s=i);for(u=O[s],i=1;i<f;i++)w<(M=Math.abs(r[a*I[i]+i]))&&(w=M,s=I[i],u=i);if(_=r[a*s+u],Math.abs(_)<=1.192092896e-7)break;for(x=.5*(t[u]-t[s]),k=(m=Math.abs(x)+B(_,x))/(g=B(_,m)),g=_/g,m=_/m*_,x<0&&(g=-g,m=-m),r[a*s+u]=0,t[s]-=m,t[u]+=m,i=0;i<s;i++)b=a*i+u,z=r[v=a*i+s],A=r[b],r[v]=z*k-A*g,r[b]=z*g+A*k;for(i=s+1;i<u;i++)b=a*i+u,z=r[v=a*s+i],A=r[b],r[v]=z*k-A*g,r[b]=z*g+A*k;for(v=a*s+(i=u+1),b=a*u+i;i<f;i++,v++,b++)z=r[v],A=r[b],r[v]=z*k-A*g,r[b]=z*g+A*k;if(e)for(v=o*s,b=o*u,i=0;i<f;i++,v++,b++)z=e[v],A=e[b],e[v]=z*k-A*g,e[b]=z*g+A*k;for(n=0;n<2;n++){if((l=0==n?s:u)<f-1){for(h=l+1,w=Math.abs(r[a*l+h]),i=l+2;i<f;i++)w<(M=Math.abs(r[a*l+i]))&&(w=M,h=i);O[l]=h}if(l>0){for(h=0,w=Math.abs(r[l]),i=1;i<l;i++)w<(M=Math.abs(r[a*i+l]))&&(w=M,h=i);I[l]=h}}}for(s=0;s<f-1;s++){for(h=s,i=s+1;i<f;i++)t[h]<t[i]&&(h=i);if(s!=h&&(F(t,h,s),e))for(i=0;i<f;i++)F(e,o*h+i,o*s+i)}c(q),c(j)}(h.data,e,u.data,a?a.data:void 0,e,e),t)for(;--e>=0;)t.data[e]=u.data[e];c(n),c(s)};var S=Object.freeze({__proto__:null,lu_solve:E,cholesky_solve:function(r,a){var t,e,o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=r.cols,u=r.data,l=a.data;for(o=0;o<c;o++)for(e=1,s=n=o*c,f=o;f<c;f++){for(t=u[s+o],i=0;i<o;i++)t-=u[i*c+o]*u[s+i];if(f==o){if(u[s+o]=t,0==t)return 0;e=1/t}else u[n+f]=t,u[s+o]=t*e;s+=c}for(n=0,h=0;h<c;h++){for(t=l[h],d=0;d<h;d++)t-=u[n+d]*l[d];l[h]=t,n+=c}for(n=0,h=0;h<c;h++)l[h]/=u[n+h],n+=c;for(h=c-1;h>=0;h--){for(t=l[h],n=(d=h+1)*c;d<c;d++)t-=u[n+h]*l[d],n+=c;l[h]=t}return 1},svd_decompose:P,svd_solve:function(r,a,e){var o,i=0,n=0,s=0,h=0,u=0,l=r.rows,v=r.cols,b=0,y=0,p=1|r.type,w=d(l*l<<3),M=d(v<<3),_=d(v*v<<3),x=new f(l,l,p,w.data),m=new f(1,v,p,M.data),g=new f(v,v,p,_.data),k=e.data,z=x.data,A=m.data,q=g.data;for(P(r,m,x,g,0),o=t*A[0]*v;i<v;i++,u+=v){for(y=0,n=0;n<v;n++)if(A[n]>o){for(s=0,b=0,h=0;s<l;s++,h+=v)b+=z[h+n]*k[s];y+=b*q[u+n]/A[n]}a.data[i]=y}c(w),c(M),c(_)},svd_invert:function(r,a){var e,o=0,i=0,n=0,s=0,h=0,u=0,l=a.rows,v=a.cols,b=0,y=1|a.type,p=d(l*l<<3),w=d(v<<3),M=d(v*v<<3),_=new f(l,l,y,p.data),x=new f(1,v,y,w.data),m=new f(v,v,y,M.data),g=r.data,k=_.data,z=x.data,A=m.data;for(P(a,x,_,m,0),e=t*z[0]*v;o<v;o++,h+=v)for(i=0,s=0;i<l;i++,u++){for(n=0,b=0;n<v;n++,s++)z[n]>e&&(b+=A[h+n]*k[s]/z[n]);g[u]=b}c(p),c(w),c(M)},eigenVV:R}),U=function(r,a,t,e,o,f,i){for(var n=[],s=0,h=0,d=0,c=0,u=!1;d<1e3;++d){for(s=0;s<e&&d<1e3;){for(u=!1,c=0;!u;)for(u=!0,c=n[s]=0|Math.floor(Math.random()*o),h=0;h<s;++h)if(c==n[h]){u=!1;break}f[s]=a[c],i[s]=t[c],r.check_subset(f,i,s+1)?++s:d++}break}return s==e&&d<1e3},V=function(r,a,t,e,o,f,i,n){var s=0,h=0,d=0,c=f*f;for(r.error(t,e,a,i,o);h<o;++h)d=i[h]<=c?1:0,n[h]=d,s+=d;return s};var C=Object.freeze({__proto__:null,ransac:function(r,a,t,e,o,i,n,s){if(void 0===s&&(s=1e3),o<r.size)return!1;var h=r.size,u=s,l=0,v=!1,b=[],y=[],p=i.cols,w=i.rows,M=1|i.type,_=d(p*w<<3),x=d(o),m=d(o<<2),g=new f(p,w,M,_.data),k=new f(o,1,257,x.data),z=-1,A=0,q=m.f32;if(o==h){if(a.run(t,e,g,o)<=0)return c(_),c(x),c(m),!1;if(g.copy_to(i),n)for(;--o>=0;)n.data[o]=1;return c(_),c(x),c(m),!0}for(;l<u;++l){if(!U(a,t,e,h,o,b,y)){if(0==l)return c(_),c(x),c(m),!1;break}a.run(b,y,g,h)<=0||(A=V(a,g,t,e,o,r.thresh,q,k.data))>Math.max(z,h-1)&&(g.copy_to(i),z=A,n&&k.copy_to(n),u=r.update_iters((o-A)/o,u),v=!0)}return c(_),c(x),c(m),v},lmeds:function(r,a,t,e,o,i,n,s){if(void 0===s&&(s=1e3),o<r.size)return!1;var h=r.size,u=s,l=0,v=!1,y=[],p=[],w=i.cols,M=i.rows,_=1|i.type,x=d(w*M<<3),m=d(o),g=d(o<<2),k=new f(w,M,_,x.data),z=new f(o,1,257,m.data),A=0,q=g.f32,j=1e9,O=0,I=0;if(r.eps=.45,u=r.update_iters(r.eps,u),o==h){if(a.run(t,e,k,o)<=0)return c(x),c(m),c(g),!1;if(k.copy_to(i),n)for(;--o>=0;)n.data[o]=1;return c(x),c(m),c(g),!0}for(;l<u;++l){if(!U(a,t,e,h,o,y,p)){if(0==l)return c(x),c(m),c(g),!1;break}a.run(y,p,k,h)<=0||(a.error(t,e,k,q,o),(I=b(q,0,o-1))<j&&(j=I,k.copy_to(i),v=!0))}return v&&(O=2.5*1.4826*(1+5/(o-h))*Math.sqrt(j),O=Math.max(O,.001),A=V(a,i,t,e,o,O,q,z.data),n&&z.copy_to(n),v=A>=h),c(x),c(m),c(g),v}}),Q=function(r){return r*r},T=new f(3,3,1025),$=new f(3,3,1025),H=new f(6,6,1025),L=new f(6,1,1025);var N=new f(9,9,1025),D=new f(9,9,1025);var G=Object.freeze({__proto__:null,affine2d:class{constructor(){}run(r,a,t,e){var o,i,n=0,s=0,h=1|t.type,u=t.data,l=T.data,v=$.data,b=0,y=0;!function(r,a,t,e,o){for(var f,i,n=0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,b=0;n<o;++n)s+=r[n].x,h+=r[n].y,c+=a[n].x,u+=a[n].y;for(s/=o,h/=o,c/=o,u/=o,n=0;n<o;++n)v=r[n].x-s,b=r[n].y-h,d+=Math.sqrt(v*v+b*b),v=a[n].x-c,b=a[n].y-u,l+=Math.sqrt(v*v+b*b);d/=o,l/=o,f=Math.SQRT2/d,i=Math.SQRT2/l,t[0]=t[4]=f,t[2]=-s*f,t[5]=-h*f,t[1]=t[3]=t[6]=t[7]=0,t[8]=1,e[0]=e[4]=i,e[2]=-c*i,e[5]=-u*i,e[1]=e[3]=e[6]=e[7]=0,e[8]=1}(r,a,l,v,e);for(var p=d(2*e*6<<3),w=d(2*e<<3),M=new f(6,2*e,h,p.data),_=new f(1,2*e,h,w.data),x=M.data,m=_.data;n<e;++n)o=r[n],i=a[n],b=l[0]*o.x+l[1]*o.y+l[2],y=l[3]*o.x+l[4]*o.y+l[5],x[s=2*n*6]=b,x[s+1]=y,x[s+2]=1,x[s+3]=0,x[s+4]=0,x[s+5]=0,x[s+=6]=0,x[s+1]=0,x[s+2]=0,x[s+3]=b,x[s+4]=y,x[s+5]=1,m[n<<1]=v[0]*i.x+v[1]*i.y+v[2],m[1+(n<<1)]=v[3]*i.x+v[4]*i.y+v[5];return A(H,M),z(L,M,_),E(H,L),u[0]=L.data[0],u[1]=L.data[1],u[2]=L.data[2],u[3]=L.data[3],u[4]=L.data[4],u[5]=L.data[5],u[6]=0,u[7]=0,u[8]=1,q($,$),j(t,$,t),j(t,t,T),c(p),c(w),1}error(r,a,t,e,o){for(var f,i,n=0,s=t.data;n<o;++n)f=r[n],i=a[n],e[n]=Q(i.x-s[0]*f.x-s[1]*f.y-s[2])+Q(i.y-s[3]*f.x-s[4]*f.y-s[5])}check_subset(){return!0}},homography2d:class{constructor(){}run(r,a,e,o){for(var f=0,i=0,n=e.data,s=T.data,h=$.data,d=N.data,c=D.data,u=0,l=0,v=0,b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0;f<o;++f)w+=a[f].x,M+=a[f].y,m+=r[f].x,g+=r[f].y;for(w/=o,M/=o,m/=o,g/=o,f=0;f<o;++f)y+=Math.abs(a[f].x-w),p+=Math.abs(a[f].y-M),_+=Math.abs(r[f].x-m),x+=Math.abs(r[f].y-g);if(Math.abs(y)<t||Math.abs(p)<t||Math.abs(_)<t||Math.abs(x)<t)return 0;for(y=o/y,p=o/p,_=o/_,x=o/x,s[0]=_,s[1]=0,s[2]=-m*_,s[3]=0,s[4]=x,s[5]=-g*x,s[6]=0,s[7]=0,s[8]=1,h[0]=1/y,h[1]=0,h[2]=w,h[3]=0,h[4]=1/p,h[5]=M,h[6]=0,h[7]=0,h[8]=1,f=81;--f>=0;)d[f]=0;for(f=0;f<o;++f)u=(a[f].x-w)*y,l=(a[f].y-M)*p,v=(r[f].x-m)*_,b=(r[f].y-g)*x,d[0]+=v*v,d[1]+=v*b,d[2]+=v,d[6]+=v*-u*v,d[7]+=v*-u*b,d[8]+=v*-u,d[10]+=b*b,d[11]+=b,d[15]+=b*-u*v,d[16]+=b*-u*b,d[17]+=b*-u,d[20]+=1,d[24]+=-u*v,d[25]+=-u*b,d[26]+=-u,d[30]+=v*v,d[31]+=v*b,d[32]+=v,d[33]+=v*-l*v,d[34]+=v*-l*b,d[35]+=v*-l,d[40]+=b*b,d[41]+=b,d[42]+=b*-l*v,d[43]+=b*-l*b,d[44]+=b*-l,d[50]+=1,d[51]+=-l*v,d[52]+=-l*b,d[53]+=-l,d[60]+=-u*v*-u*v+-l*v*-l*v,d[61]+=-u*v*-u*b+-l*v*-l*b,d[62]+=-u*v*-u+-l*v*-l,d[70]+=-u*b*-u*b+-l*b*-l*b,d[71]+=-u*b*-u+-l*b*-l,d[80]+=-u*-u+-l*-l;for(f=0;f<9;++f)for(i=0;i<f;++i)d[9*f+i]=d[9*i+f];return R(N,D),n[0]=c[72],n[1]=c[73],n[2]=c[74],n[3]=c[75],n[4]=c[76],n[5]=c[77],n[6]=c[78],n[7]=c[79],n[8]=c[80],j(e,$,e),j(e,e,T),u=1/n[8],n[0]*=u,n[1]*=u,n[2]*=u,n[3]*=u,n[4]*=u,n[5]*=u,n[6]*=u,n[7]*=u,n[8]=1,1}error(r,a,t,e,o){for(var f,i,n=0,s=0,h=0,d=0,c=t.data;n<o;++n)f=r[n],i=a[n],s=1/(c[6]*f.x+c[7]*f.y+1),h=(c[0]*f.x+c[1]*f.y+c[2])*s-i.x,d=(c[3]*f.x+c[4]*f.y+c[5])*s-i.y,e[n]=h*h+d*d}check_subset(r,a,t){if(4==t){var e=0,o=r[0],f=r[1],i=r[2],n=r[3],s=a[0],h=a[1],d=a[2],c=a[3],u=o.x,l=o.y,v=f.x,b=f.y,y=i.x,p=i.y,w=s.x,M=s.y,_=h.x,x=h.y,m=d.x,g=d.y,k=O(u,l,1,v,b,1,y,p,1),z=O(w,M,1,_,x,1,m,g,1);if(k*z<0&&e++,u=f.x,l=f.y,v=i.x,b=i.y,y=n.x,p=n.y,w=h.x,M=h.y,_=d.x,x=d.y,m=c.x,g=c.y,(k=O(u,l,1,v,b,1,y,p,1))*(z=O(w,M,1,_,x,1,m,g,1))<0&&e++,u=o.x,l=o.y,v=i.x,b=i.y,y=n.x,p=n.y,w=s.x,M=s.y,_=d.x,x=d.y,m=c.x,g=c.y,(k=O(u,l,1,v,b,1,y,p,1))*(z=O(w,M,1,_,x,1,m,g,1))<0&&e++,u=o.x,l=o.y,v=f.x,b=f.y,y=n.x,p=n.y,w=s.x,M=s.y,_=h.x,x=h.y,m=c.x,g=c.y,(k=O(u,l,1,v,b,1,y,p,1))*(z=O(w,M,1,_,x,1,m,g,1))<0&&e++,0!=e&&4!=e)return!1}return!0}}});var J=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),K=new Uint8Array(512),W=new Int32Array(25),X=new Int32Array(25),Y=function(r,a,t,e,o){for(var f=0,i=r[a],n=o,s=0,h=0,d=0;f<25;++f)e[f]=i-r[a+t[f]];for(f=0;f<16;f+=2)s=Math.min(e[f+1],e[f+2]),(s=Math.min(s,e[f+3]))<=n||(s=Math.min(s,e[f+4]),s=Math.min(s,e[f+5]),s=Math.min(s,e[f+6]),s=Math.min(s,e[f+7]),s=Math.min(s,e[f+8]),n=Math.max(n,Math.min(s,e[f])),n=Math.max(n,Math.min(s,e[f+9])));for(h=-n,f=0;f<16;f+=2)d=Math.max(e[f+1],e[f+2]),d=Math.max(d,e[f+3]),d=Math.max(d,e[f+4]),(d=Math.max(d,e[f+5]))>=h||(d=Math.max(d,e[f+6]),d=Math.max(d,e[f+7]),d=Math.max(d,e[f+8]),h=Math.min(h,Math.max(d,e[f])),h=Math.min(h,Math.max(d,e[f+9])));return-h-1},Z=20;const rr=function(r){Z=Math.min(Math.max(r,0),255);for(var a=-255;a<=255;++a)K[a+255]=a<-Z?1:a>Z?2:0;return Z};rr(20);var ar=Object.freeze({__proto__:null,set_threshold:rr,detect:function(r,a,t){void 0===t&&(t=3);var e,o=r.data,f=r.cols,i=r.rows,n=0,s=0,h=0,u=0,l=0,v=d(3*f),b=d(3*(f+1)<<2),y=v.u8,p=b.i32,w=W,M=X,_=Math.max(3,t),x=Math.min(i-2,i-t),m=Math.max(3,t),g=Math.min(f-3,f-t),k=0,z=0,A=Y,q=K,j=Z,O=0,I=0,F=0,B=0,E=0,P=0,R=0,S=0,U=0,V=0,C=0,Q=0;!function(r,a,t){for(var e=0,o=J;e<t;++e)r[e]=o[e<<1]+o[1+(e<<1)]*a;for(;e<25;++e)r[e]=r[e-t]}(w,f,16);var T=w[0],$=w[1],H=w[2],L=w[3],N=w[4],D=w[5],G=w[6],rr=w[7],ar=w[8],tr=w[9],er=w[10],or=w[11],fr=w[12],ir=w[13],nr=w[14],sr=w[15];for(n=0;n<3*f;++n)y[n]=0;for(n=_;n<x;++n){for(R=n*f+m|0,P=(l=(n-3)%3)*f|0,E=l*(f+1)|0,s=0;s<f;++s)y[P+s]=0;if(B=0,n<x-1)for(s=m;s<g;++s,++R)if(0!=(F=q[(I=255-(O=o[R]))+o[R+T]]|q[I+o[R+ar]])&&(F&=q[I+o[R+H]]|q[I+o[R+er]],F&=q[I+o[R+N]]|q[I+o[R+fr]],0!=(F&=q[I+o[R+G]]|q[I+o[R+nr]]))){if(F&=q[I+o[R+$]]|q[I+o[R+tr]],F&=q[I+o[R+L]]|q[I+o[R+or]],F&=q[I+o[R+D]]|q[I+o[R+ir]],1&(F&=q[I+o[R+rr]]|q[I+o[R+sr]]))for(u=O-j,k=0,h=0;h<25;++h)if(o[R+w[h]]<u){if(++k>8){p[E+ ++B]=s,y[P+s]=A(o,R,w,M,j);break}}else k=0;if(2&F)for(u=O+j,k=0,h=0;h<25;++h)if(o[R+w[h]]>u){if(++k>8){p[E+ ++B]=s,y[P+s]=A(o,R,w,M,j);break}}else k=0}if(p[E+f]=B,n!=_)for(S=(l=(n-4+3)%3)*f|0,E=l*(f+1)|0,U=(l=(n-5+3)%3)*f|0,B=p[E+f],h=0;h<B;++h)V=(s=p[E+h])+1|0,C=s-1|0,(Q=y[S+s])>y[S+V]&&Q>y[S+C]&&Q>y[U+C]&&Q>y[U+s]&&Q>y[U+V]&&Q>y[P+C]&&Q>y[P+s]&&Q>y[P+V]&&((e=a[z]).x=s,e.y=n-1,e.score=Q,z++)}return c(v),c(b),z}}),tr=function(r,a,t,e,o,f,i){var n=-2*r[a]+r[a+e]+r[a-e],s=-2*r[a]+r[a+o]+r[a-o],h=r[a+f]+r[a-f]-r[a+i]-r[a-i],d=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(t-d),Math.abs(-(t+d)))};var er=Object.freeze({__proto__:null,laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(r,a,t){void 0===t&&(t=5);var e,o=0,f=0,i=r.cols,n=r.rows,s=r.data,h=5*i|0,u=3+3*i|0,l=3-3*i|0,v=d(i*n<<2),b=v.i32,y=0,p=0,w=0,M=0,_=0,x=0|Math.max(5,t),m=0|Math.max(3,t),g=0|Math.min(i-5,i-t),k=0|Math.min(n-3,n-t);for(o=i*n;--o>=0;)b[o]=0;for(function(r,a,t,e,o,f,i,n,s,h){var d=0,c=0,u=n*t+i|0,l=u;for(d=n;d<h;++d,l=u+=t)for(c=i;c<s;++c,++l)a[l]=-4*r[l]+r[l+o]+r[l-o]+r[l+f]+r[l-f]}(s,b,i,0,5,h,x,m,g,k),p=m*i+x|0,f=m;f<k;++f,p+=i)for(o=x,w=p;o<g;++o,++w)((y=b[w])<-30&&y<b[w-1]&&y<b[w+1]&&y<b[w-i]&&y<b[w+i]&&y<b[w-i-1]&&y<b[w+i-1]&&y<b[w-i+1]&&y<b[w+i+1]||y>30&&y>b[w-1]&&y>b[w+1]&&y>b[w-i]&&y>b[w+i]&&y>b[w-i-1]&&y>b[w+i-1]&&y>b[w-i+1]&&y>b[w+i+1])&&(M=tr(s,w,y,5,h,u,l))>25&&((e=a[_]).x=o,e.y=f,e.score=M,++_,++o,++w);return c(v),_}}),or=function(r,a,t,e,o){var f,i;if(t>0)for(a-=e*o,i=-o;i<=o;++i){for(f=-o;f<=o;++f)if(r[a+f]>t)return!1;a+=e}else for(a-=e*o,i=-o;i<=o;++i){for(f=-o;f<=o;++f)if(r[a+f]<t)return!1;a+=e}return!0},fr=function(r,a,t,e,o,f,i,n){var s=0,h=0,d=i-1|0,c=0,u=0,l=0,v=0,b=0;if((c=r[a+f[h]])<=o)if(c>=e)if((u=r[a+f[d]])<=o){if(u>=e)return void(t[a]=0);if((l=r[a+f[++d]])>o)if((v=r[a+f[++d]])>o)b=3;else{if(!(v<e))return void(t[a]=0);b=6}else if((v=r[a+f[++d]])>o)b=7;else{if(!(v<e))return void(t[a]=0);b=2}}else if((l=r[a+f[++d]])>o)if((v=r[a+f[++d]])>o)b=3;else{if(!(v<e))return void(t[a]=0);b=6}else{if(!(l<e))return void(t[a]=0);if((v=r[a+f[++d]])>o)b=7;else{if(!(v<e))return void(t[a]=0);b=2}}else{if((u=r[a+f[d]])>o)return void(t[a]=0);if((l=r[a+f[++d]])>o)return void(t[a]=0);if((v=r[a+f[++d]])>o)return void(t[a]=0);b=1}else{if((u=r[a+f[d]])<e)return void(t[a]=0);if((l=r[a+f[++d]])<e)return void(t[a]=0);if((v=r[a+f[++d]])<e)return void(t[a]=0);b=0}for(h=1;h<=i;h++)switch(c=r[a+f[h]],b){case 0:if(c>o){if(l=v,(v=r[a+f[++d]])<e)return void(t[a]=0);s-=c+l,b=0;break}if(c<e){if(l>o)return void(t[a]=0);if(v>o)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])>o)return void(t[a]=0);s-=c+l,b=8;break}if(l<=o)return void(t[a]=0);if(v<=o)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])>o){s-=c+l,b=3;break}if(v<e){s-=c+l,b=6;break}return void(t[a]=0);case 1:if(c<e){if(l=v,(v=r[a+f[++d]])>o)return void(t[a]=0);s-=c+l,b=1;break}if(c>o){if(l<e)return void(t[a]=0);if(v<e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])<e)return void(t[a]=0);s-=c+l,b=9;break}if(l>=e)return void(t[a]=0);if(v>=e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])<e){s-=c+l,b=2;break}if(v>o){s-=c+l,b=7;break}return void(t[a]=0);case 2:if(c>o)return void(t[a]=0);if(l=v,v=r[a+f[++d]],c<e){if(v>o)return void(t[a]=0);s-=c+l,b=4;break}if(v>o){s-=c+l,b=7;break}if(v<e){s-=c+l,b=2;break}return void(t[a]=0);case 3:if(c<e)return void(t[a]=0);if(l=v,v=r[a+f[++d]],c>o){if(v<e)return void(t[a]=0);s-=c+l,b=5;break}if(v>o){s-=c+l,b=3;break}if(v<e){s-=c+l,b=6;break}return void(t[a]=0);case 4:if(c>o)return void(t[a]=0);if(c<e){if(l=v,(v=r[a+f[++d]])>o)return void(t[a]=0);s-=c+l,b=1;break}if(v>=e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])<e){s-=c+l,b=2;break}if(v>o){s-=c+l,b=7;break}return void(t[a]=0);case 5:if(c<e)return void(t[a]=0);if(c>o){if(l=v,(v=r[a+f[++d]])<e)return void(t[a]=0);s-=c+l,b=0;break}if(v<=o)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])>o){s-=c+l,b=3;break}if(v<e){s-=c+l,b=6;break}return void(t[a]=0);case 7:if(c>o)return void(t[a]=0);if(c<e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])>o){s-=c+l,b=3;break}if(v<e){s-=c+l,b=6;break}return void(t[a]=0);case 6:if(c>o)return void(t[a]=0);if(c<e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])<e){s-=c+l,b=2;break}if(v>o){s-=c+l,b=7;break}return void(t[a]=0);case 8:if(c>o){if(v<e)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])<e)return void(t[a]=0);s-=c+l,b=9;break}if(c<e){if(l=v,(v=r[a+f[++d]])>o)return void(t[a]=0);s-=c+l,b=1;break}return void(t[a]=0);case 9:if(c<e){if(v>o)return void(t[a]=0);if(l=v,(v=r[a+f[++d]])>o)return void(t[a]=0);s-=c+l,b=8;break}if(c>o){if(l=v,(v=r[a+f[++d]])<e)return void(t[a]=0);s-=c+l,b=0;break}return void(t[a]=0)}t[a]=s+n*r[a]};class ir{constructor(r,a,t){this.dirs=new Int32Array(1024),this.dirs_count=0|function(r,a,t){var e,o,f=0;for(e=t,o=0;o<e;o++,f++)e=Math.sqrt(t*t-o*o)+.5|0,a[f]=e+r*o;for(e--;e<o&&e>=0;e--,f++)o=Math.sqrt(t*t-e*e)+.5|0,a[f]=e+r*o;for(;-e<o;e--,f++)o=Math.sqrt(t*t-e*e)+.5|0,a[f]=e+r*o;for(o--;o>=0;o--,f++)e=-Math.sqrt(t*t-o*o)-.5|0,a[f]=e+r*o;for(;o>e;o--,f++)e=-Math.sqrt(t*t-o*o)-.5|0,a[f]=e+r*o;for(e++;e<=0;e++,f++)o=-Math.sqrt(t*t-e*e)-.5|0,a[f]=e+r*o;for(;e<-o;e++,f++)o=-Math.sqrt(t*t-e*e)-.5|0,a[f]=e+r*o;for(o++;o<0;o++,f++)e=Math.sqrt(t*t-o*o)+.5|0,a[f]=e+r*o;return a[f]=a[0],a[f+1]=a[1],f}(r,this.dirs,t),this.scores=new Int32Array(r*a),this.radius=0|t}}const nr=[];var sr=Object.freeze({__proto__:null,level_tables:nr,tau:7,init:function(r,a,t,e){var o;for(void 0===e&&(e=1),t=Math.min(t,7),t=Math.max(t,3),o=0;o<e;++o)nr[o]=new ir(r>>o,a>>o,t)},detect:function(r,a,t){void 0===t&&(t=4);var e,o,f,i,n,s=nr[0],h=0|s.radius,d=h-1|0,c=s.dirs,u=0|s.dirs_count,l=u>>1,v=r.data,b=0|r.cols,y=0|r.rows,p=b>>1,w=s.scores,M=0,_=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0|Math.max(h+1,t),O=0|Math.max(h+1,t),I=0|Math.min(b-h-2,b-t),F=0|Math.min(y-h-2,y-t);for(x=O*b+j|0,_=O;_<F;++_,x+=b)for(M=j,m=x;M<I;++M,++m)g=v[m]+7,(k=v[m]-7)<v[m+h]&&v[m+h]<g&&k<v[m-h]&&v[m-h]<g?w[m]=0:fr(v,m,w,k,g,c,l,u);for(x=O*b+j|0,_=O;_<F;++_,x+=b)for(M=j,m=x;M<I;++M,++m)A=w[m],(z=Math.abs(A))<5?(++M,++m):(i=b,n=void 0,n=0,0!=(o=w)[(f=m)+1]&&n++,0!=o[f-1]&&n++,0!=o[f+i]&&n++,0!=o[f+i+1]&&n++,0!=o[f+i-1]&&n++,0!=o[f-i]&&n++,0!=o[f-i+1]&&n++,0!=o[f-i-1]&&n++,n>=3&&or(w,m,A,p,h)&&((e=a[q]).x=M,e.y=_,e.score=z,++q,M+=d,m+=d));return q}}),hr=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),dr=new f(3,3,1025),cr=new f(32,32,257),ur=function(r,a,t,e,o,f){var i=Math.cos(t),n=Math.sin(t);dr.data[0]=i,dr.data[1]=-n,dr.data[2]=(-i+n)*f*.5+e,dr.data[3]=n,dr.data[4]=i,dr.data[5]=(-n-i)*f*.5+o,x(r,a,dr,128)};var lr=Object.freeze({__proto__:null,describe:function(r,a,t,e){var o=0,f=0,i=0,n=0,s=0,h=0,d=0,c=0,u=cr.data,l=0;256&e.type?e.resize(32,t,1):(e.type=256,e.cols=32,e.rows=t,e.channel=1,e.allocate());var v=e.data,b=0;for(o=0;o<t;++o){for(i=a[o].x,n=a[o].y,s=a[o].angle,ur(r,cr,s,i,n,32),l=0,f=0;f<32;++f)c=(h=u[528+32*hr[l+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?1:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?2:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?4:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?8:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?16:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?32:0,c|=(h=u[528+32*hr[(l+=2)+1]+hr[l]])<(d=u[528+32*hr[(l+=2)+1]+hr[l]])?64:0,h=u[528+32*hr[(l+=2)+1]+hr[l]],d=u[528+32*hr[(l+=2)+1]+hr[l]],l+=2,c|=h<d?128:0,v[b+f]=c;b+=32}}});var vr=Object.freeze({__proto__:null,track:function(r,a,t,e,o,i,n,s,h,u){void 0===n&&(n=30),void 0===s&&(s=new Uint8Array(o)),void 0===h&&(h=.01),void 0===u&&(u=1e-4);var l=.5*(i-1),v=i*i|0,b=v<<1,y=r.data,p=a.data,w=y[0].data,_=p[0].data,x=y[0].cols,m=y[0].rows,g=0,k=0,z=d(v<<2),A=d(b<<2),q=d(m*(x<<1)<<2),j=new f(x,m,514,q.data),O=z.i32,I=A.i32,F=q.i32,B=0,E=0,P=0,R=0,S=0,U=0,V=0,C=0,Q=0,T=0,$=0,H=0,L=0,N=0,D=0,G=0,J=0,K=0,W=0,X=0,Y=0,Z=0,rr=0,ar=0,tr=0,er=0,or=0,fr=0,ir=0,nr=0,sr=0,hr=0,dr=0,cr=0,ur=0,lr=0,vr=0,br=0,yr=0,pr=0,wr=0,Mr=0,_r=0;for(h*=h;X<o;++X)s[X]=1;var xr=r.levels-1|0;for(ar=xr;ar>=0;--ar)for(V=1/(1<<ar),k=m>>ar,B=(g=x>>ar)<<1,w=y[ar].data,_=p[ar].data,or=g-i|0,fr=k-i|0,M(y[ar],j),tr=0;tr<o;++tr)if(Y=(X=tr<<1)+1,C=t[X]*V,Q=t[Y]*V,ar==xr?(T=C,$=Q):(T=2*e[X],$=2*e[Y]),e[X]=T,e[Y]=$,J=0|(Q-=l),0==(Z=(G=0|(C-=l))<=0||G>=or||J<=0||J>=fr?1:0)){for(lr=16384-(dr=(1-(ir=C-G))*(1-(nr=Q-J))*16384+.5|0)-(cr=ir*(1-nr)*16384+.5|0)-(ur=(1-ir)*nr*16384+.5|0),pr=0,wr=0,Mr=0,rr=0;rr<i;++rr)for(P=(E=(rr+J)*g+G|0)<<1,S=(R=rr*i|0)<<1,Z=0;Z<i;++Z,++E,++R,P+=2)vr=(vr=w[E]*dr+w[E+1]*cr+w[E+g]*ur+w[E+g+1]*lr)+256>>9,br=(br=F[P]*dr+F[P+2]*cr+F[P+B]*ur+F[P+B+2]*lr)+8192>>14,yr=(yr=F[P+1]*dr+F[P+3]*cr+F[P+B+1]*ur+F[P+B+3]*lr)+8192>>14,O[R]=vr,I[S++]=br,I[S++]=yr,pr+=br*br,wr+=br*yr,Mr+=yr*yr;if(_r=(pr*=1/(1<<20))*(Mr*=1/(1<<20))-(wr*=1/(1<<20))*wr,(Mr+pr-Math.sqrt((pr-Mr)*(pr-Mr)+4*wr*wr))/b<u||_r<1.1920929e-7)0==ar&&(s[tr]=0);else for(_r=1/_r,T-=l,$-=l,H=0,L=0,er=0;er<n;++er){if(W=0|$,0!=(Z=(K=0|T)<=0||K>=or||W<=0||W>=fr?1:0)){0==ar&&(s[tr]=0);break}for(lr=16384-(dr=(1-(ir=T-K))*(1-(nr=$-W))*16384+.5|0)-(cr=ir*(1-nr)*16384+.5|0)-(ur=(1-ir)*nr*16384+.5|0),sr=0,hr=0,rr=0;rr<i;++rr)for(U=(rr+W)*g+K|0,S=(R=rr*i|0)<<1,Z=0;Z<i;++Z,++U,++R)vr=(vr=_[U]*dr+_[U+1]*cr+_[U+g]*ur+_[U+g+1]*lr)+256>>9,sr+=(vr-=O[R])*I[S++],hr+=vr*I[S++];if(T+=N=(wr*(hr*=1/(1<<20))-Mr*(sr*=1/(1<<20)))*_r,$+=D=(wr*sr-pr*hr)*_r,e[X]=T+l,e[Y]=$+l,N*N+D*D<=h)break;if(er>0&&Math.abs(N+H)<.01&&Math.abs(D+L)<.01){e[X]-=.5*N,e[Y]-=.5*D;break}H=N,L=D}}else 0==ar&&(s[tr]=0);c(z),c(A),c(q)}}),br=function(r,a){var t=.25*r.width+.5|0;return a.x<=r.x+t&&a.x>=r.x-t&&a.y<=r.y+t&&a.y>=r.y-t&&a.width<=(1.5*r.width+.5|0)&&(1.5*a.width+.5|0)>=r.width};const yr=function(r,a,t,e,o,f,i,n){var s,h,d,c,u,l,v,b,y,p,w,M,_,x,m,g,k,z,A,q,j,O,I,F,B,E=n.size[0]*i|0,P=n.size[1]*i|0,R=.5*i+1.5|0,S=R,U=o-E|0,V=f-P|0,C=o+1|0,Q=1/(E*P),T=!0,$=0,H=E,L=P*C,N=L+E,D=E*P*255*.07|0,G=[];for(u=0;u<V;u+=S)for($=u*C,c=0;c<U;c+=R,$+=R)if(l=r[$]-r[$+H]-r[$+L]+r[$+N],e&&(e[$]-e[$+H]-e[$+L]+e[$+N]<D||l<20))c+=R,$+=R;else{for(l*=Q,b=(v=(a[$]-a[$+H]-a[$+L]+a[$+N])*Q-l*l)>0?Math.sqrt(v):1,_=(y=n.complexClassifiers).length,T=!0,s=0;s<_;++s){for(g=(p=y[s]).threshold,x=(w=p.simpleClassifiers).length,k=0,h=0;h<x;++h){if(z=0,m=(q=(M=w[h]).features).length,1===M.tilted)for(d=0;d<m;++d)j=~~(c+(A=q[d])[0]*i)+~~(u+A[1]*i)*C,O=(F=~~(A[2]*i))*C,I=(B=~~(A[3]*i))*C,z+=(t[j]-t[j+F+O]-t[j-B+I]+t[j+F-B+O+I])*A[4];else for(d=0;d<m;++d)j=~~(c+(A=q[d])[0]*i)+~~(u+A[1]*i)*C,F=~~(A[2]*i),I=(B=~~(A[3]*i))*C,z+=(r[j]-r[j+F]-r[j+I]+r[j+I+F])*A[4];k+=z*Q<M.threshold*b?M.left_val:M.right_val}if(k<g){T=!1;break}}T&&(G.push({x:c,y:u,width:E,height:P,neighbors:1,confidence:k}),c+=R,$+=R)}return G};var pr=Object.freeze({__proto__:null,edges_density:.07,detect_single_scale:yr,detect_multi_scale:function(r,a,t,e,o,f,i,n,s){void 0===n&&(n=1.2),void 0===s&&(s=1);for(var h=i.size[0],d=i.size[1],c=[];s*h<o&&s*d<f;)c.push(...yr(r,a,t,e,o,f,s,i)),s*=n;return c},group_rectangles:function(r,a){void 0===a&&(a=1);var t,e,o=r.length,f=[];for(t=0;t<o;++t)f[t]={parent:-1,element:r[t],rank:0};for(t=0;t<o;++t)if(f[t].element){for(var i=t;-1!=f[i].parent;)i=f[i].parent;for(e=0;e<o;++e)if(t!=e&&f[e].element&&br(f[t].element,f[e].element)){for(var n=e;-1!=f[n].parent;)n=f[n].parent;if(n!=i){f[i].rank>f[n].rank?f[n].parent=i:(f[i].parent=n,f[i].rank==f[n].rank&&f[n].rank++,i=n);for(var s,h=e;-1!=f[h].parent;)s=h,h=f[h].parent,f[s].parent=i;for(h=t;-1!=f[h].parent;)s=h,h=f[h].parent,f[s].parent=i}}}var d=[],c=0;for(t=0;t<o;t++){e=-1;var u=t;if(f[u].element){for(;-1!=f[u].parent;)u=f[u].parent;f[u].rank>=0&&(f[u].rank=~c++),e=~f[u].rank}d[t]=e}var l=[];for(t=0;t<c+1;++t)l[t]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(t=0;t<o;++t){let a=r[t];var v=d[t];0==l[v].neighbors&&(l[v].confidence=a.confidence),++l[v].neighbors,l[v].x+=a.x,l[v].y+=a.y,l[v].width+=a.width,l[v].height+=a.height,l[v].confidence=Math.max(l[v].confidence,a.confidence)}var b=[];for(t=0;t<c;++t)(o=l[t].neighbors)>=a&&b.push({x:(2*l[t].x+o)/(2*o),y:(2*l[t].y+o)/(2*o),width:(2*l[t].width+o)/(2*o),height:(2*l[t].height+o)/(2*o),neighbors:l[t].neighbors,confidence:l[t].confidence});var y=[];for(o=b.length,t=0;t<o;++t){let r=b[t];var p=!0;for(e=0;e<o;++e){var w=b[e],M=.25*w.width+.5|0;if(t!=e&&r.x>=w.x-M&&r.y>=w.y-M&&r.x+r.width<=w.x+w.width+M&&r.y+r.height<=w.y+w.height+M&&(w.neighbors>Math.max(3,r.neighbors)||r.neighbors<3)){p=!1;break}}p&&y.push(r)}return y}}),wr=new g(1);let Mr=4,_r=1.1486,xr=5,mr=1;var gr=Object.freeze({__proto__:null,get interval(){return Mr},get scale(){return _r},get next(){return xr},get scale_to(){return mr},prepare_cascade:function(r){for(var a=r.stage_classifier.length,t=0;t<a;t++)for(var e=r.stage_classifier[t].feature,o=r.stage_classifier[t].count,f=r.stage_classifier[t]._feature=new Array(o),i=0;i<o;i++)f[i]={size:e[i].size,px:new Array(e[i].size),pz:new Array(e[i].size),nx:new Array(e[i].size),nz:new Array(e[i].size)}},build_pyramid:function(r,a,t,e){void 0===e&&(e=4);var o=r.cols,i=r.rows,n=0,s=0,h=0,d=!1,c=r,u=r;Mr=e,_r=Math.pow(2,1/(Mr+1)),xr=Mr+1|0,mr=Math.log(Math.min(o/a,i/t))/Math.log(_r)|0;var l=4*(mr+2*xr)|0;for(wr.levels!=l&&(wr.levels=l,wr.data=new Array(l),d=!0,wr.data[0]=r),n=1;n<=Mr;++n)s=o/Math.pow(_r,n)|0,h=i/Math.pow(_r,n)|0,c=wr.data[n<<2],(d||s!=c.cols||h!=c.rows)&&(wr.data[n<<2]=new f(s,h,257),c=wr.data[n<<2]),p(r,c,s,h);for(n=xr;n<mr+2*xr;++n)u=wr.data[(n<<2)-(xr<<2)],c=wr.data[n<<2],s=u.cols>>1,h=u.rows>>1,(d||s!=c.cols||h!=c.rows)&&(wr.data[n<<2]=new f(s,h,257),c=wr.data[n<<2]),w(u,c);for(n=2*xr;n<mr+2*xr;++n)s=(u=wr.data[(n<<2)-(xr<<2)]).cols>>1,h=u.rows>>1,c=wr.data[1+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(wr.data[1+(n<<2)]=new f(s,h,257),c=wr.data[1+(n<<2)]),w(u,c,1,0),c=wr.data[2+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(wr.data[2+(n<<2)]=new f(s,h,257),c=wr.data[2+(n<<2)]),w(u,c,0,1),c=wr.data[3+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(wr.data[3+(n<<2)]=new f(s,h,257),c=wr.data[3+(n<<2)]),w(u,c,1,1);return wr},detect:function(r,a){var t,e,o,f,i,n=0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,b=0,y=0,p=0,w=0,M=0,_=0,x=0,m=0,g=0,k=0,z=!0,A=!0,q=1,j=1,O=[0,1,0,1],I=[0,0,1,1],F=[],B=r.data,E=[],P=[0,0,0],R=[0,0,0],S=[0,0,0];for(n=0;n<mr;n++){for(m=B[(x=n<<2)+(xr<<3)].cols-(a.width>>2),g=B[x+(xr<<3)].rows-(a.height>>2),R[0]=1*B[x].cols,R[1]=1*B[x+(xr<<2)].cols,R[2]=1*B[x+(xr<<3)].cols,S[0]=4*B[x].cols-4*m,S[1]=2*B[x+(xr<<2)].cols-2*m,S[2]=1*B[x+(xr<<3)].cols-1*m,v=a.stage_classifier.length,s=0;s<v;s++)for(o=a.stage_classifier[s].feature,e=a.stage_classifier[s]._feature,b=a.stage_classifier[s].count,h=0;h<b;h++)for(f=e[h],y=0|(i=o[h]).size,l=0;l<y;l++)f.px[l]=1*i.px[l]+i.py[l]*R[i.pz[l]],f.pz[l]=i.pz[l],f.nx[l]=1*i.nx[l]+i.ny[l]*R[i.nz[l]],f.nz[l]=i.nz[l];for(E[0]=B[x].data,E[1]=B[x+(xr<<2)].data,l=0;l<4;l++)for(E[2]=B[x+(xr<<3)+l].data,P[0]=2*O[l]+I[l]*(2*B[x].cols),P[1]=1*O[l]+I[l]*(1*B[x+(xr<<2)].cols),P[2]=0,u=0;u<g;u++){for(c=0;c<m;c++){for(k=0,z=!0,v=a.stage_classifier.length,s=0;s<v;s++){for(k=0,t=a.stage_classifier[s].alpha,e=a.stage_classifier[s]._feature,b=a.stage_classifier[s].count,h=0;h<b;h++)if((w=E[(f=e[h]).pz[0]][P[f.pz[0]]+f.px[0]])<=(M=E[f.nz[0]][P[f.nz[0]]+f.nx[0]]))k+=t[h<<1];else{for(A=!0,y=f.size,_=1;_<y;_++){if(f.pz[_]>=0&&(p=E[f.pz[_]][P[f.pz[_]]+f.px[_]])<w){if(p<=M){A=!1;break}w=p}if(f.nz[_]>=0&&(d=E[f.nz[_]][P[f.nz[_]]+f.nx[_]])>M){if(w<=d){A=!1;break}M=d}}k+=A?t[1+(h<<1)]:t[h<<1]}if(k<a.stage_classifier[s].threshold){z=!1;break}}z&&(F.push({x:(4*c+2*O[l])*q,y:(4*u+2*I[l])*j,width:a.width*q,height:a.height*j,neighbor:1,confidence:k}),++c,P[0]+=4,P[1]+=2,P[2]+=1),P[0]+=4,P[1]+=2,P[2]+=1}P[0]+=S[0],P[1]+=S[1],P[2]+=S[2]}q*=_r,j*=_r}return F},group_rectangles:function(r,a){void 0===a&&(a=1);var t,e,o=r.length,f=[];for(t=0;t<o;++t)f[t]={parent:-1,element:r[t],rank:0};for(t=0;t<o;++t)if(f[t].element){for(var i=t;-1!=f[i].parent;)i=f[i].parent;for(e=0;e<o;++e)if(t!=e&&f[e].element&&br(f[t].element,f[e].element)){for(var n=e;-1!=f[n].parent;)n=f[n].parent;if(n!=i){f[i].rank>f[n].rank?f[n].parent=i:(f[i].parent=n,f[i].rank==f[n].rank&&f[n].rank++,i=n);for(var s,h=e;-1!=f[h].parent;)s=h,h=f[h].parent,f[s].parent=i;for(h=t;-1!=f[h].parent;)s=h,h=f[h].parent,f[s].parent=i}}}var d=[],c=0;for(t=0;t<o;t++){e=-1;var u=t;if(f[u].element){for(;-1!=f[u].parent;)u=f[u].parent;f[u].rank>=0&&(f[u].rank=~c++),e=~f[u].rank}d[t]=e}var l=[];for(t=0;t<c+1;++t)l[t]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(t=0;t<o;++t){let a=r[t];var v=d[t];0==l[v].neighbors&&(l[v].confidence=a.confidence),++l[v].neighbors,l[v].x+=a.x,l[v].y+=a.y,l[v].width+=a.width,l[v].height+=a.height,l[v].confidence=Math.max(l[v].confidence,a.confidence)}var b=[];for(t=0;t<c;++t)(o=l[t].neighbors)>=a&&b.push({x:(2*l[t].x+o)/(2*o),y:(2*l[t].y+o)/(2*o),width:(2*l[t].width+o)/(2*o),height:(2*l[t].height+o)/(2*o),neighbors:l[t].neighbors,confidence:l[t].confidence});var y=[];for(o=b.length,t=0;t<o;++t){let r=b[t];var p=!0;for(e=0;e<o;++e){var w=b[e],M=.25*w.width+.5|0;if(t!=e&&r.x>=w.x-M&&r.y>=w.y-M&&r.x+r.width<=w.x+w.width+M&&r.y+r.height<=w.y+w.height+M&&(w.neighbors>Math.max(3,r.neighbors)||r.neighbors<3)){p=!1;break}}p&&y.push(r)}return y}});r.REVISION="ALPHA",r.bbf=gr,r.cache=u,r.data_t=a,r.fast_corners=ar,r.haar=pr,r.imgproc=m,r.keypoint_t=class{constructor(r,a,t,e,o){void 0===r&&(r=0),void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=-1),this.x=r,this.y=a,this.score=t,this.level=e,this.angle=o}},r.linalg=S,r.math=y,r.matmath=I,r.matrix_t=f,r.motion_estimator=C,r.motion_model=G,r.optical_flow_lk=vr,r.orb=lr,r.pyramid_t=g,r.ransac_params_t=class{constructor(r,a,t,e){void 0===r&&(r=0),void 0===a&&(a=.5),void 0===t&&(t=.5),void 0===e&&(e=.99),this.size=r,this.thresh=a,this.eps=t,this.prob=e}update_iters(r,a){var t=Math.log(1-this.prob),e=Math.log(1-Math.pow(1-r,this.size));return 0|(e>=0||-t>=a*-e?a:Math.round(t/e))}},r.yape=sr,r.yape06=er,Object.defineProperty(r,"__esModule",{value:!0})}));
