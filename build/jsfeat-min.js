!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(r=r||self).jsfeat=t()}(this,(function(){"use strict";function r(r,t){this.size=-8&(r+7|0),void 0===t?this.buffer=new ArrayBuffer(this.size):(this.buffer=t,this.size=t.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}var t=1.192092896e-7,a=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),e=function(r){return 65280&r},o=function(r){return 255&r},i=function(r){return a[(65280&r)>>8]};function f(r,t,a,i){this.type=0|e(a),this.channel=0|o(a),this.cols=0|r,this.rows=0|t,void 0===i?this.allocate():(this.buffer=i,this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64)}f.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new r(this.cols*i(this.type)*this.channel*this.rows),this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64},f.prototype.copy_to=function(r){for(var t=r.data,a=this.data,e=0,o=this.cols*this.rows*this.channel|0;e<o-4;e+=4)t[e]=a[e],t[e+1]=a[e+1],t[e+2]=a[e+2],t[e+3]=a[e+3];for(;e<o;++e)t[e]=a[e]},f.prototype.resize=function(r,t,a){void 0===a&&(a=this.channel),r*i(this.type)*a*t>this.buffer.size?(this.cols=r,this.rows=t,this.channel=a,this.allocate()):(this.cols=r,this.rows=t,this.channel=a)};var n,s,h=function(){function t(t){this.next=null,this.data=new r(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new r(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}();const d=function(r,t){n=s=new h(t);for(var a=0;a<r;++a){var e=new h(t);s=s.next=e}},c=function(r){var t=n;return n=n.next,r>t.size&&t.resize(r),t},u=function(r){s=s.next=r};d(30,2560);var l=Object.freeze({__proto__:null,allocate:d,get_buffer:c,put_buffer:u}),v=new Int32Array(96);const p=function(r,t,a,e){var o=0,i=0,f=0,n=0,s=0,h=0,d=c(r<<2),l=d.f32;if(1==(1&r)&&r<=7&&t<=0)switch(r>>1){case 0:l[0]=1,h=1;break;case 1:l[0]=.25,l[1]=.5,l[2]=.25,h=1;break;case 2:l[0]=.0625,l[1]=.25,l[2]=.375,l[3]=.25,l[4]=.0625,h=1;break;case 3:l[0]=.03125,l[1]=.109375,l[2]=.21875,l[3]=.28125,l[4]=.21875,l[5]=.109375,l[6]=.03125,h=1}else for(s=-.5/((n=t>0?t:.3*(.5*(r-1)-1)+.8)*n);o<r;++o)i=o-.5*(r-1),f=Math.exp(s*i*i),l[o]=f,h+=f;if(256&e)for(h=256/h,o=0;o<r;++o)a[o]=l[o]*h+.5|0;else for(h=1/h,o=0;o<r;++o)a[o]=l[o]*h;u(d)},y=function(r,t,a){for(var e,o=0,i=0,f=0,n=t+a>>1;;){if(a<=t)return r[n];if(a==t+1)return r[t]>r[a]&&(e=r[t],r[t]=r[a],r[a]=e),r[n];for(r[o=t+a>>1]>r[a]&&(e=r[o],r[o]=r[a],r[a]=e),r[t]>r[a]&&(e=r[t],r[t]=r[a],r[a]=e),r[o]>r[t]&&(e=r[o],r[o]=r[t],r[t]=e),i=t+1,e=r[o],r[o]=r[i],r[i]=e,f=a;;){do{++i}while(r[t]>r[i]);do{--f}while(r[f]>r[t]);if(f<i)break;e=r[i],r[i]=r[f],r[f]=e}e=r[t],r[t]=r[f],r[f]=e,f<=n?t=i:f>=n&&(a=f-1)}};var b=Object.freeze({__proto__:null,get_gaussian_kernel:p,perspective_4point_transform:function(r,t,a,e,o,i,f,n,s,h,d,c,u,l,v,p,y){var b=t,w=h,_=f,M=b*w*_,x=v,m=b*x,g=w*m,k=d,z=b*k,A=i,q=a,j=l,O=q*j,I=O*A,F=j*A*k,B=j*_,R=j*k,S=w*_,U=x*w,V=x*A,C=k*A,P=1/(B-R-S+U-V+C),Q=b*j,T=q*A,E=_*b,H=x*E,L=q*w,N=O*k,D=q*k*A,G=_*x*w,J=x*q,K=-(g-M+z*A-A*m-O*w+I-F+B*w)*P,W=(M-g-Q*_+Q*k+I-w*T+V*w-F)*P,X=b,Y=(-k*m+H+L*_-O*_+N-D+V*k-G)*P,Z=(E*k-H-J*w+N-D+J*A+G-B*k)*P,$=q,rr=(-z+E+L-T+R-B-U+V)*P,tr=(-m+z+O-L+V-C-B+S)*P,ar=-((g=(w=c)*(m=(b=e)*(x=y)))-(M=b*w*(_=s))+(z=b*(k=u))*(A=n)-A*m-(O=(q=o)*(j=p))*w+(I=O*A)-(F=j*A*k)+(B=j*_)*w)*(P=1/(B-(R=j*k)-(S=w*_)+(U=x*w)-(V=x*A)+(C=k*A))),er=(M-g-(Q=b*j)*_+Q*k+I-w*(T=q*A)+V*w-F)*P,or=b,ir=(-k*m+(H=x*(E=_*b))+(L=q*w)*_-O*_+(N=O*k)-(D=q*k*A)+V*k-(G=_*x*w))*P,fr=(E*k-H-(J=x*q)*w+N-D+J*A+G-B*k)*P,nr=q,sr=(-z+E+L-T+R-B-U+V)*P,hr=(-m+z+O-L+V-C-B+S)*P,dr=X*rr;I=$*rr-Y;var cr=-Y*tr+Z*rr,ur=K-dr;T=K*tr-(z=W*rr);var lr=(M=K*$)-(g=X*Y),vr=(_=K*Z)-(m=Y*W);D=(w=Z-tr*$)*(j=1/(_-M*tr-m+g*tr+z*$-dr*Z));var pr=(C=X*tr-W)*j,yr=(E=-W*$+X*Z)*j,br=r.data;br[0]=ar*D+er*(I*j)-or*(cr*j),br[1]=ar*pr+er*(ur*j)-or*(T*j),br[2]=-ar*yr-er*(lr*j)+or*(vr*j),br[3]=ir*D+fr*(I*j)-nr*(cr*j),br[4]=ir*pr+fr*(ur*j)-nr*(T*j),br[5]=-ir*yr-fr*(lr*j)+nr*(vr*j),br[6]=sr*D+hr*(I*j)-cr*j,br[7]=sr*pr+hr*(ur*j)-T*j,br[8]=-sr*yr-hr*(lr*j)+vr*j},qsort:function(r,t,a,e){var o,i,f,n,s=0,h=0,d=0,c=0,u=0,l=0,p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=v;if(!(a-t+1<=1))for(q[0]=t,q[1]=a;s>=0;)for(h=q[s<<1],d=q[1+(s<<1)],s--;;){if((u=d-h+1)<=7){for(p=h+1;p<=d;p++)for(y=p;y>h&&e(r[y],r[y-1]);y--)o=r[y],r[y]=r[y-1],r[y-1]=o;break}for(A=0,w=h,M=d,m=h+(u>>1),u>40&&(k=h+(b=u>>3),z=h+(b<<1),i=r[g=h],f=r[k],n=r[z],h=e(i,f)?e(f,n)?k:e(i,n)?z:g:e(n,f)?k:e(i,n)?g:z,k=m,z=m+b,i=r[g=m-b],f=r[k],n=r[z],m=e(i,f)?e(f,n)?k:e(i,n)?z:g:e(n,f)?k:e(i,n)?g:z,k=d-b,z=d,i=r[g=d-(b<<1)],f=r[k],n=r[z],d=e(i,f)?e(f,n)?k:e(i,n)?z:g:e(n,f)?k:e(i,n)?g:z),k=m,z=d,i=r[g=h],f=r[k],n=r[z],(m=e(i,f)?e(f,n)?k:e(i,n)?z:g:e(n,f)?k:e(i,n)?g:z)!=w&&(o=r[m],r[m]=r[w],r[w]=o,m=w),h=_=w+1,d=x=M,i=r[m];;){for(;h<=d&&!e(i,r[h]);)e(r[h],i)||(h>_&&(o=r[_],r[_]=r[h],r[h]=o),A=1,_++),h++;for(;h<=d&&!e(r[d],i);)e(i,r[d])||(d<x&&(o=r[x],r[x]=r[d],r[d]=o),A=1,x--),d--;if(h>d)break;o=r[h],r[h]=r[d],r[d]=o,A=1,h++,d--}if(0==A){for(d=M,p=(h=w)+1;p<=d;p++)for(y=p;y>h&&e(r[y],r[y-1]);y--)o=r[y],r[y]=r[y-1],r[y-1]=o;break}for(l=h-(u=Math.min(_-w,h-_))|0,c=0;c<u;++c,++l)o=r[w+c],r[w+c]=r[l],r[l]=o;for(l=M-(u=Math.min(M-x,x-d))+1|0,c=0;c<u;++c,++l)o=r[h+c],r[h+c]=r[l],r[l]=o;if(l=x-d,(u=h-_)>1)l>1?u>l?(q[++s<<1]=w,q[1+(s<<1)]=w+u-1,h=M-l+1,d=M):(q[++s<<1]=M-l+1,q[1+(s<<1)]=M,h=w,d=w+u-1):(h=w,d=w+u-1);else{if(!(l>1))break;h=M-l+1,d=M}}},median:y});const w=function(r,t,a,e){var o=r.rows,i=r.cols;o>e&&i>a&&(t.resize(a,e,r.channel),256&r.type&&256&t.type&&o*i/(e*a)<256?function(r,t,a,e){for(var o=0,i=r.channel,f=r.cols,n=r.rows,s=r.data,h=t.data,d=f/a,l=n/e,v=d*l*65536|0,p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,F=c(a*i<<2),B=c(a*i<<2),R=c(2*f*3<<2),S=F.i32,U=B.i32,V=R.i32;p<a;p++){for(_=(g=p*d)+1-1e-6|0,M=0|(k=g+d),_=Math.min(_,f-1),M=Math.min(M,f-1),_>g&&(V[m++]=p*i|0,V[m++]=(_-1)*i|0,V[m++]=256*(_-g)|0,o++),b=_;b<M;b++)o++,V[m++]=p*i|0,V[m++]=b*i|0,V[m++]=256;k-M>.001&&(o++,V[m++]=p*i|0,V[m++]=M*i|0,V[m++]=256*(k-M)|0)}for(p=0;p<a*i;p++)S[p]=U[p]=0;for(y=0,w=0;w<n;w++){for(z=f*w,m=0;m<o;m++)for(q=V[3*m],_=V[3*m+1],j=V[3*m+2],x=0;x<i;x++)S[q+x]+=s[z+_+x]*j;if((y+1)*l<=w+1||w==n-1){if(I=256-(O=256*Math.max(w+1-(y+1)*l,0)|0),A=a*y,O<=0)for(p=0;p<a*i;p++)h[A+p]=Math.min(Math.max((U[p]+256*S[p])/v,0),255),U[p]=S[p]=0;else for(p=0;p<a*i;p++)h[A+p]=Math.min(Math.max((U[p]+S[p]*I)/v,0),255),U[p]=S[p]*O,S[p]=0;y++}else for(p=0;p<a*i;p++)U[p]+=256*S[p],S[p]=0}u(B),u(F),u(R)}(r,t,a,e):function(r,t,a,e){for(var o=0,i=r.channel,f=r.cols,n=r.rows,s=r.data,h=t.data,d=f/a,l=n/e,v=1/(d*l),p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,F=c(a*i<<2),B=c(a*i<<2),R=c(2*f*3<<2),S=F.f32,U=B.f32,V=R.f32;p<a;p++){for(_=(g=p*d)+1-1e-6|0,M=0|(k=g+d),_=Math.min(_,f-1),M=Math.min(M,f-1),_>g&&(o++,V[m++]=(_-1)*i|0,V[m++]=p*i|0,V[m++]=(_-g)*v),b=_;b<M;b++)o++,V[m++]=b*i|0,V[m++]=p*i|0,V[m++]=v;k-M>.001&&(o++,V[m++]=M*i|0,V[m++]=p*i|0,V[m++]=(k-M)*v)}for(p=0;p<a*i;p++)S[p]=U[p]=0;for(y=0,w=0;w<n;w++){for(z=f*w,m=0;m<o;m++)for(_=0|V[3*m],q=0|V[3*m+1],j=V[3*m+2],x=0;x<i;x++)S[q+x]+=s[z+_+x]*j;if((y+1)*l<=w+1||w==n-1){if(I=1-(O=Math.max(w+1-(y+1)*l,0)),A=a*y,Math.abs(O)<.001)for(p=0;p<a*i;p++)h[A+p]=U[p]+S[p],U[p]=S[p]=0;else for(p=0;p<a*i;p++)h[A+p]=U[p]+S[p]*I,U[p]=S[p]*O,S[p]=0;y++}else for(p=0;p<a*i;p++)U[p]+=S[p],S[p]=0}u(B),u(F),u(R)}(r,t,a,e))},_=function(r,t,a,e){void 0===a&&(a=0),void 0===e&&(e=0);var o=r.cols,i=o>>1,f=r.rows>>1,n=i-(a<<1),s=f-(e<<1),h=0,d=0,c=a+e*o,u=0,l=0,v=0;t.resize(i,f,r.channel);var p=r.data,y=t.data;for(d=0;d<s;++d){for(u=c,v=l,h=0;h<=n-2;h+=2,v+=2,u+=4)y[v]=p[u]+p[u+1]+p[u+o]+p[u+o+1]+2>>2,y[v+1]=p[u+2]+p[u+3]+p[u+o+2]+p[u+o+3]+2>>2;for(;h<n;++h,++v,u+=2)y[v]=p[u]+p[u+1]+p[u+o]+p[u+o+1]+2>>2;c+=o<<1,l+=i}},M=function(r,t){var a,e,o,i,f,n,s,h,d=r.cols,l=r.rows,v=d<<1,p=0,y=0,b=0,w=0,_=0,M=0,x=0;t.resize(d,l,2);var m=r.data,g=t.data,k=c(d+2<<2),z=c(d+2<<2);for(256&r.type||512&r.type?(s=k.i32,h=z.i32):(s=k.f32,h=z.f32);y<l;++y,_+=d){for(w=(y>0?y-1:1)*d|0,M=(y<l-1?y+1:l-2)*d|0,x=y*v|0,p=0,b=1;p<=d-2;p+=2,b+=2)a=m[w+p],e=m[M+p],s[b]=3*(a+e)+10*m[_+p],h[b]=e-a,a=m[w+p+1],e=m[M+p+1],s[b+1]=3*(a+e)+10*m[_+p+1],h[b+1]=e-a;for(;p<d;++p,++b)a=m[w+p],e=m[M+p],s[b]=3*(a+e)+10*m[_+p],h[b]=e-a;for(p=d+1|0,s[0]=s[1],s[p]=s[d],h[0]=h[1],h[p]=h[d],p=0;p<=d-4;p+=4)a=h[p+2],e=h[p+1],o=h[p+3],i=h[p+4],f=s[p+2],n=s[p+3],g[x++]=f-s[p],g[x++]=3*(a+h[p])+10*e,g[x++]=n-s[p+1],g[x++]=3*(o+e)+10*a,g[x++]=s[p+4]-f,g[x++]=3*(i+a)+10*o,g[x++]=s[p+5]-n,g[x++]=3*(h[p+5]+o)+10*i;for(;p<d;++p)g[x++]=s[p+2]-s[p],g[x++]=3*(h[p+2]+h[p])+10*h[p+1]}u(k),u(z)},x=function(r,t){var a,e,o,i,f,n,s,h,d=r.cols,l=r.rows,v=d<<1,p=0,y=0,b=0,w=0,_=0,M=0,x=0;t.resize(d,l,2);var m=r.data,g=t.data,k=c(d+2<<2),z=c(d+2<<2);for(256&r.type||512&r.type?(s=k.i32,h=z.i32):(s=k.f32,h=z.f32);y<l;++y,_+=d){for(w=(y>0?y-1:1)*d|0,M=(y<l-1?y+1:l-2)*d|0,x=y*v|0,p=0,b=1;p<=d-2;p+=2,b+=2)a=m[w+p],e=m[M+p],s[b]=a+e+2*m[_+p],h[b]=e-a,a=m[w+p+1],e=m[M+p+1],s[b+1]=a+e+2*m[_+p+1],h[b+1]=e-a;for(;p<d;++p,++b)a=m[w+p],e=m[M+p],s[b]=a+e+2*m[_+p],h[b]=e-a;for(p=d+1|0,s[0]=s[1],s[p]=s[d],h[0]=h[1],h[p]=h[d],p=0;p<=d-4;p+=4)a=h[p+2],e=h[p+1],o=h[p+3],i=h[p+4],f=s[p+2],n=s[p+3],g[x++]=f-s[p],g[x++]=a+h[p]+2*e,g[x++]=n-s[p+1],g[x++]=o+e+2*a,g[x++]=s[p+4]-f,g[x++]=i+a+2*o,g[x++]=s[p+5]-n,g[x++]=h[p+5]+o+2*i;for(;p<d;++p)g[x++]=s[p+2]-s[p],g[x++]=h[p+2]+h[p]+2*h[p+1]}u(k),u(z)},m=function(r,t,a,e){void 0===e&&(e=0);for(var o=r.cols,i=r.rows,f=t.cols,n=t.rows,s=r.data,h=t.data,d=0,c=0,u=0,l=0,v=0,p=0,y=0,b=0,w=0,_=0,M=0,x=a.data,m=x[0],g=x[1],k=x[2],z=x[3],A=x[4],q=x[5],j=0;c<n;++c)for(p=g*c+k,y=A*c+q,d=0;d<f;++d,++j,p+=m,y+=z)v=0|y,(l=0|p)>=0&&v>=0&&l<o-1&&v<i-1?(b=p-l,w=y-v,_=s[u=o*v+l]+b*(s[u+1]-s[u]),M=s[u+o]+b*(s[u+o+1]-s[u+o]),h[j]=_+w*(M-_)):h[j]=e};var g=Object.freeze({__proto__:null,grayscale:function(r,t,a,e,o){void 0===o&&(o=0);var i=0,f=0,n=0,s=0,h=0,d=0,c=4899,u=1868,l=4;2!=o&&3!=o||(c=1868,u=4899),1!=o&&3!=o||(l=3);var v=l<<1,p=3*l|0;e.resize(t,a,1);var y=e.data;for(f=0;f<a;++f,s+=t,n+=t*l){for(i=0,h=n,d=s;i<=t-4;i+=4,h+=l<<2,d+=4)y[d]=r[h]*c+9617*r[h+1]+r[h+2]*u+8192>>14,y[d+1]=r[h+l]*c+9617*r[h+l+1]+r[h+l+2]*u+8192>>14,y[d+2]=r[h+v]*c+9617*r[h+v+1]+r[h+v+2]*u+8192>>14,y[d+3]=r[h+p]*c+9617*r[h+p+1]+r[h+p+2]*u+8192>>14;for(;i<t;++i,++d,h+=l)y[d]=r[h]*c+9617*r[h+1]+r[h+2]*u+8192>>14}},resample:w,box_blur_gray:function(r,t,a,e){void 0===e&&(e=0);var o=r.cols,i=r.rows,f=i<<1,n=o<<1,s=0,h=0,d=0,l=0,v=1+(a<<1)|0,p=a+1|0,y=p+1|0,b=1&e?1:1/(v*v),w=c(o*i<<2),_=0,M=0,x=0,m=0,g=0,k=w.i32,z=r.data,A=0;for(t.resize(o,i,r.channel),d=0;d<i;++d){for(M=d,_=p*z[x],s=x+1|0,l=x+a|0;s<=l;++s)_+=z[s];for(m=x+p|0,A=z[g=x],h=0;h<a;++h,M+=i)k[M]=_,_+=z[m]-A,m++;for(;h<o-y;h+=2,M+=f)k[M]=_,_+=z[m]-z[g],k[M+i]=_,_+=z[m+1]-z[g+1],m+=2,g+=2;for(;h<o-p;++h,M+=i)k[M]=_,_+=z[m]-z[g],m++,g++;for(A=z[m-1];h<o;++h,M+=i)k[M]=_,_+=A-z[g],g++;x+=o}if(x=0,z=t.data,1==b)for(d=0;d<o;++d){for(M=d,_=p*k[x],s=x+1|0,l=x+a|0;s<=l;++s)_+=k[s];for(m=x+p,A=k[g=x],h=0;h<a;++h,M+=o)z[M]=_,_+=k[m]-A,m++;for(;h<i-y;h+=2,M+=n)z[M]=_,_+=k[m]-k[g],z[M+o]=_,_+=k[m+1]-k[g+1],m+=2,g+=2;for(;h<i-p;++h,M+=o)z[M]=_,_+=k[m]-k[g],m++,g++;for(A=k[m-1];h<i;++h,M+=o)z[M]=_,_+=A-k[g],g++;x+=i}else for(d=0;d<o;++d){for(M=d,_=p*k[x],s=x+1|0,l=x+a|0;s<=l;++s)_+=k[s];for(m=x+p,A=k[g=x],h=0;h<a;++h,M+=o)z[M]=_*b,_+=k[m]-A,m++;for(;h<i-y;h+=2,M+=n)z[M]=_*b,_+=k[m]-k[g],z[M+o]=_*b,_+=k[m+1]-k[g+1],m+=2,g+=2;for(;h<i-p;++h,M+=o)z[M]=_*b,_+=k[m]-k[g],m++,g++;for(A=k[m-1];h<i;++h,M+=o)z[M]=_*b,_+=A-k[g],g++;x+=i}u(w)},gaussian_blur:function(r,t,a,e){void 0===e&&(e=0),void 0===a&&(a=0);var o=(a=0==a?2*Math.max(1,4*e+1-1e-8)+1|0:a)>>1,i=r.cols,f=r.rows,n=r.type,s=256&n;t.resize(i,f,r.channel);var h,d,l=r.data,v=t.data,y=a+Math.max(f,i)|0,b=c(y<<2),w=c(a<<2);s?(h=b.i32,d=w.i32):512&n?(h=b.i32,d=w.f32):(h=b.f32,d=w.f32),p(a,e,d,n),s?function(r,t,a,e,o,i,f,n){for(var s=0,h=0,d=0,c=0,u=0,l=0,v=0,p=0,y=0,b=i[0],w=0,_=e<<1,M=3*e,x=e<<2;s<o;++s){for(l=t[c],h=0;h<n;++h)r[h]=l;for(h=0;h<=e-2;h+=2)r[h+n]=t[c+h],r[h+n+1]=t[c+h+1];for(;h<e;++h)r[h+n]=t[c+h];for(l=t[c+e-1],h=e;h<n+e;++h)r[h+n]=l;for(h=0;h<=e-4;h+=4){for(l=r[h]*b,v=r[h+1]*b,p=r[h+2]*b,y=r[h+3]*b,d=1;d<f;++d)w=i[d],l+=r[d+h]*w,v+=r[d+h+1]*w,p+=r[d+h+2]*w,y+=r[d+h+3]*w;a[u+h]=Math.min(l>>8,255),a[u+h+1]=Math.min(v>>8,255),a[u+h+2]=Math.min(p>>8,255),a[u+h+3]=Math.min(y>>8,255)}for(;h<e;++h){for(l=r[h]*b,d=1;d<f;++d)l+=r[d+h]*i[d];a[u+h]=Math.min(l>>8,255)}c+=e,u+=e}for(s=0;s<e;++s){for(l=a[s],h=0;h<n;++h)r[h]=l;for(d=s,h=0;h<=o-2;h+=2,d+=_)r[h+n]=a[d],r[h+n+1]=a[d+e];for(;h<o;++h,d+=e)r[h+n]=a[d];for(l=a[(o-1)*e+s],h=o;h<n+o;++h)r[h+n]=l;for(u=s,h=0;h<=o-4;h+=4,u+=x){for(l=r[h]*b,v=r[h+1]*b,p=r[h+2]*b,y=r[h+3]*b,d=1;d<f;++d)w=i[d],l+=r[d+h]*w,v+=r[d+h+1]*w,p+=r[d+h+2]*w,y+=r[d+h+3]*w;a[u]=Math.min(l>>8,255),a[u+e]=Math.min(v>>8,255),a[u+_]=Math.min(p>>8,255),a[u+M]=Math.min(y>>8,255)}for(;h<o;++h,u+=e){for(l=r[h]*b,d=1;d<f;++d)l+=r[d+h]*i[d];a[u]=Math.min(l>>8,255)}}}(h,l,v,i,f,d,a,o):function(r,t,a,e,o,i,f,n){for(var s=0,h=0,d=0,c=0,u=0,l=0,v=0,p=0,y=0,b=i[0],w=0,_=e<<1,M=3*e,x=e<<2;s<o;++s){for(l=t[c],h=0;h<n;++h)r[h]=l;for(h=0;h<=e-2;h+=2)r[h+n]=t[c+h],r[h+n+1]=t[c+h+1];for(;h<e;++h)r[h+n]=t[c+h];for(l=t[c+e-1],h=e;h<n+e;++h)r[h+n]=l;for(h=0;h<=e-4;h+=4){for(l=r[h]*b,v=r[h+1]*b,p=r[h+2]*b,y=r[h+3]*b,d=1;d<f;++d)w=i[d],l+=r[d+h]*w,v+=r[d+h+1]*w,p+=r[d+h+2]*w,y+=r[d+h+3]*w;a[u+h]=l,a[u+h+1]=v,a[u+h+2]=p,a[u+h+3]=y}for(;h<e;++h){for(l=r[h]*b,d=1;d<f;++d)l+=r[d+h]*i[d];a[u+h]=l}c+=e,u+=e}for(s=0;s<e;++s){for(l=a[s],h=0;h<n;++h)r[h]=l;for(d=s,h=0;h<=o-2;h+=2,d+=_)r[h+n]=a[d],r[h+n+1]=a[d+e];for(;h<o;++h,d+=e)r[h+n]=a[d];for(l=a[(o-1)*e+s],h=o;h<n+o;++h)r[h+n]=l;for(u=s,h=0;h<=o-4;h+=4,u+=x){for(l=r[h]*b,v=r[h+1]*b,p=r[h+2]*b,y=r[h+3]*b,d=1;d<f;++d)w=i[d],l+=r[d+h]*w,v+=r[d+h+1]*w,p+=r[d+h+2]*w,y+=r[d+h+3]*w;a[u]=l,a[u+e]=v,a[u+_]=p,a[u+M]=y}for(;h<o;++h,u+=e){for(l=r[h]*b,d=1;d<f;++d)l+=r[d+h]*i[d];a[u]=l}}}(h,l,v,i,f,d,a,o),u(b),u(w)},hough_transform:function(r,t,a,e){for(var o=r.data,i=r.cols,f=r.rows,n=i,s=Math.PI,h=Math.round((s-0)/a),d=Math.round((2*(i+f)+1)/t),c=1/t,u=new Int32Array((h+2)*(d+2)),l=new Float32Array(h),v=new Float32Array(h),p=0,y=0;p<h;p++)l[p]=Math.sin(y)*c,v[p]=Math.cos(y)*c,y+=a;for(var b=0;b<f;b++)for(var w=0;w<i;w++)if(0!=o[b*n+w])for(let r=0;r<h;r++){var _=Math.round(w*v[r]+b*l[r]);u[(r+1)*(d+2)+(_+=(d-1)/2)+1]+=1}var M=new Array;for(let r=0;r<d;r++)for(let t=0;t<h;t++){var x=(t+1)*(d+2)+r+1;u[x]>e&&u[x]>u[x-1]&&u[x]>=u[x+1]&&u[x]>u[x-d-2]&&u[x]>=u[x+d+2]&&M.push(x)}M.sort((function(r,t){return u[r]>u[t]||u[r]==u[t]&&r<t}));var m=Math.min(h*d,M.length),g=1/(d+2),k=new Array;for(let r=0;r<m;r++){var z=M[r];let e=Math.floor(z*g)-1;var A=(z-(e+1)*(d+2)-1-.5*(d-1))*t,q=e*a;k.push([A,q])}return k},pyrdown:_,scharr_derivatives:M,sobel_derivatives:x,compute_integral_image:function(r,t,a,e){var o=0|r.cols,i=0|r.rows,f=r.data,n=o+1|0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,p=0;if(t&&a){for(;u<n;++u)t[u]=0,a[u]=0;for(d=n+1|0,c=1,u=0,p=0;u<i;++u,++d,++c){for(s=h=0,l=0;l<=o-2;l+=2,p+=2,d+=2,c+=2)s+=v=f[p],h+=v*v,t[d]=t[c]+s,a[d]=a[c]+h,s+=v=f[p+1],h+=v*v,t[d+1]=t[c+1]+s,a[d+1]=a[c+1]+h;for(;l<o;++l,++p,++d,++c)s+=v=f[p],h+=v*v,t[d]=t[c]+s,a[d]=a[c]+h}}else if(t){for(;u<n;++u)t[u]=0;for(d=n+1|0,c=1,u=0,p=0;u<i;++u,++d,++c){for(s=0,l=0;l<=o-2;l+=2,p+=2,d+=2,c+=2)s+=f[p],t[d]=t[c]+s,s+=f[p+1],t[d+1]=t[c+1]+s;for(;l<o;++l,++p,++d,++c)s+=f[p],t[d]=t[c]+s}}else if(a){for(;u<n;++u)a[u]=0;for(d=n+1|0,c=1,u=0,p=0;u<i;++u,++d,++c){for(h=0,l=0;l<=o-2;l+=2,p+=2,d+=2,c+=2)h+=(v=f[p])*v,a[d]=a[c]+h,h+=(v=f[p+1])*v,a[d+1]=a[c+1]+h;for(;l<o;++l,++p,++d,++c)h+=(v=f[p])*v,a[d]=a[c]+h}}if(e){for(u=0;u<n;++u)e[u]=0;for(d=n+1|0,c=0,u=0,p=0;u<i;++u,++d,++c){for(l=0;l<=o-2;l+=2,p+=2,d+=2,c+=2)e[d]=f[p]+e[c],e[d+1]=f[p+1]+e[c+1];for(;l<o;++l,++p,++d,++c)e[d]=f[p]+e[c]}for(d=n+o|0,c=o,u=0;u<i;++u,d+=n,c+=n)e[d]+=e[c];for(l=o-1;l>0;--l)for(c=(d=l+i*n)-n,u=i;u>0;--u,d-=n,c-=n)e[d]+=e[c]+e[c+1]}},equalize_histogram:function(r,t){var a=r.cols,e=r.rows,o=r.data;t.resize(a,e,r.channel);var i,f,n=t.data,s=a*e,h=0,d=0,l=c(1024);for(i=l.i32;h<256;++h)i[h]=0;for(h=0;h<s;++h)++i[o[h]];for(d=i[0],h=1;h<256;++h)d=i[h]+=d;for(f=255/s,h=0;h<s;++h)n[h]=i[o[h]]*f+.5|0;u(l)},canny:function(r,t,a,e){var o=r.cols,i=r.rows;t.resize(o,i,r.channel);var n=t.data,s=0,h=0,d=0,l=o<<1,v=0,p=0,y=0,b=0,w=0,_=0,M=0,m=0,g=c(i*l<<2),k=c(3*(o+2)<<2),z=c((i+2)*(o+2)<<2),A=c(i*o<<2),q=k.i32,j=z.i32,O=A.i32,I=g.i32,F=new f(o,i,514,g.data),B=1,R=o+2+1|0,S=2*(o+2)+1|0,U=o+2|0,V=U+1|0,C=0;for(x(r,F),a>e&&(s=a,a=e,e=s),s=3*(o+2)|0;--s>=0;)q[s]=0;for(s=(i+2)*(o+2)|0;--s>=0;)j[s]=0;for(;h<o;++h,d+=2)b=I[d],w=I[d+1],q[R+h]=(b^b>>31)-(b>>31)+((w^w>>31)-(w>>31));for(s=1;s<=i;++s,d+=l){if(s==i)for(h=S+o;--h>=S;)q[h]=0;else for(h=0;h<o;h++)b=I[d+(h<<1)],w=I[d+(h<<1)+1],q[S+h]=(b^b>>31)-(b>>31)+((w^w>>31)-(w>>31));for(v=d-l|0,j[V-1]=0,p=0,h=0;h<o;++h,v+=2){if((y=q[R+h])>a)if(_=(b=I[v])^(w=I[v+1]),w=(w^w>>31)-(w>>31)|0,m=(M=13573*(b=(b^b>>31)-(b>>31)|0))+(b+b<<15),(w<<=15)<M){if(y>q[R+h-1]&&y>=q[R+h+1]){y>e&&!p&&2!=j[V+h-U]?(j[V+h]=2,p=1,O[C++]=V+h):j[V+h]=1;continue}}else if(w>m){if(y>q[B+h]&&y>=q[S+h]){y>e&&!p&&2!=j[V+h-U]?(j[V+h]=2,p=1,O[C++]=V+h):j[V+h]=1;continue}}else if(y>q[B+h-(_=_<0?-1:1)]&&y>q[S+h+_]){y>e&&!p&&2!=j[V+h-U]?(j[V+h]=2,p=1,O[C++]=V+h):j[V+h]=1;continue}j[V+h]=0,p=0}j[V+o]=0,V+=U,h=B,B=R,R=S,S=h}for(h=V-U-1,s=0;s<U;++s,++h)j[h]=0;for(;C>0;)V=O[--C],1==j[V-=U+1]&&(j[V]=2,O[C++]=V),1==j[V+=1]&&(j[V]=2,O[C++]=V),1==j[V+=1]&&(j[V]=2,O[C++]=V),1==j[V+=U]&&(j[V]=2,O[C++]=V),1==j[V-=2]&&(j[V]=2,O[C++]=V),1==j[V+=U]&&(j[V]=2,O[C++]=V),1==j[V+=1]&&(j[V]=2,O[C++]=V),1==j[V+=1]&&(j[V]=2,O[C++]=V);for(V=U+1,B=0,s=0;s<i;++s,V+=U)for(h=0;h<o;++h)n[B++]=255*(2==j[V+h]);u(g),u(k),u(z),u(A)},warp_perspective:function(r,t,a,e){void 0===e&&(e=0);for(var o=0|r.cols,i=0|r.rows,f=0|t.cols,n=0|t.rows,s=r.data,h=t.data,d=0,c=0,u=0,l=0,v=0,p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=a.data,A=z[0],q=z[1],j=z[2],O=z[3],I=z[4],F=z[5],B=z[6],R=z[7],S=z[8],U=0;c<n;++c)for(b=q*c+j,w=I*c+F,_=R*c+S,d=0;d<f;++d,++U,b+=A,w+=O,_+=B)l=0|(p=b*(M=1/_)),v=0|(y=w*M),p>0&&y>0&&l<o-1&&v<i-1?(x=Math.max(p-l,0),m=Math.max(y-v,0),g=s[u=o*v+l|0]+x*(s[u+1]-s[u]),k=s[u+o]+x*(s[u+o+1]-s[u+o]),h[U]=g+m*(k-g)):h[U]=e},warp_affine:m,skindetector:function(r,t){for(var a,e,o,i,f=r.width*r.height;f--;)i=4*f,a=r.data[i],e=r.data[i+1],o=r.data[i+2],a>95&&e>40&&o>20&&a>e&&a>o&&a-Math.min(e,o)>15&&Math.abs(a-e)>15?t[f]=255:t[f]=0}});function k(r){this.levels=0|r,this.data=new Array(r),this.pyrdown=_}k.prototype.allocate=function(r,t,a){for(var e=this.levels;--e>=0;)this.data[e]=new f(r>>e,t>>e,a)},k.prototype.build=function(r,t){void 0===t&&(t=!0);var a=2,e=r,o=this.data[0];if(!t)for(var i=r.cols*r.rows;--i>=0;)o.data[i]=r.data[i];for(o=this.data[1],this.pyrdown(e,o);a<this.levels;++a)e=o,o=this.data[a],this.pyrdown(e,o)};const z=function(r,t){for(var a=0,e=0,o=t.rows,i=t.cols,f=0,n=0,s=0,h=t.data,d=r.data;a<o;n+=1,f+=i,a++)for(s=n,e=0;e<i;s+=o,e++)d[s]=h[f+e]},A=function(r,t,a){for(var e=0,o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=t.cols,u=t.rows,l=a.cols,v=t.data,p=a.data,y=r.data,b=0;e<c;f++,e++)for(h=0,o=0;o<l;d++,h++,o++){for(s=h,n=f,b=0,i=0;i<u;n+=c,s+=l,i++)b+=v[n]*p[s];y[d]=b}},q=function(r,t){for(var a=0,e=0,o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=t.cols,u=t.rows,l=t.data,v=r.data,p=0;a<c;s+=c,a++)for(i=a,h=d=s+a,e=a;e<c;h++,d+=c,e++){for(f=i,n=e,p=0,o=0;o<u;f+=c,n+=c,o++)p+=l[f]*l[n];v[h]=p,v[d]=p}},j=function(r,t){var a=r.data,e=t.data,o=a[4],i=a[8],f=a[5],n=a[7],s=a[0],h=s*o,d=s*f,c=a[3],u=a[1],l=c*u,v=a[2],p=c*v,y=a[6],b=y*u,w=y*v,_=1/(h*i-d*n-l*i+p*n+b*f-w*o);e[0]=(o*i-f*n)*_,e[1]=-(u*i-v*n)*_,e[2]=-(-u*f+v*o)*_,e[3]=-(c*i-f*y)*_,e[4]=(s*i-w)*_,e[5]=-(d-p)*_,e[6]=-(-c*n+o*y)*_,e[7]=-(s*n-b)*_,e[8]=(h-l)*_},O=function(r,t,a){var e=r.data,o=t.data,i=a.data,f=o[0],n=o[1],s=o[2],h=o[3],d=o[4],c=o[5],u=o[6],l=o[7],v=o[8],p=i[0],y=i[1],b=i[2],w=i[3],_=i[4],M=i[5],x=i[6],m=i[7],g=i[8];e[0]=f*p+n*w+s*x,e[1]=f*y+n*_+s*m,e[2]=f*b+n*M+s*g,e[3]=h*p+d*w+c*x,e[4]=h*y+d*_+c*m,e[5]=h*b+d*M+c*g,e[6]=u*p+l*w+v*x,e[7]=u*y+l*_+v*m,e[8]=u*b+l*M+v*g},I=function(r,t,a,e,o,i,f,n,s){return r*o*s-r*i*n-e*t*s+e*a*n+f*t*i-f*a*o};var F=Object.freeze({__proto__:null,identity:function(r,t){void 0===t&&(t=1);for(var a=r.data,e=r.rows,o=r.cols,i=o+1|0,f=e*o,n=f;--f>=0;)a[f]=0;for(f=n,n=0;n<f;)a[n]=t,n+=i},transpose:z,multiply:function(r,t,a){for(var e=0,o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=t.cols,u=t.rows,l=a.cols,v=t.data,p=a.data,y=r.data,b=0;e<u;f+=c,e++)for(h=0,o=0;o<l;d++,h++,o++){for(s=h,n=f,b=0,i=0;i<c;n++,s+=l,i++)b+=v[n]*p[s];y[d]=b}},multiply_ABt:function(r,t,a){for(var e=0,o=0,i=0,f=0,n=0,s=0,h=0,d=t.cols,c=t.rows,u=a.rows,l=t.data,v=a.data,p=r.data,y=0;e<c;f+=d,e++)for(s=0,o=0;o<u;h++,o++){for(n=f,y=0,i=0;i<d;n++,s++,i++)y+=l[n]*v[s];p[h]=y}},multiply_AtB:A,multiply_AAt:function(r,t){for(var a=0,e=0,o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=t.cols,u=t.rows,l=t.data,v=r.data,p=0;a<u;i+=u+1,f=n,a++)for(h=i,d=i,s=f,e=a;e<u;h++,d+=u,e++){for(n=f,p=0,o=0;o<c;o++)p+=l[n++]*l[s++];v[h]=p,v[d]=p}},multiply_AtA:q,identity_3x3:function(r,t){void 0===t&&(t=1);var a=r.data;a[0]=a[4]=a[8]=t,a[1]=a[2]=a[3]=0,a[5]=a[6]=a[7]=0},invert_3x3:j,multiply_3x3:O,mat3x3_determinant:function(r){var t=r.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]},determinant_3x3:I}),B=function(r,t,a,e){e=r[t],r[t]=r[a],r[a]=e},R=function(r,t){return(r=Math.abs(r))>(t=Math.abs(t))?(t/=r,r*Math.sqrt(1+t*t)):t>0?(r/=t,t*Math.sqrt(1+r*r)):0};const S=function(r,a){var e,o,i,f,n=0,s=0,h=0,d=r.cols,c=r.data,u=a.data;for(n=0;n<d;n++){for(h=n,s=n+1;s<d;s++)Math.abs(c[s*d+n])>Math.abs(c[h*d+n])&&(h=s);if(Math.abs(c[h*d+n])<t)return 0;if(h!=n){for(s=n;s<d;s++)B(c,n*d+s,h*d+s,e);B(u,n,h,e)}for(i=-1/c[n*d+n],s=n+1;s<d;s++){for(o=c[s*d+n]*i,h=n+1;h<d;h++)c[s*d+h]+=o*c[n*d+h];u[s]+=o*u[n]}c[n*d+n]=-i}for(n=d-1;n>=0;n--){for(f=u[n],h=n+1;h<d;h++)f-=c[n*d+h]*u[h];u[n]=f*c[n*d+n]}return 1},U=function(r,t,a){for(var e=r.cols,o=e*e,i=1|r.type,n=c(e*e<<3),s=c(e<<3),h=new f(e,e,i,n.data),d=new f(1,e,i,s.data);--o>=0;)h.data[o]=r.data[o];if(function(r,t,a,e,o,i){var f=0,n=0,s=0,h=0,d=0,l=0,v=0,p=0,y=0,b=i*i*30,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=c(i<<2),j=c(i<<2),O=q.i32,I=j.i32;if(e)for(;f<i;f++){for(s=f*o,n=0;n<i;n++)e[s+n]=0;e[s+f]=1}for(s=0;s<i;s++){if(a[s]=r[(t+1)*s],s<i-1){for(h=s+1,w=Math.abs(r[t*s+h]),f=s+2;f<i;f++)w<(_=Math.abs(r[t*s+f]))&&(w=_,h=f);O[s]=h}if(s>0){for(h=0,w=Math.abs(r[s]),f=1;f<s;f++)w<(_=Math.abs(r[t*f+s]))&&(w=_,h=f);I[s]=h}}if(i>1)for(;y<b;y++){for(s=0,w=Math.abs(r[O[0]]),f=1;f<i-1;f++)w<(_=Math.abs(r[t*f+O[f]]))&&(w=_,s=f);for(d=O[s],f=1;f<i;f++)w<(_=Math.abs(r[t*I[f]+f]))&&(w=_,s=I[f],d=f);if(M=r[t*s+d],Math.abs(M)<=1.192092896e-7)break;for(x=.5*(a[d]-a[s]),k=(m=Math.abs(x)+R(M,x))/(g=R(M,m)),g=M/g,m=M/m*M,x<0&&(g=-g,m=-m),r[t*s+d]=0,a[s]-=m,a[d]+=m,f=0;f<s;f++)p=t*f+d,z=r[v=t*f+s],A=r[p],r[v]=z*k-A*g,r[p]=z*g+A*k;for(f=s+1;f<d;f++)p=t*f+d,z=r[v=t*s+f],A=r[p],r[v]=z*k-A*g,r[p]=z*g+A*k;for(v=t*s+(f=d+1),p=t*d+f;f<i;f++,v++,p++)z=r[v],A=r[p],r[v]=z*k-A*g,r[p]=z*g+A*k;if(e)for(v=o*s,p=o*d,f=0;f<i;f++,v++,p++)z=e[v],A=e[p],e[v]=z*k-A*g,e[p]=z*g+A*k;for(n=0;n<2;n++){if((l=0==n?s:d)<i-1){for(h=l+1,w=Math.abs(r[t*l+h]),f=l+2;f<i;f++)w<(_=Math.abs(r[t*l+f]))&&(w=_,h=f);O[l]=h}if(l>0){for(h=0,w=Math.abs(r[l]),f=1;f<l;f++)w<(_=Math.abs(r[t*f+l]))&&(w=_,h=f);I[l]=h}}}for(s=0;s<i-1;s++){for(h=s,f=s+1;f<i;f++)a[h]<a[f]&&(h=f);if(s!=h&&(B(a,h,s,w),e))for(f=0;f<i;f++)B(e,o*h+f,o*s+f,w)}u(q),u(j)}(h.data,e,d.data,t?t.data:null,e,e),a)for(;--e>=0;)a.data[e]=d.data[e];u(n),u(s)};var V=Object.freeze({__proto__:null,lu_solve:S,cholesky_solve:function(r,t){var a,e,o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=r.cols,u=r.data,l=t.data;for(o=0;o<c;o++)for(e=1,s=n=o*c,i=o;i<c;i++){for(a=u[s+o],f=0;f<o;f++)a-=u[f*c+o]*u[s+f];if(i==o){if(u[s+o]=a,0==a)return 0;e=1/a}else u[n+i]=a,u[s+o]=a*e;s+=c}for(n=0,h=0;h<c;h++){for(a=l[h],d=0;d<h;d++)a-=u[n+d]*l[d];l[h]=a,n+=c}for(n=0,h=0;h<c;h++)l[h]/=u[n+h],n+=c;for(h=c-1;h>=0;h--){for(a=l[h],n=(d=h+1)*c;d<c;d++)a-=u[n+h]*l[d],n+=c;l[h]=a}return 1},svd_decompose:function(r,t,a,e,o){void 0===o&&(o=0);var i=0,n=0,s=r.rows,h=r.cols,d=s,l=h,v=1|r.type;d<l&&(i=1,n=d,d=l,l=n);var p=c(d*d<<3),y=c(l<<3),b=c(l*l<<3),w=new f(d,d,v,p.data),_=new f(1,l,v,y.data),M=new f(l,l,v,b.data);if(0==i)z(w,r);else{for(n=0;n<h*s;n++)w.data[n]=r.data[n];for(;n<l*d;n++)w.data[n]=0}if(function(r,t,a,e,o,i,f,n){for(var s=0,h=0,d=0,l=0,v=Math.max(i,30),p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0,j=0,O=0,I=0,F=0,S=4660,U=0,V=0,C=0,P=c(f<<3),Q=P.f64;s<f;s++){for(d=0,z=0;d<i;d++)z+=(m=r[s*t+d])*m;if(Q[s]=z,e){for(d=0;d<f;d++)e[s*o+d]=0;e[s*o+s]=1}}for(;l<v;l++){for(_=0,s=0;s<f-1;s++)for(h=s+1;h<f;h++){for(p=s*t|0,y=h*t|0,O=Q[s],I=0,F=Q[h],d=2,I+=r[p]*r[y],I+=r[p+1]*r[y+1];d<i;d++)I+=r[p+d]*r[y+d];if(!(Math.abs(I)<=2.384185792e-7*Math.sqrt(O*F))){for(q=R(I*=2,A=O-F),A<0?(j=.5*(q-A),M=I/(q*(x=Math.sqrt(j/q))*2)):x=I/(q*(M=Math.sqrt((q+A)/(2*q)))*2),O=0,F=0,d=2,g=M*r[p]+x*r[y],k=-x*r[p]+M*r[y],r[p]=g,r[y]=k,O+=g*g,F+=k*k,g=M*r[p+1]+x*r[y+1],k=-x*r[p+1]+M*r[y+1],r[p+1]=g,r[y+1]=k,O+=g*g,F+=k*k;d<i;d++)g=M*r[p+d]+x*r[y+d],k=-x*r[p+d]+M*r[y+d],r[p+d]=g,r[y+d]=k,O+=g*g,F+=k*k;if(Q[s]=O,Q[h]=F,_=1,e)for(w=h*o|0,d=2,g=M*e[b=s*o|0]+x*e[w],k=-x*e[b]+M*e[w],e[b]=g,e[w]=k,g=M*e[b+1]+x*e[w+1],k=-x*e[b+1]+M*e[w+1],e[b+1]=g,e[w+1]=k;d<f;d++)g=M*e[b+d]+x*e[w+d],k=-x*e[b+d]+M*e[w+d],e[b+d]=g,e[w+d]=k}}if(0==_)break}for(s=0;s<f;s++){for(d=0,z=0;d<i;d++)z+=(m=r[s*t+d])*m;Q[s]=Math.sqrt(z)}for(s=0;s<f-1;s++){for(h=s,d=s+1;d<f;d++)Q[h]<Q[d]&&(h=d);if(s!=h&&(B(Q,s,h,z),e)){for(d=0;d<i;d++)B(r,s*t+d,h*t+d,m);for(d=0;d<f;d++)B(e,s*o+d,h*o+d,m)}}for(s=0;s<f;s++)a[s]=Q[s];if(e){for(s=0;s<n;s++){for(z=s<f?Q[s]:0;z<=1e-37;){for(V=1/i,d=0;d<i;d++)U=0!=(256&(S=214013*S+2531011)>>16)?V:-V,r[s*t+d]=U;for(l=0;l<2;l++)for(h=0;h<s;h++){for(z=0,d=0;d<i;d++)z+=r[s*t+d]*r[h*t+d];for(C=0,d=0;d<i;d++)m=r[s*t+d]-z*r[h*t+d],r[s*t+d]=m,C+=Math.abs(m);for(C=C?1/C:0,d=0;d<i;d++)r[s*t+d]*=C}for(z=0,d=0;d<i;d++)z+=(m=r[s*t+d])*m;z=Math.sqrt(z)}for(x=1/z,d=0;d<i;d++)r[s*t+d]*=x}u(P)}else u(P)}(w.data,d,_.data,M.data,l,d,l,d),t){for(n=0;n<l;n++)t.data[n]=_.data[n];for(;n<h;n++)t.data[n]=0}if(0==i){if(a&&1&o)for(n=d*d;--n>=0;)a.data[n]=w.data[n];else a&&z(a,w);if(e&&2&o)for(n=l*l;--n>=0;)e.data[n]=M.data[n];else e&&z(e,M)}else{if(a&&1&o)for(n=l*l;--n>=0;)a.data[n]=M.data[n];else a&&z(a,M);if(e&&2&o)for(n=d*d;--n>=0;)e.data[n]=w.data[n];else e&&z(e,w)}u(p),u(y),u(b)},svd_solve:function(r,a,e){var o,i=0,n=0,s=0,h=0,d=0,l=r.rows,v=r.cols,p=0,y=0,b=1|r.type,w=c(l*l<<3),_=c(v<<3),M=c(v*v<<3),x=new f(l,l,b,w.data),m=new f(1,v,b,_.data),g=new f(v,v,b,M.data),k=e.data,z=x.data,A=m.data,q=g.data;for(this.svd_decompose(r,m,x,g,0),o=t*A[0]*v;i<v;i++,d+=v){for(y=0,n=0;n<v;n++)if(A[n]>o){for(s=0,p=0,h=0;s<l;s++,h+=v)p+=z[h+n]*k[s];y+=p*q[d+n]/A[n]}a.data[i]=y}u(w),u(_),u(M)},svd_invert:function(r,a){var e,o=0,i=0,n=0,s=0,h=0,d=0,l=a.rows,v=a.cols,p=0,y=1|a.type,b=c(l*l<<3),w=c(v<<3),_=c(v*v<<3),M=new f(l,l,y,b.data),x=new f(1,v,y,w.data),m=new f(v,v,y,_.data),g=r.data,k=M.data,z=x.data,A=m.data;for(this.svd_decompose(a,x,M,m,0),e=t*z[0]*v;o<v;o++,h+=v)for(i=0,s=0;i<l;i++,d++){for(n=0,p=0;n<v;n++,s++)z[n]>e&&(p+=A[h+n]*k[s]/z[n]);g[d]=p}u(b),u(w),u(_)},eigenVV:U}),C=function(r,t,a,e,o,i,f){for(var n=[],s=0,h=0,d=0,c=0,u=!1;d<1e3;++d){for(s=0;s<e&&d<1e3;){for(u=!1,c=0;!u;)for(u=!0,c=n[s]=0|Math.floor(Math.random()*o),h=0;h<s;++h)if(c==n[h]){u=!1;break}i[s]=t[c],f[s]=a[c],r.check_subset(i,f,s+1)?++s:d++}break}return s==e&&d<1e3},P=function(r,t,a,e,o,i,f,n){var s=0,h=0,d=0,c=i*i;for(r.error(a,e,t,f,o);h<o;++h)d=f[h]<=c,n[h]=d,s+=d;return s};var Q=Object.freeze({__proto__:null,ransac:function(r,t,a,e,o,i,n,s){if(void 0===s&&(s=1e3),o<r.size)return!1;var h=r.size,d=s,l=0,v=!1,p=[],y=[],b=i.cols,w=i.rows,_=1|i.type,M=c(b*w<<3),x=c(o),m=c(o<<2),g=new f(b,w,_,M.data),k=new f(o,1,257,x.data),z=-1,A=0,q=m.f32;if(o==h){if(t.run(a,e,g,o)<=0)return u(M),u(x),u(m),!1;if(g.copy_to(i),n)for(;--o>=0;)n.data[o]=1;return u(M),u(x),u(m),!0}for(;l<d;++l){if(!C(t,a,e,h,o,p,y)){if(0==l)return u(M),u(x),u(m),!1;break}t.run(p,y,g,h)<=0||(A=P(t,g,a,e,o,r.thresh,q,k.data))>Math.max(z,h-1)&&(g.copy_to(i),z=A,n&&k.copy_to(n),d=r.update_iters((o-A)/o,d),v=!0)}return u(M),u(x),u(m),v},lmeds:function(r,t,a,e,o,i,n,s){if(void 0===s&&(s=1e3),o<r.size)return!1;var h=r.size,d=s,l=0,v=!1,p=[],b=[],w=i.cols,_=i.rows,M=1|i.type,x=c(w*_<<3),m=c(o),g=c(o<<2),k=new f(w,_,M,x.data),z=new f(o,1,257,m.data),A=0,q=g.f32,j=1e9,O=0,I=0;if(r.eps=.45,d=r.update_iters(r.eps,d),o==h){if(t.run(a,e,k,o)<=0)return u(x),u(m),u(g),!1;if(k.copy_to(i),n)for(;--o>=0;)n.data[o]=1;return u(x),u(m),u(g),!0}for(;l<d;++l){if(!C(t,a,e,h,o,p,b)){if(0==l)return u(x),u(m),u(g),!1;break}t.run(p,b,k,h)<=0||(t.error(a,e,k,q,o),(I=y(q,0,o-1))<j&&(j=I,k.copy_to(i),v=!0))}return v&&(O=2.5*1.4826*(1+5/(o-h))*Math.sqrt(j),O=Math.max(O,.001),A=P(t,i,a,e,o,O,q,z.data),n&&z.copy_to(n),v=A>=h),u(x),u(m),u(g),v}}),T=function(r){return r*r},E=new f(3,3,1025),H=new f(3,3,1025),L=new f(6,6,1025),N=new f(6,1,1025);function D(){}D.prototype.run=function(r,t,a,e){var o,i,n=0,s=0,h=1|a.type,d=a.data,l=E.data,v=H.data,p=0,y=0;!function(r,t,a,e,o){for(var i,f,n=0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,p=0;n<o;++n)s+=r[n].x,h+=r[n].y,c+=t[n].x,u+=t[n].y;for(s/=o,h/=o,c/=o,u/=o,n=0;n<o;++n)v=r[n].x-s,p=r[n].y-h,d+=Math.sqrt(v*v+p*p),v=t[n].x-c,p=t[n].y-u,l+=Math.sqrt(v*v+p*p);d/=o,l/=o,i=Math.SQRT2/d,f=Math.SQRT2/l,a[0]=a[4]=i,a[2]=-s*i,a[5]=-h*i,a[1]=a[3]=a[6]=a[7]=0,a[8]=1,e[0]=e[4]=f,e[2]=-c*f,e[5]=-u*f,e[1]=e[3]=e[6]=e[7]=0,e[8]=1}(r,t,l,v,e);for(var b=c(2*e*6<<3),w=c(2*e<<3),_=new f(6,2*e,h,b.data),M=new f(1,2*e,h,w.data),x=_.data,m=M.data;n<e;++n)o=r[n],i=t[n],p=l[0]*o.x+l[1]*o.y+l[2],y=l[3]*o.x+l[4]*o.y+l[5],x[s=2*n*6]=p,x[s+1]=y,x[s+2]=1,x[s+3]=0,x[s+4]=0,x[s+5]=0,x[s+=6]=0,x[s+1]=0,x[s+2]=0,x[s+3]=p,x[s+4]=y,x[s+5]=1,m[n<<1]=v[0]*i.x+v[1]*i.y+v[2],m[1+(n<<1)]=v[3]*i.x+v[4]*i.y+v[5];return q(L,_),A(N,_,M),S(L,N),d[0]=N.data[0],d[1]=N.data[1],d[2]=N.data[2],d[3]=N.data[3],d[4]=N.data[4],d[5]=N.data[5],d[6]=0,d[7]=0,d[8]=1,j(H,H),O(a,H,a),O(a,a,E),u(b),u(w),1},D.prototype.error=function(r,t,a,e,o){for(var i,f,n=0,s=a.data;n<o;++n)i=r[n],f=t[n],e[n]=T(f.x-s[0]*i.x-s[1]*i.y-s[2])+T(f.y-s[3]*i.x-s[4]*i.y-s[5])},D.prototype.check_subset=function(){return!0};var G=new f(9,9,1025),J=new f(9,9,1025);function K(){}K.prototype.run=function(r,a,e,o){for(var i=0,f=0,n=e.data,s=E.data,h=H.data,d=G.data,c=J.data,u=0,l=0,v=0,p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0;i<o;++i)w+=a[i].x,_+=a[i].y,m+=r[i].x,g+=r[i].y;for(w/=o,_/=o,m/=o,g/=o,i=0;i<o;++i)y+=Math.abs(a[i].x-w),b+=Math.abs(a[i].y-_),M+=Math.abs(r[i].x-m),x+=Math.abs(r[i].y-g);if(Math.abs(y)<t||Math.abs(b)<t||Math.abs(M)<t||Math.abs(x)<t)return 0;for(y=o/y,b=o/b,M=o/M,x=o/x,s[0]=M,s[1]=0,s[2]=-m*M,s[3]=0,s[4]=x,s[5]=-g*x,s[6]=0,s[7]=0,s[8]=1,h[0]=1/y,h[1]=0,h[2]=w,h[3]=0,h[4]=1/b,h[5]=_,h[6]=0,h[7]=0,h[8]=1,i=81;--i>=0;)d[i]=0;for(i=0;i<o;++i)u=(a[i].x-w)*y,l=(a[i].y-_)*b,v=(r[i].x-m)*M,p=(r[i].y-g)*x,d[0]+=v*v,d[1]+=v*p,d[2]+=v,d[6]+=v*-u*v,d[7]+=v*-u*p,d[8]+=v*-u,d[10]+=p*p,d[11]+=p,d[15]+=p*-u*v,d[16]+=p*-u*p,d[17]+=p*-u,d[20]+=1,d[24]+=-u*v,d[25]+=-u*p,d[26]+=-u,d[30]+=v*v,d[31]+=v*p,d[32]+=v,d[33]+=v*-l*v,d[34]+=v*-l*p,d[35]+=v*-l,d[40]+=p*p,d[41]+=p,d[42]+=p*-l*v,d[43]+=p*-l*p,d[44]+=p*-l,d[50]+=1,d[51]+=-l*v,d[52]+=-l*p,d[53]+=-l,d[60]+=-u*v*-u*v+-l*v*-l*v,d[61]+=-u*v*-u*p+-l*v*-l*p,d[62]+=-u*v*-u+-l*v*-l,d[70]+=-u*p*-u*p+-l*p*-l*p,d[71]+=-u*p*-u+-l*p*-l,d[80]+=-u*-u+-l*-l;for(i=0;i<9;++i)for(f=0;f<i;++f)d[9*i+f]=d[9*f+i];return U(G,J),n[0]=c[72],n[1]=c[73],n[2]=c[74],n[3]=c[75],n[4]=c[76],n[5]=c[77],n[6]=c[78],n[7]=c[79],n[8]=c[80],O(e,H,e),O(e,e,E),u=1/n[8],n[0]*=u,n[1]*=u,n[2]*=u,n[3]*=u,n[4]*=u,n[5]*=u,n[6]*=u,n[7]*=u,n[8]=1,1},K.prototype.error=function(r,t,a,e,o){for(var i,f,n=0,s=0,h=0,d=0,c=a.data;n<o;++n)i=r[n],f=t[n],s=1/(c[6]*i.x+c[7]*i.y+1),h=(c[0]*i.x+c[1]*i.y+c[2])*s-f.x,d=(c[3]*i.x+c[4]*i.y+c[5])*s-f.y,e[n]=h*h+d*d},K.prototype.check_subset=function(r,t,a){if(4==a){var e=0,o=r[0],i=r[1],f=r[2],n=r[3],s=t[0],h=t[1],d=t[2],c=t[3],u=o.x,l=o.y,v=i.x,p=i.y,y=f.x,b=f.y,w=s.x,_=s.y,M=h.x,x=h.y,m=d.x,g=d.y,k=I(u,l,1,v,p,1,y,b,1),z=I(w,_,1,M,x,1,m,g,1);if(k*z<0&&e++,u=i.x,l=i.y,v=f.x,p=f.y,y=n.x,b=n.y,w=h.x,_=h.y,M=d.x,x=d.y,m=c.x,g=c.y,(k=I(u,l,1,v,p,1,y,b,1))*(z=I(w,_,1,M,x,1,m,g,1))<0&&e++,u=o.x,l=o.y,v=f.x,p=f.y,y=n.x,b=n.y,w=s.x,_=s.y,M=d.x,x=d.y,m=c.x,g=c.y,(k=I(u,l,1,v,p,1,y,b,1))*(z=I(w,_,1,M,x,1,m,g,1))<0&&e++,u=o.x,l=o.y,v=i.x,p=i.y,y=n.x,b=n.y,w=s.x,_=s.y,M=h.x,x=h.y,m=c.x,g=c.y,(k=I(u,l,1,v,p,1,y,b,1))*(z=I(w,_,1,M,x,1,m,g,1))<0&&e++,0!=e&&4!=e)return!1}return!0};var W=Object.freeze({__proto__:null,affine2d:D,homography2d:K});function X(r,t,a,e){void 0===r&&(r=0),void 0===t&&(t=.5),void 0===a&&(a=.5),void 0===e&&(e=.99),this.size=r,this.thresh=t,this.eps=a,this.prob=e}X.prototype.update_iters=function(r,t){var a=Math.log(1-this.prob),e=Math.log(1-Math.pow(1-r,this.size));return 0|(e>=0||-a>=t*-e?t:Math.round(a/e))};var Y=Object.freeze({__proto__:null,ransac_params_t:X}),Z=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),$=new Uint8Array(512),rr=new Int32Array(25),tr=new Int32Array(25),ar=function(r,t,a,e,o){for(var i=0,f=r[t],n=o,s=0,h=0,d=0;i<25;++i)e[i]=f-r[t+a[i]];for(i=0;i<16;i+=2)s=Math.min(e[i+1],e[i+2]),(s=Math.min(s,e[i+3]))<=n||(s=Math.min(s,e[i+4]),s=Math.min(s,e[i+5]),s=Math.min(s,e[i+6]),s=Math.min(s,e[i+7]),s=Math.min(s,e[i+8]),n=Math.max(n,Math.min(s,e[i])),n=Math.max(n,Math.min(s,e[i+9])));for(h=-n,i=0;i<16;i+=2)d=Math.max(e[i+1],e[i+2]),d=Math.max(d,e[i+3]),d=Math.max(d,e[i+4]),(d=Math.max(d,e[i+5]))>=h||(d=Math.max(d,e[i+6]),d=Math.max(d,e[i+7]),d=Math.max(d,e[i+8]),h=Math.min(h,Math.max(d,e[i])),h=Math.min(h,Math.max(d,e[i+9])));return-h-1},er=20;const or=function(r){er=Math.min(Math.max(r,0),255);for(var t=-255;t<=255;++t)$[t+255]=t<-er?1:t>er?2:0;return er};or(20);var ir=Object.freeze({__proto__:null,set_threshold:or,detect:function(r,t,a){void 0===a&&(a=3);var e,o=r.data,i=r.cols,f=r.rows,n=0,s=0,h=0,d=0,l=0,v=c(3*i),p=c(3*(i+1)<<2),y=v.u8,b=p.i32,w=rr,_=tr,M=Math.max(3,a),x=Math.min(f-2,f-a),m=Math.max(3,a),g=Math.min(i-3,i-a),k=0,z=0,A=ar,q=$,j=er,O=0,I=0,F=0,B=0,R=0,S=0,U=0,V=0,C=0,P=0,Q=0,T=0;!function(r,t,a){for(var e=0,o=Z;e<a;++e)r[e]=o[e<<1]+o[1+(e<<1)]*t;for(;e<25;++e)r[e]=r[e-a]}(w,i,16);var E=w[0],H=w[1],L=w[2],N=w[3],D=w[4],G=w[5],J=w[6],K=w[7],W=w[8],X=w[9],Y=w[10],or=w[11],ir=w[12],fr=w[13],nr=w[14],sr=w[15];for(n=0;n<3*i;++n)y[n]=0;for(n=M;n<x;++n){for(U=n*i+m|0,S=(l=(n-3)%3)*i|0,R=l*(i+1)|0,s=0;s<i;++s)y[S+s]=0;if(B=0,n<x-1)for(s=m;s<g;++s,++U)if(0!=(F=q[(I=255-(O=o[U]))+o[U+E]]|q[I+o[U+W]])&&(F&=q[I+o[U+L]]|q[I+o[U+Y]],F&=q[I+o[U+D]]|q[I+o[U+ir]],0!=(F&=q[I+o[U+J]]|q[I+o[U+nr]]))){if(F&=q[I+o[U+H]]|q[I+o[U+X]],F&=q[I+o[U+N]]|q[I+o[U+or]],F&=q[I+o[U+G]]|q[I+o[U+fr]],1&(F&=q[I+o[U+K]]|q[I+o[U+sr]]))for(d=O-j,k=0,h=0;h<25;++h)if(o[U+w[h]]<d){if(++k>8){b[R+ ++B]=s,y[S+s]=A(o,U,w,_,j);break}}else k=0;if(2&F)for(d=O+j,k=0,h=0;h<25;++h)if(o[U+w[h]]>d){if(++k>8){b[R+ ++B]=s,y[S+s]=A(o,U,w,_,j);break}}else k=0}if(b[R+i]=B,n!=M)for(V=(l=(n-4+3)%3)*i|0,R=l*(i+1)|0,C=(l=(n-5+3)%3)*i|0,B=b[R+i],h=0;h<B;++h)P=(s=b[R+h])+1|0,Q=s-1|0,(T=y[V+s])>y[V+P]&&T>y[V+Q]&&T>y[C+Q]&&T>y[C+s]&&T>y[C+P]&&T>y[S+Q]&&T>y[S+s]&&T>y[S+P]&&((e=t[z]).x=s,e.y=n-1,e.score=T,z++)}return u(v),u(p),z}}),fr=function(r,t,a,e,o,i,f){var n=-2*r[t]+r[t+e]+r[t-e],s=-2*r[t]+r[t+o]+r[t-o],h=r[t+i]+r[t-i]-r[t+f]-r[t-f],d=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(a-d),Math.abs(-(a+d)))};var nr=Object.freeze({__proto__:null,laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(r,t,a){void 0===a&&(a=5);var e,o=0,i=0,f=r.cols,n=r.rows,s=r.data,h=5*f|0,d=3+3*f|0,l=3-3*f|0,v=c(f*n<<2),p=v.i32,y=0,b=0,w=0,_=0,M=0,x=this.laplacian_threshold,m=this.min_eigen_value_threshold,g=0|Math.max(5,a),k=0|Math.max(3,a),z=0|Math.min(f-5,f-a),A=0|Math.min(n-3,n-a);for(o=f*n;--o>=0;)p[o]=0;for(function(r,t,a,e,o,i,f,n,s,h){var d=0,c=0,u=n*a+f|0,l=u;for(d=n;d<h;++d,l=u+=a)for(c=f;c<s;++c,++l)t[l]=-4*r[l]+r[l+o]+r[l-o]+r[l+i]+r[l-i]}(s,p,f,0,5,h,g,k,z,A),b=k*f+g|0,i=k;i<A;++i,b+=f)for(o=g,w=b;o<z;++o,++w)((y=p[w])<-x&&y<p[w-1]&&y<p[w+1]&&y<p[w-f]&&y<p[w+f]&&y<p[w-f-1]&&y<p[w+f-1]&&y<p[w-f+1]&&y<p[w+f+1]||y>x&&y>p[w-1]&&y>p[w+1]&&y>p[w-f]&&y>p[w+f]&&y>p[w-f-1]&&y>p[w+f-1]&&y>p[w-f+1]&&y>p[w+f+1])&&(_=fr(s,w,y,5,h,d,l))>m&&((e=t[M]).x=o,e.y=i,e.score=_,++M,++o,++w);return u(v),M}}),sr=function(r,t,a,e,o){var i,f;if(a>0)for(t-=e*o,f=-o;f<=o;++f){for(i=-o;i<=o;++i)if(r[t+i]>a)return!1;t+=e}else for(t-=e*o,f=-o;f<=o;++f){for(i=-o;i<=o;++i)if(r[t+i]<a)return!1;t+=e}return!0},hr=function(r,t,a,e,o,i,f,n){var s=0,h=0,d=f-1|0,c=0,u=0,l=0,v=0,p=0;if((c=r[t+i[h]])<=o)if(c>=e)if((u=r[t+i[d]])<=o){if(u>=e)return void(a[t]=0);if((l=r[t+i[++d]])>o)if((v=r[t+i[++d]])>o)p=3;else{if(!(v<e))return void(a[t]=0);p=6}else if((v=r[t+i[++d]])>o)p=7;else{if(!(v<e))return void(a[t]=0);p=2}}else if((l=r[t+i[++d]])>o)if((v=r[t+i[++d]])>o)p=3;else{if(!(v<e))return void(a[t]=0);p=6}else{if(!(l<e))return void(a[t]=0);if((v=r[t+i[++d]])>o)p=7;else{if(!(v<e))return void(a[t]=0);p=2}}else{if((u=r[t+i[d]])>o)return void(a[t]=0);if((l=r[t+i[++d]])>o)return void(a[t]=0);if((v=r[t+i[++d]])>o)return void(a[t]=0);p=1}else{if((u=r[t+i[d]])<e)return void(a[t]=0);if((l=r[t+i[++d]])<e)return void(a[t]=0);if((v=r[t+i[++d]])<e)return void(a[t]=0);p=0}for(h=1;h<=f;h++)switch(c=r[t+i[h]],p){case 0:if(c>o){if(l=v,(v=r[t+i[++d]])<e)return void(a[t]=0);s-=c+l,p=0;break}if(c<e){if(l>o)return void(a[t]=0);if(v>o)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])>o)return void(a[t]=0);s-=c+l,p=8;break}if(l<=o)return void(a[t]=0);if(v<=o)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])>o){s-=c+l,p=3;break}if(v<e){s-=c+l,p=6;break}return void(a[t]=0);case 1:if(c<e){if(l=v,(v=r[t+i[++d]])>o)return void(a[t]=0);s-=c+l,p=1;break}if(c>o){if(l<e)return void(a[t]=0);if(v<e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])<e)return void(a[t]=0);s-=c+l,p=9;break}if(l>=e)return void(a[t]=0);if(v>=e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])<e){s-=c+l,p=2;break}if(v>o){s-=c+l,p=7;break}return void(a[t]=0);case 2:if(c>o)return void(a[t]=0);if(l=v,v=r[t+i[++d]],c<e){if(v>o)return void(a[t]=0);s-=c+l,p=4;break}if(v>o){s-=c+l,p=7;break}if(v<e){s-=c+l,p=2;break}return void(a[t]=0);case 3:if(c<e)return void(a[t]=0);if(l=v,v=r[t+i[++d]],c>o){if(v<e)return void(a[t]=0);s-=c+l,p=5;break}if(v>o){s-=c+l,p=3;break}if(v<e){s-=c+l,p=6;break}return void(a[t]=0);case 4:if(c>o)return void(a[t]=0);if(c<e){if(l=v,(v=r[t+i[++d]])>o)return void(a[t]=0);s-=c+l,p=1;break}if(v>=e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])<e){s-=c+l,p=2;break}if(v>o){s-=c+l,p=7;break}return void(a[t]=0);case 5:if(c<e)return void(a[t]=0);if(c>o){if(l=v,(v=r[t+i[++d]])<e)return void(a[t]=0);s-=c+l,p=0;break}if(v<=o)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])>o){s-=c+l,p=3;break}if(v<e){s-=c+l,p=6;break}return void(a[t]=0);case 7:if(c>o)return void(a[t]=0);if(c<e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])>o){s-=c+l,p=3;break}if(v<e){s-=c+l,p=6;break}return void(a[t]=0);case 6:if(c>o)return void(a[t]=0);if(c<e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])<e){s-=c+l,p=2;break}if(v>o){s-=c+l,p=7;break}return void(a[t]=0);case 8:if(c>o){if(v<e)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])<e)return void(a[t]=0);s-=c+l,p=9;break}if(c<e){if(l=v,(v=r[t+i[++d]])>o)return void(a[t]=0);s-=c+l,p=1;break}return void(a[t]=0);case 9:if(c<e){if(v>o)return void(a[t]=0);if(l=v,(v=r[t+i[++d]])>o)return void(a[t]=0);s-=c+l,p=8;break}if(c>o){if(l=v,(v=r[t+i[++d]])<e)return void(a[t]=0);s-=c+l,p=0;break}return void(a[t]=0)}a[t]=s+n*r[t]},dr=function(r,t,a){this.dirs=new Int32Array(1024),this.dirs_count=0|function(r,t,a){var e,o,i=0;for(e=a,o=0;o<e;o++,i++)e=Math.sqrt(a*a-o*o)+.5|0,t[i]=e+r*o;for(e--;e<o&&e>=0;e--,i++)o=Math.sqrt(a*a-e*e)+.5|0,t[i]=e+r*o;for(;-e<o;e--,i++)o=Math.sqrt(a*a-e*e)+.5|0,t[i]=e+r*o;for(o--;o>=0;o--,i++)e=-Math.sqrt(a*a-o*o)-.5|0,t[i]=e+r*o;for(;o>e;o--,i++)e=-Math.sqrt(a*a-o*o)-.5|0,t[i]=e+r*o;for(e++;e<=0;e++,i++)o=-Math.sqrt(a*a-e*e)-.5|0,t[i]=e+r*o;for(;e<-o;e++,i++)o=-Math.sqrt(a*a-e*e)-.5|0,t[i]=e+r*o;for(o++;o<0;o++,i++)e=Math.sqrt(a*a-o*o)+.5|0,t[i]=e+r*o;return t[i]=t[0],t[i+1]=t[1],i}(r,this.dirs,a),this.scores=new Int32Array(r*t),this.radius=0|a};var cr=Object.freeze({__proto__:null,level_tables:[],tau:7,init:function(r,t,a,e){var o;for(void 0===e&&(e=1),a=Math.min(a,7),a=Math.max(a,3),o=0;o<e;++o)this.level_tables[o]=new dr(r>>o,t>>o,a)},detect:function(r,t,a){void 0===a&&(a=4);var e,o,i,f,n,s=this.level_tables[0],h=0|s.radius,d=h-1|0,c=s.dirs,u=0|s.dirs_count,l=u>>1,v=r.data,p=0|r.cols,y=0|r.rows,b=p>>1,w=s.scores,_=0,M=0,x=0,m=0,g=0,k=0,z=0,A=0,q=0|this.tau,j=0,O=0|Math.max(h+1,a),I=0|Math.max(h+1,a),F=0|Math.min(p-h-2,p-a),B=0|Math.min(y-h-2,y-a);for(x=I*p+O|0,M=I;M<B;++M,x+=p)for(_=O,m=x;_<F;++_,++m)g=v[m]+q,(k=v[m]-q)<v[m+h]&&v[m+h]<g&&k<v[m-h]&&v[m-h]<g?w[m]=0:hr(v,m,w,k,g,c,l,u);for(x=I*p+O|0,M=I;M<B;++M,x+=p)for(_=O,m=x;_<F;++_,++m)A=w[m],(z=Math.abs(A))<5?(++_,++m):(f=p,n=void 0,n=0,0!=(o=w)[(i=m)+1]&&n++,0!=o[i-1]&&n++,0!=o[i+f]&&n++,0!=o[i+f+1]&&n++,0!=o[i+f-1]&&n++,0!=o[i-f]&&n++,0!=o[i-f+1]&&n++,0!=o[i-f-1]&&n++,n>=3&&sr(w,m,A,b,h)&&((e=t[j]).x=_,e.y=M,e.score=z,++j,_+=d,m+=d));return j}}),ur=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),lr=new f(3,3,1025),vr=new f(32,32,257),pr=function(r,t,a,e,o,i){var f=Math.cos(a),n=Math.sin(a);lr.data[0]=f,lr.data[1]=-n,lr.data[2]=(-f+n)*i*.5+e,lr.data[3]=n,lr.data[4]=f,lr.data[5]=(-n-f)*i*.5+o,m(r,t,lr,128)};var yr=Object.freeze({__proto__:null,describe:function(r,t,a,e){var o=0,i=0,f=0,n=0,s=0,h=0,d=0,c=0,u=vr.data,l=0;256&e.type?e.resize(32,a,1):(e.type=256,e.cols=32,e.rows=a,e.channel=1,e.allocate());var v=e.data,p=0;for(o=0;o<a;++o){for(f=t[o].x,n=t[o].y,s=t[o].angle,pr(r,vr,s,f,n,32),l=0,i=0;i<32;++i)c=(h=u[528+32*ur[l+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]])|0,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<1,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<2,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<3,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<4,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<5,c|=((h=u[528+32*ur[(l+=2)+1]+ur[l]])<(d=u[528+32*ur[(l+=2)+1]+ur[l]]))<<6,h=u[528+32*ur[(l+=2)+1]+ur[l]],d=u[528+32*ur[(l+=2)+1]+ur[l]],l+=2,c|=(h<d)<<7,v[p+i]=c;p+=32}}});var br=Object.freeze({__proto__:null,track:function(r,t,a,e,o,i,n,s,h,d){void 0===n&&(n=30),void 0===s&&(s=new Uint8Array(o)),void 0===h&&(h=.01),void 0===d&&(d=1e-4);var l=.5*(i-1),v=i*i|0,p=v<<1,y=r.data,b=t.data,w=y[0].data,_=b[0].data,x=y[0].cols,m=y[0].rows,g=0,k=0,z=c(v<<2),A=c(p<<2),q=c(m*(x<<1)<<2),j=new f(x,m,514,q.data),O=z.i32,I=A.i32,F=q.i32,B=0,R=0,S=0,U=0,V=0,C=0,P=0,Q=0,T=0,E=0,H=0,L=0,N=0,D=0,G=0,J=0,K=0,W=0,X=0,Y=0,Z=0,$=0,rr=0,tr=0,ar=0,er=0,or=0,ir=0,fr=0,nr=0,sr=0,hr=0,dr=0,cr=0,ur=0,lr=0,vr=0,pr=0,yr=0,br=0,wr=0,_r=0,Mr=0;for(h*=h;Y<o;++Y)s[Y]=1;var xr=r.levels-1|0;for(tr=xr;tr>=0;--tr)for(P=1/(1<<tr),k=m>>tr,B=(g=x>>tr)<<1,w=y[tr].data,_=b[tr].data,or=g-i|0,ir=k-i|0,M(y[tr],j),ar=0;ar<o;++ar)if(Z=(Y=ar<<1)+1,Q=a[Y]*P,T=a[Z]*P,tr==xr?(E=Q,H=T):(E=2*e[Y],H=2*e[Z]),e[Y]=E,e[Z]=H,0==($=(J=0|(Q-=l))<=0|J>=or|(K=0|(T-=l))<=0|K>=ir)){for(lr=16384-(dr=(1-(fr=Q-J))*(1-(nr=T-K))*16384+.5|0)-(cr=fr*(1-nr)*16384+.5|0)-(ur=(1-fr)*nr*16384+.5|0),br=0,wr=0,_r=0,rr=0;rr<i;++rr)for(S=(R=(rr+K)*g+J|0)<<1,V=(U=rr*i|0)<<1,$=0;$<i;++$,++R,++U,S+=2)vr=(vr=w[R]*dr+w[R+1]*cr+w[R+g]*ur+w[R+g+1]*lr)+256>>9,pr=(pr=F[S]*dr+F[S+2]*cr+F[S+B]*ur+F[S+B+2]*lr)+8192>>14,yr=(yr=F[S+1]*dr+F[S+3]*cr+F[S+B+1]*ur+F[S+B+3]*lr)+8192>>14,O[U]=vr,I[V++]=pr,I[V++]=yr,br+=pr*pr,wr+=pr*yr,_r+=yr*yr;if(Mr=(br*=1/(1<<20))*(_r*=1/(1<<20))-(wr*=1/(1<<20))*wr,(_r+br-Math.sqrt((br-_r)*(br-_r)+4*wr*wr))/p<d||Mr<1.1920929e-7)0==tr&&(s[ar]=0);else for(Mr=1/Mr,E-=l,H-=l,L=0,N=0,er=0;er<n;++er){if(0!=($=(W=0|E)<=0|W>=or|(X=0|H)<=0|X>=ir)){0==tr&&(s[ar]=0);break}for(lr=16384-(dr=(1-(fr=E-W))*(1-(nr=H-X))*16384+.5|0)-(cr=fr*(1-nr)*16384+.5|0)-(ur=(1-fr)*nr*16384+.5|0),sr=0,hr=0,rr=0;rr<i;++rr)for(C=(rr+X)*g+W|0,V=(U=rr*i|0)<<1,$=0;$<i;++$,++C,++U)vr=(vr=_[C]*dr+_[C+1]*cr+_[C+g]*ur+_[C+g+1]*lr)+256>>9,sr+=(vr-=O[U])*I[V++],hr+=vr*I[V++];if(E+=D=(wr*(hr*=1/(1<<20))-_r*(sr*=1/(1<<20)))*Mr,H+=G=(wr*sr-br*hr)*Mr,e[Y]=E+l,e[Z]=H+l,D*D+G*G<=h)break;if(er>0&&Math.abs(D+L)<.01&&Math.abs(G+N)<.01){e[Y]-=.5*D,e[Z]-=.5*G;break}L=D,N=G}}else 0==tr&&(s[ar]=0);u(z),u(A),u(q)}}),wr=function(r,t){var a=.25*r.width+.5|0;return t.x<=r.x+a&&t.x>=r.x-a&&t.y<=r.y+a&&t.y>=r.y-a&&t.width<=1.5*r.width+.5|0&&1.5*t.width+.5|0>=r.width};const _r=function(r,t,a,e,o,i,f,n){var s,h,d,c,u,l,v,p,y,b,w,_,M,x,m,g,k,z,A,q,j,O,I,F,B,R=n.size[0]*f|0,S=n.size[1]*f|0,U=.5*f+1.5|0,V=U,C=o-R|0,P=i-S|0,Q=o+1|0,T=1/(R*S),E=!0,H=0,L=R,N=S*Q,D=N+R,G=R*S*255*.07|0,J=[];for(u=0;u<P;u+=V)for(H=u*Q,c=0;c<C;c+=U,H+=U)if(l=r[H]-r[H+L]-r[H+N]+r[H+D],e&&(e[H]-e[H+L]-e[H+N]+e[H+D]<G||l<20))c+=U,H+=U;else{for(l*=T,p=(v=(t[H]-t[H+L]-t[H+N]+t[H+D])*T-l*l)>0?Math.sqrt(v):1,M=(y=n.complexClassifiers).length,E=!0,s=0;s<M;++s){for(g=(b=y[s]).threshold,x=(w=b.simpleClassifiers).length,k=0,h=0;h<x;++h){if(z=0,m=(q=(_=w[h]).features).length,1===_.tilted)for(d=0;d<m;++d)j=~~(c+(A=q[d])[0]*f)+~~(u+A[1]*f)*Q,O=(F=~~(A[2]*f))*Q,I=(B=~~(A[3]*f))*Q,z+=(a[j]-a[j+F+O]-a[j-B+I]+a[j+F-B+O+I])*A[4];else for(d=0;d<m;++d)j=~~(c+(A=q[d])[0]*f)+~~(u+A[1]*f)*Q,F=~~(A[2]*f),I=(B=~~(A[3]*f))*Q,z+=(r[j]-r[j+F]-r[j+I]+r[j+I+F])*A[4];k+=z*T<_.threshold*p?_.left_val:_.right_val}if(k<g){E=!1;break}}E&&(J.push({x:c,y:u,width:R,height:S,neighbor:1,confidence:k}),c+=U,H+=U)}return J};var Mr=Object.freeze({__proto__:null,edges_density:.07,detect_single_scale:_r,detect_multi_scale:function(r,t,a,e,o,i,f,n,s){void 0===n&&(n=1.2),void 0===s&&(s=1);for(var h=f.size[0],d=f.size[1],c=[];s*h<o&&s*d<i;)c=c.concat(_r(r,t,a,e,o,i,s,f)),s*=n;return c},group_rectangles:function(r,t){void 0===t&&(t=1);var a,e,o=r.length,i=[];for(a=0;a<o;++a)i[a]={parent:-1,element:r[a],rank:0};for(a=0;a<o;++a)if(i[a].element){for(var f=a;-1!=i[f].parent;)f=i[f].parent;for(e=0;e<o;++e)if(a!=e&&i[e].element&&wr(i[a].element,i[e].element)){for(var n=e;-1!=i[n].parent;)n=i[n].parent;if(n!=f){i[f].rank>i[n].rank?i[n].parent=f:(i[f].parent=n,i[f].rank==i[n].rank&&i[n].rank++,f=n);for(var s,h=e;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=f;for(h=a;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=f}}}var d=[],c=0;for(a=0;a<o;a++){e=-1;var u=a;if(i[u].element){for(;-1!=i[u].parent;)u=i[u].parent;i[u].rank>=0&&(i[u].rank=~c++),e=~i[u].rank}d[a]=e}var l=[];for(a=0;a<c+1;++a)l[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<o;++a){let t=r[a];var v=d[a];0==l[v].neighbors&&(l[v].confidence=t.confidence),++l[v].neighbors,l[v].x+=t.x,l[v].y+=t.y,l[v].width+=t.width,l[v].height+=t.height,l[v].confidence=Math.max(l[v].confidence,t.confidence)}var p=[];for(a=0;a<c;++a)(o=l[a].neighbors)>=t&&p.push({x:(2*l[a].x+o)/(2*o),y:(2*l[a].y+o)/(2*o),width:(2*l[a].width+o)/(2*o),height:(2*l[a].height+o)/(2*o),neighbors:l[a].neighbors,confidence:l[a].confidence});var y=[];for(o=p.length,a=0;a<o;++a){let r=p[a];var b=!0;for(e=0;e<o;++e){var w=p[e],_=.25*w.width+.5|0;if(a!=e&&r.x>=w.x-_&&r.y>=w.y-_&&r.x+r.width<=w.x+w.width+_&&r.y+r.height<=w.y+w.height+_&&(w.neighbors>Math.max(3,r.neighbors)||r.neighbors<3)){b=!1;break}}b&&y.push(r)}return y}}),xr=function(r,t){var a=.25*r.width+.5|0;return t.x<=r.x+a&&t.x>=r.x-a&&t.y<=r.y+a&&t.y>=r.y-a&&t.width<=1.5*r.width+.5|0&&1.5*t.width+.5|0>=r.width},mr=new k(1);let gr=4,kr=1.1486,zr=5,Ar=1;var qr=Object.freeze({__proto__:null,get interval(){return gr},get scale(){return kr},get next(){return zr},get scale_to(){return Ar},prepare_cascade:function(r){for(var t=r.stage_classifier.length,a=0;a<t;a++)for(var e=r.stage_classifier[a].feature,o=r.stage_classifier[a].count,i=r.stage_classifier[a]._feature=new Array(o),f=0;f<o;f++)i[f]={size:e[f].size,px:new Array(e[f].size),pz:new Array(e[f].size),nx:new Array(e[f].size),nz:new Array(e[f].size)}},build_pyramid:function(r,t,a,e){void 0===e&&(e=4);var o=r.cols,i=r.rows,n=0,s=0,h=0,d=!1,c=r,u=r;gr=e,kr=Math.pow(2,1/(gr+1)),zr=gr+1|0,Ar=Math.log(Math.min(o/t,i/a))/Math.log(kr)|0;var l=4*(Ar+2*zr)|0;for(mr.levels!=l&&(mr.levels=l,mr.data=new Array(l),d=!0,mr.data[0]=r),n=1;n<=gr;++n)s=o/Math.pow(kr,n)|0,h=i/Math.pow(kr,n)|0,c=mr.data[n<<2],(d||s!=c.cols||h!=c.rows)&&(mr.data[n<<2]=new f(s,h,257),c=mr.data[n<<2]),w(r,c,s,h);for(n=zr;n<Ar+2*zr;++n)u=mr.data[(n<<2)-(zr<<2)],c=mr.data[n<<2],s=u.cols>>1,h=u.rows>>1,(d||s!=c.cols||h!=c.rows)&&(mr.data[n<<2]=new f(s,h,257),c=mr.data[n<<2]),_(u,c);for(n=2*zr;n<Ar+2*zr;++n)s=(u=mr.data[(n<<2)-(zr<<2)]).cols>>1,h=u.rows>>1,c=mr.data[1+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(mr.data[1+(n<<2)]=new f(s,h,257),c=mr.data[1+(n<<2)]),_(u,c,1,0),c=mr.data[2+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(mr.data[2+(n<<2)]=new f(s,h,257),c=mr.data[2+(n<<2)]),_(u,c,0,1),c=mr.data[3+(n<<2)],(d||s!=c.cols||h!=c.rows)&&(mr.data[3+(n<<2)]=new f(s,h,257),c=mr.data[3+(n<<2)]),_(u,c,1,1);return mr},detect:function(r,t){var a,e,o,i,f,n=0,s=0,h=0,d=0,c=0,u=0,l=0,v=0,p=0,y=0,b=0,w=0,_=0,M=0,x=0,m=0,g=0,k=0,z=!0,A=!0,q=1,j=1,O=[0,1,0,1],I=[0,0,1,1],F=[],B=r.data,R=[],S=[0,0,0],U=[0,0,0],V=[0,0,0];for(n=0;n<Ar;n++){for(m=B[(x=n<<2)+(zr<<3)].cols-(t.width>>2),g=B[x+(zr<<3)].rows-(t.height>>2),U[0]=1*B[x].cols,U[1]=1*B[x+(zr<<2)].cols,U[2]=1*B[x+(zr<<3)].cols,V[0]=4*B[x].cols-4*m,V[1]=2*B[x+(zr<<2)].cols-2*m,V[2]=1*B[x+(zr<<3)].cols-1*m,v=t.stage_classifier.length,s=0;s<v;s++)for(o=t.stage_classifier[s].feature,e=t.stage_classifier[s]._feature,p=t.stage_classifier[s].count,h=0;h<p;h++)for(i=e[h],y=0|(f=o[h]).size,l=0;l<y;l++)i.px[l]=1*f.px[l]+f.py[l]*U[f.pz[l]],i.pz[l]=f.pz[l],i.nx[l]=1*f.nx[l]+f.ny[l]*U[f.nz[l]],i.nz[l]=f.nz[l];for(R[0]=B[x].data,R[1]=B[x+(zr<<2)].data,l=0;l<4;l++)for(R[2]=B[x+(zr<<3)+l].data,S[0]=2*O[l]+I[l]*(2*B[x].cols),S[1]=1*O[l]+I[l]*(1*B[x+(zr<<2)].cols),S[2]=0,u=0;u<g;u++){for(c=0;c<m;c++){for(k=0,z=!0,v=t.stage_classifier.length,s=0;s<v;s++){for(k=0,a=t.stage_classifier[s].alpha,e=t.stage_classifier[s]._feature,p=t.stage_classifier[s].count,h=0;h<p;h++)if((w=R[(i=e[h]).pz[0]][S[i.pz[0]]+i.px[0]])<=(_=R[i.nz[0]][S[i.nz[0]]+i.nx[0]]))k+=a[h<<1];else{for(A=!0,y=i.size,M=1;M<y;M++){if(i.pz[M]>=0&&(b=R[i.pz[M]][S[i.pz[M]]+i.px[M]])<w){if(b<=_){A=!1;break}w=b}if(i.nz[M]>=0&&(d=R[i.nz[M]][S[i.nz[M]]+i.nx[M]])>_){if(w<=d){A=!1;break}_=d}}k+=A?a[1+(h<<1)]:a[h<<1]}if(k<t.stage_classifier[s].threshold){z=!1;break}}z&&(F.push({x:(4*c+2*O[l])*q,y:(4*u+2*I[l])*j,width:t.width*q,height:t.height*j,neighbor:1,confidence:k}),++c,S[0]+=4,S[1]+=2,S[2]+=1),S[0]+=4,S[1]+=2,S[2]+=1}S[0]+=V[0],S[1]+=V[1],S[2]+=V[2]}q*=kr,j*=kr}return F},group_rectangles:function(r,t){void 0===t&&(t=1);var a,e,o=r.length,i=[];for(a=0;a<o;++a)i[a]={parent:-1,element:r[a],rank:0};for(a=0;a<o;++a)if(i[a].element){for(var f=a;-1!=i[f].parent;)f=i[f].parent;for(e=0;e<o;++e)if(a!=e&&i[e].element&&xr(i[a].element,i[e].element)){for(var n=e;-1!=i[n].parent;)n=i[n].parent;if(n!=f){i[f].rank>i[n].rank?i[n].parent=f:(i[f].parent=n,i[f].rank==i[n].rank&&i[n].rank++,f=n);for(var s,h=e;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=f;for(h=a;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=f}}}var d=[],c=0;for(a=0;a<o;a++){e=-1;var u=a;if(i[u].element){for(;-1!=i[u].parent;)u=i[u].parent;i[u].rank>=0&&(i[u].rank=~c++),e=~i[u].rank}d[a]=e}var l=[];for(a=0;a<c+1;++a)l[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<o;++a){let t=r[a];var v=d[a];0==l[v].neighbors&&(l[v].confidence=t.confidence),++l[v].neighbors,l[v].x+=t.x,l[v].y+=t.y,l[v].width+=t.width,l[v].height+=t.height,l[v].confidence=Math.max(l[v].confidence,t.confidence)}var p=[];for(a=0;a<c;++a)(o=l[a].neighbors)>=t&&p.push({x:(2*l[a].x+o)/(2*o),y:(2*l[a].y+o)/(2*o),width:(2*l[a].width+o)/(2*o),height:(2*l[a].height+o)/(2*o),neighbors:l[a].neighbors,confidence:l[a].confidence});var y=[];for(o=p.length,a=0;a<o;++a){let r=p[a];var b=!0;for(e=0;e<o;++e){var w=p[e],_=.25*w.width+.5|0;if(a!=e&&r.x>=w.x-_&&r.y>=w.y-_&&r.x+r.width<=w.x+w.width+_&&r.y+r.height<=w.y+w.height+_&&(w.neighbors>Math.max(3,r.neighbors)||r.neighbors<3)){b=!1;break}}b&&y.push(r)}return y}});const jr={REVISION:"ALPHA"};return jr.data_t=r,jr.keypoint_t=function(r,t,a,e,o){void 0===r&&(r=0),void 0===t&&(t=0),void 0===a&&(a=0),void 0===e&&(e=0),void 0===o&&(o=-1),this.x=r,this.y=t,this.score=a,this.level=e,this.angle=o},jr.matrix_t=f,jr.pyramid_t=k,jr.cache=l,jr.math=b,jr.matmath=F,jr.linalg=V,jr.motion_esimtator=Q,jr.motion_model=W,jr.ransac_params_t=Y,jr.imgproc=g,jr.fast_corners=ir,jr.yape06=nr,jr.yape=cr,jr.orb=yr,jr.optical_flow_lk=br,jr.haar=Mr,jr.bbf=qr,jr}));
