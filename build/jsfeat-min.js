!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).jsfeat=r()}(this,(function(){"use strict";var t,r,a,e,f,i,o,n,s,h={REVISION:"ALPHA"};t=h,r=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),a=function(t){return 65280&t},e=function(t){return 255&t},f=function(t){return r[(65280&t)>>8]},i=function(t,r){this.size=-8&(t+7|0),void 0===r?this.buffer=new ArrayBuffer(this.size):(this.buffer=r,this.size=r.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)},o=function(){function t(t,r,f,i){this.type=0|a(f),this.channel=0|e(f),this.cols=0|t,this.rows=0|r,void 0===i?this.allocate():(this.buffer=i,this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new i(this.cols*f(this.type)*this.channel*this.rows),this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var r=t.data,a=this.data,e=0,f=this.cols*this.rows*this.channel|0;e<f-4;e+=4)r[e]=a[e],r[e+1]=a[e+1],r[e+2]=a[e+2],r[e+3]=a[e+3];for(;e<f;++e)r[e]=a[e]},t.prototype.resize=function(t,r,a){void 0===a&&(a=this.channel),t*f(this.type)*a*r>this.buffer.size?(this.cols=t,this.rows=r,this.channel=a,this.allocate()):(this.cols=t,this.rows=r,this.channel=a)},t}(),n=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=h.imgproc.pyrdown}return t.prototype.allocate=function(t,r,a){for(var e=this.levels;--e>=0;)this.data[e]=new o(t>>e,r>>e,a)},t.prototype.build=function(t,r){void 0===r&&(r=!0);var a=2,e=t,f=this.data[0];if(!r)for(var i=t.cols*t.rows;--i>=0;)f.data[i]=t.data[i];for(f=this.data[1],this.pyrdown(e,f);a<this.levels;++a)e=f,f=this.data[a],this.pyrdown(e,f)},t}(),s=function(t,r,a,e,f){void 0===t&&(t=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===e&&(e=0),void 0===f&&(f=-1),this.x=t,this.y=r,this.score=a,this.level=e,this.angle=f},t.U8_t=256,t.S32_t=512,t.F32_t=1024,t.S64_t=2048,t.F64_t=4096,t.C1_t=1,t.C2_t=2,t.C3_t=3,t.C4_t=4,t.U8C1_t=257,t.U8C3_t=259,t.U8C4_t=260,t.F32C1_t=1025,t.F32C2_t=1026,t.S32C1_t=513,t.S32C2_t=514,t.EPSILON=1.192092896e-7,t.FLT_MIN=1e-37,t.COLOR_RGBA2GRAY=0,t.COLOR_RGB2GRAY=1,t.COLOR_BGRA2GRAY=2,t.COLOR_BGR2GRAY=3,t.BOX_BLUR_NOSCALE=1,t.SVD_U_T=1,t.SVD_V_T=2,t.get_data_type=a,t.get_channel=e,t.get_data_type_size=f,t.data_t=i,t.matrix_t=o,t.pyramid_t=n,t.keypoint_t=s,function(t){var r,a,e,f=(e=function(){function t(t){this.next=null,this.data=new h.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new h.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),{allocate:function(t,f){r=a=new e(f);for(var i=0;i<t;++i){var o=new e(f);a=a.next=o}},get_buffer:function(t){var a=r;return r=r.next,t>a.size&&a.resize(t),a},put_buffer:function(t){a=a.next=t}});t.cache=f,f.allocate(30,2560)}(h),function(t){var r,a=(r=new Int32Array(96),{get_gaussian_kernel:function(t,r,a,e){var f=0,i=0,o=0,n=0,s=0,c=0,u=h.cache.get_buffer(t<<2),d=u.f32;if(1==(1&t)&&t<=7&&r<=0)switch(t>>1){case 0:d[0]=1,c=1;break;case 1:d[0]=.25,d[1]=.5,d[2]=.25,c=1;break;case 2:d[0]=.0625,d[1]=.25,d[2]=.375,d[3]=.25,d[4]=.0625,c=1;break;case 3:d[0]=.03125,d[1]=.109375,d[2]=.21875,d[3]=.28125,d[4]=.21875,d[5]=.109375,d[6]=.03125,c=1}else for(s=-.5/((n=r>0?r:.3*(.5*(t-1)-1)+.8)*n);f<t;++f)i=f-.5*(t-1),o=Math.exp(s*i*i),d[f]=o,c+=o;if(e&h.U8_t)for(c=256/c,f=0;f<t;++f)a[f]=d[f]*c+.5|0;else for(c=1/c,f=0;f<t;++f)a[f]=d[f]*c;h.cache.put_buffer(u)},perspective_4point_transform:function(t,r,a,e,f,i,o,n,s,h,c,u,d,_,l,v,p){var b=r,m=h,x=o,y=b*m*x,w=l,g=b*w,M=m*g,k=c,z=b*k,A=i,C=a,O=_,R=C*O,S=R*A,L=O*A*k,I=O*x,U=O*k,q=m*x,G=w*m,B=w*A,F=k*A,N=1/(I-U-q+G-B+F),V=b*O,E=C*A,P=x*b,T=w*P,Y=C*m,D=R*k,j=C*k*A,Q=x*w*m,X=w*C,H=-(M-y+z*A-A*g-R*m+S-L+I*m)*N,J=(y-M-V*x+V*k+S-m*E+B*m-L)*N,K=b,W=(-k*g+T+Y*x-R*x+D-j+B*k-Q)*N,Z=(P*k-T-X*m+D-j+X*A+Q-I*k)*N,$=C,tt=(-z+P+Y-E+U-I-G+B)*N,rt=(-g+z+R-Y+B-F-I+q)*N,at=-((M=(m=u)*(g=(b=e)*(w=p)))-(y=b*m*(x=s))+(z=b*(k=d))*(A=n)-A*g-(R=(C=f)*(O=v))*m+(S=R*A)-(L=O*A*k)+(I=O*x)*m)*(N=1/(I-(U=O*k)-(q=m*x)+(G=w*m)-(B=w*A)+(F=k*A))),et=(y-M-(V=b*O)*x+V*k+S-m*(E=C*A)+B*m-L)*N,ft=b,it=(-k*g+(T=w*(P=x*b))+(Y=C*m)*x-R*x+(D=R*k)-(j=C*k*A)+B*k-(Q=x*w*m))*N,ot=(P*k-T-(X=w*C)*m+D-j+X*A+Q-I*k)*N,nt=C,st=(-z+P+Y-E+U-I-G+B)*N,ht=(-g+z+R-Y+B-F-I+q)*N,ct=K*tt;S=$*tt-W;var ut=-W*rt+Z*tt,dt=H-ct;E=H*rt-(z=J*tt);var _t=(y=H*$)-(M=K*W),lt=(x=H*Z)-(g=W*J);j=(m=Z-rt*$)*(O=1/(x-y*rt-g+M*rt+z*$-ct*Z));var vt=(F=K*rt-J)*O,pt=(P=-J*$+K*Z)*O,bt=t.data;bt[0]=at*j+et*(S*O)-ft*(ut*O),bt[1]=at*vt+et*(dt*O)-ft*(E*O),bt[2]=-at*pt-et*(_t*O)+ft*(lt*O),bt[3]=it*j+ot*(S*O)-nt*(ut*O),bt[4]=it*vt+ot*(dt*O)-nt*(E*O),bt[5]=-it*pt-ot*(_t*O)+nt*(lt*O),bt[6]=st*j+ht*(S*O)-ut*O,bt[7]=st*vt+ht*(dt*O)-E*O,bt[8]=-st*pt-ht*(_t*O)+lt*O},qsort:function(t,a,e,f){var i,o,n,s,h=0,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=r;if(!(e-a+1<=1))for(C[0]=a,C[1]=e;h>=0;)for(c=C[h<<1],u=C[1+(h<<1)],h--;;){if((_=u-c+1)<=7){for(v=c+1;v<=u;v++)for(p=v;p>c&&f(t[p],t[p-1]);p--)i=t[p],t[p]=t[p-1],t[p-1]=i;break}for(A=0,m=c,y=u,g=c+(_>>1),_>40&&(k=c+(b=_>>3),z=c+(b<<1),o=t[M=c],n=t[k],s=t[z],c=f(o,n)?f(n,s)?k:f(o,s)?z:M:f(s,n)?k:f(o,s)?M:z,k=g,z=g+b,o=t[M=g-b],n=t[k],s=t[z],g=f(o,n)?f(n,s)?k:f(o,s)?z:M:f(s,n)?k:f(o,s)?M:z,k=u-b,z=u,o=t[M=u-(b<<1)],n=t[k],s=t[z],u=f(o,n)?f(n,s)?k:f(o,s)?z:M:f(s,n)?k:f(o,s)?M:z),k=g,z=u,o=t[M=c],n=t[k],s=t[z],(g=f(o,n)?f(n,s)?k:f(o,s)?z:M:f(s,n)?k:f(o,s)?M:z)!=m&&(i=t[g],t[g]=t[m],t[m]=i,g=m),c=x=m+1,u=w=y,o=t[g];;){for(;c<=u&&!f(o,t[c]);)f(t[c],o)||(c>x&&(i=t[x],t[x]=t[c],t[c]=i),A=1,x++),c++;for(;c<=u&&!f(t[u],o);)f(o,t[u])||(u<w&&(i=t[w],t[w]=t[u],t[u]=i),A=1,w--),u--;if(c>u)break;i=t[c],t[c]=t[u],t[u]=i,A=1,c++,u--}if(0==A){for(u=y,v=(c=m)+1;v<=u;v++)for(p=v;p>c&&f(t[p],t[p-1]);p--)i=t[p],t[p]=t[p-1],t[p-1]=i;break}for(l=c-(_=Math.min(x-m,c-x))|0,d=0;d<_;++d,++l)i=t[m+d],t[m+d]=t[l],t[l]=i;for(l=y-(_=Math.min(y-w,w-u))+1|0,d=0;d<_;++d,++l)i=t[c+d],t[c+d]=t[l],t[l]=i;if(l=w-u,(_=c-x)>1)l>1?_>l?(C[++h<<1]=m,C[1+(h<<1)]=m+_-1,c=y-l+1,u=y):(C[++h<<1]=y-l+1,C[1+(h<<1)]=y,c=m,u=m+_-1):(c=m,u=m+_-1);else{if(!(l>1))break;c=y-l+1,u=y}}},median:function(t,r,a){for(var e,f=0,i=0,o=0,n=r+a>>1;;){if(a<=r)return t[n];if(a==r+1)return t[r]>t[a]&&(e=t[r],t[r]=t[a],t[a]=e),t[n];for(t[f=r+a>>1]>t[a]&&(e=t[f],t[f]=t[a],t[a]=e),t[r]>t[a]&&(e=t[r],t[r]=t[a],t[a]=e),t[f]>t[r]&&(e=t[f],t[f]=t[r],t[r]=e),i=r+1,e=t[f],t[f]=t[i],t[i]=e,o=a;;){do{++i}while(t[r]>t[i]);do{--o}while(t[o]>t[r]);if(o<i)break;e=t[i],t[i]=t[o],t[o]=e}e=t[r],t[r]=t[o],t[o]=e,o<=n?r=i:o>=n&&(a=o-1)}return 0}});t.math=a}(h),function(t){var r={identity:function(t,r){void 0===r&&(r=1);for(var a=t.data,e=t.rows,f=t.cols,i=f+1|0,o=e*f,n=o;--o>=0;)a[o]=0;for(o=n,n=0;n<o;)a[n]=r,n+=i},transpose:function(t,r){for(var a=0,e=0,f=r.rows,i=r.cols,o=0,n=0,s=0,h=r.data,c=t.data;a<f;n+=1,o+=i,a++)for(s=n,e=0;e<i;s+=f,e++)c[s]=h[o+e]},multiply:function(t,r,a){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=r.cols,d=r.rows,_=a.cols,l=r.data,v=a.data,p=t.data,b=0;e<d;o+=u,e++)for(h=0,f=0;f<_;c++,h++,f++){for(s=h,n=o,b=0,i=0;i<u;n++,s+=_,i++)b+=l[n]*v[s];p[c]=b}},multiply_ABt:function(t,r,a){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=r.cols,u=r.rows,d=a.rows,_=r.data,l=a.data,v=t.data,p=0;e<u;o+=c,e++)for(s=0,f=0;f<d;h++,f++){for(n=o,p=0,i=0;i<c;n++,s++,i++)p+=_[n]*l[s];v[h]=p}},multiply_AtB:function(t,r,a){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=r.cols,d=r.rows,_=a.cols,l=r.data,v=a.data,p=t.data,b=0;e<u;o++,e++)for(h=0,f=0;f<_;c++,h++,f++){for(s=h,n=o,b=0,i=0;i<d;n+=u,s+=_,i++)b+=l[n]*v[s];p[c]=b}},multiply_AAt:function(t,r){for(var a=0,e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=r.cols,d=r.rows,_=r.data,l=t.data,v=0;a<d;i+=d+1,o=n,a++)for(h=i,c=i,s=o,e=a;e<d;h++,c+=d,e++){for(n=o,v=0,f=0;f<u;f++)v+=_[n++]*_[s++];l[h]=v,l[c]=v}},multiply_AtA:function(t,r){for(var a=0,e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=r.cols,d=r.rows,_=r.data,l=t.data,v=0;a<u;s+=u,a++)for(i=a,h=c=s+a,e=a;e<u;h++,c+=u,e++){for(o=i,n=e,v=0,f=0;f<d;o+=u,n+=u,f++)v+=_[o]*_[n];l[h]=v,l[c]=v}},identity_3x3:function(t,r){void 0===r&&(r=1);var a=t.data;a[0]=a[4]=a[8]=r,a[1]=a[2]=a[3]=0,a[5]=a[6]=a[7]=0},invert_3x3:function(t,r){var a=t.data,e=r.data,f=a[4],i=a[8],o=a[5],n=a[7],s=a[0],h=s*f,c=s*o,u=a[3],d=a[1],_=u*d,l=a[2],v=u*l,p=a[6],b=p*d,m=p*l,x=1/(h*i-c*n-_*i+v*n+b*o-m*f);e[0]=(f*i-o*n)*x,e[1]=-(d*i-l*n)*x,e[2]=-(-d*o+l*f)*x,e[3]=-(u*i-o*p)*x,e[4]=(s*i-m)*x,e[5]=-(c-v)*x,e[6]=-(-u*n+f*p)*x,e[7]=-(s*n-b)*x,e[8]=(h-_)*x},multiply_3x3:function(t,r,a){var e=t.data,f=r.data,i=a.data,o=f[0],n=f[1],s=f[2],h=f[3],c=f[4],u=f[5],d=f[6],_=f[7],l=f[8],v=i[0],p=i[1],b=i[2],m=i[3],x=i[4],y=i[5],w=i[6],g=i[7],M=i[8];e[0]=o*v+n*m+s*w,e[1]=o*p+n*x+s*g,e[2]=o*b+n*y+s*M,e[3]=h*v+c*m+u*w,e[4]=h*p+c*x+u*g,e[5]=h*b+c*y+u*M,e[6]=d*v+_*m+l*w,e[7]=d*p+_*x+l*g,e[8]=d*b+_*y+l*M},mat3x3_determinant:function(t){var r=t.data;return r[0]*r[4]*r[8]-r[0]*r[5]*r[7]-r[3]*r[1]*r[8]+r[3]*r[2]*r[7]+r[6]*r[1]*r[5]-r[6]*r[2]*r[4]},determinant_3x3:function(t,r,a,e,f,i,o,n,s){return t*f*s-t*i*n-e*r*s+e*a*n+o*r*i-o*a*f}};t.matmath=r}(h),function(t){var r,a,e=(r=function(t,r,a,e){e=t[r],t[r]=t[a],t[a]=e},a=function(t,r){return(t=Math.abs(t))>(r=Math.abs(r))?(r/=t,t*Math.sqrt(1+r*r)):r>0?(t/=r,r*Math.sqrt(1+t*t)):0},{lu_solve:function(t,a){var e,f,i,o,n=0,s=0,c=0,u=t.cols,d=t.data,_=a.data;for(n=0;n<u;n++){for(c=n,s=n+1;s<u;s++)Math.abs(d[s*u+n])>Math.abs(d[c*u+n])&&(c=s);if(Math.abs(d[c*u+n])<h.EPSILON)return 0;if(c!=n){for(s=n;s<u;s++)r(d,n*u+s,c*u+s,e);r(_,n,c,e)}for(i=-1/d[n*u+n],s=n+1;s<u;s++){for(f=d[s*u+n]*i,c=n+1;c<u;c++)d[s*u+c]+=f*d[n*u+c];_[s]+=f*_[n]}d[n*u+n]=-i}for(n=u-1;n>=0;n--){for(o=_[n],c=n+1;c<u;c++)o-=d[n*u+c]*_[c];_[n]=o*d[n*u+n]}return 1},cholesky_solve:function(t,r){var a,e,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=t.cols,d=t.data,_=r.data;for(f=0;f<u;f++)for(e=1,s=n=f*u,i=f;i<u;i++){for(a=d[s+f],o=0;o<f;o++)a-=d[o*u+f]*d[s+o];if(i==f){if(d[s+f]=a,0==a)return 0;e=1/a}else d[n+i]=a,d[s+f]=a*e;s+=u}for(n=0,h=0;h<u;h++){for(a=_[h],c=0;c<h;c++)a-=d[n+c]*_[c];_[h]=a,n+=u}for(n=0,h=0;h<u;h++)_[h]/=d[n+h],n+=u;for(h=u-1;h>=0;h--){for(a=_[h],n=(c=h+1)*u;c<u;c++)a-=d[n+h]*_[c],n+=u;_[h]=a}return 1},svd_decompose:function(t,e,f,i,o){void 0===o&&(o=0);var n=0,s=0,c=t.rows,u=t.cols,d=c,_=u,l=t.type|h.C1_t;d<_&&(n=1,s=d,d=_,_=s);var v=h.cache.get_buffer(d*d<<3),p=h.cache.get_buffer(_<<3),b=h.cache.get_buffer(_*_<<3),m=new h.matrix_t(d,d,l,v.data),x=new h.matrix_t(1,_,l,p.data),y=new h.matrix_t(_,_,l,b.data);if(0==n)h.matmath.transpose(m,t);else{for(s=0;s<u*c;s++)m.data[s]=t.data[s];for(;s<_*d;s++)m.data[s]=0}if(function(t,e,f,i,o,n,s,c){for(var u=2*h.EPSILON,d=h.FLT_MIN,_=0,l=0,v=0,p=0,b=Math.max(n,30),m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,S=0,L=0,I=0,U=0,q=0,G=4660,B=0,F=0,N=0,V=h.cache.get_buffer(s<<3),E=V.f64;_<s;_++){for(v=0,O=0;v<n;v++)O+=(z=t[_*e+v])*z;if(E[_]=O,i){for(v=0;v<s;v++)i[_*o+v]=0;i[_*o+_]=1}}for(;p<b;p++){for(g=0,_=0;_<s-1;_++)for(l=_+1;l<s;l++){for(m=_*e|0,x=l*e|0,I=E[_],U=0,q=E[l],v=2,U+=t[m]*t[x],U+=t[m+1]*t[x+1];v<n;v++)U+=t[m+v]*t[x+v];if(!(Math.abs(U)<=u*Math.sqrt(I*q))){for(S=a(U*=2,R=I-q),R<0?(L=.5*(S-R),M=U/(S*(k=Math.sqrt(L/S))*2)):k=U/(S*(M=Math.sqrt((S+R)/(2*S)))*2),I=0,q=0,v=2,A=M*t[m]+k*t[x],C=-k*t[m]+M*t[x],t[m]=A,t[x]=C,I+=A*A,q+=C*C,A=M*t[m+1]+k*t[x+1],C=-k*t[m+1]+M*t[x+1],t[m+1]=A,t[x+1]=C,I+=A*A,q+=C*C;v<n;v++)A=M*t[m+v]+k*t[x+v],C=-k*t[m+v]+M*t[x+v],t[m+v]=A,t[x+v]=C,I+=A*A,q+=C*C;if(E[_]=I,E[l]=q,g=1,i)for(w=l*o|0,v=2,A=M*i[y=_*o|0]+k*i[w],C=-k*i[y]+M*i[w],i[y]=A,i[w]=C,A=M*i[y+1]+k*i[w+1],C=-k*i[y+1]+M*i[w+1],i[y+1]=A,i[w+1]=C;v<s;v++)A=M*i[y+v]+k*i[w+v],C=-k*i[y+v]+M*i[w+v],i[y+v]=A,i[w+v]=C}}if(0==g)break}for(_=0;_<s;_++){for(v=0,O=0;v<n;v++)O+=(z=t[_*e+v])*z;E[_]=Math.sqrt(O)}for(_=0;_<s-1;_++){for(l=_,v=_+1;v<s;v++)E[l]<E[v]&&(l=v);if(_!=l&&(r(E,_,l,O),i)){for(v=0;v<n;v++)r(t,_*e+v,l*e+v,z);for(v=0;v<s;v++)r(i,_*o+v,l*o+v,z)}}for(_=0;_<s;_++)f[_]=E[_];if(i){for(_=0;_<c;_++){for(O=_<s?E[_]:0;O<=d;){for(F=1/n,v=0;v<n;v++)B=0!=(256&(G=214013*G+2531011)>>16)?F:-F,t[_*e+v]=B;for(p=0;p<2;p++)for(l=0;l<_;l++){for(O=0,v=0;v<n;v++)O+=t[_*e+v]*t[l*e+v];for(N=0,v=0;v<n;v++)z=t[_*e+v]-O*t[l*e+v],t[_*e+v]=z,N+=Math.abs(z);for(N=N?1/N:0,v=0;v<n;v++)t[_*e+v]*=N}for(O=0,v=0;v<n;v++)O+=(z=t[_*e+v])*z;O=Math.sqrt(O)}for(k=1/O,v=0;v<n;v++)t[_*e+v]*=k}h.cache.put_buffer(V)}else h.cache.put_buffer(V)}(m.data,d,x.data,y.data,_,d,_,d),e){for(s=0;s<_;s++)e.data[s]=x.data[s];for(;s<u;s++)e.data[s]=0}if(0==n){if(f&&o&h.SVD_U_T)for(s=d*d;--s>=0;)f.data[s]=m.data[s];else f&&h.matmath.transpose(f,m);if(i&&o&h.SVD_V_T)for(s=_*_;--s>=0;)i.data[s]=y.data[s];else i&&h.matmath.transpose(i,y)}else{if(f&&o&h.SVD_U_T)for(s=_*_;--s>=0;)f.data[s]=y.data[s];else f&&h.matmath.transpose(f,y);if(i&&o&h.SVD_V_T)for(s=d*d;--s>=0;)i.data[s]=m.data[s];else i&&h.matmath.transpose(i,m)}h.cache.put_buffer(v),h.cache.put_buffer(p),h.cache.put_buffer(b)},svd_solve:function(t,r,a){var e,f=0,i=0,o=0,n=0,s=0,c=t.rows,u=t.cols,d=0,_=0,l=t.type|h.C1_t,v=h.cache.get_buffer(c*c<<3),p=h.cache.get_buffer(u<<3),b=h.cache.get_buffer(u*u<<3),m=new h.matrix_t(c,c,l,v.data),x=new h.matrix_t(1,u,l,p.data),y=new h.matrix_t(u,u,l,b.data),w=a.data,g=m.data,M=x.data,k=y.data;for(this.svd_decompose(t,x,m,y,0),e=h.EPSILON*M[0]*u;f<u;f++,s+=u){for(_=0,i=0;i<u;i++)if(M[i]>e){for(o=0,d=0,n=0;o<c;o++,n+=u)d+=g[n+i]*w[o];_+=d*k[s+i]/M[i]}r.data[f]=_}h.cache.put_buffer(v),h.cache.put_buffer(p),h.cache.put_buffer(b)},svd_invert:function(t,r){var a,e=0,f=0,i=0,o=0,n=0,s=0,c=r.rows,u=r.cols,d=0,_=r.type|h.C1_t,l=h.cache.get_buffer(c*c<<3),v=h.cache.get_buffer(u<<3),p=h.cache.get_buffer(u*u<<3),b=new h.matrix_t(c,c,_,l.data),m=new h.matrix_t(1,u,_,v.data),x=new h.matrix_t(u,u,_,p.data),y=t.data,w=b.data,g=m.data,M=x.data;for(this.svd_decompose(r,m,b,x,0),a=h.EPSILON*g[0]*u;e<u;e++,n+=u)for(f=0,o=0;f<c;f++,s++){for(i=0,d=0;i<u;i++,o++)g[i]>a&&(d+=M[n+i]*w[o]/g[i]);y[s]=d}h.cache.put_buffer(l),h.cache.put_buffer(v),h.cache.put_buffer(p)},eigenVV:function(t,e,f){for(var i=t.cols,o=i*i,n=t.type|h.C1_t,s=h.cache.get_buffer(i*i<<3),c=h.cache.get_buffer(i<<3),u=new h.matrix_t(i,i,n,s.data),d=new h.matrix_t(1,i,n,c.data);--o>=0;)u.data[o]=t.data[o];if(function(t,e,f,i,o,n){var s=h.EPSILON,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=n*n*30,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=h.cache.get_buffer(n<<2),S=h.cache.get_buffer(n<<2),L=R.i32,I=S.i32;if(i)for(;c<n;c++){for(d=c*o,u=0;u<n;u++)i[d+u]=0;i[d+c]=1}for(d=0;d<n;d++){if(f[d]=t[(e+1)*d],d<n-1){for(_=d+1,y=Math.abs(t[e*d+_]),c=d+2;c<n;c++)y<(w=Math.abs(t[e*d+c]))&&(y=w,_=c);L[d]=_}if(d>0){for(_=0,y=Math.abs(t[d]),c=1;c<d;c++)y<(w=Math.abs(t[e*c+d]))&&(y=w,_=c);I[d]=_}}if(n>1)for(;m<x;m++){for(d=0,y=Math.abs(t[L[0]]),c=1;c<n-1;c++)y<(w=Math.abs(t[e*c+L[c]]))&&(y=w,d=c);for(l=L[d],c=1;c<n;c++)y<(w=Math.abs(t[e*I[c]+c]))&&(y=w,d=I[c],l=c);if(g=t[e*d+l],Math.abs(g)<=s)break;for(M=.5*(f[l]-f[d]),A=(k=Math.abs(M)+a(g,M))/(z=a(g,k)),z=g/z,k=g/k*g,M<0&&(z=-z,k=-k),t[e*d+l]=0,f[d]-=k,f[l]+=k,c=0;c<d;c++)b=e*c+l,C=t[p=e*c+d],O=t[b],t[p]=C*A-O*z,t[b]=C*z+O*A;for(c=d+1;c<l;c++)b=e*c+l,C=t[p=e*d+c],O=t[b],t[p]=C*A-O*z,t[b]=C*z+O*A;for(p=e*d+(c=l+1),b=e*l+c;c<n;c++,p++,b++)C=t[p],O=t[b],t[p]=C*A-O*z,t[b]=C*z+O*A;if(i)for(p=o*d,b=o*l,c=0;c<n;c++,p++,b++)C=i[p],O=i[b],i[p]=C*A-O*z,i[b]=C*z+O*A;for(u=0;u<2;u++){if((v=0==u?d:l)<n-1){for(_=v+1,y=Math.abs(t[e*v+_]),c=v+2;c<n;c++)y<(w=Math.abs(t[e*v+c]))&&(y=w,_=c);L[v]=_}if(v>0){for(_=0,y=Math.abs(t[v]),c=1;c<v;c++)y<(w=Math.abs(t[e*c+v]))&&(y=w,_=c);I[v]=_}}}for(d=0;d<n-1;d++){for(_=d,c=d+1;c<n;c++)f[_]<f[c]&&(_=c);if(d!=_&&(r(f,_,d,y),i))for(c=0;c<n;c++)r(i,o*_+c,o*d+c,y)}h.cache.put_buffer(R),h.cache.put_buffer(S)}(u.data,i,d.data,e?e.data:null,i,i),f)for(;--i>=0;)f.data[i]=d.data[i];h.cache.put_buffer(s),h.cache.put_buffer(c)}});t.linalg=e}(h),function(t){var r,a,e,f,i,o,n,s,c,u,d=(r=function(t){return t*t},a=new h.matrix_t(3,3,h.F32_t|h.C1_t),e=new h.matrix_t(3,3,h.F32_t|h.C1_t),f=new h.matrix_t(6,6,h.F32_t|h.C1_t),i=new h.matrix_t(6,1,h.F32_t|h.C1_t),o=function(){function t(){}return t.prototype.run=function(t,r,o,n){var s,c,u=0,d=0,_=o.type|h.C1_t,l=o.data,v=a.data,p=e.data,b=0,m=0;!function(t,r,a,e,f){for(var i,o,n=0,s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;n<f;++n)s+=t[n].x,h+=t[n].y,u+=r[n].x,d+=r[n].y;for(s/=f,h/=f,u/=f,d/=f,n=0;n<f;++n)l=t[n].x-s,v=t[n].y-h,c+=Math.sqrt(l*l+v*v),l=r[n].x-u,v=r[n].y-d,_+=Math.sqrt(l*l+v*v);c/=f,_/=f,i=Math.SQRT2/c,o=Math.SQRT2/_,a[0]=a[4]=i,a[2]=-s*i,a[5]=-h*i,a[1]=a[3]=a[6]=a[7]=0,a[8]=1,e[0]=e[4]=o,e[2]=-u*o,e[5]=-d*o,e[1]=e[3]=e[6]=e[7]=0,e[8]=1}(t,r,v,p,n);for(var x=h.cache.get_buffer(2*n*6<<3),y=h.cache.get_buffer(2*n<<3),w=new h.matrix_t(6,2*n,_,x.data),g=new h.matrix_t(1,2*n,_,y.data),M=w.data,k=g.data;u<n;++u)s=t[u],c=r[u],b=v[0]*s.x+v[1]*s.y+v[2],m=v[3]*s.x+v[4]*s.y+v[5],M[d=2*u*6]=b,M[d+1]=m,M[d+2]=1,M[d+3]=0,M[d+4]=0,M[d+5]=0,M[d+=6]=0,M[d+1]=0,M[d+2]=0,M[d+3]=b,M[d+4]=m,M[d+5]=1,k[u<<1]=p[0]*c.x+p[1]*c.y+p[2],k[1+(u<<1)]=p[3]*c.x+p[4]*c.y+p[5];return h.matmath.multiply_AtA(f,w),h.matmath.multiply_AtB(i,w,g),h.linalg.lu_solve(f,i),l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=0,l[7]=0,l[8]=1,h.matmath.invert_3x3(e,e),h.matmath.multiply_3x3(o,e,o),h.matmath.multiply_3x3(o,o,a),h.cache.put_buffer(x),h.cache.put_buffer(y),1},t.prototype.error=function(t,a,e,f,i){for(var o,n,s=0,h=e.data;s<i;++s)o=t[s],n=a[s],f[s]=r(n.x-h[0]*o.x-h[1]*o.y-h[2])+r(n.y-h[3]*o.x-h[4]*o.y-h[5])},t.prototype.check_subset=function(t,r,a){return!0},t}(),n=new h.matrix_t(9,9,h.F32_t|h.C1_t),s=new h.matrix_t(9,9,h.F32_t|h.C1_t),{affine2d:o,homography2d:function(){function t(){}return t.prototype.run=function(t,r,f,i){for(var o=0,c=0,u=f.data,d=a.data,_=e.data,l=n.data,v=s.data,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0;o<i;++o)g+=r[o].x,M+=r[o].y,A+=t[o].x,C+=t[o].y;for(g/=i,M/=i,A/=i,C/=i,o=0;o<i;++o)y+=Math.abs(r[o].x-g),w+=Math.abs(r[o].y-M),k+=Math.abs(t[o].x-A),z+=Math.abs(t[o].y-C);if(Math.abs(y)<h.EPSILON||Math.abs(w)<h.EPSILON||Math.abs(k)<h.EPSILON||Math.abs(z)<h.EPSILON)return 0;for(y=i/y,w=i/w,k=i/k,z=i/z,d[0]=k,d[1]=0,d[2]=-A*k,d[3]=0,d[4]=z,d[5]=-C*z,d[6]=0,d[7]=0,d[8]=1,_[0]=1/y,_[1]=0,_[2]=g,_[3]=0,_[4]=1/w,_[5]=M,_[6]=0,_[7]=0,_[8]=1,o=81;--o>=0;)l[o]=0;for(o=0;o<i;++o)p=(r[o].x-g)*y,b=(r[o].y-M)*w,m=(t[o].x-A)*k,x=(t[o].y-C)*z,l[0]+=m*m,l[1]+=m*x,l[2]+=m,l[6]+=m*-p*m,l[7]+=m*-p*x,l[8]+=m*-p,l[10]+=x*x,l[11]+=x,l[15]+=x*-p*m,l[16]+=x*-p*x,l[17]+=x*-p,l[20]+=1,l[24]+=-p*m,l[25]+=-p*x,l[26]+=-p,l[30]+=m*m,l[31]+=m*x,l[32]+=m,l[33]+=m*-b*m,l[34]+=m*-b*x,l[35]+=m*-b,l[40]+=x*x,l[41]+=x,l[42]+=x*-b*m,l[43]+=x*-b*x,l[44]+=x*-b,l[50]+=1,l[51]+=-b*m,l[52]+=-b*x,l[53]+=-b,l[60]+=-p*m*-p*m+-b*m*-b*m,l[61]+=-p*m*-p*x+-b*m*-b*x,l[62]+=-p*m*-p+-b*m*-b,l[70]+=-p*x*-p*x+-b*x*-b*x,l[71]+=-p*x*-p+-b*x*-b,l[80]+=-p*-p+-b*-b;for(o=0;o<9;++o)for(c=0;c<o;++c)l[9*o+c]=l[9*c+o];return h.linalg.eigenVV(n,s),u[0]=v[72],u[1]=v[73],u[2]=v[74],u[3]=v[75],u[4]=v[76],u[5]=v[77],u[6]=v[78],u[7]=v[79],u[8]=v[80],h.matmath.multiply_3x3(f,e,f),h.matmath.multiply_3x3(f,f,a),p=1/u[8],u[0]*=p,u[1]*=p,u[2]*=p,u[3]*=p,u[4]*=p,u[5]*=p,u[6]*=p,u[7]*=p,u[8]=1,1},t.prototype.error=function(t,r,a,e,f){for(var i,o,n=0,s=0,h=0,c=0,u=a.data;n<f;++n)i=t[n],o=r[n],s=1/(u[6]*i.x+u[7]*i.y+1),h=(u[0]*i.x+u[1]*i.y+u[2])*s-o.x,c=(u[3]*i.x+u[4]*i.y+u[5])*s-o.y,e[n]=h*h+c*c},t.prototype.check_subset=function(t,r,a){if(4==a){var e=0,f=t[0],i=t[1],o=t[2],n=t[3],s=r[0],c=r[1],u=r[2],d=r[3],_=f.x,l=f.y,v=i.x,p=i.y,b=o.x,m=o.y,x=s.x,y=s.y,w=c.x,g=c.y,M=u.x,k=u.y,z=h.matmath.determinant_3x3(_,l,1,v,p,1,b,m,1),A=h.matmath.determinant_3x3(x,y,1,w,g,1,M,k,1);if(z*A<0&&e++,_=i.x,l=i.y,v=o.x,p=o.y,b=n.x,m=n.y,x=c.x,y=c.y,w=u.x,g=u.y,M=d.x,k=d.y,(z=h.matmath.determinant_3x3(_,l,1,v,p,1,b,m,1))*(A=h.matmath.determinant_3x3(x,y,1,w,g,1,M,k,1))<0&&e++,_=f.x,l=f.y,v=o.x,p=o.y,b=n.x,m=n.y,x=s.x,y=s.y,w=u.x,g=u.y,M=d.x,k=d.y,(z=h.matmath.determinant_3x3(_,l,1,v,p,1,b,m,1))*(A=h.matmath.determinant_3x3(x,y,1,w,g,1,M,k,1))<0&&e++,_=f.x,l=f.y,v=i.x,p=i.y,b=n.x,m=n.y,x=s.x,y=s.y,w=c.x,g=c.y,M=d.x,k=d.y,(z=h.matmath.determinant_3x3(_,l,1,v,p,1,b,m,1))*(A=h.matmath.determinant_3x3(x,y,1,w,g,1,M,k,1))<0&&e++,0!=e&&4!=e)return!1}return!0},t}()}),_=function(){function t(t,r,a,e){void 0===t&&(t=0),void 0===r&&(r=.5),void 0===a&&(a=.5),void 0===e&&(e=.99),this.size=t,this.thresh=r,this.eps=a,this.prob=e}return t.prototype.update_iters=function(t,r){var a=Math.log(1-this.prob),e=Math.log(1-Math.pow(1-t,this.size));return 0|(e>=0||-a>=r*-e?r:Math.round(a/e))},t}(),l=(c=function(t,r,a,e,f,i,o){for(var n=[],s=0,h=0,c=0,u=0,d=!1;c<1e3;++c){for(s=0;s<e&&c<1e3;){for(d=!1,u=0;!d;)for(d=!0,u=n[s]=0|Math.floor(Math.random()*f),h=0;h<s;++h)if(u==n[h]){d=!1;break}i[s]=r[u],o[s]=a[u],t.check_subset(i,o,s+1)?++s:c++}break}return s==e&&c<1e3},u=function(t,r,a,e,f,i,o,n){var s=0,h=0,c=0,u=i*i;for(t.error(a,e,r,o,f);h<f;++h)c=o[h]<=u,n[h]=c,s+=c;return s},{ransac:function(t,r,a,e,f,i,o,n){if(void 0===n&&(n=1e3),f<t.size)return!1;var s=t.size,d=n,_=0,l=!1,v=[],p=[],b=i.cols,m=i.rows,x=i.type|h.C1_t,y=h.cache.get_buffer(b*m<<3),w=h.cache.get_buffer(f),g=h.cache.get_buffer(f<<2),M=new h.matrix_t(b,m,x,y.data),k=new h.matrix_t(f,1,h.U8C1_t,w.data),z=-1,A=0,C=g.f32;if(f==s){if(r.run(a,e,M,f)<=0)return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!1;if(M.copy_to(i),o)for(;--f>=0;)o.data[f]=1;return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!0}for(;_<d;++_){if(!c(r,a,e,s,f,v,p)){if(0==_)return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!1;break}r.run(v,p,M,s)<=0||(A=u(r,M,a,e,f,t.thresh,C,k.data))>Math.max(z,s-1)&&(M.copy_to(i),z=A,o&&k.copy_to(o),d=t.update_iters((f-A)/f,d),l=!0)}return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),l},lmeds:function(t,r,a,e,f,i,o,n){if(void 0===n&&(n=1e3),f<t.size)return!1;var s=t.size,d=n,_=0,l=!1,v=[],p=[],b=i.cols,m=i.rows,x=i.type|h.C1_t,y=h.cache.get_buffer(b*m<<3),w=h.cache.get_buffer(f),g=h.cache.get_buffer(f<<2),M=new h.matrix_t(b,m,x,y.data),k=new h.matrix_t(f,1,h.U8_t|h.C1_t,w.data),z=0,A=g.f32,C=1e9,O=0,R=0;if(t.eps=.45,d=t.update_iters(t.eps,d),f==s){if(r.run(a,e,M,f)<=0)return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!1;if(M.copy_to(i),o)for(;--f>=0;)o.data[f]=1;return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!0}for(;_<d;++_){if(!c(r,a,e,s,f,v,p)){if(0==_)return h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),!1;break}r.run(v,p,M,s)<=0||(r.error(a,e,M,A,f),(R=h.math.median(A,0,f-1))<C&&(C=R,M.copy_to(i),l=!0))}return l&&(O=2.5*1.4826*(1+5/(f-s))*Math.sqrt(C),O=Math.max(O,.001),z=u(r,i,a,e,f,O,A,k.data),o&&k.copy_to(o),l=z>=s),h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),l}});t.ransac_params_t=_,t.motion_model=d,t.motion_estimator=l}(h),function(t){var r={grayscale:function(t,r,a,e,f){void 0===f&&(f=h.COLOR_RGBA2GRAY);var i=0,o=0,n=0,s=0,c=0,u=0,d=4899,_=1868,l=4;f!=h.COLOR_BGRA2GRAY&&f!=h.COLOR_BGR2GRAY||(d=1868,_=4899),f!=h.COLOR_RGB2GRAY&&f!=h.COLOR_BGR2GRAY||(l=3);var v=l<<1,p=3*l|0;e.resize(r,a,1);var b=e.data;for(o=0;o<a;++o,s+=r,n+=r*l){for(i=0,c=n,u=s;i<=r-4;i+=4,c+=l<<2,u+=4)b[u]=t[c]*d+9617*t[c+1]+t[c+2]*_+8192>>14,b[u+1]=t[c+l]*d+9617*t[c+l+1]+t[c+l+2]*_+8192>>14,b[u+2]=t[c+v]*d+9617*t[c+v+1]+t[c+v+2]*_+8192>>14,b[u+3]=t[c+p]*d+9617*t[c+p+1]+t[c+p+2]*_+8192>>14;for(;i<r;++i,++u,c+=l)b[u]=t[c]*d+9617*t[c+1]+t[c+2]*_+8192>>14}},resample:function(t,r,a,e){var f=t.rows,i=t.cols;f>e&&i>a&&(r.resize(a,e,t.channel),t.type&h.U8_t&&r.type&h.U8_t&&f*i/(e*a)<256?function(t,r,a,e){for(var f=0,i=t.channel,o=t.cols,n=t.rows,s=t.data,c=r.data,u=o/a,d=n/e,_=u*d*65536|0,l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,S=h.cache.get_buffer(a*i<<2),L=h.cache.get_buffer(a*i<<2),I=h.cache.get_buffer(2*o*3<<2),U=S.i32,q=L.i32,G=I.i32;l<a;l++){for(m=1+(g=l*u)-1e-6|0,x=0|(M=g+u),m=Math.min(m,o-1),x=Math.min(x,o-1),m>g&&(G[w++]=l*i|0,G[w++]=(m-1)*i|0,G[w++]=256*(m-g)|0,f++),p=m;p<x;p++)f++,G[w++]=l*i|0,G[w++]=p*i|0,G[w++]=256;M-x>.001&&(f++,G[w++]=l*i|0,G[w++]=x*i|0,G[w++]=256*(M-x)|0)}for(l=0;l<a*i;l++)U[l]=q[l]=0;for(v=0,b=0;b<n;b++){for(k=o*b,w=0;w<f;w++)for(A=G[3*w],m=G[3*w+1],C=G[3*w+2],y=0;y<i;y++)U[A+y]+=s[k+m+y]*C;if((v+1)*d<=b+1||b==n-1){if(R=256-(O=256*Math.max(b+1-(v+1)*d,0)|0),z=a*v,O<=0)for(l=0;l<a*i;l++)c[z+l]=Math.min(Math.max((q[l]+256*U[l])/_,0),255),q[l]=U[l]=0;else for(l=0;l<a*i;l++)c[z+l]=Math.min(Math.max((q[l]+U[l]*R)/_,0),255),q[l]=U[l]*O,U[l]=0;v++}else for(l=0;l<a*i;l++)q[l]+=256*U[l],U[l]=0}h.cache.put_buffer(L),h.cache.put_buffer(S),h.cache.put_buffer(I)}(t,r,a,e):function(t,r,a,e){for(var f=0,i=t.channel,o=t.cols,n=t.rows,s=t.data,c=r.data,u=o/a,d=n/e,_=1/(u*d),l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,S=h.cache.get_buffer(a*i<<2),L=h.cache.get_buffer(a*i<<2),I=h.cache.get_buffer(2*o*3<<2),U=S.f32,q=L.f32,G=I.f32;l<a;l++){for(m=1+(g=l*u)-1e-6|0,x=0|(M=g+u),m=Math.min(m,o-1),x=Math.min(x,o-1),m>g&&(f++,G[w++]=(m-1)*i|0,G[w++]=l*i|0,G[w++]=(m-g)*_),p=m;p<x;p++)f++,G[w++]=p*i|0,G[w++]=l*i|0,G[w++]=_;M-x>.001&&(f++,G[w++]=x*i|0,G[w++]=l*i|0,G[w++]=(M-x)*_)}for(l=0;l<a*i;l++)U[l]=q[l]=0;for(v=0,b=0;b<n;b++){for(k=o*b,w=0;w<f;w++)for(m=0|G[3*w],A=0|G[3*w+1],C=G[3*w+2],y=0;y<i;y++)U[A+y]+=s[k+m+y]*C;if((v+1)*d<=b+1||b==n-1){if(R=1-(O=Math.max(b+1-(v+1)*d,0)),z=a*v,Math.abs(O)<.001)for(l=0;l<a*i;l++)c[z+l]=q[l]+U[l],q[l]=U[l]=0;else for(l=0;l<a*i;l++)c[z+l]=q[l]+U[l]*R,q[l]=U[l]*O,U[l]=0;v++}else for(l=0;l<a*i;l++)q[l]+=U[l],U[l]=0}h.cache.put_buffer(L),h.cache.put_buffer(S),h.cache.put_buffer(I)}(t,r,a,e))},box_blur_gray:function(t,r,a,e){void 0===e&&(e=0);var f=t.cols,i=t.rows,o=i<<1,n=f<<1,s=0,c=0,u=0,d=0,_=1+(a<<1)|0,l=a+1|0,v=l+1|0,p=e&h.BOX_BLUR_NOSCALE?1:1/(_*_),b=h.cache.get_buffer(f*i<<2),m=0,x=0,y=0,w=0,g=0,M=b.i32,k=t.data,z=0;for(r.resize(f,i,t.channel),u=0;u<i;++u){for(x=u,m=l*k[y],s=y+1|0,d=y+a|0;s<=d;++s)m+=k[s];for(w=y+l|0,z=k[g=y],c=0;c<a;++c,x+=i)M[x]=m,m+=k[w]-z,w++;for(;c<f-v;c+=2,x+=o)M[x]=m,m+=k[w]-k[g],M[x+i]=m,m+=k[w+1]-k[g+1],w+=2,g+=2;for(;c<f-l;++c,x+=i)M[x]=m,m+=k[w]-k[g],w++,g++;for(z=k[w-1];c<f;++c,x+=i)M[x]=m,m+=z-k[g],g++;y+=f}if(y=0,k=r.data,1==p)for(u=0;u<f;++u){for(x=u,m=l*M[y],s=y+1|0,d=y+a|0;s<=d;++s)m+=M[s];for(w=y+l,z=M[g=y],c=0;c<a;++c,x+=f)k[x]=m,m+=M[w]-z,w++;for(;c<i-v;c+=2,x+=n)k[x]=m,m+=M[w]-M[g],k[x+f]=m,m+=M[w+1]-M[g+1],w+=2,g+=2;for(;c<i-l;++c,x+=f)k[x]=m,m+=M[w]-M[g],w++,g++;for(z=M[w-1];c<i;++c,x+=f)k[x]=m,m+=z-M[g],g++;y+=i}else for(u=0;u<f;++u){for(x=u,m=l*M[y],s=y+1|0,d=y+a|0;s<=d;++s)m+=M[s];for(w=y+l,z=M[g=y],c=0;c<a;++c,x+=f)k[x]=m*p,m+=M[w]-z,w++;for(;c<i-v;c+=2,x+=n)k[x]=m*p,m+=M[w]-M[g],k[x+f]=m*p,m+=M[w+1]-M[g+1],w+=2,g+=2;for(;c<i-l;++c,x+=f)k[x]=m*p,m+=M[w]-M[g],w++,g++;for(z=M[w-1];c<i;++c,x+=f)k[x]=m*p,m+=z-M[g],g++;y+=i}h.cache.put_buffer(b)},gaussian_blur:function(t,r,a,e){void 0===e&&(e=0),void 0===a&&(a=0);var f=(a=0==a?2*Math.max(1,4*e+1-1e-8)+1|0:a)>>1,i=t.cols,o=t.rows,n=t.type,s=n&h.U8_t;r.resize(i,o,t.channel);var c,u,d=t.data,_=r.data,l=a+Math.max(o,i)|0,v=h.cache.get_buffer(l<<2),p=h.cache.get_buffer(a<<2);s?(c=v.i32,u=p.i32):n&h.S32_t?(c=v.i32,u=p.f32):(c=v.f32,u=p.f32),h.math.get_gaussian_kernel(a,e,u,n),s?function(t,r,a,e,f,i,o,n){for(var s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=i[0],m=0,x=e<<1,y=3*e,w=e<<2;s<f;++s){for(_=r[u],h=0;h<n;++h)t[h]=_;for(h=0;h<=e-2;h+=2)t[h+n]=r[u+h],t[h+n+1]=r[u+h+1];for(;h<e;++h)t[h+n]=r[u+h];for(_=r[u+e-1],h=e;h<n+e;++h)t[h+n]=_;for(h=0;h<=e-4;h+=4){for(_=t[h]*b,l=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,p+=t[c+h+3]*m;a[d+h]=Math.min(_>>8,255),a[d+h+1]=Math.min(l>>8,255),a[d+h+2]=Math.min(v>>8,255),a[d+h+3]=Math.min(p>>8,255)}for(;h<e;++h){for(_=t[h]*b,c=1;c<o;++c)_+=t[c+h]*i[c];a[d+h]=Math.min(_>>8,255)}u+=e,d+=e}for(s=0;s<e;++s){for(_=a[s],h=0;h<n;++h)t[h]=_;for(c=s,h=0;h<=f-2;h+=2,c+=x)t[h+n]=a[c],t[h+n+1]=a[c+e];for(;h<f;++h,c+=e)t[h+n]=a[c];for(_=a[(f-1)*e+s],h=f;h<n+f;++h)t[h+n]=_;for(d=s,h=0;h<=f-4;h+=4,d+=w){for(_=t[h]*b,l=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,p+=t[c+h+3]*m;a[d]=Math.min(_>>8,255),a[d+e]=Math.min(l>>8,255),a[d+x]=Math.min(v>>8,255),a[d+y]=Math.min(p>>8,255)}for(;h<f;++h,d+=e){for(_=t[h]*b,c=1;c<o;++c)_+=t[c+h]*i[c];a[d]=Math.min(_>>8,255)}}}(c,d,_,i,o,u,a,f):function(t,r,a,e,f,i,o,n){for(var s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=i[0],m=0,x=e<<1,y=3*e,w=e<<2;s<f;++s){for(_=r[u],h=0;h<n;++h)t[h]=_;for(h=0;h<=e-2;h+=2)t[h+n]=r[u+h],t[h+n+1]=r[u+h+1];for(;h<e;++h)t[h+n]=r[u+h];for(_=r[u+e-1],h=e;h<n+e;++h)t[h+n]=_;for(h=0;h<=e-4;h+=4){for(_=t[h]*b,l=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,p+=t[c+h+3]*m;a[d+h]=_,a[d+h+1]=l,a[d+h+2]=v,a[d+h+3]=p}for(;h<e;++h){for(_=t[h]*b,c=1;c<o;++c)_+=t[c+h]*i[c];a[d+h]=_}u+=e,d+=e}for(s=0;s<e;++s){for(_=a[s],h=0;h<n;++h)t[h]=_;for(c=s,h=0;h<=f-2;h+=2,c+=x)t[h+n]=a[c],t[h+n+1]=a[c+e];for(;h<f;++h,c+=e)t[h+n]=a[c];for(_=a[(f-1)*e+s],h=f;h<n+f;++h)t[h+n]=_;for(d=s,h=0;h<=f-4;h+=4,d+=w){for(_=t[h]*b,l=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,p+=t[c+h+3]*m;a[d]=_,a[d+e]=l,a[d+x]=v,a[d+y]=p}for(;h<f;++h,d+=e){for(_=t[h]*b,c=1;c<o;++c)_+=t[c+h]*i[c];a[d]=_}}}(c,d,_,i,o,u,a,f),h.cache.put_buffer(v),h.cache.put_buffer(p)},hough_transform:function(t,r,a,e){for(var f=t.data,i=t.cols,o=t.rows,n=i,s=Math.PI,h=Math.round((s-0)/a),c=Math.round((2*(i+o)+1)/r),u=1/r,d=new Int32Array((h+2)*(c+2)),_=new Float32Array(h),l=new Float32Array(h),v=0,p=0;v<h;v++)_[v]=Math.sin(p)*u,l[v]=Math.cos(p)*u,p+=a;for(var b=0;b<o;b++)for(var m=0;m<i;m++)if(0!=f[b*n+m])for(v=0;v<h;v++){var x=Math.round(m*l[v]+b*_[v]);d[(v+1)*(c+2)+(x+=(c-1)/2)+1]+=1}var y=new Array;for(x=0;x<c;x++)for(v=0;v<h;v++){var w=(v+1)*(c+2)+x+1;d[w]>e&&d[w]>d[w-1]&&d[w]>=d[w+1]&&d[w]>d[w-c-2]&&d[w]>=d[w+c+2]&&y.push(w)}y.sort((function(t,r){return d[t]>d[r]||d[t]==d[r]&&t<r}));var g=Math.min(h*c,y.length),M=1/(c+2),k=new Array;for(b=0;b<g;b++){var z=y[b],A=((x=z-(1+(v=Math.floor(z*M)-1))*(c+2)-1)-.5*(c-1))*r,C=v*a;k.push([A,C])}return k},pyrdown:function(t,r,a,e){void 0===a&&(a=0),void 0===e&&(e=0);var f=t.cols,i=f>>1,o=t.rows>>1,n=i-(a<<1),s=o-(e<<1),h=0,c=0,u=a+e*f,d=0,_=0,l=0;r.resize(i,o,t.channel);var v=t.data,p=r.data;for(c=0;c<s;++c){for(d=u,l=_,h=0;h<=n-2;h+=2,l+=2,d+=4)p[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2,p[l+1]=v[d+2]+v[d+3]+v[d+f+2]+v[d+f+3]+2>>2;for(;h<n;++h,++l,d+=2)p[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2;u+=f<<1,_+=i}},scharr_derivatives:function(t,r){var a,e,f,i,o,n,s,c,u=t.cols,d=t.rows,_=u<<1,l=0,v=0,p=0,b=0,m=0,x=0,y=0;r.resize(u,d,2);var w=t.data,g=r.data,M=h.cache.get_buffer(u+2<<2),k=h.cache.get_buffer(u+2<<2);for(t.type&h.U8_t||t.type&h.S32_t?(s=M.i32,c=k.i32):(s=M.f32,c=k.f32);v<d;++v,m+=u){for(b=(v>0?v-1:1)*u|0,x=(v<d-1?v+1:d-2)*u|0,y=v*_|0,l=0,p=1;l<=u-2;l+=2,p+=2)a=w[b+l],e=w[x+l],s[p]=3*(a+e)+10*w[m+l],c[p]=e-a,a=w[b+l+1],e=w[x+l+1],s[p+1]=3*(a+e)+10*w[m+l+1],c[p+1]=e-a;for(;l<u;++l,++p)a=w[b+l],e=w[x+l],s[p]=3*(a+e)+10*w[m+l],c[p]=e-a;for(l=u+1|0,s[0]=s[1],s[l]=s[u],c[0]=c[1],c[l]=c[u],l=0;l<=u-4;l+=4)a=c[l+2],e=c[l+1],f=c[l+3],i=c[l+4],o=s[l+2],n=s[l+3],g[y++]=o-s[l],g[y++]=3*(a+c[l])+10*e,g[y++]=n-s[l+1],g[y++]=3*(f+e)+10*a,g[y++]=s[l+4]-o,g[y++]=3*(i+a)+10*f,g[y++]=s[l+5]-n,g[y++]=3*(c[l+5]+f)+10*i;for(;l<u;++l)g[y++]=s[l+2]-s[l],g[y++]=3*(c[l+2]+c[l])+10*c[l+1]}h.cache.put_buffer(M),h.cache.put_buffer(k)},sobel_derivatives:function(t,r){var a,e,f,i,o,n,s,c,u=t.cols,d=t.rows,_=u<<1,l=0,v=0,p=0,b=0,m=0,x=0,y=0;r.resize(u,d,2);var w=t.data,g=r.data,M=h.cache.get_buffer(u+2<<2),k=h.cache.get_buffer(u+2<<2);for(t.type&h.U8_t||t.type&h.S32_t?(s=M.i32,c=k.i32):(s=M.f32,c=k.f32);v<d;++v,m+=u){for(b=(v>0?v-1:1)*u|0,x=(v<d-1?v+1:d-2)*u|0,y=v*_|0,l=0,p=1;l<=u-2;l+=2,p+=2)a=w[b+l],e=w[x+l],s[p]=a+e+2*w[m+l],c[p]=e-a,a=w[b+l+1],e=w[x+l+1],s[p+1]=a+e+2*w[m+l+1],c[p+1]=e-a;for(;l<u;++l,++p)a=w[b+l],e=w[x+l],s[p]=a+e+2*w[m+l],c[p]=e-a;for(l=u+1|0,s[0]=s[1],s[l]=s[u],c[0]=c[1],c[l]=c[u],l=0;l<=u-4;l+=4)a=c[l+2],e=c[l+1],f=c[l+3],i=c[l+4],o=s[l+2],n=s[l+3],g[y++]=o-s[l],g[y++]=a+c[l]+2*e,g[y++]=n-s[l+1],g[y++]=f+e+2*a,g[y++]=s[l+4]-o,g[y++]=i+a+2*f,g[y++]=s[l+5]-n,g[y++]=c[l+5]+f+2*i;for(;l<u;++l)g[y++]=s[l+2]-s[l],g[y++]=c[l+2]+c[l]+2*c[l+1]}h.cache.put_buffer(M),h.cache.put_buffer(k)},compute_integral_image:function(t,r,a,e){var f=0|t.cols,i=0|t.rows,o=t.data,n=f+1|0,s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;if(r&&a){for(;d<n;++d)r[d]=0,a[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(s=h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)s+=l=o[v],h+=l*l,r[c]=r[u]+s,a[c]=a[u]+h,s+=l=o[v+1],h+=l*l,r[c+1]=r[u+1]+s,a[c+1]=a[u+1]+h;for(;_<f;++_,++v,++c,++u)s+=l=o[v],h+=l*l,r[c]=r[u]+s,a[c]=a[u]+h}}else if(r){for(;d<n;++d)r[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(s=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)s+=o[v],r[c]=r[u]+s,s+=o[v+1],r[c+1]=r[u+1]+s;for(;_<f;++_,++v,++c,++u)s+=o[v],r[c]=r[u]+s}}else if(a){for(;d<n;++d)a[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)h+=(l=o[v])*l,a[c]=a[u]+h,h+=(l=o[v+1])*l,a[c+1]=a[u+1]+h;for(;_<f;++_,++v,++c,++u)h+=(l=o[v])*l,a[c]=a[u]+h}}if(e){for(d=0;d<n;++d)e[d]=0;for(c=n+1|0,u=0,d=0,v=0;d<i;++d,++c,++u){for(_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)e[c]=o[v]+e[u],e[c+1]=o[v+1]+e[u+1];for(;_<f;++_,++v,++c,++u)e[c]=o[v]+e[u]}for(c=n+f|0,u=f,d=0;d<i;++d,c+=n,u+=n)e[c]+=e[u];for(_=f-1;_>0;--_)for(u=(c=_+i*n)-n,d=i;d>0;--d,c-=n,u-=n)e[c]+=e[u]+e[u+1]}},equalize_histogram:function(t,r){var a=t.cols,e=t.rows,f=t.data;r.resize(a,e,t.channel);var i,o,n=r.data,s=a*e,c=0,u=0,d=h.cache.get_buffer(1024);for(i=d.i32;c<256;++c)i[c]=0;for(c=0;c<s;++c)++i[f[c]];for(u=i[0],c=1;c<256;++c)u=i[c]+=u;for(o=255/s,c=0;c<s;++c)n[c]=i[f[c]]*o+.5|0;h.cache.put_buffer(d)},canny:function(t,r,a,e){var f=t.cols,i=t.rows;t.data,r.resize(f,i,t.channel);var o=r.data,n=0,s=0,c=0,u=f<<1,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=0,y=h.cache.get_buffer(i*u<<2),w=h.cache.get_buffer(3*(f+2)<<2),g=h.cache.get_buffer((i+2)*(f+2)<<2),M=h.cache.get_buffer(i*f<<2),k=w.i32,z=g.i32,A=M.i32,C=y.i32,O=new h.matrix_t(f,i,h.S32C2_t,y.data),R=1,S=f+2+1|0,L=2*(f+2)+1|0,I=f+2|0,U=I+1|0,q=0;for(this.sobel_derivatives(t,O),a>e&&(n=a,a=e,e=n),n=3*(f+2)|0;--n>=0;)k[n]=0;for(n=(i+2)*(f+2)|0;--n>=0;)z[n]=0;for(;s<f;++s,c+=2)v=C[c],p=C[c+1],k[S+s]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(n=1;n<=i;++n,c+=u){if(n==i)for(s=L+f;--s>=L;)k[s]=0;else for(s=0;s<f;s++)v=C[c+(s<<1)],p=C[c+(s<<1)+1],k[L+s]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(d=c-u|0,z[U-1]=0,_=0,s=0;s<f;++s,d+=2){if((l=k[S+s])>a)if(b=(v=C[d])^(p=C[d+1]),p=(p^p>>31)-(p>>31)|0,x=(m=13573*(v=(v^v>>31)-(v>>31)|0))+(v+v<<15),(p<<=15)<m){if(l>k[S+s-1]&&l>=k[S+s+1]){l>e&&!_&&2!=z[U+s-I]?(z[U+s]=2,_=1,A[q++]=U+s):z[U+s]=1;continue}}else if(p>x){if(l>k[R+s]&&l>=k[L+s]){l>e&&!_&&2!=z[U+s-I]?(z[U+s]=2,_=1,A[q++]=U+s):z[U+s]=1;continue}}else if(l>k[R+s-(b=b<0?-1:1)]&&l>k[L+s+b]){l>e&&!_&&2!=z[U+s-I]?(z[U+s]=2,_=1,A[q++]=U+s):z[U+s]=1;continue}z[U+s]=0,_=0}z[U+f]=0,U+=I,s=R,R=S,S=L,L=s}for(s=U-I-1,n=0;n<I;++n,++s)z[s]=0;for(;q>0;)U=A[--q],1==z[U-=I+1]&&(z[U]=2,A[q++]=U),1==z[U+=1]&&(z[U]=2,A[q++]=U),1==z[U+=1]&&(z[U]=2,A[q++]=U),1==z[U+=I]&&(z[U]=2,A[q++]=U),1==z[U-=2]&&(z[U]=2,A[q++]=U),1==z[U+=I]&&(z[U]=2,A[q++]=U),1==z[U+=1]&&(z[U]=2,A[q++]=U),1==z[U+=1]&&(z[U]=2,A[q++]=U);for(U=I+1,R=0,n=0;n<i;++n,U+=I)for(s=0;s<f;++s)o[R++]=255*(2==z[U+s]);h.cache.put_buffer(y),h.cache.put_buffer(w),h.cache.put_buffer(g),h.cache.put_buffer(M)},warp_perspective:function(t,r,a,e){void 0===e&&(e=0);for(var f=0|t.cols,i=0|t.rows,o=0|r.cols,n=0|r.rows,s=t.data,h=r.data,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=a.data,A=z[0],C=z[1],O=z[2],R=z[3],S=z[4],L=z[5],I=z[6],U=z[7],q=z[8],G=0;u<n;++u)for(b=C*u+O,m=S*u+L,x=U*u+q,c=0;c<o;++c,++G,b+=A,m+=R,x+=I)_=0|(v=b*(y=1/x)),l=0|(p=m*y),v>0&&p>0&&_<f-1&&l<i-1?(w=Math.max(v-_,0),g=Math.max(p-l,0),M=s[d=f*l+_|0]+w*(s[d+1]-s[d]),k=s[d+f]+w*(s[d+f+1]-s[d+f]),h[G]=M+g*(k-M)):h[G]=e},warp_affine:function(t,r,a,e){void 0===e&&(e=0);for(var f=t.cols,i=t.rows,o=r.cols,n=r.rows,s=t.data,h=r.data,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=a.data,g=w[0],M=w[1],k=w[2],z=w[3],A=w[4],C=w[5],O=0;u<n;++u)for(v=M*u+k,p=A*u+C,c=0;c<o;++c,++O,v+=g,p+=z)l=0|p,(_=0|v)>=0&&l>=0&&_<f-1&&l<i-1?(b=v-_,m=p-l,x=s[d=f*l+_]+b*(s[d+1]-s[d]),y=s[d+f]+b*(s[d+f+1]-s[d+f]),h[O]=x+m*(y-x)):h[O]=e},skindetector:function(t,r){for(var a,e,f,i,o=t.width*t.height;o--;)i=4*o,a=t.data[i],e=t.data[i+1],f=t.data[i+2],a>95&&e>40&&f>20&&a>e&&a>f&&a-Math.min(e,f)>15&&Math.abs(a-e)>15?r[o]=255:r[o]=0}};t.imgproc=r}(h),function(t){var r,a,e,f,i,o,n=(r=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),a=new Uint8Array(512),e=new Int32Array(25),f=new Int32Array(25),i=function(t,r,a,e,f){for(var i=0,o=t[r],n=f,s=0,h=0,c=0;i<25;++i)e[i]=o-t[r+a[i]];for(i=0;i<16;i+=2)s=Math.min(e[i+1],e[i+2]),(s=Math.min(s,e[i+3]))<=n||(s=Math.min(s,e[i+4]),s=Math.min(s,e[i+5]),s=Math.min(s,e[i+6]),s=Math.min(s,e[i+7]),s=Math.min(s,e[i+8]),n=Math.max(n,Math.min(s,e[i])),n=Math.max(n,Math.min(s,e[i+9])));for(h=-n,i=0;i<16;i+=2)c=Math.max(e[i+1],e[i+2]),c=Math.max(c,e[i+3]),c=Math.max(c,e[i+4]),(c=Math.max(c,e[i+5]))>=h||(c=Math.max(c,e[i+6]),c=Math.max(c,e[i+7]),c=Math.max(c,e[i+8]),h=Math.min(h,Math.max(c,e[i])),h=Math.min(h,Math.max(c,e[i+9])));return-h-1},o=20,{set_threshold:function(t){o=Math.min(Math.max(t,0),255);for(var r=-255;r<=255;++r)a[r+255]=r<-o?1:r>o?2:0;return o},detect:function(t,n,s){void 0===s&&(s=3);var c,u=t.data,d=t.cols,_=t.rows,l=0,v=0,p=0,b=0,m=0,x=h.cache.get_buffer(3*d),y=h.cache.get_buffer(3*(d+1)<<2),w=x.u8,g=y.i32,M=e,k=f,z=Math.max(3,s),A=Math.min(_-2,_-s),C=Math.max(3,s),O=Math.min(d-3,d-s),R=0,S=0,L=i,I=a,U=o,q=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0,D=0,j=0;!function(t,a,e){for(var f=0,i=r;f<e;++f)t[f]=i[f<<1]+i[1+(f<<1)]*a;for(;f<25;++f)t[f]=t[f-e]}(M,d,16);var Q=M[0],X=M[1],H=M[2],J=M[3],K=M[4],W=M[5],Z=M[6],$=M[7],tt=M[8],rt=M[9],at=M[10],et=M[11],ft=M[12],it=M[13],ot=M[14],nt=M[15];for(l=0;l<3*d;++l)w[l]=0;for(l=z;l<A;++l){for(E=l*d+C|0,V=(m=(l-3)%3)*d|0,N=m*(d+1)|0,v=0;v<d;++v)w[V+v]=0;if(F=0,l<A-1)for(v=C;v<O;++v,++E)if(0!=(B=I[(G=255-(q=u[E]))+u[E+Q]]|I[G+u[E+tt]])&&(B&=I[G+u[E+H]]|I[G+u[E+at]],B&=I[G+u[E+K]]|I[G+u[E+ft]],0!=(B&=I[G+u[E+Z]]|I[G+u[E+ot]]))){if(B&=I[G+u[E+X]]|I[G+u[E+rt]],B&=I[G+u[E+J]]|I[G+u[E+et]],B&=I[G+u[E+W]]|I[G+u[E+it]],1&(B&=I[G+u[E+$]]|I[G+u[E+nt]]))for(b=q-U,R=0,p=0;p<25;++p)if(u[E+M[p]]<b){if(++R>8){g[N+ ++F]=v,w[V+v]=L(u,E,M,k,U);break}}else R=0;if(2&B)for(b=q+U,R=0,p=0;p<25;++p)if(u[E+M[p]]>b){if(++R>8){g[N+ ++F]=v,w[V+v]=L(u,E,M,k,U);break}}else R=0}if(g[N+d]=F,l!=z)for(P=(m=(l-4+3)%3)*d|0,N=m*(d+1)|0,T=(m=(l-5+3)%3)*d|0,F=g[N+d],p=0;p<F;++p)Y=(v=g[N+p])+1|0,D=v-1|0,(j=w[P+v])>w[P+Y]&&j>w[P+D]&&j>w[T+D]&&j>w[T+v]&&j>w[T+Y]&&j>w[V+D]&&j>w[V+v]&&j>w[V+Y]&&((c=n[S]).x=v,c.y=l-1,c.score=j,S++)}return h.cache.put_buffer(x),h.cache.put_buffer(y),S}});t.fast_corners=n,n.set_threshold(20)}(h),function(t){var r,a=(r=function(t,r,a,e,f,i,o){var n=-2*t[r]+t[r+e]+t[r-e],s=-2*t[r]+t[r+f]+t[r-f],h=t[r+i]+t[r-i]-t[r+o]-t[r-o],c=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(a-c),Math.abs(-(a+c)))},{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(t,a,e){void 0===e&&(e=5);var f,i=0,o=0,n=t.cols,s=t.rows,c=t.data,u=5*n|0,d=3+3*n|0,_=3-3*n|0,l=h.cache.get_buffer(n*s<<2),v=l.i32,p=0,b=0,m=0,x=0,y=0,w=this.laplacian_threshold,g=this.min_eigen_value_threshold,M=0|Math.max(5,e),k=0|Math.max(3,e),z=0|Math.min(n-5,n-e),A=0|Math.min(s-3,s-e);for(i=n*s;--i>=0;)v[i]=0;for(function(t,r,a,e,f,i,o,n,s,h){var c=0,u=0,d=n*a+o|0,_=d;for(c=n;c<h;++c,_=d+=a)for(u=o;u<s;++u,++_)r[_]=-4*t[_]+t[_+f]+t[_-f]+t[_+i]+t[_-i]}(c,v,n,0,5,u,M,k,z,A),b=k*n+M|0,o=k;o<A;++o,b+=n)for(i=M,m=b;i<z;++i,++m)((p=v[m])<-w&&p<v[m-1]&&p<v[m+1]&&p<v[m-n]&&p<v[m+n]&&p<v[m-n-1]&&p<v[m+n-1]&&p<v[m-n+1]&&p<v[m+n+1]||p>w&&p>v[m-1]&&p>v[m+1]&&p>v[m-n]&&p>v[m+n]&&p>v[m-n-1]&&p>v[m+n-1]&&p>v[m-n+1]&&p>v[m+n+1])&&(x=r(c,m,p,5,u,d,_))>g&&((f=a[y]).x=i,f.y=o,f.score=x,++y,++i,++m);return h.cache.put_buffer(l),y}});t.yape06=a}(h),function(t){var r,a,e,f=(r=function(t,r,a,e,f){var i,o;if(a>0)for(r-=e*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[r+i]>a)return!1;r+=e}else for(r-=e*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[r+i]<a)return!1;r+=e}return!0},a=function(t,r,a,e,f,i,o,n){var s=0,h=0,c=o-1|0,u=0,d=0,_=0,l=0,v=0;if((u=t[r+i[h]])<=f)if(u>=e)if((d=t[r+i[c]])<=f){if(d>=e)return void(a[r]=0);if((_=t[r+i[++c]])>f)if((l=t[r+i[++c]])>f)v=3;else{if(!(l<e))return void(a[r]=0);v=6}else if((l=t[r+i[++c]])>f)v=7;else{if(!(l<e))return void(a[r]=0);v=2}}else if((_=t[r+i[++c]])>f)if((l=t[r+i[++c]])>f)v=3;else{if(!(l<e))return void(a[r]=0);v=6}else{if(!(_<e))return void(a[r]=0);if((l=t[r+i[++c]])>f)v=7;else{if(!(l<e))return void(a[r]=0);v=2}}else{if((d=t[r+i[c]])>f)return void(a[r]=0);if((_=t[r+i[++c]])>f)return void(a[r]=0);if((l=t[r+i[++c]])>f)return void(a[r]=0);v=1}else{if((d=t[r+i[c]])<e)return void(a[r]=0);if((_=t[r+i[++c]])<e)return void(a[r]=0);if((l=t[r+i[++c]])<e)return void(a[r]=0);v=0}for(h=1;h<=o;h++)switch(u=t[r+i[h]],v){case 0:if(u>f){if(_=l,(l=t[r+i[++c]])<e)return void(a[r]=0);s-=u+_,v=0;break}if(u<e){if(_>f)return void(a[r]=0);if(l>f)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])>f)return void(a[r]=0);s-=u+_,v=8;break}if(_<=f)return void(a[r]=0);if(l<=f)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(a[r]=0);case 1:if(u<e){if(_=l,(l=t[r+i[++c]])>f)return void(a[r]=0);s-=u+_,v=1;break}if(u>f){if(_<e)return void(a[r]=0);if(l<e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])<e)return void(a[r]=0);s-=u+_,v=9;break}if(_>=e)return void(a[r]=0);if(l>=e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(a[r]=0);case 2:if(u>f)return void(a[r]=0);if(_=l,l=t[r+i[++c]],u<e){if(l>f)return void(a[r]=0);s-=u+_,v=4;break}if(l>f){s-=u+_,v=7;break}if(l<e){s-=u+_,v=2;break}return void(a[r]=0);case 3:if(u<e)return void(a[r]=0);if(_=l,l=t[r+i[++c]],u>f){if(l<e)return void(a[r]=0);s-=u+_,v=5;break}if(l>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(a[r]=0);case 4:if(u>f)return void(a[r]=0);if(u<e){if(_=l,(l=t[r+i[++c]])>f)return void(a[r]=0);s-=u+_,v=1;break}if(l>=e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(a[r]=0);case 5:if(u<e)return void(a[r]=0);if(u>f){if(_=l,(l=t[r+i[++c]])<e)return void(a[r]=0);s-=u+_,v=0;break}if(l<=f)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(a[r]=0);case 7:if(u>f)return void(a[r]=0);if(u<e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(a[r]=0);case 6:if(u>f)return void(a[r]=0);if(u<e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(a[r]=0);case 8:if(u>f){if(l<e)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])<e)return void(a[r]=0);s-=u+_,v=9;break}if(u<e){if(_=l,(l=t[r+i[++c]])>f)return void(a[r]=0);s-=u+_,v=1;break}return void(a[r]=0);case 9:if(u<e){if(l>f)return void(a[r]=0);if(_=l,(l=t[r+i[++c]])>f)return void(a[r]=0);s-=u+_,v=8;break}if(u>f){if(_=l,(l=t[r+i[++c]])<e)return void(a[r]=0);s-=u+_,v=0;break}return void(a[r]=0)}a[r]=s+n*t[r]},e=function(t,r,a){this.dirs=new Int32Array(1024),this.dirs_count=0|function(t,r,a){var e,f,i=0;for(e=a,f=0;f<e;f++,i++)e=Math.sqrt(a*a-f*f)+.5|0,r[i]=e+t*f;for(e--;e<f&&e>=0;e--,i++)f=Math.sqrt(a*a-e*e)+.5|0,r[i]=e+t*f;for(;-e<f;e--,i++)f=Math.sqrt(a*a-e*e)+.5|0,r[i]=e+t*f;for(f--;f>=0;f--,i++)e=-Math.sqrt(a*a-f*f)-.5|0,r[i]=e+t*f;for(;f>e;f--,i++)e=-Math.sqrt(a*a-f*f)-.5|0,r[i]=e+t*f;for(e++;e<=0;e++,i++)f=-Math.sqrt(a*a-e*e)-.5|0,r[i]=e+t*f;for(;e<-f;e++,i++)f=-Math.sqrt(a*a-e*e)-.5|0,r[i]=e+t*f;for(f++;f<0;f++,i++)e=Math.sqrt(a*a-f*f)+.5|0,r[i]=e+t*f;return r[i]=r[0],r[i+1]=r[1],i}(t,this.dirs,a),this.scores=new Int32Array(t*r),this.radius=0|a},{level_tables:[],tau:7,init:function(t,r,a,f){var i;for(void 0===f&&(f=1),a=Math.min(a,7),a=Math.max(a,3),i=0;i<f;++i)this.level_tables[i]=new e(t>>i,r>>i,a)},detect:function(t,e,f){void 0===f&&(f=4);var i,o,n,s,h,c=this.level_tables[0],u=0|c.radius,d=u-1|0,_=c.dirs,l=0|c.dirs_count,v=l>>1,p=t.data,b=0|t.cols,m=0|t.rows,x=b>>1,y=c.scores,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0|this.tau,S=0,L=0|Math.max(u+1,f),I=0|Math.max(u+1,f),U=0|Math.min(b-u-2,b-f),q=0|Math.min(m-u-2,m-f);for(M=I*b+L|0,g=I;g<q;++g,M+=b)for(w=L,k=M;w<U;++w,++k)z=p[k]+R,(A=p[k]-R)<p[k+u]&&p[k+u]<z&&A<p[k-u]&&p[k-u]<z?y[k]=0:a(p,k,y,A,z,_,v,l);for(M=I*b+L|0,g=I;g<q;++g,M+=b)for(w=L,k=M;w<U;++w,++k)O=y[k],(C=Math.abs(O))<5?(++w,++k):(s=b,h=void 0,h=0,0!=(o=y)[(n=k)+1]&&h++,0!=o[n-1]&&h++,0!=o[n+s]&&h++,0!=o[n+s+1]&&h++,0!=o[n+s-1]&&h++,0!=o[n-s]&&h++,0!=o[n-s+1]&&h++,0!=o[n-s-1]&&h++,h>=3&&r(y,k,O,x,u)&&((i=e[S]).x=w,i.y=g,i.score=C,++S,w+=d,k+=d));return S}});t.yape=f}(h),function(t){var r,a,e,f,i=(r=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),a=new h.matrix_t(3,3,h.F32_t|h.C1_t),e=new h.matrix_t(32,32,h.U8_t|h.C1_t),f=function(t,r,e,f,i,o){var n=Math.cos(e),s=Math.sin(e);a.data[0]=n,a.data[1]=-s,a.data[2]=(-n+s)*o*.5+f,a.data[3]=s,a.data[4]=n,a.data[5]=(-s-n)*o*.5+i,h.imgproc.warp_affine(t,r,a,128)},{describe:function(t,a,i,o){var n=0,s=0,c=0,u=0,d=0,_=0,l=0,v=0,p=(t.data,t.cols,t.rows,e.data),b=0;o.type&h.U8_t?o.resize(32,i,1):(o.type=h.U8_t,o.cols=32,o.rows=i,o.channel=1,o.allocate());var m=o.data,x=0;for(n=0;n<i;++n){for(c=a[n].x,u=a[n].y,d=a[n].angle,f(t,e,d,c,u,32),b=0,s=0;s<32;++s)v=(_=p[528+32*r[b+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]])|0,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<1,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<2,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<3,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<4,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<5,v|=((_=p[528+32*r[(b+=2)+1]+r[b]])<(l=p[528+32*r[(b+=2)+1]+r[b]]))<<6,_=p[528+32*r[(b+=2)+1]+r[b]],l=p[528+32*r[(b+=2)+1]+r[b]],b+=2,v|=(_<l)<<7,m[x+s]=v;x+=32}}});t.orb=i}(h),function(t){var r,a=(r=h.imgproc.scharr_derivatives,{track:function(t,a,e,f,i,o,n,s,c,u){void 0===n&&(n=30),void 0===s&&(s=new Uint8Array(i)),void 0===c&&(c=.01),void 0===u&&(u=1e-4);var d=.5*(o-1),_=o*o|0,l=_<<1,v=t.data,p=a.data,b=v[0].data,m=p[0].data,x=v[0].cols,y=v[0].rows,w=0,g=0,M=h.cache.get_buffer(_<<2),k=h.cache.get_buffer(l<<2),z=h.cache.get_buffer(y*(x<<1)<<2),A=new h.matrix_t(x,y,h.S32C2_t,z.data),C=M.i32,O=k.i32,R=z.i32,S=0,L=0,I=0,U=0,q=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0,D=0,j=0,Q=0,X=0,H=0,J=0,K=0,W=0,Z=0,$=0,tt=0,rt=0,at=0,et=0,ft=0,it=0,ot=0,nt=0,st=0,ht=0,ct=0,ut=0,dt=0,_t=0,lt=0,vt=0,pt=0,bt=0,mt=0;for(c*=c;J<i;++J)s[J]=1;var xt=t.levels-1|0;for($=xt;$>=0;--$)for(B=1/(1<<$),g=y>>$,S=(w=x>>$)<<1,b=v[$].data,m=p[$].data,at=w-o|0,et=g-o|0,r(v[$],A),tt=0;tt<i;++tt)if(K=1+(J=tt<<1),F=e[J]*B,N=e[K]*B,$==xt?(V=F,E=N):(V=2*f[J],E=2*f[K]),f[J]=V,f[K]=E,0==(W=(j=0|(F-=d))<=0|j>=at|(Q=0|(N-=d))<=0|Q>=et)){for(ut=16384-(st=(1-(ft=F-j))*(1-(it=N-Q))*16384+.5|0)-(ht=ft*(1-it)*16384+.5|0)-(ct=(1-ft)*it*16384+.5|0),vt=0,pt=0,bt=0,Z=0;Z<o;++Z)for(I=(L=(Z+Q)*w+j|0)<<1,q=(U=Z*o|0)<<1,W=0;W<o;++W,++L,++U,I+=2)dt=256+(dt=b[L]*st+b[L+1]*ht+b[L+w]*ct+b[L+w+1]*ut)>>9,_t=8192+(_t=R[I]*st+R[I+2]*ht+R[I+S]*ct+R[I+S+2]*ut)>>14,lt=8192+(lt=R[I+1]*st+R[I+3]*ht+R[I+S+1]*ct+R[I+S+3]*ut)>>14,C[U]=dt,O[q++]=_t,O[q++]=lt,vt+=_t*_t,pt+=_t*lt,bt+=lt*lt;if(mt=(vt*=1/(1<<20))*(bt*=1/(1<<20))-(pt*=1/(1<<20))*pt,(bt+vt-Math.sqrt((vt-bt)*(vt-bt)+4*pt*pt))/l<u||mt<1.1920929e-7)0==$&&(s[tt]=0);else for(mt=1/mt,V-=d,E-=d,P=0,T=0,rt=0;rt<n;++rt){if(0!=(W=(X=0|V)<=0|X>=at|(H=0|E)<=0|H>=et)){0==$&&(s[tt]=0);break}for(ut=16384-(st=(1-(ft=V-X))*(1-(it=E-H))*16384+.5|0)-(ht=ft*(1-it)*16384+.5|0)-(ct=(1-ft)*it*16384+.5|0),ot=0,nt=0,Z=0;Z<o;++Z)for(G=(Z+H)*w+X|0,q=(U=Z*o|0)<<1,W=0;W<o;++W,++G,++U)dt=256+(dt=m[G]*st+m[G+1]*ht+m[G+w]*ct+m[G+w+1]*ut)>>9,ot+=(dt-=C[U])*O[q++],nt+=dt*O[q++];if(V+=Y=(pt*(nt*=1/(1<<20))-bt*(ot*=1/(1<<20)))*mt,E+=D=(pt*ot-vt*nt)*mt,f[J]=V+d,f[K]=E+d,Y*Y+D*D<=c)break;if(rt>0&&Math.abs(Y+P)<.01&&Math.abs(D+T)<.01){f[J]-=.5*Y,f[K]-=.5*D;break}P=Y,T=D}}else 0==$&&(s[tt]=0);h.cache.put_buffer(M),h.cache.put_buffer(k),h.cache.put_buffer(z)}});t.optical_flow_lk=a}(h);var c=function(t,r){var a=.25*t.width+.5|0;return r.x<=t.x+a&&r.x>=t.x-a&&r.y<=t.y+a&&r.y>=t.y-a&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width};const u=function(t,r,a,e,f,i,o,n){var s,h,c,u,d,_,l,v,p,b,m,x,y,w,g,M,k,z,A,C,O,R,S,L,I,U=n.size[0]*o|0,q=n.size[1]*o|0,G=.5*o+1.5|0,B=G,F=f-U|0,N=i-q|0,V=f+1|0,E=1/(U*q),P=!0,T=0,Y=U,D=q*V,j=D+U,Q=U*q*255*.07|0,X=[];for(d=0;d<N;d+=B)for(T=d*V,u=0;u<F;u+=G,T+=G)if(_=t[T]-t[T+Y]-t[T+D]+t[T+j],e&&(e[T]-e[T+Y]-e[T+D]+e[T+j]<Q||_<20))u+=G,T+=G;else{for(_*=E,v=(l=(r[T]-r[T+Y]-r[T+D]+r[T+j])*E-_*_)>0?Math.sqrt(l):1,y=(p=n.complexClassifiers).length,P=!0,s=0;s<y;++s){for(M=(b=p[s]).threshold,w=(m=b.simpleClassifiers).length,k=0,h=0;h<w;++h){if(z=0,g=(C=(x=m[h]).features).length,1===x.tilted)for(c=0;c<g;++c)O=~~(u+(A=C[c])[0]*o)+~~(d+A[1]*o)*V,R=(L=~~(A[2]*o))*V,S=(I=~~(A[3]*o))*V,z+=(a[O]-a[O+L+R]-a[O-I+S]+a[O+L-I+R+S])*A[4];else for(c=0;c<g;++c)O=~~(u+(A=C[c])[0]*o)+~~(d+A[1]*o)*V,L=~~(A[2]*o),S=(I=~~(A[3]*o))*V,z+=(t[O]-t[O+L]-t[O+S]+t[O+S+L])*A[4];k+=z*E<x.threshold*v?x.left_val:x.right_val}if(k<M){P=!1;break}}P&&(X.push({x:u,y:d,width:U,height:q,neighbor:1,confidence:k}),u+=G,T+=G)}return X};var d=Object.freeze({__proto__:null,edges_density:.07,detect_single_scale:u,detect_multi_scale:function(t,r,a,e,f,i,o,n,s){void 0===n&&(n=1.2),void 0===s&&(s=1);for(var h=o.size[0],c=o.size[1],d=[];s*h<f&&s*c<i;)d=d.concat(u(t,r,a,e,f,i,s,o)),s*=n;return d},group_rectangles:function(t,r){void 0===r&&(r=1);var a,e,f=t.length,i=[];for(a=0;a<f;++a)i[a]={parent:-1,element:t[a],rank:0};for(a=0;a<f;++a)if(i[a].element){for(var o=a;-1!=i[o].parent;)o=i[o].parent;for(e=0;e<f;++e)if(a!=e&&i[e].element&&c(i[a].element,i[e].element)){for(var n=e;-1!=i[n].parent;)n=i[n].parent;if(n!=o){i[o].rank>i[n].rank?i[n].parent=o:(i[o].parent=n,i[o].rank==i[n].rank&&i[n].rank++,o=n);for(var s,h=e;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=o;for(h=a;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=o}}}var u=[],d=0;for(a=0;a<f;a++){e=-1;var _=a;if(i[_].element){for(;-1!=i[_].parent;)_=i[_].parent;i[_].rank>=0&&(i[_].rank=~d++),e=~i[_].rank}u[a]=e}var l=[];for(a=0;a<d+1;++a)l[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<f;++a){var v=t[a],p=u[a];0==l[p].neighbors&&(l[p].confidence=v.confidence),++l[p].neighbors,l[p].x+=v.x,l[p].y+=v.y,l[p].width+=v.width,l[p].height+=v.height,l[p].confidence=Math.max(l[p].confidence,v.confidence)}var b=[];for(a=0;a<d;++a)(f=l[a].neighbors)>=r&&b.push({x:(2*l[a].x+f)/(2*f),y:(2*l[a].y+f)/(2*f),width:(2*l[a].width+f)/(2*f),height:(2*l[a].height+f)/(2*f),neighbors:l[a].neighbors,confidence:l[a].confidence});var m=[];for(f=b.length,a=0;a<f;++a){v=b[a];var x=!0;for(e=0;e<f;++e){var y=b[e],w=.25*y.width+.5|0;if(a!=e&&v.x>=y.x-w&&v.y>=y.y-w&&v.x+v.width<=y.x+y.width+w&&v.y+v.height<=y.y+y.height+w&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){x=!1;break}}x&&m.push(v)}return m}});return function(t){var r=function(){var t=function(t,r){var a=.25*t.width+.5|0;return r.x<=t.x+a&&r.x>=t.x-a&&r.y<=t.y+a&&r.y>=t.y-a&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width},r=new h.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var r=t.stage_classifier.length,a=0;a<r;a++)for(var e=t.stage_classifier[a].feature,f=t.stage_classifier[a].count,i=t.stage_classifier[a]._feature=new Array(f),o=0;o<f;o++)i[o]={size:e[o].size,px:new Array(e[o].size),pz:new Array(e[o].size),nx:new Array(e[o].size),nz:new Array(e[o].size)}},build_pyramid:function(t,a,e,f){void 0===f&&(f=4);var i=t.cols,o=t.rows,n=0,s=0,c=0,u=!1,d=t,_=t,l=h.U8_t|h.C1_t;this.interval=f,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(i/a,o/e))/Math.log(this.scale)|0;var v=4*(this.scale_to+2*this.next)|0;for(r.levels!=v&&(r.levels=v,r.data=new Array(v),u=!0,r.data[0]=t),n=1;n<=this.interval;++n)s=i/Math.pow(this.scale,n)|0,c=o/Math.pow(this.scale,n)|0,d=r.data[n<<2],(u||s!=d.cols||c!=d.rows)&&(r.data[n<<2]=new h.matrix_t(s,c,l),d=r.data[n<<2]),h.imgproc.resample(t,d,s,c);for(n=this.next;n<this.scale_to+2*this.next;++n)_=r.data[(n<<2)-(this.next<<2)],d=r.data[n<<2],s=_.cols>>1,c=_.rows>>1,(u||s!=d.cols||c!=d.rows)&&(r.data[n<<2]=new h.matrix_t(s,c,l),d=r.data[n<<2]),h.imgproc.pyrdown(_,d);for(n=2*this.next;n<this.scale_to+2*this.next;++n)s=(_=r.data[(n<<2)-(this.next<<2)]).cols>>1,c=_.rows>>1,d=r.data[1+(n<<2)],(u||s!=d.cols||c!=d.rows)&&(r.data[1+(n<<2)]=new h.matrix_t(s,c,l),d=r.data[1+(n<<2)]),h.imgproc.pyrdown(_,d,1,0),d=r.data[2+(n<<2)],(u||s!=d.cols||c!=d.rows)&&(r.data[2+(n<<2)]=new h.matrix_t(s,c,l),d=r.data[2+(n<<2)]),h.imgproc.pyrdown(_,d,0,1),d=r.data[3+(n<<2)],(u||s!=d.cols||c!=d.rows)&&(r.data[3+(n<<2)]=new h.matrix_t(s,c,l),d=r.data[3+(n<<2)]),h.imgproc.pyrdown(_,d,1,1);return r},detect:function(t,r){this.interval;var a,e,f,i,o,n=this.scale,s=this.next,h=this.scale_to,c=0,u=0,d=0,_=0,l=0,v=0,p=0,b=0,m=0,x=0,y=0,w=0,g=0,M=0,k=0,z=0,A=0,C=0,O=!0,R=!0,S=1,L=1,I=[0,1,0,1],U=[0,0,1,1],q=[],G=t.data,B=[],F=[0,0,0],N=[0,0,0],V=[0,0,0];for(c=0;c<h;c++){for(z=G[(k=c<<2)+(s<<3)].cols-(r.width>>2),A=G[k+(s<<3)].rows-(r.height>>2),N[0]=1*G[k].cols,N[1]=1*G[k+(s<<2)].cols,N[2]=1*G[k+(s<<3)].cols,V[0]=4*G[k].cols-4*z,V[1]=2*G[k+(s<<2)].cols-2*z,V[2]=1*G[k+(s<<3)].cols-1*z,b=r.stage_classifier.length,u=0;u<b;u++)for(f=r.stage_classifier[u].feature,e=r.stage_classifier[u]._feature,m=r.stage_classifier[u].count,d=0;d<m;d++)for(i=e[d],x=0|(o=f[d]).size,p=0;p<x;p++)i.px[p]=1*o.px[p]+o.py[p]*N[o.pz[p]],i.pz[p]=o.pz[p],i.nx[p]=1*o.nx[p]+o.ny[p]*N[o.nz[p]],i.nz[p]=o.nz[p];for(B[0]=G[k].data,B[1]=G[k+(s<<2)].data,p=0;p<4;p++)for(B[2]=G[k+(s<<3)+p].data,F[0]=2*I[p]+U[p]*(2*G[k].cols),F[1]=1*I[p]+U[p]*(1*G[k+(s<<2)].cols),F[2]=0,v=0;v<A;v++){for(l=0;l<z;l++){for(C=0,O=!0,b=r.stage_classifier.length,u=0;u<b;u++){for(C=0,a=r.stage_classifier[u].alpha,e=r.stage_classifier[u]._feature,m=r.stage_classifier[u].count,d=0;d<m;d++)if((w=B[(i=e[d]).pz[0]][F[i.pz[0]]+i.px[0]])<=(g=B[i.nz[0]][F[i.nz[0]]+i.nx[0]]))C+=a[d<<1];else{for(R=!0,x=i.size,M=1;M<x;M++){if(i.pz[M]>=0&&(y=B[i.pz[M]][F[i.pz[M]]+i.px[M]])<w){if(y<=g){R=!1;break}w=y}if(i.nz[M]>=0&&(_=B[i.nz[M]][F[i.nz[M]]+i.nx[M]])>g){if(w<=_){R=!1;break}g=_}}C+=R?a[1+(d<<1)]:a[d<<1]}if(C<r.stage_classifier[u].threshold){O=!1;break}}O&&(q.push({x:(4*l+2*I[p])*S,y:(4*v+2*U[p])*L,width:r.width*S,height:r.height*L,neighbor:1,confidence:C}),++l,F[0]+=4,F[1]+=2,F[2]+=1),F[0]+=4,F[1]+=2,F[2]+=1}F[0]+=V[0],F[1]+=V[1],F[2]+=V[2]}S*=n,L*=n}return q},group_rectangles:function(r,a){void 0===a&&(a=1);var e,f,i=r.length,o=[];for(e=0;e<i;++e)o[e]={parent:-1,element:r[e],rank:0};for(e=0;e<i;++e)if(o[e].element){for(var n=e;-1!=o[n].parent;)n=o[n].parent;for(f=0;f<i;++f)if(e!=f&&o[f].element&&t(o[e].element,o[f].element)){for(var s=f;-1!=o[s].parent;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var h,c=f;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=n;for(c=e;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=n}}}var u=[],d=0;for(e=0;e<i;e++){f=-1;var _=e;if(o[_].element){for(;-1!=o[_].parent;)_=o[_].parent;o[_].rank>=0&&(o[_].rank=~d++),f=~o[_].rank}u[e]=f}var l=[];for(e=0;e<d+1;++e)l[e]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(e=0;e<i;++e){var v=r[e],p=u[e];0==l[p].neighbors&&(l[p].confidence=v.confidence),++l[p].neighbors,l[p].x+=v.x,l[p].y+=v.y,l[p].width+=v.width,l[p].height+=v.height,l[p].confidence=Math.max(l[p].confidence,v.confidence)}var b=[];for(e=0;e<d;++e)(i=l[e].neighbors)>=a&&b.push({x:(2*l[e].x+i)/(2*i),y:(2*l[e].y+i)/(2*i),width:(2*l[e].width+i)/(2*i),height:(2*l[e].height+i)/(2*i),neighbors:l[e].neighbors,confidence:l[e].confidence});var m=[];for(i=b.length,e=0;e<i;++e){v=b[e];var x=!0;for(f=0;f<i;++f){var y=b[f],w=.25*y.width+.5|0;if(e!=f&&v.x>=y.x-w&&v.y>=y.y-w&&v.x+v.width<=y.x+y.width+w&&v.y+v.height<=y.y+y.height+w&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){x=!1;break}}x&&m.push(v)}return m}}}();t.bbf=r}(h),h.haar=d,h}));
