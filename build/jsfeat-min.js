!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t=t||self).jsfeat=a()}(this,(function(){"use strict";var t={REVISION:"ALPHA"};const a=function(t,a,r,e){var f=t.rows,i=t.cols;f>e&&i>r&&(a.resize(r,e,t.channel),t.type&jsfeat.U8_t&&a.type&jsfeat.U8_t&&f*i/(e*r)<256?function(t,a,r,e){for(var f=0,i=t.channel,o=t.cols,n=t.rows,s=t.data,h=a.data,c=o/r,u=n/e,d=c*u*65536|0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=0,O=jsfeat.cache.get_buffer(r*i<<2),R=jsfeat.cache.get_buffer(r*i<<2),S=jsfeat.cache.get_buffer(2*o*3<<2),L=O.i32,I=R.i32,U=S.i32;_<r;_++){for(p=(w=_*c)+1-1e-6|0,m=0|(M=w+c),p=Math.min(p,o-1),m=Math.min(m,o-1),p>w&&(U[y++]=_*i|0,U[y++]=(p-1)*i|0,U[y++]=256*(p-w)|0,f++),v=p;v<m;v++)f++,U[y++]=_*i|0,U[y++]=v*i|0,U[y++]=256;M-m>.001&&(f++,U[y++]=_*i|0,U[y++]=m*i|0,U[y++]=256*(M-m)|0)}for(_=0;_<r*i;_++)L[_]=I[_]=0;for(l=0,b=0;b<n;b++){for(g=o*b,y=0;y<f;y++)for(z=U[3*y],p=U[3*y+1],j=U[3*y+2],x=0;x<i;x++)L[z+x]+=s[g+p+x]*j;if((l+1)*u<=b+1||b==n-1){if(C=256-(A=256*Math.max(b+1-(l+1)*u,0)|0),k=r*l,A<=0)for(_=0;_<r*i;_++)h[k+_]=Math.min(Math.max((I[_]+256*L[_])/d,0),255),I[_]=L[_]=0;else for(_=0;_<r*i;_++)h[k+_]=Math.min(Math.max((I[_]+L[_]*C)/d,0),255),I[_]=L[_]*A,L[_]=0;l++}else for(_=0;_<r*i;_++)I[_]+=256*L[_],L[_]=0}jsfeat.cache.put_buffer(R),jsfeat.cache.put_buffer(O),jsfeat.cache.put_buffer(S)}(t,a,r,e):function(t,a,r,e){for(var f=0,i=t.channel,o=t.cols,n=t.rows,s=t.data,h=a.data,c=o/r,u=n/e,d=1/(c*u),_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=0,O=jsfeat.cache.get_buffer(r*i<<2),R=jsfeat.cache.get_buffer(r*i<<2),S=jsfeat.cache.get_buffer(2*o*3<<2),L=O.f32,I=R.f32,U=S.f32;_<r;_++){for(p=(w=_*c)+1-1e-6|0,m=0|(M=w+c),p=Math.min(p,o-1),m=Math.min(m,o-1),p>w&&(f++,U[y++]=(p-1)*i|0,U[y++]=_*i|0,U[y++]=(p-w)*d),v=p;v<m;v++)f++,U[y++]=v*i|0,U[y++]=_*i|0,U[y++]=d;M-m>.001&&(f++,U[y++]=m*i|0,U[y++]=_*i|0,U[y++]=(M-m)*d)}for(_=0;_<r*i;_++)L[_]=I[_]=0;for(l=0,b=0;b<n;b++){for(g=o*b,y=0;y<f;y++)for(p=0|U[3*y],z=0|U[3*y+1],j=U[3*y+2],x=0;x<i;x++)L[z+x]+=s[g+p+x]*j;if((l+1)*u<=b+1||b==n-1){if(C=1-(A=Math.max(b+1-(l+1)*u,0)),k=r*l,Math.abs(A)<.001)for(_=0;_<r*i;_++)h[k+_]=I[_]+L[_],I[_]=L[_]=0;else for(_=0;_<r*i;_++)h[k+_]=I[_]+L[_]*C,I[_]=L[_]*A,L[_]=0;l++}else for(_=0;_<r*i;_++)I[_]+=L[_],L[_]=0}jsfeat.cache.put_buffer(R),jsfeat.cache.put_buffer(O),jsfeat.cache.put_buffer(S)}(t,a,r,e))},r=function(t,a,r,e){void 0===r&&(r=0),void 0===e&&(e=0);var f=t.cols,i=f>>1,o=t.rows>>1,n=i-(r<<1),s=o-(e<<1),h=0,c=0,u=r+e*f,d=0,_=0,l=0;a.resize(i,o,t.channel);var v=t.data,b=a.data;for(c=0;c<s;++c){for(d=u,l=_,h=0;h<=n-2;h+=2,l+=2,d+=4)b[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2,b[l+1]=v[d+2]+v[d+3]+v[d+f+2]+v[d+f+3]+2>>2;for(;h<n;++h,++l,d+=2)b[l]=v[d]+v[d+1]+v[d+f]+v[d+f+1]+2>>2;u+=f<<1,_+=i}},e=function(t,a){var r,e,f,i,o,n,s,h,c=t.cols,u=t.rows,d=c<<1,_=0,l=0,v=0,b=0,p=0,m=0,x=0;a.resize(c,u,2);var y=t.data,w=a.data,M=jsfeat.cache.get_buffer(c+2<<2),g=jsfeat.cache.get_buffer(c+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(s=M.i32,h=g.i32):(s=M.f32,h=g.f32);l<u;++l,p+=c){for(b=(l>0?l-1:1)*c|0,m=(l<u-1?l+1:u-2)*c|0,x=l*d|0,_=0,v=1;_<=c-2;_+=2,v+=2)r=y[b+_],e=y[m+_],s[v]=3*(r+e)+10*y[p+_],h[v]=e-r,r=y[b+_+1],e=y[m+_+1],s[v+1]=3*(r+e)+10*y[p+_+1],h[v+1]=e-r;for(;_<c;++_,++v)r=y[b+_],e=y[m+_],s[v]=3*(r+e)+10*y[p+_],h[v]=e-r;for(_=c+1|0,s[0]=s[1],s[_]=s[c],h[0]=h[1],h[_]=h[c],_=0;_<=c-4;_+=4)r=h[_+2],e=h[_+1],f=h[_+3],i=h[_+4],o=s[_+2],n=s[_+3],w[x++]=o-s[_],w[x++]=3*(r+h[_])+10*e,w[x++]=n-s[_+1],w[x++]=3*(f+e)+10*r,w[x++]=s[_+4]-o,w[x++]=3*(i+r)+10*f,w[x++]=s[_+5]-n,w[x++]=3*(h[_+5]+f)+10*i;for(;_<c;++_)w[x++]=s[_+2]-s[_],w[x++]=3*(h[_+2]+h[_])+10*h[_+1]}jsfeat.cache.put_buffer(M),jsfeat.cache.put_buffer(g)},f=function(t,a){var r,e,f,i,o,n,s,h,c=t.cols,u=t.rows,d=c<<1,_=0,l=0,v=0,b=0,p=0,m=0,x=0;a.resize(c,u,2);var y=t.data,w=a.data,M=jsfeat.cache.get_buffer(c+2<<2),g=jsfeat.cache.get_buffer(c+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(s=M.i32,h=g.i32):(s=M.f32,h=g.f32);l<u;++l,p+=c){for(b=(l>0?l-1:1)*c|0,m=(l<u-1?l+1:u-2)*c|0,x=l*d|0,_=0,v=1;_<=c-2;_+=2,v+=2)r=y[b+_],e=y[m+_],s[v]=r+e+2*y[p+_],h[v]=e-r,r=y[b+_+1],e=y[m+_+1],s[v+1]=r+e+2*y[p+_+1],h[v+1]=e-r;for(;_<c;++_,++v)r=y[b+_],e=y[m+_],s[v]=r+e+2*y[p+_],h[v]=e-r;for(_=c+1|0,s[0]=s[1],s[_]=s[c],h[0]=h[1],h[_]=h[c],_=0;_<=c-4;_+=4)r=h[_+2],e=h[_+1],f=h[_+3],i=h[_+4],o=s[_+2],n=s[_+3],w[x++]=o-s[_],w[x++]=r+h[_]+2*e,w[x++]=n-s[_+1],w[x++]=f+e+2*r,w[x++]=s[_+4]-o,w[x++]=i+r+2*f,w[x++]=s[_+5]-n,w[x++]=h[_+5]+f+2*i;for(;_<c;++_)w[x++]=s[_+2]-s[_],w[x++]=h[_+2]+h[_]+2*h[_+1]}jsfeat.cache.put_buffer(M),jsfeat.cache.put_buffer(g)},i=function(t,a,r,e){void 0===e&&(e=0);for(var f=t.cols,i=t.rows,o=a.cols,n=a.rows,s=t.data,h=a.data,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=r.data,M=w[0],g=w[1],k=w[2],z=w[3],j=w[4],A=w[5],C=0;u<n;++u)for(v=g*u+k,b=j*u+A,c=0;c<o;++c,++C,v+=M,b+=z)l=0|b,(_=0|v)>=0&&l>=0&&_<f-1&&l<i-1?(p=v-_,m=b-l,x=s[d=f*l+_]+p*(s[d+1]-s[d]),y=s[d+f]+p*(s[d+f+1]-s[d+f]),h[C]=x+m*(y-x)):h[C]=e};var o,n,s,h,c,u,d,_,l,v=Object.freeze({__proto__:null,grayscale:function(t,a,r,e,f){void 0===f&&(f=jsfeat.COLOR_RGBA2GRAY);var i=0,o=0,n=0,s=0,h=0,c=0,u=4899,d=1868,_=4;f!=jsfeat.COLOR_BGRA2GRAY&&f!=jsfeat.COLOR_BGR2GRAY||(u=1868,d=4899),f!=jsfeat.COLOR_RGB2GRAY&&f!=jsfeat.COLOR_BGR2GRAY||(_=3);var l=_<<1,v=3*_|0;e.resize(a,r,1);var b=e.data;for(o=0;o<r;++o,s+=a,n+=a*_){for(i=0,h=n,c=s;i<=a-4;i+=4,h+=_<<2,c+=4)b[c]=t[h]*u+9617*t[h+1]+t[h+2]*d+8192>>14,b[c+1]=t[h+_]*u+9617*t[h+_+1]+t[h+_+2]*d+8192>>14,b[c+2]=t[h+l]*u+9617*t[h+l+1]+t[h+l+2]*d+8192>>14,b[c+3]=t[h+v]*u+9617*t[h+v+1]+t[h+v+2]*d+8192>>14;for(;i<a;++i,++c,h+=_)b[c]=t[h]*u+9617*t[h+1]+t[h+2]*d+8192>>14}},resample:a,box_blur_gray:function(t,a,r,e){void 0===e&&(e=0);var f=t.cols,i=t.rows,o=i<<1,n=f<<1,s=0,h=0,c=0,u=0,d=1+(r<<1)|0,_=r+1|0,l=_+1|0,v=e&jsfeat.BOX_BLUR_NOSCALE?1:1/(d*d),b=jsfeat.cache.get_buffer(f*i<<2),p=0,m=0,x=0,y=0,w=0,M=b.i32,g=t.data,k=0;for(a.resize(f,i,t.channel),c=0;c<i;++c){for(m=c,p=_*g[x],s=x+1|0,u=x+r|0;s<=u;++s)p+=g[s];for(y=x+_|0,k=g[w=x],h=0;h<r;++h,m+=i)M[m]=p,p+=g[y]-k,y++;for(;h<f-l;h+=2,m+=o)M[m]=p,p+=g[y]-g[w],M[m+i]=p,p+=g[y+1]-g[w+1],y+=2,w+=2;for(;h<f-_;++h,m+=i)M[m]=p,p+=g[y]-g[w],y++,w++;for(k=g[y-1];h<f;++h,m+=i)M[m]=p,p+=k-g[w],w++;x+=f}if(x=0,g=a.data,1==v)for(c=0;c<f;++c){for(m=c,p=_*M[x],s=x+1|0,u=x+r|0;s<=u;++s)p+=M[s];for(y=x+_,k=M[w=x],h=0;h<r;++h,m+=f)g[m]=p,p+=M[y]-k,y++;for(;h<i-l;h+=2,m+=n)g[m]=p,p+=M[y]-M[w],g[m+f]=p,p+=M[y+1]-M[w+1],y+=2,w+=2;for(;h<i-_;++h,m+=f)g[m]=p,p+=M[y]-M[w],y++,w++;for(k=M[y-1];h<i;++h,m+=f)g[m]=p,p+=k-M[w],w++;x+=i}else for(c=0;c<f;++c){for(m=c,p=_*M[x],s=x+1|0,u=x+r|0;s<=u;++s)p+=M[s];for(y=x+_,k=M[w=x],h=0;h<r;++h,m+=f)g[m]=p*v,p+=M[y]-k,y++;for(;h<i-l;h+=2,m+=n)g[m]=p*v,p+=M[y]-M[w],g[m+f]=p*v,p+=M[y+1]-M[w+1],y+=2,w+=2;for(;h<i-_;++h,m+=f)g[m]=p*v,p+=M[y]-M[w],y++,w++;for(k=M[y-1];h<i;++h,m+=f)g[m]=p*v,p+=k-M[w],w++;x+=i}jsfeat.cache.put_buffer(b)},gaussian_blur:function(t,a,r,e){void 0===e&&(e=0),void 0===r&&(r=0);var f=(r=0==r?2*Math.max(1,4*e+1-1e-8)+1|0:r)>>1,i=t.cols,o=t.rows,n=t.type,s=n&jsfeat.U8_t;a.resize(i,o,t.channel);var h,c,u=t.data,d=a.data,_=r+Math.max(o,i)|0,l=jsfeat.cache.get_buffer(_<<2),v=jsfeat.cache.get_buffer(r<<2);s?(h=l.i32,c=v.i32):n&jsfeat.S32_t?(h=l.i32,c=v.f32):(h=l.f32,c=v.f32),jsfeat.math.get_gaussian_kernel(r,e,c,n),s?function(t,a,r,e,f,i,o,n){for(var s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=i[0],m=0,x=e<<1,y=3*e,w=e<<2;s<f;++s){for(_=a[u],h=0;h<n;++h)t[h]=_;for(h=0;h<=e-2;h+=2)t[h+n]=a[u+h],t[h+n+1]=a[u+h+1];for(;h<e;++h)t[h+n]=a[u+h];for(_=a[u+e-1],h=e;h<n+e;++h)t[h+n]=_;for(h=0;h<=e-4;h+=4){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,b+=t[c+h+3]*m;r[d+h]=Math.min(_>>8,255),r[d+h+1]=Math.min(l>>8,255),r[d+h+2]=Math.min(v>>8,255),r[d+h+3]=Math.min(b>>8,255)}for(;h<e;++h){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];r[d+h]=Math.min(_>>8,255)}u+=e,d+=e}for(s=0;s<e;++s){for(_=r[s],h=0;h<n;++h)t[h]=_;for(c=s,h=0;h<=f-2;h+=2,c+=x)t[h+n]=r[c],t[h+n+1]=r[c+e];for(;h<f;++h,c+=e)t[h+n]=r[c];for(_=r[(f-1)*e+s],h=f;h<n+f;++h)t[h+n]=_;for(d=s,h=0;h<=f-4;h+=4,d+=w){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,b+=t[c+h+3]*m;r[d]=Math.min(_>>8,255),r[d+e]=Math.min(l>>8,255),r[d+x]=Math.min(v>>8,255),r[d+y]=Math.min(b>>8,255)}for(;h<f;++h,d+=e){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];r[d]=Math.min(_>>8,255)}}}(h,u,d,i,o,c,r,f):function(t,a,r,e,f,i,o,n){for(var s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=i[0],m=0,x=e<<1,y=3*e,w=e<<2;s<f;++s){for(_=a[u],h=0;h<n;++h)t[h]=_;for(h=0;h<=e-2;h+=2)t[h+n]=a[u+h],t[h+n+1]=a[u+h+1];for(;h<e;++h)t[h+n]=a[u+h];for(_=a[u+e-1],h=e;h<n+e;++h)t[h+n]=_;for(h=0;h<=e-4;h+=4){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,b+=t[c+h+3]*m;r[d+h]=_,r[d+h+1]=l,r[d+h+2]=v,r[d+h+3]=b}for(;h<e;++h){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];r[d+h]=_}u+=e,d+=e}for(s=0;s<e;++s){for(_=r[s],h=0;h<n;++h)t[h]=_;for(c=s,h=0;h<=f-2;h+=2,c+=x)t[h+n]=r[c],t[h+n+1]=r[c+e];for(;h<f;++h,c+=e)t[h+n]=r[c];for(_=r[(f-1)*e+s],h=f;h<n+f;++h)t[h+n]=_;for(d=s,h=0;h<=f-4;h+=4,d+=w){for(_=t[h]*p,l=t[h+1]*p,v=t[h+2]*p,b=t[h+3]*p,c=1;c<o;++c)m=i[c],_+=t[c+h]*m,l+=t[c+h+1]*m,v+=t[c+h+2]*m,b+=t[c+h+3]*m;r[d]=_,r[d+e]=l,r[d+x]=v,r[d+y]=b}for(;h<f;++h,d+=e){for(_=t[h]*p,c=1;c<o;++c)_+=t[c+h]*i[c];r[d]=_}}}(h,u,d,i,o,c,r,f),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(v)},hough_transform:function(t,a,r,e){for(var f=t.data,i=t.cols,o=t.rows,n=i,s=Math.PI,h=Math.round((s-0)/r),c=Math.round((2*(i+o)+1)/a),u=1/a,d=new Int32Array((h+2)*(c+2)),_=new Float32Array(h),l=new Float32Array(h),v=0,b=0;v<h;v++)_[v]=Math.sin(b)*u,l[v]=Math.cos(b)*u,b+=r;for(var p=0;p<o;p++)for(var m=0;m<i;m++)if(0!=f[p*n+m])for(v=0;v<h;v++){var x=Math.round(m*l[v]+p*_[v]);d[(v+1)*(c+2)+(x+=(c-1)/2)+1]+=1}var y=new Array;for(x=0;x<c;x++)for(v=0;v<h;v++){var w=(v+1)*(c+2)+x+1;d[w]>e&&d[w]>d[w-1]&&d[w]>=d[w+1]&&d[w]>d[w-c-2]&&d[w]>=d[w+c+2]&&y.push(w)}y.sort((function(t,a){return d[t]>d[a]||d[t]==d[a]&&t<a}));var M=Math.min(h*c,y.length),g=1/(c+2),k=new Array;for(p=0;p<M;p++){var z=y[p],j=((x=z-((v=Math.floor(z*g)-1)+1)*(c+2)-1)-.5*(c-1))*a,A=v*r;k.push([j,A])}return k},pyrdown:r,scharr_derivatives:e,sobel_derivatives:f,compute_integral_image:function(t,a,r,e){var f=0|t.cols,i=0|t.rows,o=t.data,n=f+1|0,s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;if(a&&r){for(;d<n;++d)a[d]=0,r[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(s=h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)s+=l=o[v],h+=l*l,a[c]=a[u]+s,r[c]=r[u]+h,s+=l=o[v+1],h+=l*l,a[c+1]=a[u+1]+s,r[c+1]=r[u+1]+h;for(;_<f;++_,++v,++c,++u)s+=l=o[v],h+=l*l,a[c]=a[u]+s,r[c]=r[u]+h}}else if(a){for(;d<n;++d)a[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(s=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)s+=o[v],a[c]=a[u]+s,s+=o[v+1],a[c+1]=a[u+1]+s;for(;_<f;++_,++v,++c,++u)s+=o[v],a[c]=a[u]+s}}else if(r){for(;d<n;++d)r[d]=0;for(c=n+1|0,u=1,d=0,v=0;d<i;++d,++c,++u){for(h=0,_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)h+=(l=o[v])*l,r[c]=r[u]+h,h+=(l=o[v+1])*l,r[c+1]=r[u+1]+h;for(;_<f;++_,++v,++c,++u)h+=(l=o[v])*l,r[c]=r[u]+h}}if(e){for(d=0;d<n;++d)e[d]=0;for(c=n+1|0,u=0,d=0,v=0;d<i;++d,++c,++u){for(_=0;_<=f-2;_+=2,v+=2,c+=2,u+=2)e[c]=o[v]+e[u],e[c+1]=o[v+1]+e[u+1];for(;_<f;++_,++v,++c,++u)e[c]=o[v]+e[u]}for(c=n+f|0,u=f,d=0;d<i;++d,c+=n,u+=n)e[c]+=e[u];for(_=f-1;_>0;--_)for(u=(c=_+i*n)-n,d=i;d>0;--d,c-=n,u-=n)e[c]+=e[u]+e[u+1]}},equalize_histogram:function(t,a){var r=t.cols,e=t.rows,f=t.data;a.resize(r,e,t.channel);var i,o,n=a.data,s=r*e,h=0,c=0,u=jsfeat.cache.get_buffer(1024);for(i=u.i32;h<256;++h)i[h]=0;for(h=0;h<s;++h)++i[f[h]];for(c=i[0],h=1;h<256;++h)c=i[h]+=c;for(o=255/s,h=0;h<s;++h)n[h]=i[f[h]]*o+.5|0;jsfeat.cache.put_buffer(u)},canny:function(t,a,r,e){var i=t.cols,o=t.rows;t.data;a.resize(i,o,t.channel);var n=a.data,s=0,h=0,c=0,u=i<<1,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=jsfeat.cache.get_buffer(o*u<<2),w=jsfeat.cache.get_buffer(3*(i+2)<<2),M=jsfeat.cache.get_buffer((o+2)*(i+2)<<2),g=jsfeat.cache.get_buffer(o*i<<2),k=w.i32,z=M.i32,j=g.i32,A=y.i32,C=new jsfeat.matrix_t(i,o,jsfeat.S32C2_t,y.data),O=1,R=i+2+1|0,S=2*(i+2)+1|0,L=i+2|0,I=L+1|0,U=0;for(f(t,C),r>e&&(s=r,r=e,e=s),s=3*(i+2)|0;--s>=0;)k[s]=0;for(s=(o+2)*(i+2)|0;--s>=0;)z[s]=0;for(;h<i;++h,c+=2)v=A[c],b=A[c+1],k[R+h]=(v^v>>31)-(v>>31)+((b^b>>31)-(b>>31));for(s=1;s<=o;++s,c+=u){if(s==o)for(h=S+i;--h>=S;)k[h]=0;else for(h=0;h<i;h++)v=A[c+(h<<1)],b=A[c+(h<<1)+1],k[S+h]=(v^v>>31)-(v>>31)+((b^b>>31)-(b>>31));for(d=c-u|0,z[I-1]=0,_=0,h=0;h<i;++h,d+=2){if((l=k[R+h])>r)if(p=(v=A[d])^(b=A[d+1]),b=(b^b>>31)-(b>>31)|0,x=(m=13573*(v=(v^v>>31)-(v>>31)|0))+(v+v<<15),(b<<=15)<m){if(l>k[R+h-1]&&l>=k[R+h+1]){l>e&&!_&&2!=z[I+h-L]?(z[I+h]=2,_=1,j[U++]=I+h):z[I+h]=1;continue}}else if(b>x){if(l>k[O+h]&&l>=k[S+h]){l>e&&!_&&2!=z[I+h-L]?(z[I+h]=2,_=1,j[U++]=I+h):z[I+h]=1;continue}}else if(l>k[O+h-(p=p<0?-1:1)]&&l>k[S+h+p]){l>e&&!_&&2!=z[I+h-L]?(z[I+h]=2,_=1,j[U++]=I+h):z[I+h]=1;continue}z[I+h]=0,_=0}z[I+i]=0,I+=L,h=O,O=R,R=S,S=h}for(h=I-L-1,s=0;s<L;++s,++h)z[h]=0;for(;U>0;)I=j[--U],1==z[I-=L+1]&&(z[I]=2,j[U++]=I),1==z[I+=1]&&(z[I]=2,j[U++]=I),1==z[I+=1]&&(z[I]=2,j[U++]=I),1==z[I+=L]&&(z[I]=2,j[U++]=I),1==z[I-=2]&&(z[I]=2,j[U++]=I),1==z[I+=L]&&(z[I]=2,j[U++]=I),1==z[I+=1]&&(z[I]=2,j[U++]=I),1==z[I+=1]&&(z[I]=2,j[U++]=I);for(I=L+1,O=0,s=0;s<o;++s,I+=L)for(h=0;h<i;++h)n[O++]=255*(2==z[I+h]);jsfeat.cache.put_buffer(y),jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(M),jsfeat.cache.put_buffer(g)},warp_perspective:function(t,a,r,e){void 0===e&&(e=0);for(var f=0|t.cols,i=0|t.rows,o=0|a.cols,n=0|a.rows,s=t.data,h=a.data,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=r.data,j=z[0],A=z[1],C=z[2],O=z[3],R=z[4],S=z[5],L=z[6],I=z[7],U=z[8],q=0;u<n;++u)for(p=A*u+C,m=R*u+S,x=I*u+U,c=0;c<o;++c,++q,p+=j,m+=O,x+=L)_=0|(v=p*(y=1/x)),l=0|(b=m*y),v>0&&b>0&&_<f-1&&l<i-1?(w=Math.max(v-_,0),M=Math.max(b-l,0),g=s[d=f*l+_|0]+w*(s[d+1]-s[d]),k=s[d+f]+w*(s[d+f+1]-s[d+f]),h[q]=g+M*(k-g)):h[q]=e},warp_affine:i,skindetector:function(t,a){for(var r,e,f,i,o=t.width*t.height;o--;)i=4*o,r=t.data[i],e=t.data[i+1],f=t.data[i+2],r>95&&e>40&&f>20&&r>e&&r>f&&r-Math.min(e,f)>15&&Math.abs(r-e)>15?a[o]=255:a[o]=0}});o=t,n=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),s=function(t){return 65280&t},h=function(t){return 255&t},c=function(t){return n[(65280&t)>>8]},u=function(t,a){this.size=-8&(t+7|0),void 0===a?this.buffer=new ArrayBuffer(this.size):(this.buffer=a,this.size=a.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)},d=function(){function t(t,a,r,e){this.type=0|s(r),this.channel=0|h(r),this.cols=0|t,this.rows=0|a,void 0===e?this.allocate():(this.buffer=e,this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new u(this.cols*c(this.type)*this.channel*this.rows),this.data=256&this.type?this.buffer.u8:512&this.type?this.buffer.i32:1024&this.type?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var a=t.data,r=this.data,e=0,f=this.cols*this.rows*this.channel|0;e<f-4;e+=4)a[e]=r[e],a[e+1]=r[e+1],a[e+2]=r[e+2],a[e+3]=r[e+3];for(;e<f;++e)a[e]=r[e]},t.prototype.resize=function(t,a,r){void 0===r&&(r=this.channel),t*c(this.type)*r*a>this.buffer.size?(this.cols=t,this.rows=a,this.channel=r,this.allocate()):(this.cols=t,this.rows=a,this.channel=r)},t}(),_=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=r}return t.prototype.allocate=function(t,a,r){for(var e=this.levels;--e>=0;)this.data[e]=new d(t>>e,a>>e,r)},t.prototype.build=function(t,a){void 0===a&&(a=!0);var r=2,e=t,f=this.data[0];if(!a)for(var i=t.cols*t.rows;--i>=0;)f.data[i]=t.data[i];for(f=this.data[1],this.pyrdown(e,f);r<this.levels;++r)e=f,f=this.data[r],this.pyrdown(e,f)},t}(),l=function(t,a,r,e,f){void 0===t&&(t=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===e&&(e=0),void 0===f&&(f=-1),this.x=t,this.y=a,this.score=r,this.level=e,this.angle=f},o.U8_t=256,o.S32_t=512,o.F32_t=1024,o.S64_t=2048,o.F64_t=4096,o.C1_t=1,o.C2_t=2,o.C3_t=3,o.C4_t=4,o.U8C1_t=257,o.U8C3_t=259,o.U8C4_t=260,o.F32C1_t=1025,o.F32C2_t=1026,o.S32C1_t=513,o.S32C2_t=514,o.EPSILON=1.192092896e-7,o.FLT_MIN=1e-37,o.COLOR_RGBA2GRAY=0,o.COLOR_RGB2GRAY=1,o.COLOR_BGRA2GRAY=2,o.COLOR_BGR2GRAY=3,o.BOX_BLUR_NOSCALE=1,o.SVD_U_T=1,o.SVD_V_T=2,o.get_data_type=s,o.get_channel=h,o.get_data_type_size=c,o.data_t=u,o.matrix_t=d,o.pyramid_t=_,o.keypoint_t=l,function(a){var r,e,f,i=(f=function(){function a(a){this.next=null,this.data=new t.data_t(a),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return a.prototype.resize=function(a){delete this.data,this.data=new t.data_t(a),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},a}(),{allocate:function(t,a){r=e=new f(a);for(var i=0;i<t;++i){var o=new f(a);e=e.next=o}},get_buffer:function(t){var a=r;return r=r.next,t>a.size&&a.resize(t),a},put_buffer:function(t){e=e.next=t}});a.cache=i,i.allocate(30,2560)}(t),function(a){var r,e=(r=new Int32Array(96),{get_gaussian_kernel:function(a,r,e,f){var i=0,o=0,n=0,s=0,h=0,c=0,u=t.cache.get_buffer(a<<2),d=u.f32;if(1==(1&a)&&a<=7&&r<=0)switch(a>>1){case 0:d[0]=1,c=1;break;case 1:d[0]=.25,d[1]=.5,d[2]=.25,c=1;break;case 2:d[0]=.0625,d[1]=.25,d[2]=.375,d[3]=.25,d[4]=.0625,c=1;break;case 3:d[0]=.03125,d[1]=.109375,d[2]=.21875,d[3]=.28125,d[4]=.21875,d[5]=.109375,d[6]=.03125,c=1}else for(h=-.5/((s=r>0?r:.3*(.5*(a-1)-1)+.8)*s);i<a;++i)o=i-.5*(a-1),n=Math.exp(h*o*o),d[i]=n,c+=n;if(f&t.U8_t)for(c=256/c,i=0;i<a;++i)e[i]=d[i]*c+.5|0;else for(c=1/c,i=0;i<a;++i)e[i]=d[i]*c;t.cache.put_buffer(u)},perspective_4point_transform:function(t,a,r,e,f,i,o,n,s,h,c,u,d,_,l,v,b){var p=a,m=h,x=o,y=p*m*x,w=l,M=p*w,g=m*M,k=c,z=p*k,j=i,A=r,C=_,O=A*C,R=O*j,S=C*j*k,L=C*x,I=C*k,U=m*x,q=w*m,G=w*j,B=k*j,F=1/(L-I-U+q-G+B),N=p*C,V=A*j,E=x*p,P=w*E,T=A*m,Y=O*k,D=A*k*j,Q=x*w*m,X=w*A,H=-(g-y+z*j-j*M-O*m+R-S+L*m)*F,J=(y-g-N*x+N*k+R-m*V+G*m-S)*F,K=p,W=(-k*M+P+T*x-O*x+Y-D+G*k-Q)*F,Z=(E*k-P-X*m+Y-D+X*j+Q-L*k)*F,$=A,tt=(-z+E+T-V+I-L-q+G)*F,at=(-M+z+O-T+G-B-L+U)*F,rt=-((g=(m=u)*(M=(p=e)*(w=b)))-(y=p*m*(x=s))+(z=p*(k=d))*(j=n)-j*M-(O=(A=f)*(C=v))*m+(R=O*j)-(S=C*j*k)+(L=C*x)*m)*(F=1/(L-(I=C*k)-(U=m*x)+(q=w*m)-(G=w*j)+(B=k*j))),et=(y-g-(N=p*C)*x+N*k+R-m*(V=A*j)+G*m-S)*F,ft=p,it=(-k*M+(P=w*(E=x*p))+(T=A*m)*x-O*x+(Y=O*k)-(D=A*k*j)+G*k-(Q=x*w*m))*F,ot=(E*k-P-(X=w*A)*m+Y-D+X*j+Q-L*k)*F,nt=A,st=(-z+E+T-V+I-L-q+G)*F,ht=(-M+z+O-T+G-B-L+U)*F,ct=K*tt;R=$*tt-W;var ut=-W*at+Z*tt,dt=H-ct;V=H*at-(z=J*tt);var _t=(y=H*$)-(g=K*W),lt=(x=H*Z)-(M=W*J);D=(m=Z-at*$)*(C=1/(x-y*at-M+g*at+z*$-ct*Z));var vt=(B=K*at-J)*C,bt=(E=-J*$+K*Z)*C,pt=t.data;pt[0]=rt*D+et*(R*C)-ft*(ut*C),pt[1]=rt*vt+et*(dt*C)-ft*(V*C),pt[2]=-rt*bt-et*(_t*C)+ft*(lt*C),pt[3]=it*D+ot*(R*C)-nt*(ut*C),pt[4]=it*vt+ot*(dt*C)-nt*(V*C),pt[5]=-it*bt-ot*(_t*C)+nt*(lt*C),pt[6]=st*D+ht*(R*C)-ut*C,pt[7]=st*vt+ht*(dt*C)-V*C,pt[8]=-st*bt-ht*(_t*C)+lt*C},qsort:function(t,a,e,f){var i,o,n,s,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=r;if(!(e-a+1<=1))for(A[0]=a,A[1]=e;h>=0;)for(c=A[h<<1],u=A[1+(h<<1)],h--;;){if((_=u-c+1)<=7){for(v=c+1;v<=u;v++)for(b=v;b>c&&f(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(j=0,m=c,y=u,M=c+(_>>1),_>40&&(k=c+(p=_>>3),z=c+(p<<1),o=t[g=c],n=t[k],s=t[z],c=f(o,n)?f(n,s)?k:f(o,s)?z:g:f(s,n)?k:f(o,s)?g:z,k=M,z=M+p,o=t[g=M-p],n=t[k],s=t[z],M=f(o,n)?f(n,s)?k:f(o,s)?z:g:f(s,n)?k:f(o,s)?g:z,k=u-p,z=u,o=t[g=u-(p<<1)],n=t[k],s=t[z],u=f(o,n)?f(n,s)?k:f(o,s)?z:g:f(s,n)?k:f(o,s)?g:z),k=M,z=u,o=t[g=c],n=t[k],s=t[z],(M=f(o,n)?f(n,s)?k:f(o,s)?z:g:f(s,n)?k:f(o,s)?g:z)!=m&&(i=t[M],t[M]=t[m],t[m]=i,M=m),c=x=m+1,u=w=y,o=t[M];;){for(;c<=u&&!f(o,t[c]);)f(t[c],o)||(c>x&&(i=t[x],t[x]=t[c],t[c]=i),j=1,x++),c++;for(;c<=u&&!f(t[u],o);)f(o,t[u])||(u<w&&(i=t[w],t[w]=t[u],t[u]=i),j=1,w--),u--;if(c>u)break;i=t[c],t[c]=t[u],t[u]=i,j=1,c++,u--}if(0==j){for(u=y,v=(c=m)+1;v<=u;v++)for(b=v;b>c&&f(t[b],t[b-1]);b--)i=t[b],t[b]=t[b-1],t[b-1]=i;break}for(l=c-(_=Math.min(x-m,c-x))|0,d=0;d<_;++d,++l)i=t[m+d],t[m+d]=t[l],t[l]=i;for(l=y-(_=Math.min(y-w,w-u))+1|0,d=0;d<_;++d,++l)i=t[c+d],t[c+d]=t[l],t[l]=i;if(l=w-u,(_=c-x)>1)l>1?_>l?(A[++h<<1]=m,A[1+(h<<1)]=m+_-1,c=y-l+1,u=y):(A[++h<<1]=y-l+1,A[1+(h<<1)]=y,c=m,u=m+_-1):(c=m,u=m+_-1);else{if(!(l>1))break;c=y-l+1,u=y}}},median:function(t,a,r){for(var e,f=0,i=0,o=0,n=a+r>>1;;){if(r<=a)return t[n];if(r==a+1)return t[a]>t[r]&&(e=t[a],t[a]=t[r],t[r]=e),t[n];for(t[f=a+r>>1]>t[r]&&(e=t[f],t[f]=t[r],t[r]=e),t[a]>t[r]&&(e=t[a],t[a]=t[r],t[r]=e),t[f]>t[a]&&(e=t[f],t[f]=t[a],t[a]=e),i=a+1,e=t[f],t[f]=t[i],t[i]=e,o=r;;){do{++i}while(t[a]>t[i]);do{--o}while(t[o]>t[a]);if(o<i)break;e=t[i],t[i]=t[o],t[o]=e}e=t[a],t[a]=t[o],t[o]=e,o<=n?a=i:o>=n&&(r=o-1)}return 0}});a.math=e}(t),function(t){var a={identity:function(t,a){void 0===a&&(a=1);for(var r=t.data,e=t.rows,f=t.cols,i=f+1|0,o=e*f,n=o;--o>=0;)r[o]=0;for(o=n,n=0;n<o;)r[n]=a,n+=i},transpose:function(t,a){for(var r=0,e=0,f=a.rows,i=a.cols,o=0,n=0,s=0,h=a.data,c=t.data;r<f;n+=1,o+=i,r++)for(s=n,e=0;e<i;s+=f,e++)c[s]=h[o+e]},multiply:function(t,a,r){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=a.cols,d=a.rows,_=r.cols,l=a.data,v=r.data,b=t.data,p=0;e<d;o+=u,e++)for(h=0,f=0;f<_;c++,h++,f++){for(s=h,n=o,p=0,i=0;i<u;n++,s+=_,i++)p+=l[n]*v[s];b[c]=p}},multiply_ABt:function(t,a,r){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=a.cols,u=a.rows,d=r.rows,_=a.data,l=r.data,v=t.data,b=0;e<u;o+=c,e++)for(s=0,f=0;f<d;h++,f++){for(n=o,b=0,i=0;i<c;n++,s++,i++)b+=_[n]*l[s];v[h]=b}},multiply_AtB:function(t,a,r){for(var e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=a.cols,d=a.rows,_=r.cols,l=a.data,v=r.data,b=t.data,p=0;e<u;o++,e++)for(h=0,f=0;f<_;c++,h++,f++){for(s=h,n=o,p=0,i=0;i<d;n+=u,s+=_,i++)p+=l[n]*v[s];b[c]=p}},multiply_AAt:function(t,a){for(var r=0,e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=a.cols,d=a.rows,_=a.data,l=t.data,v=0;r<d;i+=d+1,o=n,r++)for(h=i,c=i,s=o,e=r;e<d;h++,c+=d,e++){for(n=o,v=0,f=0;f<u;f++)v+=_[n++]*_[s++];l[h]=v,l[c]=v}},multiply_AtA:function(t,a){for(var r=0,e=0,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=a.cols,d=a.rows,_=a.data,l=t.data,v=0;r<u;s+=u,r++)for(i=r,h=c=s+r,e=r;e<u;h++,c+=u,e++){for(o=i,n=e,v=0,f=0;f<d;o+=u,n+=u,f++)v+=_[o]*_[n];l[h]=v,l[c]=v}},identity_3x3:function(t,a){void 0===a&&(a=1);var r=t.data;r[0]=r[4]=r[8]=a,r[1]=r[2]=r[3]=0,r[5]=r[6]=r[7]=0},invert_3x3:function(t,a){var r=t.data,e=a.data,f=r[4],i=r[8],o=r[5],n=r[7],s=r[0],h=s*f,c=s*o,u=r[3],d=r[1],_=u*d,l=r[2],v=u*l,b=r[6],p=b*d,m=b*l,x=1/(h*i-c*n-_*i+v*n+p*o-m*f);e[0]=(f*i-o*n)*x,e[1]=-(d*i-l*n)*x,e[2]=-(-d*o+l*f)*x,e[3]=-(u*i-o*b)*x,e[4]=(s*i-m)*x,e[5]=-(c-v)*x,e[6]=-(-u*n+f*b)*x,e[7]=-(s*n-p)*x,e[8]=(h-_)*x},multiply_3x3:function(t,a,r){var e=t.data,f=a.data,i=r.data,o=f[0],n=f[1],s=f[2],h=f[3],c=f[4],u=f[5],d=f[6],_=f[7],l=f[8],v=i[0],b=i[1],p=i[2],m=i[3],x=i[4],y=i[5],w=i[6],M=i[7],g=i[8];e[0]=o*v+n*m+s*w,e[1]=o*b+n*x+s*M,e[2]=o*p+n*y+s*g,e[3]=h*v+c*m+u*w,e[4]=h*b+c*x+u*M,e[5]=h*p+c*y+u*g,e[6]=d*v+_*m+l*w,e[7]=d*b+_*x+l*M,e[8]=d*p+_*y+l*g},mat3x3_determinant:function(t){var a=t.data;return a[0]*a[4]*a[8]-a[0]*a[5]*a[7]-a[3]*a[1]*a[8]+a[3]*a[2]*a[7]+a[6]*a[1]*a[5]-a[6]*a[2]*a[4]},determinant_3x3:function(t,a,r,e,f,i,o,n,s){return t*f*s-t*i*n-e*a*s+e*r*n+o*a*i-o*r*f}};t.matmath=a}(t),function(a){var r,e,f=(r=function(t,a,r,e){e=t[a],t[a]=t[r],t[r]=e},e=function(t,a){return(t=Math.abs(t))>(a=Math.abs(a))?(a/=t,t*Math.sqrt(1+a*a)):a>0?(t/=a,a*Math.sqrt(1+t*t)):0},{lu_solve:function(a,e){var f,i,o,n,s=0,h=0,c=0,u=a.cols,d=a.data,_=e.data;for(s=0;s<u;s++){for(c=s,h=s+1;h<u;h++)Math.abs(d[h*u+s])>Math.abs(d[c*u+s])&&(c=h);if(Math.abs(d[c*u+s])<t.EPSILON)return 0;if(c!=s){for(h=s;h<u;h++)r(d,s*u+h,c*u+h,f);r(_,s,c,f)}for(o=-1/d[s*u+s],h=s+1;h<u;h++){for(i=d[h*u+s]*o,c=s+1;c<u;c++)d[h*u+c]+=i*d[s*u+c];_[h]+=i*_[s]}d[s*u+s]=-o}for(s=u-1;s>=0;s--){for(n=_[s],c=s+1;c<u;c++)n-=d[s*u+c]*_[c];_[s]=n*d[s*u+s]}return 1},cholesky_solve:function(t,a){var r,e,f=0,i=0,o=0,n=0,s=0,h=0,c=0,u=t.cols,d=t.data,_=a.data;for(f=0;f<u;f++)for(e=1,s=n=f*u,i=f;i<u;i++){for(r=d[s+f],o=0;o<f;o++)r-=d[o*u+f]*d[s+o];if(i==f){if(d[s+f]=r,0==r)return 0;e=1/r}else d[n+i]=r,d[s+f]=r*e;s+=u}for(n=0,h=0;h<u;h++){for(r=_[h],c=0;c<h;c++)r-=d[n+c]*_[c];_[h]=r,n+=u}for(n=0,h=0;h<u;h++)_[h]/=d[n+h],n+=u;for(h=u-1;h>=0;h--){for(r=_[h],n=(c=h+1)*u;c<u;c++)r-=d[n+h]*_[c],n+=u;_[h]=r}return 1},svd_decompose:function(a,f,i,o,n){void 0===n&&(n=0);var s=0,h=0,c=a.rows,u=a.cols,d=c,_=u,l=a.type|t.C1_t;d<_&&(s=1,h=d,d=_,_=h);var v=t.cache.get_buffer(d*d<<3),b=t.cache.get_buffer(_<<3),p=t.cache.get_buffer(_*_<<3),m=new t.matrix_t(d,d,l,v.data),x=new t.matrix_t(1,_,l,b.data),y=new t.matrix_t(_,_,l,p.data);if(0==s)t.matmath.transpose(m,a);else{for(h=0;h<u*c;h++)m.data[h]=a.data[h];for(;h<_*d;h++)m.data[h]=0}if(function(a,f,i,o,n,s,h,c){for(var u=2*t.EPSILON,d=t.FLT_MIN,_=0,l=0,v=0,b=0,p=Math.max(s,30),m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=0,O=0,R=0,S=0,L=0,I=0,U=0,q=4660,G=0,B=0,F=0,N=t.cache.get_buffer(h<<3),V=N.f64;_<h;_++){for(v=0,C=0;v<s;v++)C+=(z=a[_*f+v])*z;if(V[_]=C,o){for(v=0;v<h;v++)o[_*n+v]=0;o[_*n+_]=1}}for(;b<p;b++){for(M=0,_=0;_<h-1;_++)for(l=_+1;l<h;l++){for(m=_*f|0,x=l*f|0,L=V[_],I=0,U=V[l],v=2,I+=a[m]*a[x],I+=a[m+1]*a[x+1];v<s;v++)I+=a[m+v]*a[x+v];if(!(Math.abs(I)<=u*Math.sqrt(L*U))){for(R=e(I*=2,O=L-U),O<0?(S=.5*(R-O),g=I/(R*(k=Math.sqrt(S/R))*2)):k=I/(R*(g=Math.sqrt((R+O)/(2*R)))*2),L=0,U=0,v=2,j=g*a[m]+k*a[x],A=-k*a[m]+g*a[x],a[m]=j,a[x]=A,L+=j*j,U+=A*A,j=g*a[m+1]+k*a[x+1],A=-k*a[m+1]+g*a[x+1],a[m+1]=j,a[x+1]=A,L+=j*j,U+=A*A;v<s;v++)j=g*a[m+v]+k*a[x+v],A=-k*a[m+v]+g*a[x+v],a[m+v]=j,a[x+v]=A,L+=j*j,U+=A*A;if(V[_]=L,V[l]=U,M=1,o)for(w=l*n|0,v=2,j=g*o[y=_*n|0]+k*o[w],A=-k*o[y]+g*o[w],o[y]=j,o[w]=A,j=g*o[y+1]+k*o[w+1],A=-k*o[y+1]+g*o[w+1],o[y+1]=j,o[w+1]=A;v<h;v++)j=g*o[y+v]+k*o[w+v],A=-k*o[y+v]+g*o[w+v],o[y+v]=j,o[w+v]=A}}if(0==M)break}for(_=0;_<h;_++){for(v=0,C=0;v<s;v++)C+=(z=a[_*f+v])*z;V[_]=Math.sqrt(C)}for(_=0;_<h-1;_++){for(l=_,v=_+1;v<h;v++)V[l]<V[v]&&(l=v);if(_!=l&&(r(V,_,l,C),o)){for(v=0;v<s;v++)r(a,_*f+v,l*f+v,z);for(v=0;v<h;v++)r(o,_*n+v,l*n+v,z)}}for(_=0;_<h;_++)i[_]=V[_];if(o){for(_=0;_<c;_++){for(C=_<h?V[_]:0;C<=d;){for(B=1/s,v=0;v<s;v++)G=0!=(256&(q=214013*q+2531011)>>16)?B:-B,a[_*f+v]=G;for(b=0;b<2;b++)for(l=0;l<_;l++){for(C=0,v=0;v<s;v++)C+=a[_*f+v]*a[l*f+v];for(F=0,v=0;v<s;v++)z=a[_*f+v]-C*a[l*f+v],a[_*f+v]=z,F+=Math.abs(z);for(F=F?1/F:0,v=0;v<s;v++)a[_*f+v]*=F}for(C=0,v=0;v<s;v++)C+=(z=a[_*f+v])*z;C=Math.sqrt(C)}for(k=1/C,v=0;v<s;v++)a[_*f+v]*=k}t.cache.put_buffer(N)}else t.cache.put_buffer(N)}(m.data,d,x.data,y.data,_,d,_,d),f){for(h=0;h<_;h++)f.data[h]=x.data[h];for(;h<u;h++)f.data[h]=0}if(0==s){if(i&&n&t.SVD_U_T)for(h=d*d;--h>=0;)i.data[h]=m.data[h];else i&&t.matmath.transpose(i,m);if(o&&n&t.SVD_V_T)for(h=_*_;--h>=0;)o.data[h]=y.data[h];else o&&t.matmath.transpose(o,y)}else{if(i&&n&t.SVD_U_T)for(h=_*_;--h>=0;)i.data[h]=y.data[h];else i&&t.matmath.transpose(i,y);if(o&&n&t.SVD_V_T)for(h=d*d;--h>=0;)o.data[h]=m.data[h];else o&&t.matmath.transpose(o,m)}t.cache.put_buffer(v),t.cache.put_buffer(b),t.cache.put_buffer(p)},svd_solve:function(a,r,e){var f,i=0,o=0,n=0,s=0,h=0,c=a.rows,u=a.cols,d=0,_=0,l=a.type|t.C1_t,v=t.cache.get_buffer(c*c<<3),b=t.cache.get_buffer(u<<3),p=t.cache.get_buffer(u*u<<3),m=new t.matrix_t(c,c,l,v.data),x=new t.matrix_t(1,u,l,b.data),y=new t.matrix_t(u,u,l,p.data),w=e.data,M=m.data,g=x.data,k=y.data;for(this.svd_decompose(a,x,m,y,0),f=t.EPSILON*g[0]*u;i<u;i++,h+=u){for(_=0,o=0;o<u;o++)if(g[o]>f){for(n=0,d=0,s=0;n<c;n++,s+=u)d+=M[s+o]*w[n];_+=d*k[h+o]/g[o]}r.data[i]=_}t.cache.put_buffer(v),t.cache.put_buffer(b),t.cache.put_buffer(p)},svd_invert:function(a,r){var e,f=0,i=0,o=0,n=0,s=0,h=0,c=r.rows,u=r.cols,d=0,_=r.type|t.C1_t,l=t.cache.get_buffer(c*c<<3),v=t.cache.get_buffer(u<<3),b=t.cache.get_buffer(u*u<<3),p=new t.matrix_t(c,c,_,l.data),m=new t.matrix_t(1,u,_,v.data),x=new t.matrix_t(u,u,_,b.data),y=a.data,w=p.data,M=m.data,g=x.data;for(this.svd_decompose(r,m,p,x,0),e=t.EPSILON*M[0]*u;f<u;f++,s+=u)for(i=0,n=0;i<c;i++,h++){for(o=0,d=0;o<u;o++,n++)M[o]>e&&(d+=g[s+o]*w[n]/M[o]);y[h]=d}t.cache.put_buffer(l),t.cache.put_buffer(v),t.cache.put_buffer(b)},eigenVV:function(a,f,i){for(var o=a.cols,n=o*o,s=a.type|t.C1_t,h=t.cache.get_buffer(o*o<<3),c=t.cache.get_buffer(o<<3),u=new t.matrix_t(o,o,s,h.data),d=new t.matrix_t(1,o,s,c.data);--n>=0;)u.data[n]=a.data[n];if(function(a,f,i,o,n,s){var h=t.EPSILON,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=s*s*30,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=0,O=t.cache.get_buffer(s<<2),R=t.cache.get_buffer(s<<2),S=O.i32,L=R.i32;if(o)for(;c<s;c++){for(d=c*n,u=0;u<s;u++)o[d+u]=0;o[d+c]=1}for(d=0;d<s;d++){if(i[d]=a[(f+1)*d],d<s-1){for(_=d+1,y=Math.abs(a[f*d+_]),c=d+2;c<s;c++)y<(w=Math.abs(a[f*d+c]))&&(y=w,_=c);S[d]=_}if(d>0){for(_=0,y=Math.abs(a[d]),c=1;c<d;c++)y<(w=Math.abs(a[f*c+d]))&&(y=w,_=c);L[d]=_}}if(s>1)for(;m<x;m++){for(d=0,y=Math.abs(a[S[0]]),c=1;c<s-1;c++)y<(w=Math.abs(a[f*c+S[c]]))&&(y=w,d=c);for(l=S[d],c=1;c<s;c++)y<(w=Math.abs(a[f*L[c]+c]))&&(y=w,d=L[c],l=c);if(M=a[f*d+l],Math.abs(M)<=h)break;for(g=.5*(i[l]-i[d]),j=(k=Math.abs(g)+e(M,g))/(z=e(M,k)),z=M/z,k=M/k*M,g<0&&(z=-z,k=-k),a[f*d+l]=0,i[d]-=k,i[l]+=k,c=0;c<d;c++)p=f*c+l,A=a[b=f*c+d],C=a[p],a[b]=A*j-C*z,a[p]=A*z+C*j;for(c=d+1;c<l;c++)p=f*c+l,A=a[b=f*d+c],C=a[p],a[b]=A*j-C*z,a[p]=A*z+C*j;for(b=f*d+(c=l+1),p=f*l+c;c<s;c++,b++,p++)A=a[b],C=a[p],a[b]=A*j-C*z,a[p]=A*z+C*j;if(o)for(b=n*d,p=n*l,c=0;c<s;c++,b++,p++)A=o[b],C=o[p],o[b]=A*j-C*z,o[p]=A*z+C*j;for(u=0;u<2;u++){if((v=0==u?d:l)<s-1){for(_=v+1,y=Math.abs(a[f*v+_]),c=v+2;c<s;c++)y<(w=Math.abs(a[f*v+c]))&&(y=w,_=c);S[v]=_}if(v>0){for(_=0,y=Math.abs(a[v]),c=1;c<v;c++)y<(w=Math.abs(a[f*c+v]))&&(y=w,_=c);L[v]=_}}}for(d=0;d<s-1;d++){for(_=d,c=d+1;c<s;c++)i[_]<i[c]&&(_=c);if(d!=_&&(r(i,_,d,y),o))for(c=0;c<s;c++)r(o,n*_+c,n*d+c,y)}t.cache.put_buffer(O),t.cache.put_buffer(R)}(u.data,o,d.data,f?f.data:null,o,o),i)for(;--o>=0;)i.data[o]=d.data[o];t.cache.put_buffer(h),t.cache.put_buffer(c)}});a.linalg=f}(t),function(a){var r,e,f,i,o,n,s,h,c,u,d=(r=function(t){return t*t},e=new t.matrix_t(3,3,t.F32_t|t.C1_t),f=new t.matrix_t(3,3,t.F32_t|t.C1_t),i=new t.matrix_t(6,6,t.F32_t|t.C1_t),o=new t.matrix_t(6,1,t.F32_t|t.C1_t),n=function(){function a(){}return a.prototype.run=function(a,r,n,s){var h,c,u=0,d=0,_=n.type|t.C1_t,l=n.data,v=e.data,b=f.data,p=0,m=0;!function(t,a,r,e,f){for(var i,o,n=0,s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0;n<f;++n)s+=t[n].x,h+=t[n].y,u+=a[n].x,d+=a[n].y;for(s/=f,h/=f,u/=f,d/=f,n=0;n<f;++n)l=t[n].x-s,v=t[n].y-h,c+=Math.sqrt(l*l+v*v),l=a[n].x-u,v=a[n].y-d,_+=Math.sqrt(l*l+v*v);c/=f,_/=f,i=Math.SQRT2/c,o=Math.SQRT2/_,r[0]=r[4]=i,r[2]=-s*i,r[5]=-h*i,r[1]=r[3]=r[6]=r[7]=0,r[8]=1,e[0]=e[4]=o,e[2]=-u*o,e[5]=-d*o,e[1]=e[3]=e[6]=e[7]=0,e[8]=1}(a,r,v,b,s);for(var x=t.cache.get_buffer(2*s*6<<3),y=t.cache.get_buffer(2*s<<3),w=new t.matrix_t(6,2*s,_,x.data),M=new t.matrix_t(1,2*s,_,y.data),g=w.data,k=M.data;u<s;++u)h=a[u],c=r[u],p=v[0]*h.x+v[1]*h.y+v[2],m=v[3]*h.x+v[4]*h.y+v[5],g[d=2*u*6]=p,g[d+1]=m,g[d+2]=1,g[d+3]=0,g[d+4]=0,g[d+5]=0,g[d+=6]=0,g[d+1]=0,g[d+2]=0,g[d+3]=p,g[d+4]=m,g[d+5]=1,k[u<<1]=b[0]*c.x+b[1]*c.y+b[2],k[1+(u<<1)]=b[3]*c.x+b[4]*c.y+b[5];return t.matmath.multiply_AtA(i,w),t.matmath.multiply_AtB(o,w,M),t.linalg.lu_solve(i,o),l[0]=o.data[0],l[1]=o.data[1],l[2]=o.data[2],l[3]=o.data[3],l[4]=o.data[4],l[5]=o.data[5],l[6]=0,l[7]=0,l[8]=1,t.matmath.invert_3x3(f,f),t.matmath.multiply_3x3(n,f,n),t.matmath.multiply_3x3(n,n,e),t.cache.put_buffer(x),t.cache.put_buffer(y),1},a.prototype.error=function(t,a,e,f,i){for(var o,n,s=0,h=e.data;s<i;++s)o=t[s],n=a[s],f[s]=r(n.x-h[0]*o.x-h[1]*o.y-h[2])+r(n.y-h[3]*o.x-h[4]*o.y-h[5])},a.prototype.check_subset=function(t,a,r){return!0},a}(),s=new t.matrix_t(9,9,t.F32_t|t.C1_t),h=new t.matrix_t(9,9,t.F32_t|t.C1_t),{affine2d:n,homography2d:function(){function a(){}return a.prototype.run=function(a,r,i,o){for(var n=0,c=0,u=i.data,d=e.data,_=f.data,l=s.data,v=h.data,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0;n<o;++n)M+=r[n].x,g+=r[n].y,j+=a[n].x,A+=a[n].y;for(M/=o,g/=o,j/=o,A/=o,n=0;n<o;++n)y+=Math.abs(r[n].x-M),w+=Math.abs(r[n].y-g),k+=Math.abs(a[n].x-j),z+=Math.abs(a[n].y-A);if(Math.abs(y)<t.EPSILON||Math.abs(w)<t.EPSILON||Math.abs(k)<t.EPSILON||Math.abs(z)<t.EPSILON)return 0;for(y=o/y,w=o/w,k=o/k,z=o/z,d[0]=k,d[1]=0,d[2]=-j*k,d[3]=0,d[4]=z,d[5]=-A*z,d[6]=0,d[7]=0,d[8]=1,_[0]=1/y,_[1]=0,_[2]=M,_[3]=0,_[4]=1/w,_[5]=g,_[6]=0,_[7]=0,_[8]=1,n=81;--n>=0;)l[n]=0;for(n=0;n<o;++n)b=(r[n].x-M)*y,p=(r[n].y-g)*w,m=(a[n].x-j)*k,x=(a[n].y-A)*z,l[0]+=m*m,l[1]+=m*x,l[2]+=m,l[6]+=m*-b*m,l[7]+=m*-b*x,l[8]+=m*-b,l[10]+=x*x,l[11]+=x,l[15]+=x*-b*m,l[16]+=x*-b*x,l[17]+=x*-b,l[20]+=1,l[24]+=-b*m,l[25]+=-b*x,l[26]+=-b,l[30]+=m*m,l[31]+=m*x,l[32]+=m,l[33]+=m*-p*m,l[34]+=m*-p*x,l[35]+=m*-p,l[40]+=x*x,l[41]+=x,l[42]+=x*-p*m,l[43]+=x*-p*x,l[44]+=x*-p,l[50]+=1,l[51]+=-p*m,l[52]+=-p*x,l[53]+=-p,l[60]+=-b*m*-b*m+-p*m*-p*m,l[61]+=-b*m*-b*x+-p*m*-p*x,l[62]+=-b*m*-b+-p*m*-p,l[70]+=-b*x*-b*x+-p*x*-p*x,l[71]+=-b*x*-b+-p*x*-p,l[80]+=-b*-b+-p*-p;for(n=0;n<9;++n)for(c=0;c<n;++c)l[9*n+c]=l[9*c+n];return t.linalg.eigenVV(s,h),u[0]=v[72],u[1]=v[73],u[2]=v[74],u[3]=v[75],u[4]=v[76],u[5]=v[77],u[6]=v[78],u[7]=v[79],u[8]=v[80],t.matmath.multiply_3x3(i,f,i),t.matmath.multiply_3x3(i,i,e),b=1/u[8],u[0]*=b,u[1]*=b,u[2]*=b,u[3]*=b,u[4]*=b,u[5]*=b,u[6]*=b,u[7]*=b,u[8]=1,1},a.prototype.error=function(t,a,r,e,f){for(var i,o,n=0,s=0,h=0,c=0,u=r.data;n<f;++n)i=t[n],o=a[n],s=1/(u[6]*i.x+u[7]*i.y+1),h=(u[0]*i.x+u[1]*i.y+u[2])*s-o.x,c=(u[3]*i.x+u[4]*i.y+u[5])*s-o.y,e[n]=h*h+c*c},a.prototype.check_subset=function(a,r,e){if(4==e){var f=0,i=a[0],o=a[1],n=a[2],s=a[3],h=r[0],c=r[1],u=r[2],d=r[3],_=i.x,l=i.y,v=o.x,b=o.y,p=n.x,m=n.y,x=h.x,y=h.y,w=c.x,M=c.y,g=u.x,k=u.y,z=t.matmath.determinant_3x3(_,l,1,v,b,1,p,m,1),j=t.matmath.determinant_3x3(x,y,1,w,M,1,g,k,1);if(z*j<0&&f++,_=o.x,l=o.y,v=n.x,b=n.y,p=s.x,m=s.y,x=c.x,y=c.y,w=u.x,M=u.y,g=d.x,k=d.y,(z=t.matmath.determinant_3x3(_,l,1,v,b,1,p,m,1))*(j=t.matmath.determinant_3x3(x,y,1,w,M,1,g,k,1))<0&&f++,_=i.x,l=i.y,v=n.x,b=n.y,p=s.x,m=s.y,x=h.x,y=h.y,w=u.x,M=u.y,g=d.x,k=d.y,(z=t.matmath.determinant_3x3(_,l,1,v,b,1,p,m,1))*(j=t.matmath.determinant_3x3(x,y,1,w,M,1,g,k,1))<0&&f++,_=i.x,l=i.y,v=o.x,b=o.y,p=s.x,m=s.y,x=h.x,y=h.y,w=c.x,M=c.y,g=d.x,k=d.y,(z=t.matmath.determinant_3x3(_,l,1,v,b,1,p,m,1))*(j=t.matmath.determinant_3x3(x,y,1,w,M,1,g,k,1))<0&&f++,0!=f&&4!=f)return!1}return!0},a}()}),_=function(){function t(t,a,r,e){void 0===t&&(t=0),void 0===a&&(a=.5),void 0===r&&(r=.5),void 0===e&&(e=.99),this.size=t,this.thresh=a,this.eps=r,this.prob=e}return t.prototype.update_iters=function(t,a){var r=Math.log(1-this.prob),e=Math.log(1-Math.pow(1-t,this.size));return 0|(e>=0||-r>=a*-e?a:Math.round(r/e))},t}(),l=(c=function(t,a,r,e,f,i,o){for(var n=[],s=0,h=0,c=0,u=0,d=!1;c<1e3;++c){for(s=0;s<e&&c<1e3;){for(d=!1,u=0;!d;)for(d=!0,u=n[s]=0|Math.floor(Math.random()*f),h=0;h<s;++h)if(u==n[h]){d=!1;break}i[s]=a[u],o[s]=r[u],t.check_subset(i,o,s+1)?++s:c++}break}return s==e&&c<1e3},u=function(t,a,r,e,f,i,o,n){var s=0,h=0,c=0,u=i*i;for(t.error(r,e,a,o,f);h<f;++h)c=o[h]<=u,n[h]=c,s+=c;return s},{ransac:function(a,r,e,f,i,o,n,s){if(void 0===s&&(s=1e3),i<a.size)return!1;var h=a.size,d=s,_=0,l=!1,v=[],b=[],p=o.cols,m=o.rows,x=o.type|t.C1_t,y=t.cache.get_buffer(p*m<<3),w=t.cache.get_buffer(i),M=t.cache.get_buffer(i<<2),g=new t.matrix_t(p,m,x,y.data),k=new t.matrix_t(i,1,t.U8C1_t,w.data),z=-1,j=0,A=M.f32;if(i==h){if(r.run(e,f,g,i)<=0)return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;if(g.copy_to(o),n)for(;--i>=0;)n.data[i]=1;return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!0}for(;_<d;++_){if(!c(r,e,f,h,i,v,b)){if(0==_)return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;break}r.run(v,b,g,h)<=0||(j=u(r,g,e,f,i,a.thresh,A,k.data))>Math.max(z,h-1)&&(g.copy_to(o),z=j,n&&k.copy_to(n),d=a.update_iters((i-j)/i,d),l=!0)}return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),l},lmeds:function(a,r,e,f,i,o,n,s){if(void 0===s&&(s=1e3),i<a.size)return!1;var h=a.size,d=s,_=0,l=!1,v=[],b=[],p=o.cols,m=o.rows,x=o.type|t.C1_t,y=t.cache.get_buffer(p*m<<3),w=t.cache.get_buffer(i),M=t.cache.get_buffer(i<<2),g=new t.matrix_t(p,m,x,y.data),k=new t.matrix_t(i,1,t.U8_t|t.C1_t,w.data),z=0,j=M.f32,A=1e9,C=0,O=0;if(a.eps=.45,d=a.update_iters(a.eps,d),i==h){if(r.run(e,f,g,i)<=0)return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;if(g.copy_to(o),n)for(;--i>=0;)n.data[i]=1;return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!0}for(;_<d;++_){if(!c(r,e,f,h,i,v,b)){if(0==_)return t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),!1;break}r.run(v,b,g,h)<=0||(r.error(e,f,g,j,i),(O=t.math.median(j,0,i-1))<A&&(A=O,g.copy_to(o),l=!0))}return l&&(C=2.5*1.4826*(1+5/(i-h))*Math.sqrt(A),C=Math.max(C,.001),z=u(r,o,e,f,i,C,j,k.data),n&&k.copy_to(n),l=z>=h),t.cache.put_buffer(y),t.cache.put_buffer(w),t.cache.put_buffer(M),l}});a.ransac_params_t=_,a.motion_model=d,a.motion_estimator=l}(t);var b=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),p=new Uint8Array(512),m=new Int32Array(25),x=new Int32Array(25),y=function(t,a,r,e,f){for(var i=0,o=t[a],n=f,s=0,h=0,c=0;i<25;++i)e[i]=o-t[a+r[i]];for(i=0;i<16;i+=2)s=Math.min(e[i+1],e[i+2]),(s=Math.min(s,e[i+3]))<=n||(s=Math.min(s,e[i+4]),s=Math.min(s,e[i+5]),s=Math.min(s,e[i+6]),s=Math.min(s,e[i+7]),s=Math.min(s,e[i+8]),n=Math.max(n,Math.min(s,e[i])),n=Math.max(n,Math.min(s,e[i+9])));for(h=-n,i=0;i<16;i+=2)c=Math.max(e[i+1],e[i+2]),c=Math.max(c,e[i+3]),c=Math.max(c,e[i+4]),(c=Math.max(c,e[i+5]))>=h||(c=Math.max(c,e[i+6]),c=Math.max(c,e[i+7]),c=Math.max(c,e[i+8]),h=Math.min(h,Math.max(c,e[i])),h=Math.min(h,Math.max(c,e[i+9])));return-h-1},w=20;const M=function(t){w=Math.min(Math.max(t,0),255);for(var a=-255;a<=255;++a)p[a+255]=a<-w?1:a>w?2:0;return w};M(20);var g=Object.freeze({__proto__:null,set_threshold:M,detect:function(t,a,r){void 0===r&&(r=3);var e,f=t.data,i=t.cols,o=t.rows,n=0,s=0,h=0,c=0,u=0,d=jsfeat.cache.get_buffer(3*i),_=jsfeat.cache.get_buffer(3*(i+1)<<2),l=d.u8,v=_.i32,M=m,g=x,k=Math.max(3,r),z=Math.min(o-2,o-r),j=Math.max(3,r),A=Math.min(i-3,i-r),C=0,O=0,R=y,S=p,L=w,I=0,U=0,q=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0;!function(t,a,r){for(var e=0,f=b;e<r;++e)t[e]=f[e<<1]+f[1+(e<<1)]*a;for(;e<25;++e)t[e]=t[e-r]}(M,i,16);var D=M[0],Q=M[1],X=M[2],H=M[3],J=M[4],K=M[5],W=M[6],Z=M[7],$=M[8],tt=M[9],at=M[10],rt=M[11],et=M[12],ft=M[13],it=M[14],ot=M[15];for(n=0;n<3*i;++n)l[n]=0;for(n=k;n<z;++n){for(N=n*i+j|0,F=(u=(n-3)%3)*i|0,B=u*(i+1)|0,s=0;s<i;++s)l[F+s]=0;if(G=0,n<z-1)for(s=j;s<A;++s,++N)if(0!=(q=S[(U=255-(I=f[N]))+f[N+D]]|S[U+f[N+$]])&&(q&=S[U+f[N+X]]|S[U+f[N+at]],q&=S[U+f[N+J]]|S[U+f[N+et]],0!=(q&=S[U+f[N+W]]|S[U+f[N+it]]))){if(q&=S[U+f[N+Q]]|S[U+f[N+tt]],q&=S[U+f[N+H]]|S[U+f[N+rt]],q&=S[U+f[N+K]]|S[U+f[N+ft]],1&(q&=S[U+f[N+Z]]|S[U+f[N+ot]]))for(c=I-L,C=0,h=0;h<25;++h)if(f[N+M[h]]<c){if(++C>8){v[B+ ++G]=s,l[F+s]=R(f,N,M,g,L);break}}else C=0;if(2&q)for(c=I+L,C=0,h=0;h<25;++h)if(f[N+M[h]]>c){if(++C>8){v[B+ ++G]=s,l[F+s]=R(f,N,M,g,L);break}}else C=0}if(v[B+i]=G,n!=k)for(V=(u=(n-4+3)%3)*i|0,B=u*(i+1)|0,E=(u=(n-5+3)%3)*i|0,G=v[B+i],h=0;h<G;++h)P=(s=v[B+h])+1|0,T=s-1|0,(Y=l[V+s])>l[V+P]&&Y>l[V+T]&&Y>l[E+T]&&Y>l[E+s]&&Y>l[E+P]&&Y>l[F+T]&&Y>l[F+s]&&Y>l[F+P]&&((e=a[O]).x=s,e.y=n-1,e.score=Y,O++)}return jsfeat.cache.put_buffer(d),jsfeat.cache.put_buffer(_),O}});!function(a){var r,e=(r=function(t,a,r,e,f,i,o){var n=-2*t[a]+t[a+e]+t[a-e],s=-2*t[a]+t[a+f]+t[a-f],h=t[a+i]+t[a-i]-t[a+o]-t[a-o],c=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(r-c),Math.abs(-(r+c)))},{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(a,e,f){void 0===f&&(f=5);var i,o=0,n=0,s=a.cols,h=a.rows,c=a.data,u=5*s|0,d=3+3*s|0,_=3-3*s|0,l=t.cache.get_buffer(s*h<<2),v=l.i32,b=0,p=0,m=0,x=0,y=0,w=this.laplacian_threshold,M=this.min_eigen_value_threshold,g=0|Math.max(5,f),k=0|Math.max(3,f),z=0|Math.min(s-5,s-f),j=0|Math.min(h-3,h-f);for(o=s*h;--o>=0;)v[o]=0;for(function(t,a,r,e,f,i,o,n,s,h){var c=0,u=0,d=n*r+o|0,_=d;for(c=n;c<h;++c,_=d+=r)for(u=o;u<s;++u,++_)a[_]=-4*t[_]+t[_+f]+t[_-f]+t[_+i]+t[_-i]}(c,v,s,0,5,u,g,k,z,j),p=k*s+g|0,n=k;n<j;++n,p+=s)for(o=g,m=p;o<z;++o,++m)((b=v[m])<-w&&b<v[m-1]&&b<v[m+1]&&b<v[m-s]&&b<v[m+s]&&b<v[m-s-1]&&b<v[m+s-1]&&b<v[m-s+1]&&b<v[m+s+1]||b>w&&b>v[m-1]&&b>v[m+1]&&b>v[m-s]&&b>v[m+s]&&b>v[m-s-1]&&b>v[m+s-1]&&b>v[m-s+1]&&b>v[m+s+1])&&(x=r(c,m,b,5,u,d,_))>M&&((i=e[y]).x=o,i.y=n,i.score=x,++y,++o,++m);return t.cache.put_buffer(l),y}});a.yape06=e}(t),function(t){var a,r,e,f=(a=function(t,a,r,e,f){var i,o;if(r>0)for(a-=e*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[a+i]>r)return!1;a+=e}else for(a-=e*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[a+i]<r)return!1;a+=e}return!0},r=function(t,a,r,e,f,i,o,n){var s=0,h=0,c=o-1|0,u=0,d=0,_=0,l=0,v=0;if((u=t[a+i[h]])<=f)if(u>=e)if((d=t[a+i[c]])<=f){if(d>=e)return void(r[a]=0);if((_=t[a+i[++c]])>f)if((l=t[a+i[++c]])>f)v=3;else{if(!(l<e))return void(r[a]=0);v=6}else if((l=t[a+i[++c]])>f)v=7;else{if(!(l<e))return void(r[a]=0);v=2}}else if((_=t[a+i[++c]])>f)if((l=t[a+i[++c]])>f)v=3;else{if(!(l<e))return void(r[a]=0);v=6}else{if(!(_<e))return void(r[a]=0);if((l=t[a+i[++c]])>f)v=7;else{if(!(l<e))return void(r[a]=0);v=2}}else{if((d=t[a+i[c]])>f)return void(r[a]=0);if((_=t[a+i[++c]])>f)return void(r[a]=0);if((l=t[a+i[++c]])>f)return void(r[a]=0);v=1}else{if((d=t[a+i[c]])<e)return void(r[a]=0);if((_=t[a+i[++c]])<e)return void(r[a]=0);if((l=t[a+i[++c]])<e)return void(r[a]=0);v=0}for(h=1;h<=o;h++)switch(u=t[a+i[h]],v){case 0:if(u>f){if(_=l,(l=t[a+i[++c]])<e)return void(r[a]=0);s-=u+_,v=0;break}if(u<e){if(_>f)return void(r[a]=0);if(l>f)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])>f)return void(r[a]=0);s-=u+_,v=8;break}if(_<=f)return void(r[a]=0);if(l<=f)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(r[a]=0);case 1:if(u<e){if(_=l,(l=t[a+i[++c]])>f)return void(r[a]=0);s-=u+_,v=1;break}if(u>f){if(_<e)return void(r[a]=0);if(l<e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])<e)return void(r[a]=0);s-=u+_,v=9;break}if(_>=e)return void(r[a]=0);if(l>=e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(r[a]=0);case 2:if(u>f)return void(r[a]=0);if(_=l,l=t[a+i[++c]],u<e){if(l>f)return void(r[a]=0);s-=u+_,v=4;break}if(l>f){s-=u+_,v=7;break}if(l<e){s-=u+_,v=2;break}return void(r[a]=0);case 3:if(u<e)return void(r[a]=0);if(_=l,l=t[a+i[++c]],u>f){if(l<e)return void(r[a]=0);s-=u+_,v=5;break}if(l>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(r[a]=0);case 4:if(u>f)return void(r[a]=0);if(u<e){if(_=l,(l=t[a+i[++c]])>f)return void(r[a]=0);s-=u+_,v=1;break}if(l>=e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(r[a]=0);case 5:if(u<e)return void(r[a]=0);if(u>f){if(_=l,(l=t[a+i[++c]])<e)return void(r[a]=0);s-=u+_,v=0;break}if(l<=f)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(r[a]=0);case 7:if(u>f)return void(r[a]=0);if(u<e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])>f){s-=u+_,v=3;break}if(l<e){s-=u+_,v=6;break}return void(r[a]=0);case 6:if(u>f)return void(r[a]=0);if(u<e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])<e){s-=u+_,v=2;break}if(l>f){s-=u+_,v=7;break}return void(r[a]=0);case 8:if(u>f){if(l<e)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])<e)return void(r[a]=0);s-=u+_,v=9;break}if(u<e){if(_=l,(l=t[a+i[++c]])>f)return void(r[a]=0);s-=u+_,v=1;break}return void(r[a]=0);case 9:if(u<e){if(l>f)return void(r[a]=0);if(_=l,(l=t[a+i[++c]])>f)return void(r[a]=0);s-=u+_,v=8;break}if(u>f){if(_=l,(l=t[a+i[++c]])<e)return void(r[a]=0);s-=u+_,v=0;break}return void(r[a]=0)}r[a]=s+n*t[a]},e=function(t,a,r){this.dirs=new Int32Array(1024),this.dirs_count=0|function(t,a,r){var e,f,i=0;for(e=r,f=0;f<e;f++,i++)e=Math.sqrt(r*r-f*f)+.5|0,a[i]=e+t*f;for(e--;e<f&&e>=0;e--,i++)f=Math.sqrt(r*r-e*e)+.5|0,a[i]=e+t*f;for(;-e<f;e--,i++)f=Math.sqrt(r*r-e*e)+.5|0,a[i]=e+t*f;for(f--;f>=0;f--,i++)e=-Math.sqrt(r*r-f*f)-.5|0,a[i]=e+t*f;for(;f>e;f--,i++)e=-Math.sqrt(r*r-f*f)-.5|0,a[i]=e+t*f;for(e++;e<=0;e++,i++)f=-Math.sqrt(r*r-e*e)-.5|0,a[i]=e+t*f;for(;e<-f;e++,i++)f=-Math.sqrt(r*r-e*e)-.5|0,a[i]=e+t*f;for(f++;f<0;f++,i++)e=Math.sqrt(r*r-f*f)+.5|0,a[i]=e+t*f;return a[i]=a[0],a[i+1]=a[1],i}(t,this.dirs,r),this.scores=new Int32Array(t*a),this.radius=0|r},{level_tables:[],tau:7,init:function(t,a,r,f){var i;for(void 0===f&&(f=1),r=Math.min(r,7),r=Math.max(r,3),i=0;i<f;++i)this.level_tables[i]=new e(t>>i,a>>i,r)},detect:function(t,e,f){void 0===f&&(f=4);var i,o,n,s,h,c=this.level_tables[0],u=0|c.radius,d=u-1|0,_=c.dirs,l=0|c.dirs_count,v=l>>1,b=t.data,p=0|t.cols,m=0|t.rows,x=p>>1,y=c.scores,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=0,O=0|this.tau,R=0,S=0|Math.max(u+1,f),L=0|Math.max(u+1,f),I=0|Math.min(p-u-2,p-f),U=0|Math.min(m-u-2,m-f);for(g=L*p+S|0,M=L;M<U;++M,g+=p)for(w=S,k=g;w<I;++w,++k)z=b[k]+O,(j=b[k]-O)<b[k+u]&&b[k+u]<z&&j<b[k-u]&&b[k-u]<z?y[k]=0:r(b,k,y,j,z,_,v,l);for(g=L*p+S|0,M=L;M<U;++M,g+=p)for(w=S,k=g;w<I;++w,++k)C=y[k],(A=Math.abs(C))<5?(++w,++k):(s=p,h=void 0,h=0,0!=(o=y)[(n=k)+1]&&h++,0!=o[n-1]&&h++,0!=o[n+s]&&h++,0!=o[n+s+1]&&h++,0!=o[n+s-1]&&h++,0!=o[n-s]&&h++,0!=o[n-s+1]&&h++,0!=o[n-s-1]&&h++,h>=3&&a(y,k,C,x,u)&&((i=e[R]).x=w,i.y=M,i.score=A,++R,w+=d,k+=d));return R}});t.yape=f}(t),function(a){var r,e,f,o,n=(r=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),e=new t.matrix_t(3,3,t.F32_t|t.C1_t),f=new t.matrix_t(32,32,t.U8_t|t.C1_t),o=function(t,a,r,f,o,n){var s=Math.cos(r),h=Math.sin(r);e.data[0]=s,e.data[1]=-h,e.data[2]=(-s+h)*n*.5+f,e.data[3]=h,e.data[4]=s,e.data[5]=(-h-s)*n*.5+o,i(t,a,e,128)},{describe:function(a,e,i,n){var s=0,h=0,c=0,u=0,d=0,_=0,l=0,v=0,b=(a.data,a.cols,a.rows,f.data),p=0;n.type&t.U8_t?n.resize(32,i,1):(n.type=t.U8_t,n.cols=32,n.rows=i,n.channel=1,n.allocate());var m=n.data,x=0;for(s=0;s<i;++s){for(c=e[s].x,u=e[s].y,d=e[s].angle,o(a,f,d,c,u,32),p=0,h=0;h<32;++h)v=(_=b[528+32*r[p+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]])|0,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<1,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<2,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<3,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<4,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<5,v|=((_=b[528+32*r[(p+=2)+1]+r[p]])<(l=b[528+32*r[(p+=2)+1]+r[p]]))<<6,_=b[528+32*r[(p+=2)+1]+r[p]],l=b[528+32*r[(p+=2)+1]+r[p]],p+=2,v|=(_<l)<<7,m[x+h]=v;x+=32}}});a.orb=n}(t);var k=Object.freeze({__proto__:null,track:function(a,r,f,i,o,n,s,h,c,u){void 0===s&&(s=30),void 0===h&&(h=new Uint8Array(o)),void 0===c&&(c=.01),void 0===u&&(u=1e-4);var d=.5*(n-1),_=n*n|0,l=_<<1,v=a.data,b=r.data,p=v[0].data,m=b[0].data,x=v[0].cols,y=v[0].rows,w=0,M=0,g=t.cache.get_buffer(_<<2),k=t.cache.get_buffer(l<<2),z=t.cache.get_buffer(y*(x<<1)<<2),j=new t.matrix_t(x,y,t.S32C2_t,z.data),A=g.i32,C=k.i32,O=z.i32,R=0,S=0,L=0,I=0,U=0,q=0,G=0,B=0,F=0,N=0,V=0,E=0,P=0,T=0,Y=0,D=0,Q=0,X=0,H=0,J=0,K=0,W=0,Z=0,$=0,tt=0,at=0,rt=0,et=0,ft=0,it=0,ot=0,nt=0,st=0,ht=0,ct=0,ut=0,dt=0,_t=0,lt=0,vt=0,bt=0,pt=0,mt=0;for(c*=c;J<o;++J)h[J]=1;var xt=a.levels-1|0;for($=xt;$>=0;--$)for(G=1/(1<<$),M=y>>$,R=(w=x>>$)<<1,p=v[$].data,m=b[$].data,rt=w-n|0,et=M-n|0,e(v[$],j),tt=0;tt<o;++tt)if(K=(J=tt<<1)+1,B=f[J]*G,F=f[K]*G,$==xt?(N=B,V=F):(N=2*i[J],V=2*i[K]),i[J]=N,i[K]=V,0==(W=(D=0|(B-=d))<=0|D>=rt|(Q=0|(F-=d))<=0|Q>=et)){for(ut=16384-(st=(1-(ft=B-D))*(1-(it=F-Q))*16384+.5|0)-(ht=ft*(1-it)*16384+.5|0)-(ct=(1-ft)*it*16384+.5|0),vt=0,bt=0,pt=0,Z=0;Z<n;++Z)for(L=(S=(Z+Q)*w+D|0)<<1,U=(I=Z*n|0)<<1,W=0;W<n;++W,++S,++I,L+=2)dt=(dt=p[S]*st+p[S+1]*ht+p[S+w]*ct+p[S+w+1]*ut)+256>>9,_t=(_t=O[L]*st+O[L+2]*ht+O[L+R]*ct+O[L+R+2]*ut)+8192>>14,lt=(lt=O[L+1]*st+O[L+3]*ht+O[L+R+1]*ct+O[L+R+3]*ut)+8192>>14,A[I]=dt,C[U++]=_t,C[U++]=lt,vt+=_t*_t,bt+=_t*lt,pt+=lt*lt;if(mt=(vt*=1/(1<<20))*(pt*=1/(1<<20))-(bt*=1/(1<<20))*bt,(pt+vt-Math.sqrt((vt-pt)*(vt-pt)+4*bt*bt))/l<u||mt<1.1920929e-7)0==$&&(h[tt]=0);else for(mt=1/mt,N-=d,V-=d,E=0,P=0,at=0;at<s;++at){if(0!=(W=(X=0|N)<=0|X>=rt|(H=0|V)<=0|H>=et)){0==$&&(h[tt]=0);break}for(ut=16384-(st=(1-(ft=N-X))*(1-(it=V-H))*16384+.5|0)-(ht=ft*(1-it)*16384+.5|0)-(ct=(1-ft)*it*16384+.5|0),ot=0,nt=0,Z=0;Z<n;++Z)for(q=(Z+H)*w+X|0,U=(I=Z*n|0)<<1,W=0;W<n;++W,++q,++I)dt=(dt=m[q]*st+m[q+1]*ht+m[q+w]*ct+m[q+w+1]*ut)+256>>9,ot+=(dt-=A[I])*C[U++],nt+=dt*C[U++];if(N+=T=(bt*(nt*=1/(1<<20))-pt*(ot*=1/(1<<20)))*mt,V+=Y=(bt*ot-vt*nt)*mt,i[J]=N+d,i[K]=V+d,T*T+Y*Y<=c)break;if(at>0&&Math.abs(T+E)<.01&&Math.abs(Y+P)<.01){i[J]-=.5*T,i[K]-=.5*Y;break}E=T,P=Y}}else 0==$&&(h[tt]=0);t.cache.put_buffer(g),t.cache.put_buffer(k),t.cache.put_buffer(z)}}),z=function(t,a){var r=.25*t.width+.5|0;return a.x<=t.x+r&&a.x>=t.x-r&&a.y<=t.y+r&&a.y>=t.y-r&&a.width<=1.5*t.width+.5|0&&1.5*a.width+.5|0>=t.width};const j=function(t,a,r,e,f,i,o,n){var s,h,c,u,d,_,l,v,b,p,m,x,y,w,M,g,k,z,j,A,C,O,R,S,L,I=n.size[0]*o|0,U=n.size[1]*o|0,q=.5*o+1.5|0,G=q,B=f-I|0,F=i-U|0,N=f+1|0,V=1/(I*U),E=!0,P=0,T=I,Y=U*N,D=Y+I,Q=I*U*255*.07|0,X=[];for(d=0;d<F;d+=G)for(P=d*N,u=0;u<B;u+=q,P+=q)if(_=t[P]-t[P+T]-t[P+Y]+t[P+D],e&&(e[P]-e[P+T]-e[P+Y]+e[P+D]<Q||_<20))u+=q,P+=q;else{for(_*=V,v=(l=(a[P]-a[P+T]-a[P+Y]+a[P+D])*V-_*_)>0?Math.sqrt(l):1,y=(b=n.complexClassifiers).length,E=!0,s=0;s<y;++s){for(g=(p=b[s]).threshold,w=(m=p.simpleClassifiers).length,k=0,h=0;h<w;++h){if(z=0,M=(A=(x=m[h]).features).length,1===x.tilted)for(c=0;c<M;++c)C=~~(u+(j=A[c])[0]*o)+~~(d+j[1]*o)*N,O=(S=~~(j[2]*o))*N,R=(L=~~(j[3]*o))*N,z+=(r[C]-r[C+S+O]-r[C-L+R]+r[C+S-L+O+R])*j[4];else for(c=0;c<M;++c)C=~~(u+(j=A[c])[0]*o)+~~(d+j[1]*o)*N,S=~~(j[2]*o),R=(L=~~(j[3]*o))*N,z+=(t[C]-t[C+S]-t[C+R]+t[C+R+S])*j[4];k+=z*V<x.threshold*v?x.left_val:x.right_val}if(k<g){E=!1;break}}E&&(X.push({x:u,y:d,width:I,height:U,neighbor:1,confidence:k}),u+=q,P+=q)}return X};var A=Object.freeze({__proto__:null,edges_density:.07,detect_single_scale:j,detect_multi_scale:function(t,a,r,e,f,i,o,n,s){void 0===n&&(n=1.2),void 0===s&&(s=1);for(var h=o.size[0],c=o.size[1],u=[];s*h<f&&s*c<i;)u=u.concat(j(t,a,r,e,f,i,s,o)),s*=n;return u},group_rectangles:function(t,a){void 0===a&&(a=1);var r,e,f=t.length,i=[];for(r=0;r<f;++r)i[r]={parent:-1,element:t[r],rank:0};for(r=0;r<f;++r)if(i[r].element){for(var o=r;-1!=i[o].parent;)o=i[o].parent;for(e=0;e<f;++e)if(r!=e&&i[e].element&&z(i[r].element,i[e].element)){for(var n=e;-1!=i[n].parent;)n=i[n].parent;if(n!=o){i[o].rank>i[n].rank?i[n].parent=o:(i[o].parent=n,i[o].rank==i[n].rank&&i[n].rank++,o=n);for(var s,h=e;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=o;for(h=r;-1!=i[h].parent;)s=h,h=i[h].parent,i[s].parent=o}}}var c=[],u=0;for(r=0;r<f;r++){e=-1;var d=r;if(i[d].element){for(;-1!=i[d].parent;)d=i[d].parent;i[d].rank>=0&&(i[d].rank=~u++),e=~i[d].rank}c[r]=e}var _=[];for(r=0;r<u+1;++r)_[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<f;++r){var l=t[r],v=c[r];0==_[v].neighbors&&(_[v].confidence=l.confidence),++_[v].neighbors,_[v].x+=l.x,_[v].y+=l.y,_[v].width+=l.width,_[v].height+=l.height,_[v].confidence=Math.max(_[v].confidence,l.confidence)}var b=[];for(r=0;r<u;++r)(f=_[r].neighbors)>=a&&b.push({x:(2*_[r].x+f)/(2*f),y:(2*_[r].y+f)/(2*f),width:(2*_[r].width+f)/(2*f),height:(2*_[r].height+f)/(2*f),neighbors:_[r].neighbors,confidence:_[r].confidence});var p=[];for(f=b.length,r=0;r<f;++r){l=b[r];var m=!0;for(e=0;e<f;++e){var x=b[e],y=.25*x.width+.5|0;if(r!=e&&l.x>=x.x-y&&l.y>=x.y-y&&l.x+l.width<=x.x+x.width+y&&l.y+l.height<=x.y+x.height+y&&(x.neighbors>Math.max(3,l.neighbors)||l.neighbors<3)){m=!1;break}}m&&p.push(l)}return p}});return function(e){var f=function(){var e=function(t,a){var r=.25*t.width+.5|0;return a.x<=t.x+r&&a.x>=t.x-r&&a.y<=t.y+r&&a.y>=t.y-r&&a.width<=1.5*t.width+.5|0&&1.5*a.width+.5|0>=t.width},f=new t.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var a=t.stage_classifier.length,r=0;r<a;r++)for(var e=t.stage_classifier[r].feature,f=t.stage_classifier[r].count,i=t.stage_classifier[r]._feature=new Array(f),o=0;o<f;o++)i[o]={size:e[o].size,px:new Array(e[o].size),pz:new Array(e[o].size),nx:new Array(e[o].size),nz:new Array(e[o].size)}},build_pyramid:function(e,i,o,n){void 0===n&&(n=4);var s=e.cols,h=e.rows,c=0,u=0,d=0,_=!1,l=e,v=e,b=t.U8_t|t.C1_t;this.interval=n,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(s/i,h/o))/Math.log(this.scale)|0;var p=4*(this.scale_to+2*this.next)|0;for(f.levels!=p&&(f.levels=p,f.data=new Array(p),_=!0,f.data[0]=e),c=1;c<=this.interval;++c)u=s/Math.pow(this.scale,c)|0,d=h/Math.pow(this.scale,c)|0,l=f.data[c<<2],(_||u!=l.cols||d!=l.rows)&&(f.data[c<<2]=new t.matrix_t(u,d,b),l=f.data[c<<2]),a(e,l,u,d);for(c=this.next;c<this.scale_to+2*this.next;++c)v=f.data[(c<<2)-(this.next<<2)],l=f.data[c<<2],u=v.cols>>1,d=v.rows>>1,(_||u!=l.cols||d!=l.rows)&&(f.data[c<<2]=new t.matrix_t(u,d,b),l=f.data[c<<2]),r(v,l);for(c=2*this.next;c<this.scale_to+2*this.next;++c)u=(v=f.data[(c<<2)-(this.next<<2)]).cols>>1,d=v.rows>>1,l=f.data[1+(c<<2)],(_||u!=l.cols||d!=l.rows)&&(f.data[1+(c<<2)]=new t.matrix_t(u,d,b),l=f.data[1+(c<<2)]),r(v,l,1,0),l=f.data[2+(c<<2)],(_||u!=l.cols||d!=l.rows)&&(f.data[2+(c<<2)]=new t.matrix_t(u,d,b),l=f.data[2+(c<<2)]),r(v,l,0,1),l=f.data[3+(c<<2)],(_||u!=l.cols||d!=l.rows)&&(f.data[3+(c<<2)]=new t.matrix_t(u,d,b),l=f.data[3+(c<<2)]),r(v,l,1,1);return f},detect:function(t,a){this.interval;var r,e,f,i,o,n=this.scale,s=this.next,h=this.scale_to,c=0,u=0,d=0,_=0,l=0,v=0,b=0,p=0,m=0,x=0,y=0,w=0,M=0,g=0,k=0,z=0,j=0,A=0,C=!0,O=!0,R=1,S=1,L=[0,1,0,1],I=[0,0,1,1],U=[],q=t.data,G=[],B=[0,0,0],F=[0,0,0],N=[0,0,0];for(c=0;c<h;c++){for(z=q[(k=c<<2)+(s<<3)].cols-(a.width>>2),j=q[k+(s<<3)].rows-(a.height>>2),F[0]=1*q[k].cols,F[1]=1*q[k+(s<<2)].cols,F[2]=1*q[k+(s<<3)].cols,N[0]=4*q[k].cols-4*z,N[1]=2*q[k+(s<<2)].cols-2*z,N[2]=1*q[k+(s<<3)].cols-1*z,p=a.stage_classifier.length,u=0;u<p;u++)for(f=a.stage_classifier[u].feature,e=a.stage_classifier[u]._feature,m=a.stage_classifier[u].count,d=0;d<m;d++)for(i=e[d],x=0|(o=f[d]).size,b=0;b<x;b++)i.px[b]=1*o.px[b]+o.py[b]*F[o.pz[b]],i.pz[b]=o.pz[b],i.nx[b]=1*o.nx[b]+o.ny[b]*F[o.nz[b]],i.nz[b]=o.nz[b];for(G[0]=q[k].data,G[1]=q[k+(s<<2)].data,b=0;b<4;b++)for(G[2]=q[k+(s<<3)+b].data,B[0]=2*L[b]+I[b]*(2*q[k].cols),B[1]=1*L[b]+I[b]*(1*q[k+(s<<2)].cols),B[2]=0,v=0;v<j;v++){for(l=0;l<z;l++){for(A=0,C=!0,p=a.stage_classifier.length,u=0;u<p;u++){for(A=0,r=a.stage_classifier[u].alpha,e=a.stage_classifier[u]._feature,m=a.stage_classifier[u].count,d=0;d<m;d++)if((w=G[(i=e[d]).pz[0]][B[i.pz[0]]+i.px[0]])<=(M=G[i.nz[0]][B[i.nz[0]]+i.nx[0]]))A+=r[d<<1];else{for(O=!0,x=i.size,g=1;g<x;g++){if(i.pz[g]>=0&&(y=G[i.pz[g]][B[i.pz[g]]+i.px[g]])<w){if(y<=M){O=!1;break}w=y}if(i.nz[g]>=0&&(_=G[i.nz[g]][B[i.nz[g]]+i.nx[g]])>M){if(w<=_){O=!1;break}M=_}}A+=O?r[1+(d<<1)]:r[d<<1]}if(A<a.stage_classifier[u].threshold){C=!1;break}}C&&(U.push({x:(4*l+2*L[b])*R,y:(4*v+2*I[b])*S,width:a.width*R,height:a.height*S,neighbor:1,confidence:A}),++l,B[0]+=4,B[1]+=2,B[2]+=1),B[0]+=4,B[1]+=2,B[2]+=1}B[0]+=N[0],B[1]+=N[1],B[2]+=N[2]}R*=n,S*=n}return U},group_rectangles:function(t,a){void 0===a&&(a=1);var r,f,i=t.length,o=[];for(r=0;r<i;++r)o[r]={parent:-1,element:t[r],rank:0};for(r=0;r<i;++r)if(o[r].element){for(var n=r;-1!=o[n].parent;)n=o[n].parent;for(f=0;f<i;++f)if(r!=f&&o[f].element&&e(o[r].element,o[f].element)){for(var s=f;-1!=o[s].parent;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var h,c=f;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=n;for(c=r;-1!=o[c].parent;)h=c,c=o[c].parent,o[h].parent=n}}}var u=[],d=0;for(r=0;r<i;r++){f=-1;var _=r;if(o[_].element){for(;-1!=o[_].parent;)_=o[_].parent;o[_].rank>=0&&(o[_].rank=~d++),f=~o[_].rank}u[r]=f}var l=[];for(r=0;r<d+1;++r)l[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<i;++r){var v=t[r],b=u[r];0==l[b].neighbors&&(l[b].confidence=v.confidence),++l[b].neighbors,l[b].x+=v.x,l[b].y+=v.y,l[b].width+=v.width,l[b].height+=v.height,l[b].confidence=Math.max(l[b].confidence,v.confidence)}var p=[];for(r=0;r<d;++r)(i=l[r].neighbors)>=a&&p.push({x:(2*l[r].x+i)/(2*i),y:(2*l[r].y+i)/(2*i),width:(2*l[r].width+i)/(2*i),height:(2*l[r].height+i)/(2*i),neighbors:l[r].neighbors,confidence:l[r].confidence});var m=[];for(i=p.length,r=0;r<i;++r){v=p[r];var x=!0;for(f=0;f<i;++f){var y=p[f],w=.25*y.width+.5|0;if(r!=f&&v.x>=y.x-w&&v.y>=y.y-w&&v.x+v.width<=y.x+y.width+w&&v.y+v.height<=y.y+y.height+w&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){x=!1;break}}x&&m.push(v)}return m}}}();e.bbf=f}(t),t.imgproc=v,t.fast_corners=g,t.optical_flow_lk=k,t.haar=A,t}));
